0F1D40639BE11BAB0E024BE808D65CD6BA671","pipeline":{"afterLFSR":"278B446A0E9C2B5CCC73E4B937B15EB9277CA1C7A4921F4726DF675B656453F8","afterSalt":"48522D36312053504F322D39352053544550532D3533354D50","afterTinkerbell":"C41D8D144B89B57F9C363AB763ED2E38A4856BF408144948A519F6E0F1D41834","afterTransposition":"1DC448494B89148D369C382E63EDB73A85A47FB50814F46B1834A519F6E0F1D4"},"plaintext":"HR-61 SPO2-95 STEPS-535","serverTime":1769528151604,"timestamp":102426,"type":"encryption_update","ztmEnabled":false}
21:05:52.093 > [WebSocket] Processing message type: encryption_update
21:05:52.099 > [104.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:52.206 > [WebSocket] Received (87 bytes): {"heartRate":61,"spo2":95,"steps":535,"time":1769528151604,"type":"health_data_update"}
21:05:52.213 > [WebSocket] Processing message type: health_data_update
21:05:52.220 > [104.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:52.328 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":4.8798,"encryptionTime":0.0,"finalPlaintext":"HR-61 SPO2-95 STEPS-535","handshakeSuccess":true,"totalTime":4.8798},"type":"session_summary_update"}
21:05:52.350 > [WebSocket] Processing message type: session_summary_update
21:05:52.355 > [104.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:05:52.461 > [WebSocket] Received (656 bytes): {"decryptionTime":4.8798,"encryptedPacket":"8102170017000408000000011DC448494B89148D369C382E63EDB73A85A47FB50814F46B1834A519F6E0F1D40639BE11BAB0E024BE808D65CD6BA671","finalPlaintext":"HR-61 SPO2-95 STEPS-535","healthData":{"heartRate":61,"spo2":95,"steps":535},"pipeline":{"afterDepad":"48522D36312053504F322D39352053544550532D353335CDEED454CDEED4","afterLFSR":"48522D36312053504F322D39352053544550532D3533354D04CDEED454CDEED4","afterTinkerbell":"278B446A0E9C2B5CCC73E4B937B15EB9277CA1C7A4921F477212898F31A9BD2C","afterTransposition":"C41D8D144B89B57F9C363AB763ED2E38A4856BF408144948F1D41834A519F6E0"},"serverTime":1769528151608,"type":"decryption_update"}
21:05:52.519 > [WebSocket] Processing message type: decryption_update
21:05:52.526 > [WebSocket] Server decryption completed
21:05:52.528 > [WebSocket] Health data - HR: 61, SPO2: 95, Steps: 535
21:05:52.534 > [104.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:05:52.635 > [WebSocket] Received (694 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","deviceId":"f9641d44","healthSendCount":0,"pipeline":{"afterLFSR":"278B446A0E9C2B5CCC73E4B937B15EB9277CA1C7A4921F4726DF675B656453F8","afterSalt":"48522D36312053504F322D39352053544550532D3533354D50","afterTinkerbell":"C41D8D144B89B57F9C363AB763ED2E38A4856BF408144948A519F6E0F1D41834","afterTransposition":"1DC448494B89148D369C382E63EDB73A85A47FB50814F46B1834A519F6E0F1D4","finalPacket":"8102170017000408000000011DC448494B89148D369C382E63EDB73A85A47FB50814F46B1834A519F6E0F1D40639BE11BAB0E024BE808D65CD6BA671"},"plaintext":"HR-61 SPO2-95 STEPS-535","timestamp":103988,"type":"encryption_pipeline","ztmEnabled":false}
21:05:52.696 > [WebSocket] Processing message type: encryption_pipeline
21:05:52.702 > [104.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:05:52.809 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":0,"message":"Health data #1 sent successfully","state":7,"success":true,"timestamp":103993,"type":"health_data_sent"}
21:05:52.826 > [WebSocket] Processing message type: health_data_sent
21:05:52.829 > [105.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:05:52.931 > [105.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.033 > [105.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.133 > [105.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.235 > [105.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.336 > [105.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.436 > [105.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.538 > [105.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.639 > [105.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.740 > [105.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.841 > [106.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:53.942 > [106.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.042 > [106.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.144 > [106.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.245 > [106.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.346 > [106.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.447 > [106.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.548 > [106.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.648 > [106.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.750 > [107.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.851 > [107.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:54.951 > [107.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.053 > [107.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.154 > [107.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.255 > [107.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.356 > [107.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.456 > [107.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.558 > [107.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.659 > [107.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.760 > [108.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.861 > [108.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:55.961 > [108.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.063 > [108.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.164 > [108.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.263 > [108.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.365 > [108.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.467 > [108.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.568 > [108.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.668 > [108.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.770 > [109.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.870 > [109.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:56.972 > [109.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.073 > [109.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.173 > [109.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.275 > [109.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.376 > [109.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.477 > [109.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.577 > [109.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.677 > [109.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.779 > [110.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.881 > [110.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:57.982 > [110.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.083 > [110.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.184 > [110.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.285 > [110.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.386 > [110.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.487 > [110.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.588 > [110.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.688 > [110.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.789 > [111.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.891 > [111.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:58.992 > [111.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.093 > [111.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.194 > [111.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.294 > [111.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.396 > [111.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.497 > [111.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.598 > [111.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.698 > [111.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.799 > [112.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:05:59.900 > [112.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.001 > [112.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.103 > [112.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.204 > [112.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.305 > [112.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.406 > [112.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.507 > [112.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.608 > [112.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.709 > [112.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.810 > [113.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:00.911 > [113.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.011 > [113.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.113 > [113.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.213 > [113.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.314 > [113.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.415 > [113.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.516 > [113.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.617 > [113.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.718 > [113.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.819 > [114.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:01.825 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:01.830 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:06:01.836 > Generated health data: HR-61 SPO2-95 STEPS-586
21:06:01.839 > [ESP32] ========================================
21:06:01.844 > [ESP32] ENCRYPTION PIPELINE START
21:06:01.846 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:01.855 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:01.861 > [ESP32] ========================================
21:06:01.866 > [ESP32] MsgKeys: lfsrSeed=0x76B5A320 tnk[0..3]=9B9590F9 trn[0..3]=E8DFA652
21:06:01.873 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3538364D50
21:06:01.877 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3538364D5000000000000000 
21:06:01.886 > [ESP32][LFSR] Initializing - Seed: 0x76B5A320 SeedBe: 0x20A3B576 ChaosKey[0..3]: 9B9590F9 InitialTap: 0x0029 State: 0x76B5A320
21:06:01.897 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
21:06:01.906 > 3_After_LFSR (32): 68F19840BDB02E0BBC9A6E7A2068894C BDEC4EEFBBFE98C0CA346DD49E54E203
21:06:01.914 > [ESP32][LFSR] Keystream (first 16 bytes): 20A3B5768C907D5BF3A843431548DA18
21:06:01.920 > [ESP32][TINKERBELL] Input (first 16 bytes): 68F19840BDB02E0BBC9A6E7A2068894C Nonce: 0x00000002 Buffer size: 32 bytes
21:06:01.931 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 9B9590F9
21:06:01.939 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:01.946 > 4_After_Tinkerbell (32): 678FC7692332A95631B52CB3B96CC2FF 8D8CB77B587802B47735149716760A31 
21:06:01.955 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:01.964 > 5_After_Transposition (32): B4027858A9562332678FC76916760A31 B96CC2FF143597777B8CB78D312CB5B3 
21:06:01.972 > [ESP32] === HMAC DEBUG INFO ===
21:06:01.975 > [ESP32] HMAC Key being used: 5EF9CDBE8899BDCABB6F04914E1C7A5D24926FFBD8A7300240B2805FDE78D6E4
21:06:01.983 > [ESP32] HMAC Input length: 44 bytes
21:06:01.986 > [ESP32] HMAC Input (first 32 bytes): 810217001700040800000002B4027858A9562332678FC76916760A31B96CC2FF
21:06:01.994 > [ESP32] Nonce: 0x00000002
21:06:01.997 > [ESP32] Packet size before HMAC: 60
21:06:02.000 > [ESP32] Computed HMAC Tag: 203492A33B32158B31BA8024ED520FB1
21:06:02.005 > [ESP32] === END HMAC DEBUG ===
21:06:02.009 > 6_Final_Packet (60): 810217001700040800000002B4027858 A9562332678FC76916760A31B96CC2FF ...
21:06:02.017 > [RETRY] Attempt 1/3 (nonce: 2)
21:06:02.020 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:02.026 > Sending pipeline data to server (655 bytes)
21:06:03.540 > [HTTP] Response code: 400
21:06:03.540 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:03.545 > [HTTP] Request failed with code: 400
21:06:03.548 > [RETRY] Send failed, waiting 100 ms before retry
21:06:03.648 > [RETRY] Attempt 2/3 (nonce: 2)
21:06:03.648 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:03.654 > Sending pipeline data to server (655 bytes)
21:06:03.789 > [HTTP] Response code: 400
21:06:03.789 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:03.795 > [HTTP] Request failed with code: 400
21:06:03.798 > [RETRY] Send failed, waiting 200 ms before retry
21:06:03.997 > [RETRY] Attempt 3/3 (nonce: 2)
21:06:03.997 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:04.002 > Sending pipeline data to server (655 bytes)
21:06:05.544 > [HTTP] Response code: 400
21:06:05.544 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:05.551 > [HTTP] Request failed with code: 400
21:06:05.553 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:06:05.559 > [RETRY] Consecutive failures: 1
21:06:05.561 > Health data send failed (retry count: 1/3)
21:06:05.666 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":115746,"type":"health_data_error"}
21:06:05.681 > [WebSocket] Processing message type: health_data_error
21:06:05.686 > [117.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:05.694 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:05.700 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:06:05.705 > Generated health data: HR-61 SPO2-95 STEPS-618
21:06:05.709 > [ESP32] ========================================
21:06:05.714 > [ESP32] ENCRYPTION PIPELINE START
21:06:05.717 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:05.723 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:05.731 > [ESP32] ========================================
21:06:05.734 > [ESP32] MsgKeys: lfsrSeed=0x76B5A320 tnk[0..3]=9B9590F9 trn[0..3]=E8DFA652
21:06:05.739 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3631384D50
21:06:05.748 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3631384D5000000000000000
21:06:05.755 > [ESP32][LFSR] Initializing - Seed: 0x76B5A320 SeedBe: 0x20A3B576 ChaosKey[0..3]: 9B9590F9 InitialTap: 0x0029 State: 0x76B5A320
21:06:05.767 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
21:06:05.773 > 3_After_LFSR (32): 68F19840BDB02E0BBC9A6E7A2068894C BDEC4EEFB8F796C0CA346DD49E54E203
21:06:05.780 > [ESP32][LFSR] Keystream (first 16 bytes): 20A3B5768C907D5BF3A843431548DA18
21:06:05.789 > [ESP32][TINKERBELL] Input (first 16 bytes): 68F19840BDB02E0BBC9A6E7A2068894C Nonce: 0x00000002 Buffer size: 32 bytes
21:06:05.797 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 9B9590F9
21:06:05.809 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:05.817 > 4_After_Tinkerbell (32): 678FC7692332A95631B52CB3B96CC2FF 8D8CB77B5B710CB47735149716760A31
21:06:05.825 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:05.831 > 5_After_Transposition (32): B40C715BA9562332678FC76916760A31 B96CC2FF143597777B8CB78D312CB5B3 
21:06:05.839 > [ESP32] === HMAC DEBUG INFO ===
21:06:05.842 > [ESP32] HMAC Key being used: 5EF9CDBE8899BDCABB6F04914E1C7A5D24926FFBD8A7300240B2805FDE78D6E4
21:06:05.850 > [ESP32] HMAC Input length: 44 bytes
21:06:05.852 > [ESP32] HMAC Input (first 32 bytes): 810217001700040800000002B40C715BA9562332678FC76916760A31B96CC2FF
21:06:05.864 > [ESP32] Nonce: 0x00000002
21:06:05.867 > [ESP32] Packet size before HMAC: 60
21:06:05.870 > [ESP32] Computed HMAC Tag: DC8D29125C784F5D59D984B9B9DE4229
21:06:05.875 > [ESP32] === END HMAC DEBUG ===
21:06:05.878 > 6_Final_Packet (60): 810217001700040800000002B40C715B A9562332678FC76916760A31B96CC2FF ...
21:06:05.883 > [RETRY] Attempt 1/3 (nonce: 2)
21:06:05.886 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:05.892 > Sending pipeline data to server (655 bytes)
21:06:09.079 > [HTTP] Response code: 400
21:06:09.079 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:09.084 > [HTTP] Request failed with code: 400
21:06:09.087 > [RETRY] Send failed, waiting 100 ms before retry
21:06:09.186 > [RETRY] Attempt 2/3 (nonce: 2)
21:06:09.186 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:09.191 > Sending pipeline data to server (655 bytes)
21:06:09.316 > [HTTP] Response code: 400
21:06:09.316 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:09.322 > [HTTP] Request failed with code: 400
21:06:09.324 > [RETRY] Send failed, waiting 200 ms before retry
21:06:09.524 > [RETRY] Attempt 3/3 (nonce: 2)
21:06:09.524 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:09.530 > Sending pipeline data to server (655 bytes)
21:06:11.101 > [HTTP] Response code: 400
21:06:11.101 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:11.106 > [HTTP] Request failed with code: 400
21:06:11.109 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:06:11.114 > [RETRY] Consecutive failures: 2
21:06:11.117 > Health data send failed (retry count: 2/3)
21:06:11.220 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":115996,"type":"health_data_error"}
21:06:11.233 > [WebSocket] Processing message type: health_data_error
21:06:11.239 > [123.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:11.247 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:11.253 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:06:11.259 > Generated health data: HR-62 SPO2-95 STEPS-626
21:06:11.261 > [ESP32] ========================================
21:06:11.267 > [ESP32] ENCRYPTION PIPELINE START
21:06:11.269 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:11.274 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:11.284 > [ESP32] ========================================
21:06:11.286 > [ESP32] MsgKeys: lfsrSeed=0x76B5A320 tnk[0..3]=9B9590F9 trn[0..3]=E8DFA652
21:06:11.292 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3632364D50
21:06:11.300 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3632364D5000000000000000 
21:06:11.308 > [ESP32][LFSR] Initializing - Seed: 0x76B5A320 SeedBe: 0x20A3B576 ChaosKey[0..3]: 9B9590F9 InitialTap: 0x0029 State: 0x76B5A320
21:06:11.319 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:11.325 > 3_After_LFSR (32): 68F19840BEB02E0BBC9A6E7A2068894C BDEC4EEFB8F498C0CA346DD49E54E203
21:06:11.333 > [ESP32][LFSR] Keystream (first 16 bytes): 20A3B5768C907D5BF3A843431548DA18
21:06:11.342 > [ESP32][TINKERBELL] Input (first 16 bytes): 68F19840BEB02E0BBC9A6E7A2068894C Nonce: 0x00000002 Buffer size: 32 bytes
21:06:11.350 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 9B9590F9
21:06:11.362 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:11.370 > 4_After_Tinkerbell (32): 678FC7692032A95631B52CB3B96CC2FF 8D8CB77B5B7202B47735149716760A31
21:06:11.378 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:11.383 > 5_After_Transposition (32): B402725BA9562032678FC76916760A31 B96CC2FF143597777B8CB78D312CB5B3        
21:06:11.392 > [ESP32] === HMAC DEBUG INFO ===
21:06:11.395 > [ESP32] HMAC Key being used: 5EF9CDBE8899BDCABB6F04914E1C7A5D24926FFBD8A7300240B2805FDE78D6E4
21:06:11.402 > [ESP32] HMAC Input length: 44 bytes
21:06:11.405 > [ESP32] HMAC Input (first 32 bytes): 810217001700040800000002B402725BA9562032678FC76916760A31B96CC2FF
21:06:11.417 > [ESP32] Nonce: 0x00000002
21:06:11.420 > [ESP32] Packet size before HMAC: 60
21:06:11.423 > [ESP32] Computed HMAC Tag: 75993AD6CE02C7B2C349CA1657DEACE3
21:06:11.428 > [ESP32] === END HMAC DEBUG ===
21:06:11.430 > 6_Final_Packet (60): 810217001700040800000002B402725B A9562032678FC76916760A31B96CC2FF ...
21:06:11.436 > [RETRY] Attempt 1/3 (nonce: 2)
21:06:11.438 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:11.445 > Sending pipeline data to server (655 bytes)
21:06:14.568 > [HTTP] Response code: 400
21:06:14.568 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:14.574 > [HTTP] Request failed with code: 400
21:06:14.576 > [RETRY] Send failed, waiting 100 ms before retry
21:06:14.676 > [RETRY] Attempt 2/3 (nonce: 2)
21:06:14.676 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:14.682 > Sending pipeline data to server (655 bytes)
21:06:14.819 > [HTTP] Response code: 400
21:06:14.819 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:14.825 > [HTTP] Request failed with code: 400
21:06:14.827 > [RETRY] Send failed, waiting 200 ms before retry
21:06:15.026 > [RETRY] Attempt 3/3 (nonce: 2)
21:06:15.027 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:15.033 > Sending pipeline data to server (655 bytes)
21:06:16.583 > [HTTP] Response code: 400
21:06:16.583 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:16.588 > [HTTP] Request failed with code: 400
21:06:16.591 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:06:16.597 > [RETRY] Consecutive failures: 3
21:06:16.600 > Health data send failed (retry count: 3/3)
21:06:16.602 > Health data transmission failed after max retries
21:06:16.702 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":117751,"type":"health_data_error"}
21:06:16.716 > [WebSocket] Processing message type: health_data_error
21:06:16.722 > [128.9] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:16.730 > ERROR state - attempting recovery
21:06:16.733 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:16.739 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:06:16.742 > Generated health data: HR-62 SPO2-95 STEPS-643
21:06:16.747 > [ESP32] ========================================
21:06:16.750 > [ESP32] ENCRYPTION PIPELINE START
21:06:16.752 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:16.761 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:16.766 > [ESP32] ========================================
21:06:16.772 > [ESP32] MsgKeys: lfsrSeed=0x76B5A320 tnk[0..3]=9B9590F9 trn[0..3]=E8DFA652
21:06:16.777 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3634334D50
21:06:16.783 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3634334D5000000000000000
21:06:16.792 > [ESP32][LFSR] Initializing - Seed: 0x76B5A320 SeedBe: 0x20A3B576 ChaosKey[0..3]: 9B9590F9 InitialTap: 0x0029 State: 0x76B5A320
21:06:16.803 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:16.811 > 3_After_LFSR (32): 68F19840BEB02E0BBC9A6E7A2068894C BDEC4EEFB8F29DC0CA346DD49E54E203 
21:06:16.819 > [ESP32][LFSR] Keystream (first 16 bytes): 20A3B5768C907D5BF3A843431548DA18
21:06:16.824 > [ESP32][TINKERBELL] Input (first 16 bytes): 68F19840BEB02E0BBC9A6E7A2068894C Nonce: 0x00000002 Buffer size: 32 bytes
21:06:16.836 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 9B9590F9
21:06:16.847 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:16.853 > 4_After_Tinkerbell (32): 678FC7692032A95631B52CB3B96CC2FF 8D8CB77B5B7407B47735149716760A31 
21:06:16.861 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 0F7E5F299E82875D8D2F42C999044BB3
21:06:16.869 > 5_After_Transposition (32): B407745BA9562032678FC76916760A31 B96CC2FF143597777B8CB78D312CB5B3 
21:06:16.877 > [ESP32] === HMAC DEBUG INFO ===
21:06:16.880 > [ESP32] HMAC Key being used: 5EF9CDBE8899BDCABB6F04914E1C7A5D24926FFBD8A7300240B2805FDE78D6E4        
21:06:16.889 > [ESP32] HMAC Input length: 44 bytes
21:06:16.892 > [ESP32] HMAC Input (first 32 bytes): 810217001700040800000002B407745BA9562032678FC76916760A31B96CC2FF
21:06:16.900 > [ESP32] Nonce: 0x00000002
21:06:16.902 > [ESP32] Packet size before HMAC: 60
21:06:16.905 > [ESP32] Computed HMAC Tag: 840C160FF36FF88F33730683782DD9D1
21:06:16.911 > [ESP32] === END HMAC DEBUG ===
21:06:16.914 > 6_Final_Packet (60): 810217001700040800000002B407745B A9562032678FC76916760A31B96CC2FF ...
21:06:16.922 > [RETRY] Attempt 1/3 (nonce: 2)
21:06:16.925 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:16.930 > Sending pipeline data to server (655 bytes)
21:06:20.092 > [HTTP] Response code: 400
21:06:20.092 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:20.098 > [HTTP] Request failed with code: 400
21:06:20.100 > [RETRY] Send failed, waiting 100 ms before retry
21:06:20.201 > [RETRY] Attempt 2/3 (nonce: 2)
21:06:20.201 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:20.207 > Sending pipeline data to server (655 bytes)
21:06:21.460 > [HTTP] Response code: 400
21:06:21.460 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:21.465 > [HTTP] Request failed with code: 400
21:06:21.468 > [RETRY] Send failed, waiting 200 ms before retry
21:06:21.668 > [RETRY] Attempt 3/3 (nonce: 2)
21:06:21.669 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:21.674 > Sending pipeline data to server (655 bytes)
21:06:21.842 > [HTTP] Response code: 400
21:06:21.842 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:21.847 > [HTTP] Request failed with code: 400
21:06:21.850 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:06:21.855 > [RETRY] Consecutive failures: 4
21:06:21.858 > ✗ Auto-recovery failed - restarting key exchange
21:06:23.962 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":121285,"type":"health_data_error"}
21:06:23.976 > [WebSocket] Processing message type: health_data_error
21:06:23.982 > [136.2] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:23.990 > ✓ Public key loaded from NVS
21:06:24.088 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":121522,"type":"health_data_error"}
21:06:24.102 > [WebSocket] Processing message type: health_data_error
21:06:24.107 > [136.3] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:24.212 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":123307,"type":"health_data_error"}
21:06:24.224 > [WebSocket] Processing message type: health_data_error
21:06:24.231 > [136.4] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED      
21:06:24.238 > Generating fresh master key from entropy...
21:06:24.248 > Generated master key (32): 3EEE25D432A14DBE902D9A392FFED794 3AE4404E900A2DBB7417C86DE75D8CEF
21:06:24.253 > Using reduced master key (byte % 3) for NTRU encryption only
21:06:24.263 > NTRU encrypted master key (502): 00730069004E007F001A000B001D0072 00150077001300030020006D007C0004 ...
21:06:24.271 > POST http://10.249.92.115:8081/master-key
21:06:24.852 > ✓ Master key exchange completed
21:06:24.954 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":126775,"type":"health_data_error"}
21:06:24.968 > [WebSocket] Processing message type: health_data_error
21:06:24.974 > [137.2] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:24.983 > Loading master key from NVS and deriving symmetric keys...
21:06:24.988 > Loaded master key from NVS (32): 3EEE25D432A14DBE902D9A392FFED794 3AE4404E900A2DBB7417C86DE75D8CEF 
21:06:24.996 > Derived HMAC key (32): 72FDD391EDE8BA653F63E140B0C108B5 A933D2348A6F92EB485FBC50E514CAB3 
21:06:25.005 > Derived Tinkerbell key (16): 642685C79CEB5EE3B0B619148A507683
21:06:25.010 > Derived Transposition key (16): F47483B07FA7B678DCF599DD6677095A
21:06:25.016 > ✓ Symmetric keys derived successfully
21:06:25.018 > Nonce tracker reset - new session started
21:06:25.513 > Waiting for server to process master key...
21:06:25.518 > ✓ Symmetric keys ready - starting health data transmission
21:06:25.620 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":127025,"type":"health_data_error"}
21:06:25.634 > [WebSocket] Processing message type: health_data_error
21:06:25.640 > [137.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:25.743 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":128789,"type":"health_data_error"}
21:06:25.757 > [WebSocket] Processing message type: health_data_error
21:06:25.762 > [138.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:25.865 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":132299,"type":"health_data_error"}
21:06:25.879 > [WebSocket] Processing message type: health_data_error
21:06:25.885 > [138.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:25.988 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":133667,"type":"health_data_error"}
21:06:26.001 > [WebSocket] Processing message type: health_data_error
21:06:26.007 > [138.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:26.110 > [138.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.211 > [138.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.311 > [138.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.413 > [138.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.514 > [138.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.614 > [138.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.716 > [138.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.816 > [139.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:26.918 > [139.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.019 > [139.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.120 > [139.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.221 > [139.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.326 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":134049,"type":"health_data_error"}
21:06:27.340 > [WebSocket] Processing message type: health_data_error
21:06:27.345 > [139.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:27.448 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528184676,"type":"master_key_received"}
21:06:27.462 > [WebSocket] Processing message type: master_key_received
21:06:27.464 > [139.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.570 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":137052,"type":"master_key_exchanged"}        
21:06:27.587 > [WebSocket] Processing message type: master_key_exchanged
21:06:27.592 > [139.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:27.693 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":137721,"type":"symmetric_keys_derived"}
21:06:27.709 > [WebSocket] Processing message type: symmetric_keys_derived
21:06:27.714 > [139.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.815 > [140.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:27.916 > [140.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.017 > [140.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.118 > [140.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.218 > [140.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.320 > [140.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.421 > [140.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.522 > [140.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.623 > [140.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.724 > [140.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.825 > [141.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:28.926 > [141.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.026 > [141.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.128 > [141.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.229 > [141.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.330 > [141.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.431 > [141.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.532 > [141.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.633 > [141.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.734 > [141.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.835 > [142.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:29.935 > [142.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.037 > [142.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.138 > [142.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.239 > [142.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.340 > [142.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.441 > [142.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.542 > [142.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.643 > [142.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.743 > [142.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.845 > [143.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:30.945 > [143.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.047 > [143.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.147 > [143.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.249 > [143.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.348 > [143.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.450 > [143.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.552 > [143.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.652 > [143.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.753 > [144.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.855 > [144.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:31.955 > [144.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.057 > [144.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.157 > [144.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.259 > [144.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.359 > [144.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.461 > [144.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.562 > [144.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.662 > [144.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.764 > [145.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.864 > [145.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:32.965 > [145.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.067 > [145.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.167 > [145.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.268 > [145.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.370 > [145.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.471 > [145.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.572 > [145.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.673 > [145.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.774 > [146.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.875 > [146.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:33.975 > [146.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.076 > [146.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.177 > [146.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.279 > [146.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.380 > [146.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.480 > [146.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.582 > [146.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.683 > [146.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.784 > [147.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.884 > [147.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:34.986 > [147.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.086 > [147.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.188 > [147.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.288 > [147.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.390 > [147.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.491 > [147.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.592 > [147.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:35.597 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:35.603 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:06:35.608 > Generated health data: HR-62 SPO2-95 STEPS-741
21:06:35.611 > [ESP32] ========================================
21:06:35.616 > [ESP32] ENCRYPTION PIPELINE START
21:06:35.619 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:35.627 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:35.633 > [ESP32] ========================================
21:06:35.638 > [ESP32] MsgKeys: lfsrSeed=0x561AFB6B tnk[0..3]=487EAB1E trn[0..3]=5CC94F2D
21:06:35.644 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3734314D50
21:06:35.650 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3734314D5000000000000000 
21:06:35.658 > [ESP32][LFSR] Initializing - Seed: 0x561AFB6B SeedBe: 0x6BFB1A56 ChaosKey[0..3]: 487EAB1E InitialTap: 0x0029 State: 0x561AFB6B
21:06:35.668 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:35.677 > 3_After_LFSR (32): 23A93760CBE8917546D2CADDD07A9187 422AB648B541FE967218AE0434254E6A 
21:06:35.686 > [ESP32][LFSR] Keystream (first 16 bytes): 6BFB1A56F9C8C22509E0E7E4E55AC2D3
21:06:35.691 > [ESP32][TINKERBELL] Input (first 16 bytes): 23A93760CBE8917546D2CADDD07A9187 Nonce: 0x00000001 Buffer size: 32 bytes
21:06:35.703 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 487EAB1E
21:06:35.711 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:35.718 > 4_After_Tinkerbell (32): 95E6DDA797C6751F055414746E667ED4 10FEED4D3FA19BE073409A1B455BA817
21:06:35.727 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:35.736 > 5_After_Transposition (32): 1474751FDDA7666E1B9A540597C6455B A13FED4D95E617A810FE9BE0D47E4073        
21:06:35.744 > [ESP32] === HMAC DEBUG INFO ===
21:06:35.746 > [ESP32] HMAC Key being used: 72FDD391EDE8BA653F63E140B0C108B5A933D2348A6F92EB485FBC50E514CAB3        
21:06:35.756 > [ESP32] HMAC Input length: 44 bytes
21:06:35.758 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000011474751FDDA7666E1B9A540597C6455BA13FED4D
21:06:35.766 > [ESP32] Nonce: 0x00000001
21:06:35.769 > [ESP32] Packet size before HMAC: 60
21:06:35.771 > [ESP32] Computed HMAC Tag: ACDCE7D2564914159CC8B478D9AEEF29
21:06:35.777 > [ESP32] === END HMAC DEBUG ===
21:06:35.780 > 6_Final_Packet (60): 8102170017000408000000011474751F DDA7666E1B9A540597C6455BA13FED4D ...
21:06:35.788 > [RETRY] Attempt 1/3 (nonce: 1)
21:06:35.791 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:35.798 > Sending pipeline data to server (655 bytes)
21:06:37.352 > [HTTP] Response code: 400
21:06:37.352 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:37.358 > [HTTP] Request failed with code: 400
21:06:37.360 > [RETRY] Send failed, waiting 100 ms before retry
21:06:37.460 > [RETRY] Attempt 2/3 (nonce: 1)
21:06:37.461 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:37.465 > Sending pipeline data to server (655 bytes)
21:06:39.111 > [HTTP] Response code: 400
21:06:39.111 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:39.116 > [HTTP] Request failed with code: 400
21:06:39.118 > [RETRY] Send failed, waiting 200 ms before retry
21:06:39.320 > [RETRY] Attempt 3/3 (nonce: 1)
21:06:39.320 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:39.325 > Sending pipeline data to server (655 bytes)
21:06:40.165 > [HTTP] Response code: 400
21:06:40.165 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:40.170 > [HTTP] Request failed with code: 400
21:06:40.173 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:06:40.177 > [RETRY] Consecutive failures: 5
21:06:40.181 > [EMERGENCY] Triggering emergency reset!
21:06:40.183 > [CRYPTO] Resetting cryptographic state
21:06:40.189 > [CRYPTO] Crypto state reset complete
21:06:40.192 > [CRYPTO] Packet counter: 2
21:06:40.195 > [EMERGENCY] Emergency reset complete
21:06:40.197 > Health data send failed (retry count: 1/3)
21:06:40.296 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":149559,"type":"health_data_error"}
21:06:40.310 > [WebSocket] Processing message type: health_data_error
21:06:40.315 > [152.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:40.324 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:40.330 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:06:40.336 > Generated health data: HR-62 SPO2-95 STEPS-790
21:06:40.338 > [ESP32] ========================================
21:06:40.343 > [ESP32] ENCRYPTION PIPELINE START
21:06:40.346 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:40.352 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:40.360 > [ESP32] ========================================
21:06:40.363 > [ESP32] MsgKeys: lfsrSeed=0x561AFB6B tnk[0..3]=487EAB1E trn[0..3]=5CC94F2D
21:06:40.368 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3739304D50
21:06:40.377 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3739304D5000000000000000 
21:06:40.385 > [ESP32][LFSR] Initializing - Seed: 0x561AFB6B SeedBe: 0x6BFB1A56 ChaosKey[0..3]: 487EAB1E InitialTap: 0x0029 State: 0x561AFB6B
21:06:40.396 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:40.401 > 3_After_LFSR (32): 23A93760CBE8917546D2CADDD07A9187 422AB648B54CFF967218AE0434254E6A
21:06:40.410 > [ESP32][LFSR] Keystream (first 16 bytes): 6BFB1A56F9C8C22509E0E7E4E55AC2D3
21:06:40.418 > [ESP32][TINKERBELL] Input (first 16 bytes): 23A93760CBE8917546D2CADDD07A9187 Nonce: 0x00000001 Buffer size: 32 bytes
21:06:40.427 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 487EAB1E
21:06:40.438 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:40.446 > 4_After_Tinkerbell (32): 95E6DDA797C6751F055414746E667ED4 10FEED4D3FAC9AE073409A1B455BA817
21:06:40.455 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:40.460 > 5_After_Transposition (32): 1474751FDDA7666E1B9A540597C6455B AC3FED4D95E617A810FE9AE0D47E4073        
21:06:40.468 > [ESP32] === HMAC DEBUG INFO ===
21:06:40.472 > [ESP32] HMAC Key being used: 72FDD391EDE8BA653F63E140B0C108B5A933D2348A6F92EB485FBC50E514CAB3
21:06:40.480 > [ESP32] HMAC Input length: 44 bytes
21:06:40.483 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000011474751FDDA7666E1B9A540597C6455BAC3FED4D
21:06:40.493 > [ESP32] Nonce: 0x00000001
21:06:40.496 > [ESP32] Packet size before HMAC: 60
21:06:40.498 > [ESP32] Computed HMAC Tag: F4EF7B64837D36AA12036A1B60FA5DD4
21:06:40.505 > [ESP32] === END HMAC DEBUG ===
21:06:40.507 > 6_Final_Packet (60): 8102170017000408000000011474751F DDA7666E1B9A540597C6455BAC3FED4D ...
21:06:40.513 > [RETRY] Attempt 1/3 (nonce: 1)
21:06:40.515 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:40.521 > Sending pipeline data to server (655 bytes)
21:06:42.112 > [HTTP] Response code: 400
21:06:42.113 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:42.118 > [HTTP] Request failed with code: 400
21:06:42.121 > [RETRY] Send failed, waiting 100 ms before retry
21:06:42.221 > [RETRY] Attempt 2/3 (nonce: 1)
21:06:42.221 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:42.226 > Sending pipeline data to server (655 bytes)
21:06:42.391 > [HTTP] Response code: 400
21:06:42.392 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:42.398 > [HTTP] Request failed with code: 400
21:06:42.400 > [RETRY] Send failed, waiting 200 ms before retry
21:06:42.600 > [RETRY] Attempt 3/3 (nonce: 1)
21:06:42.600 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:42.605 > Sending pipeline data to server (655 bytes)
21:06:44.118 > [HTTP] Response code: 400
21:06:44.120 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:44.124 > [HTTP] Request failed with code: 400
21:06:44.127 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:06:44.133 > [RETRY] Consecutive failures: 1
21:06:44.135 > Health data send failed (retry count: 2/3)
21:06:44.240 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":151318,"type":"health_data_error"}
21:06:44.254 > [WebSocket] Processing message type: health_data_error
21:06:44.259 > [156.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:44.267 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:44.272 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:06:44.278 > Generated health data: HR-62 SPO2-95 STEPS-814
21:06:44.282 > [ESP32] ========================================
21:06:44.287 > [ESP32] ENCRYPTION PIPELINE START
21:06:44.290 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:44.295 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:44.303 > [ESP32] ========================================
21:06:44.306 > [ESP32] MsgKeys: lfsrSeed=0x561AFB6B tnk[0..3]=487EAB1E trn[0..3]=5CC94F2D
21:06:44.312 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3831344D50
21:06:44.320 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3831344D5000000000000000
21:06:44.329 > [ESP32][LFSR] Initializing - Seed: 0x561AFB6B SeedBe: 0x6BFB1A56 ChaosKey[0..3]: 487EAB1E InitialTap: 0x0029 State: 0x561AFB6B
21:06:44.340 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:44.345 > 3_After_LFSR (32): 23A93760CBE8917546D2CADDD07A9187 422AB648BA44FB967218AE0434254E6A 
21:06:44.353 > [ESP32][LFSR] Keystream (first 16 bytes): 6BFB1A56F9C8C22509E0E7E4E55AC2D3
21:06:44.361 > [ESP32][TINKERBELL] Input (first 16 bytes): 23A93760CBE8917546D2CADDD07A9187 Nonce: 0x00000001 Buffer size: 32 bytes
21:06:44.370 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 487EAB1E
21:06:44.381 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:44.390 > 4_After_Tinkerbell (32): 95E6DDA797C6751F055414746E667ED4 10FEED4D30A49EE073409A1B455BA817 
21:06:44.398 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:44.404 > 5_After_Transposition (32): 1474751FDDA7666E1B9A540597C6455B A430ED4D95E617A810FE9EE0D47E4073 
21:06:44.411 > [ESP32] === HMAC DEBUG INFO ===
21:06:44.415 > [ESP32] HMAC Key being used: 72FDD391EDE8BA653F63E140B0C108B5A933D2348A6F92EB485FBC50E514CAB3
21:06:44.423 > [ESP32] HMAC Input length: 44 bytes
21:06:44.426 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000011474751FDDA7666E1B9A540597C6455BA430ED4D
21:06:44.437 > [ESP32] Nonce: 0x00000001
21:06:44.440 > [ESP32] Packet size before HMAC: 60
21:06:44.442 > [ESP32] Computed HMAC Tag: C57773C7206378F88F12E48F0D946BE6
21:06:44.448 > [ESP32] === END HMAC DEBUG ===
21:06:44.451 > 6_Final_Packet (60): 8102170017000408000000011474751F DDA7666E1B9A540597C6455BA430ED4D ...
21:06:44.456 > [RETRY] Attempt 1/3 (nonce: 1)
21:06:44.459 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:44.465 > Sending pipeline data to server (655 bytes)
21:06:46.438 > [HTTP] Response code: 400
21:06:46.439 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:46.443 > [HTTP] Request failed with code: 400
21:06:46.447 > [RETRY] Send failed, waiting 100 ms before retry
21:06:46.547 > [RETRY] Attempt 2/3 (nonce: 1)
21:06:46.548 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:46.553 > Sending pipeline data to server (655 bytes)
21:06:48.129 > [HTTP] Response code: 400
21:06:48.129 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:48.135 > [HTTP] Request failed with code: 400
21:06:48.137 > [RETRY] Send failed, waiting 200 ms before retry
21:06:48.336 > [RETRY] Attempt 3/3 (nonce: 1)
21:06:48.336 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:48.341 > Sending pipeline data to server (655 bytes)
21:06:49.258 > [HTTP] Response code: 400
21:06:49.258 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:49.262 > [HTTP] Request failed with code: 400
21:06:49.265 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:06:49.271 > [RETRY] Consecutive failures: 2
21:06:49.274 > Health data send failed (retry count: 3/3)
21:06:49.276 > Health data transmission failed after max retries
21:06:49.378 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":152372,"type":"health_data_error"}
21:06:49.391 > [WebSocket] Processing message type: health_data_error
21:06:49.396 > [161.6] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:49.404 > ERROR state - attempting recovery
21:06:49.407 > [RETRY] Attempting to send health data (Max retries: 3)
21:06:49.413 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:06:49.415 > Generated health data: HR-62 SPO2-95 STEPS-815
21:06:49.422 > [ESP32] ========================================
21:06:49.424 > [ESP32] ENCRYPTION PIPELINE START
21:06:49.427 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:06:49.435 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:06:49.441 > [ESP32] ========================================
21:06:49.446 > [ESP32] MsgKeys: lfsrSeed=0x561AFB6B tnk[0..3]=487EAB1E trn[0..3]=5CC94F2D
21:06:49.452 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3831354D50
21:06:49.457 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3831354D5000000000000000 
21:06:49.466 > [ESP32][LFSR] Initializing - Seed: 0x561AFB6B SeedBe: 0x6BFB1A56 ChaosKey[0..3]: 487EAB1E InitialTap: 0x0029 State: 0x561AFB6B
21:06:49.477 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
21:06:49.485 > 3_After_LFSR (32): 23A93760CBE8917546D2CADDD07A9187 422AB648BA44FA967218AE0434254E6A 
21:06:49.493 > [ESP32][LFSR] Keystream (first 16 bytes): 6BFB1A56F9C8C22509E0E7E4E55AC2D3
21:06:49.499 > [ESP32][TINKERBELL] Input (first 16 bytes): 23A93760CBE8917546D2CADDD07A9187 Nonce: 0x00000001 Buffer size: 32 bytes
21:06:49.510 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 487EAB1E
21:06:49.522 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:49.527 > 4_After_Tinkerbell (32): 95E6DDA797C6751F055414746E667ED4 10FEED4D30A49FE073409A1B455BA817
21:06:49.535 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): B64FEAC75C2EE46A4386DEA9BE1CEF53
21:06:49.543 > 5_After_Transposition (32): 1474751FDDA7666E1B9A540597C6455B A430ED4D95E617A810FE9FE0D47E4073        
21:06:49.552 > [ESP32] === HMAC DEBUG INFO ===
21:06:49.554 > [ESP32] HMAC Key being used: 72FDD391EDE8BA653F63E140B0C108B5A933D2348A6F92EB485FBC50E514CAB3        
21:06:49.563 > [ESP32] HMAC Input length: 44 bytes
21:06:49.566 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000011474751FDDA7666E1B9A540597C6455BA430ED4D
21:06:49.574 > [ESP32] Nonce: 0x00000001
21:06:49.576 > [ESP32] Packet size before HMAC: 60
21:06:49.580 > [ESP32] Computed HMAC Tag: B60CE1A4EC35B209937C309BFAFAE521
21:06:49.585 > [ESP32] === END HMAC DEBUG ===
21:06:49.588 > 6_Final_Packet (60): 8102170017000408000000011474751F DDA7666E1B9A540597C6455BA430ED4D ...
21:06:49.596 > [RETRY] Attempt 1/3 (nonce: 1)
21:06:49.598 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:49.604 > Sending pipeline data to server (655 bytes)
21:06:51.200 > [HTTP] Response code: 400
21:06:51.200 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:51.205 > [HTTP] Request failed with code: 400
21:06:51.207 > [RETRY] Send failed, waiting 100 ms before retry
21:06:51.307 > [RETRY] Attempt 2/3 (nonce: 1)
21:06:51.308 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:51.313 > Sending pipeline data to server (655 bytes)
21:06:52.205 > [HTTP] Response code: 400
21:06:52.205 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:52.211 > [HTTP] Request failed with code: 400
21:06:52.218 > [RETRY] Send failed, waiting 200 ms before retry
21:06:52.418 > [RETRY] Attempt 3/3 (nonce: 1)
21:06:52.418 > POST http://10.249.92.115:8081/health-data with pipeline data
21:06:52.423 > Sending pipeline data to server (655 bytes)
21:06:53.218 > [HTTP] Response code: 400
21:06:53.218 > [HTTP] Error response: {"error":"Decryption failed"}
21:06:53.223 > [HTTP] Request failed with code: 400
21:06:53.226 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:06:53.231 > [RETRY] Consecutive failures: 3
21:06:53.234 > ✗ Auto-recovery failed - restarting key exchange
21:06:55.340 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":154320,"type":"health_data_error"}
21:06:55.353 > [WebSocket] Processing message type: health_data_error
21:06:55.359 > [167.6] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:55.367 > ✓ Public key loaded from NVS
21:06:55.465 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":154599,"type":"health_data_error"}
21:06:55.479 > [WebSocket] Processing message type: health_data_error
21:06:55.485 > [167.7] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED     
21:06:55.588 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":156327,"type":"health_data_error"}
21:06:55.602 > [WebSocket] Processing message type: health_data_error
21:06:55.607 > [167.8] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED      
21:06:55.616 > Generating fresh master key from entropy...
21:06:55.624 > Generated master key (32): 0B11009275D964EE205FF9DBC80CD1C2 4658EC51B16A1413CF18D4E740F35A9C
21:06:55.630 > Using reduced master key (byte % 3) for NTRU encryption only
21:06:55.641 > NTRU encrypted master key (502): 0073006A004D007F0018000A001C0072 00170079001200030020006B007C0005 ...
21:06:55.649 > POST http://10.249.92.115:8081/master-key
21:06:56.929 > ✓ Master key exchange completed
21:06:57.030 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":158646,"type":"health_data_error"}
21:06:57.044 > [WebSocket] Processing message type: health_data_error
21:06:57.050 > [169.2] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:57.059 > Loading master key from NVS and deriving symmetric keys...
21:06:57.064 > Loaded master key from NVS (32): 0B11009275D964EE205FF9DBC80CD1C2 4658EC51B16A1413CF18D4E740F35A9C 
21:06:57.072 > Derived HMAC key (32): F0288C276F8F135A611EE51A547AE74F A1F7BDA02BF57AF2F795D0E9AB246074
21:06:57.080 > Derived Tinkerbell key (16): C7153D4A2665A115A190D73090F15F80 
21:06:57.086 > Derived Transposition key (16): DAA82047ADDA3D030AB94804481F9EDD
21:06:57.092 > ✓ Symmetric keys derived successfully
21:06:57.094 > Nonce tracker reset - new session started
21:06:57.590 > Waiting for server to process master key...
21:06:57.594 > ✓ Symmetric keys ready - starting health data transmission
21:06:57.697 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":160336,"type":"health_data_error"}
21:06:57.710 > [WebSocket] Processing message type: health_data_error
21:06:57.716 > [169.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:57.819 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":7,"success":false,"timestamp":161465,"type":"health_data_error"}
21:06:57.833 > [WebSocket] Processing message type: health_data_error
21:06:57.838 > [170.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:57.941 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":163407,"type":"health_data_error"}
21:06:57.954 > [WebSocket] Processing message type: health_data_error
21:06:57.961 > [170.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:58.064 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":164412,"type":"health_data_error"}
21:06:58.077 > [WebSocket] Processing message type: health_data_error
21:06:58.083 > [170.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:58.187 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Failed to send health data","state":8,"success":false,"timestamp":165425,"type":"health_data_error"}
21:06:58.200 > [WebSocket] Processing message type: health_data_error
21:06:58.206 > [170.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.308 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528216756,"type":"master_key_received"}
21:06:58.322 > [WebSocket] Processing message type: master_key_received
21:06:58.325 > [170.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.430 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":169128,"type":"master_key_exchanged"}
21:06:58.447 > [WebSocket] Processing message type: master_key_exchanged
21:06:58.453 > [170.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.552 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":169798,"type":"symmetric_keys_derived"}
21:06:58.568 > [WebSocket] Processing message type: symmetric_keys_derived
21:06:58.574 > [170.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED        
21:06:58.674 > [170.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.774 > [171.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.876 > [171.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:58.977 > [171.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.077 > [171.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.179 > [171.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.280 > [171.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.380 > [171.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.481 > [171.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.583 > [171.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.684 > [171.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.785 > [172.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.886 > [172.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:06:59.987 > [172.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.087 > [172.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.189 > [172.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.290 > [172.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.391 > [172.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.492 > [172.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.592 > [172.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.693 > [172.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.794 > [173.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.895 > [173.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:00.996 > [173.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.098 > [173.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.199 > [173.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.300 > [173.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.400 > [173.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.501 > [173.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.602 > [173.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.704 > [173.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.804 > [174.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:01.905 > [174.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.006 > [174.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.107 > [174.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.208 > [174.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.309 > [174.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.411 > [174.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.511 > [174.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.613 > [174.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.713 > [174.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.814 > [175.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:02.916 > [175.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.016 > [175.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.117 > [175.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.218 > [175.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.320 > [175.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.421 > [175.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.522 > [175.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.623 > [175.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.724 > [175.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.824 > [176.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:03.925 > [176.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.026 > [176.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.127 > [176.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.229 > [176.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.330 > [176.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.430 > [176.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.532 > [176.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.633 > [176.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.734 > [176.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.834 > [177.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:04.935 > [177.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.037 > [177.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.137 > [177.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.239 > [177.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.340 > [177.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.440 > [177.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.541 > [177.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.642 > [177.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.744 > [177.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.844 > [178.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:05.945 > [178.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.047 > [178.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.147 > [178.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.249 > [178.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.349 > [178.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.450 > [178.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.551 > [178.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.653 > [178.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.754 > [179.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.854 > [179.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:06.956 > [179.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.057 > [179.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.157 > [179.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.258 > [179.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.360 > [179.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.460 > [179.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.562 > [179.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.663 > [179.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:07.668 > [RETRY] Attempting to send health data (Max retries: 3)
21:07:07.674 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:07:07.679 > Generated health data: HR-63 SPO2-95 STEPS-915
21:07:07.682 > [ESP32] ========================================
21:07:07.688 > [ESP32] ENCRYPTION PIPELINE START
21:07:07.690 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:07:07.698 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:07:07.704 > [ESP32] ========================================
21:07:07.710 > [ESP32] MsgKeys: lfsrSeed=0x9FAB4221 tnk[0..3]=097F428C trn[0..3]=02885139
21:07:07.715 > 1_After_Salt (25): 48522D36332053504F322D3935205354 4550532D3931354D50
21:07:07.720 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D3931354D5000000000000000 
21:07:07.729 > [ESP32][LFSR] Initializing - Seed: 0x9FAB4221 SeedBe: 0x2142AB9F ChaosKey[0..3]: 097F428C InitialTap: 0x0029 State: 0x9FAB4221
21:07:07.740 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
21:07:07.748 > 3_After_LFSR (32): 691086A9DF0763A2850CECE64B5E6F4D 3EF475DF91B7BE1E59286C3FC595A5D6
21:07:07.757 > [ESP32][LFSR] Keystream (first 16 bytes): 2142AB9FEC2730F2CA3EC1DF7E7E3C19
21:07:07.762 > [ESP32][TINKERBELL] Input (first 16 bytes): 691086A9DF0763A2850CECE64B5E6F4D Nonce: 0x00000001 Buffer size: 32 bytes
21:07:07.773 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 097F428C
21:07:07.782 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 31123E1D6325FE52C611DD998AF34021
21:07:07.790 > 4_After_Tinkerbell (32): 5802B8B4BC229DF0431D317FC1AD2F6C 666C3688C01E88C27C515CBF0184545D
21:07:07.798 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 31123E1D6325FE52C611DD998AF34021
21:07:07.807 > 5_After_Transposition (32): 9DC2583622BC1D7F2F6C4331ADC00288 88F066B81EC16CB4BF545D7C5C840151        
21:07:07.815 > [ESP32] === HMAC DEBUG INFO ===
21:07:07.818 > [ESP32] HMAC Key being used: F0288C276F8F135A611EE51A547AE74FA1F7BDA02BF57AF2F795D0E9AB246074        
21:07:07.826 > [ESP32] HMAC Input length: 44 bytes
21:07:07.829 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000019DC2583622BC1D7F2F6C4331ADC0028888F066B8
21:07:07.838 > [ESP32] Nonce: 0x00000001
21:07:07.840 > [ESP32] Packet size before HMAC: 60
21:07:07.843 > [ESP32] Computed HMAC Tag: 5B21618D8B464E994452A7AEFADD8466
21:07:07.848 > [ESP32] === END HMAC DEBUG ===
21:07:07.851 > 6_Final_Packet (60): 8102170017000408000000019DC25836 22BC1D7F2F6C4331ADC0028888F066B8 ...
21:07:07.859 > [RETRY] Attempt 1/3 (nonce: 1)
21:07:07.862 > POST http://10.249.92.115:8081/health-data with pipeline data
21:07:07.868 > Sending pipeline data to server (655 bytes)
21:07:09.415 > [HTTP] Response code: 400
21:07:09.416 > [HTTP] Error response: {"error":"Decryption failed"}
21:07:09.421 > [HTTP] Request failed with code: 400
21:07:09.424 > [RETRY] Send failed, waiting 100 ms before retry
21:07:09.524 > [RETRY] Attempt 2/3 (nonce: 1)
21:07:09.524 > POST http://10.249.92.115:8081/health-data with pipeline data
21:07:09.530 > Sending pipeline data to server (655 bytes)
21:07:12.667 > [HTTP] Response code: 400
21:07:12.667 > [HTTP] Error response: {"error":"Decryption failed"}
21:07:12.672 > [HTTP] Request failed with code: 400
21:07:12.675 > [RETRY] Send failed, waiting 200 ms before retry
21:07:12.875 > [RETRY] Attempt 3/3 (nonce: 1)
21:07:12.875 > POST http://10.249.92.115:8081/health-data with pipeline data
21:07:12.881 > Sending pipeline data to server (655 bytes)
21:07:14.037 > [HTTP] Response

] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:40.661 > [212.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:40.763 > [213.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:40.863 > [213.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:40.964 > [213.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.065 > [213.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.167 > [213.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.266 > [213.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.369 > [213.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.470 > [213.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.570 > [213.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.672 > [213.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.772 > [214.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.874 > [214.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:41.975 > [214.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.076 > [214.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.176 > [214.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.277 > [214.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.379 > [214.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.480 > [214.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.580 > [214.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.681 > [214.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.783 > [215.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.884 > [215.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:42.985 > [215.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.085 > [215.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.187 > [215.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.288 > [215.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.388 > [215.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.490 > [215.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.591 > [215.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.692 > [215.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
21:07:43.697 > [RETRY] Attempting to send health data (Max retries: 3)
21:07:43.702 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:07:43.708 > Generated health data: HR-63 SPO2-95 STEPS-1085
21:07:43.710 > [ESP32] ========================================
21:07:43.716 > [ESP32] ENCRYPTION PIPELINE START
21:07:43.719 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:07:43.727 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:07:43.733 > [ESP32] ========================================
21:07:43.738 > [ESP32] MsgKeys: lfsrSeed=0xC97D0C11 tnk[0..3]=C103328C trn[0..3]=33474532
21:07:43.743 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313038354D50
21:07:43.750 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313038354D50000000000000 
21:07:43.758 > [ESP32][LFSR] Initializing - Seed: 0xC97D0C11 SeedBe: 0x110C7DC9 ChaosKey[0..3]: C103328C InitialTap: 0x0029 State: 0xC97D0C11
21:07:43.768 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
21:07:43.777 > 3_After_LFSR (32): 595E50FFE7576D8AD10D1E86C37BA8F6 20574790EAB2B1C38841111C9EC8D10E
21:07:43.786 > [ESP32][LFSR] Keystream (first 16 bytes): 110C7DC9D4773EDA9E3F33BFF65BFBA2
21:07:43.791 > [ESP32][TINKERBELL] Input (first 16 bytes): 595E50FFE7576D8AD10D1E86C37BA8F6 Nonce: 0x00000001 Buffer size: 32 bytes
21:07:43.803 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C103328C
21:07:43.811 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 2E4A6B6A6B81C897C892493ED5ED8EB6
21:07:43.818 > 4_After_Tinkerbell (32): 77143B958CD6A51D199F57B816962640 B80426BB8AB67F7F711EEA70C56A6DF4 
21:07:43.827 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 2E4A6B6A6B81C897C892493ED5ED8EB6
21:07:43.836 > 5_After_Transposition (32): 711EEA708CD6A51DB80426BB16962640 199F57B88AB67F7F77143B95C56A6DF4        
21:07:43.844 > [ESP32] === HMAC DEBUG INFO ===
21:07:43.847 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC
21:07:43.855 > [ESP32] HMAC Input length: 44 bytes
21:07:43.858 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001711EEA708CD6A51DB80426BB16962640199F57B8
21:07:43.866 > [ESP32] Nonce: 0x00000001
21:07:43.869 > [ESP32] Packet size before HMAC: 60
21:07:43.872 > [ESP32] Computed HMAC Tag: 63A88CFF6BCC204B5F27C91E67F9220F
21:07:43.878 > [ESP32] === END HMAC DEBUG ===
21:07:43.880 > 6_Final_Packet (60): 810218001800040800000001711EEA70 8CD6A51DB80426BB16962640199F57B8 ...
21:07:43.888 > [RETRY] Attempt 1/3 (nonce: 1)
21:07:43.891 > POST http://10.249.92.115:8081/health-data with pipeline data
21:07:43.897 > Sending pipeline data to server (658 bytes)
21:07:45.474 > [HTTP] Response code: 200
21:07:45.475 > [HTTP] Response: {"status":"OK:DECRYPTED"}
21:07:45.492 > [RETRY] Health data sent successfully!
21:07:45.494 > ✓ Health data #2 sent successfully
21:07:45.597 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":1,"serverTime":1769528265299,"type":"security_update"}
21:07:45.614 > [WebSocket] Processing message type: security_update
21:07:45.620 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
21:07:45.624 > [217.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:45.731 > [WebSocket] Received (685 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","encData":"ENC_DATA:810218001800040800000001711EEA708CD6A51DB80426BB16962640199F57B88AB67F7F77143B95C56A6DF463A88CFF6BCC204B5F27C91E67F9220F","pipeline":{"afterLFSR":"595E50FFE7576D8AD10D1E86C37BA8F620574790EAB2B1C38841111C9EC8D10E","afterSalt":"48522D36332053504F322D39352053544550532D313038354D50","afterTinkerbell":"77143B958CD6A51D199F57B816962640B80426BB8AB67F7F711EEA70C56A6DF4","afterTransposition":"711EEA708CD6A51DB80426BB16962640199F57B88AB67F7F77143B95C56A6DF4"},"plaintext":"HR-63 SPO2-95 STEPS-1085","serverTime":1769528265299,"timestamp":216105,"type":"encryption_update","ztmEnabled":false}
21:07:45.792 > [WebSocket] Processing message type: encryption_update
21:07:45.797 > [218.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED        
21:07:45.905 > [WebSocket] Received (88 bytes): {"heartRate":63,"spo2":95,"steps":1085,"time":1769528265299,"type":"health_data_update"}
21:07:45.912 > [WebSocket] Processing message type: health_data_update
21:07:45.918 > [218.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.026 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":4.3848,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-1085","handshakeSuccess":true,"totalTime":4.3848},"type":"session_summary_update"}
21:07:46.048 > [WebSocket] Processing message type: session_summary_update
21:07:46.054 > [218.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED        
21:07:46.161 > [WebSocket] Received (658 bytes): {"decryptionTime":4.3848,"encryptedPacket":"810218001800040800000001711EEA708CD6A51DB80426BB16962640199F57B88AB67F7F77143B95C56A6DF463A88CFF6BCC204B5F27C91E67F9220F","finalPlaintext":"HR-63 SPO2-95 STEPS-1085","healthData":{"heartRate":63,"spo2":95,"steps":1085},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D31303835000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D313038354D50000000000000","afterTinkerbell":"595E50FFE7576D8AD10D1E86C37BA8F620574790EAB2B1C38841111C9EC8D10E","afterTransposition":"77143B958CD6A51D199F57B816962640B80426BB8AB67F7F711EEA70C56A6DF4"},"serverTime":1769528265300,"type":"decryption_update"}
21:07:46.218 > [WebSocket] Processing message type: decryption_update
21:07:46.224 > [WebSocket] Server decryption completed
21:07:46.227 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 1085
21:07:46.232 > [218.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.334 > [WebSocket] Received (697 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","deviceId":"f9641d44","healthSendCount":1,"pipeline":{"afterLFSR":"595E50FFE7576D8AD10D1E86C37BA8F620574790EAB2B1C38841111C9EC8D10E","afterSalt":"48522D36332053504F322D39352053544550532D313038354D50","afterTinkerbell":"77143B958CD6A51D199F57B816962640B80426BB8AB67F7F711EEA70C56A6DF4","afterTransposition":"711EEA708CD6A51DB80426BB16962640199F57B88AB67F7F77143B95C56A6DF4","finalPacket":"810218001800040800000001711EEA708CD6A51DB80426BB16962640199F57B88AB67F7F77143B95C56A6DF463A88CFF6BCC204B5F27C91E67F9220F"},"plaintext":"HR-63 SPO2-95 STEPS-1085","timestamp":217684,"type":"encryption_pipeline","ztmEnabled":false}
21:07:46.395 > [WebSocket] Processing message type: encryption_pipeline
21:07:46.400 > [218.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.508 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Health data #2 sent successfully","state":7,"success":true,"timestamp":217688,"type":"health_data_sent"}
21:07:46.524 > [WebSocket] Processing message type: health_data_sent
21:07:46.527 > [218.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.630 > [218.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.730 > [218.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.831 > [219.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:46.933 > [219.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.033 > [219.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.134 > [219.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.236 > [219.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.336 > [219.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.438 > [219.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.538 > [219.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.639 > [219.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.740 > [219.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.841 > [220.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:47.943 > [220.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.044 > [220.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.145 > [220.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.245 > [220.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.347 > [220.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.448 > [220.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.549 > [220.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.648 > [220.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.750 > [221.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.851 > [221.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:48.952 > [221.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.053 > [221.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.155 > [221.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.255 > [221.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.357 > [221.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.458 > [221.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.559 > [221.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.660 > [221.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.761 > [222.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.861 > [222.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:49.962 > [222.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.063 > [222.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.165 > [222.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.265 > [222.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.367 > [222.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.468 > [222.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.568 > [222.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.669 > [222.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.770 > [223.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.871 > [223.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:50.972 > [223.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.073 > [223.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.174 > [223.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.276 > [223.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.377 > [223.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.477 > [223.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.578 > [223.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.680 > [223.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.780 > [224.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.881 > [224.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:51.981 > [224.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.083 > [224.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.184 > [224.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.286 > [224.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.386 > [224.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.488 > [224.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.588 > [224.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.690 > [224.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.791 > [225.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.892 > [225.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:52.992 > [225.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.094 > [225.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.194 > [225.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.295 > [225.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.396 > [225.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.497 > [225.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.598 > [225.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.698 > [225.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.800 > [226.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:53.901 > [226.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.001 > [226.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.103 > [226.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.203 > [226.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.305 > [226.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.405 > [226.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.507 > [226.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.608 > [226.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.709 > [226.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.811 > [227.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:54.911 > [227.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.012 > [227.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.113 > [227.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.214 > [227.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.315 > [227.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.416 > [227.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.516 > [227.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
21:07:55.522 > [RETRY] Attempting to send health data (Max retries: 3)
21:07:55.527 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:07:55.533 > Generated health data: HR-63 SPO2-95 STEPS-1178
21:07:55.537 > [ESP32] ========================================
21:07:55.542 > [ESP32] ENCRYPTION PIPELINE START
21:07:55.545 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:07:55.553 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:07:55.559 > [ESP32] ========================================
21:07:55.564 > [ESP32] MsgKeys: lfsrSeed=0xCEBAB2BD tnk[0..3]=F0295B9D trn[0..3]=0DCE597E
21:07:55.570 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313137384D50
21:07:55.575 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313137384D50000000000000
21:07:55.584 > [ESP32][LFSR] Initializing - Seed: 0xCEBAB2BD SeedBe: 0xBDB2BACE ChaosKey[0..3]: F0295B9D InitialTap: 0x0029 State: 0xCEBAB2BD
21:07:55.595 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
21:07:55.603 > 3_After_LFSR (32): F5E097F859F53D4060FD6B78FB429056 A480DC17CA0DB18B526F3F0090A2B301 
21:07:55.611 > [ESP32][LFSR] Keystream (first 16 bytes): BDB2BACE6AD56E102FCF4641CE62C302
21:07:55.617 > [ESP32][TINKERBELL] Input (first 16 bytes): F5E097F859F53D4060FD6B78FB429056 Nonce: 0x00000002 Buffer size: 32 bytes
21:07:55.628 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: F0295B9D
21:07:55.637 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): A93D24021A4AC331315DCC0E335C73FC
21:07:55.645 > 4_After_Tinkerbell (32): 5CDDB3FA43BFFE7151A0A776C81EE3AA 91D30E9267C0453E27CD045B5F6029DB 
21:07:55.653 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): A93D24021A4AC331315DCC0E335C73FC
21:07:55.661 > 5_After_Transposition (32): 5B605FFA43BF453E92C06776C81E29DB CD042751A0A771FED30E915CDDB3AAE3 
21:07:55.669 > [ESP32] === HMAC DEBUG INFO ===
21:07:55.673 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC        
21:07:55.681 > [ESP32] HMAC Input length: 44 bytes
21:07:55.683 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000025B605FFA43BF453E92C06776C81E29DBCD042751
21:07:55.691 > [ESP32] Nonce: 0x00000002
21:07:55.695 > [ESP32] Packet size before HMAC: 60
21:07:55.698 > [ESP32] Computed HMAC Tag: 4D9CA2AA162C2460884332D6BC9A6006
21:07:55.703 > [ESP32] === END HMAC DEBUG ===
21:07:55.706 > 6_Final_Packet (60): 8102180018000408000000025B605FFA 43BF453E92C06776C81E29DBCD042751 ...
21:07:55.714 > [RETRY] Attempt 1/3 (nonce: 2)
21:07:55.716 > POST http://10.249.92.115:8081/health-data with pipeline data
21:07:55.723 > Sending pipeline data to server (658 bytes)
21:07:57.231 > [HTTP] Response code: 200
21:07:57.231 > [HTTP] Response: {"status":"OK:DECRYPTED"}
21:07:57.245 > [RETRY] Health data sent successfully!
21:07:57.248 > ✓ Health data #3 sent successfully
21:07:57.350 > [WebSocket] Received (685 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","encData":"ENC_DATA:8102180018000408000000025B605FFA43BF453E92C06776C81E29DBCD042751A0A771FED30E915CDDB3AAE34D9CA2AA162C2460884332D6BC9A6006","pipeline":{"afterLFSR":"F5E097F859F53D4060FD6B78FB429056A480DC17CA0DB18B526F3F0090A2B301","afterSalt":"48522D36332053504F322D39352053544550532D313137384D50","afterTinkerbell":"5CDDB3FA43BFFE7151A0A776C81EE3AA91D30E9267C0453E27CD045B5F6029DB","afterTransposition":"5B605FFA43BF453E92C06776C81E29DBCD042751A0A771FED30E915CDDB3AAE3"},"plaintext":"HR-63 SPO2-95 STEPS-1178","serverTime":1769528277119,"timestamp":227931,"type":"encryption_update","ztmEnabled":false}
21:07:57.411 > [WebSocket] Processing message type: encryption_update
21:07:57.416 > [229.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED        
21:07:57.523 > [WebSocket] Received (88 bytes): {"heartRate":63,"spo2":95,"steps":1178,"time":1769528277119,"type":"health_data_update"}
21:07:57.531 > [WebSocket] Processing message type: health_data_update
21:07:57.537 > [229.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:57.645 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":4.0255,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-1178","handshakeSuccess":true,"totalTime":4.0255},"type":"session_summary_update"}
21:07:57.668 > [WebSocket] Processing message type: session_summary_update
21:07:57.673 > [229.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:57.778 > [WebSocket] Received (658 bytes): {"decryptionTime":4.0255,"encryptedPacket":"8102180018000408000000025B605FFA43BF453E92C06776C81E29DBCD042751A0A771FED30E915CDDB3AAE34D9CA2AA162C2460884332D6BC9A6006","finalPlaintext":"HR-63 SPO2-95 STEPS-1178","healthData":{"heartRate":63,"spo2":95,"steps":1178},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D31313738000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D313137384D50000000000000","afterTinkerbell":"F5E097F859F53D4060FD6B78FB429056A480DC17CA0DB18B526F3F0090A2B301","afterTransposition":"5CDDB3FA43BFFE7151A0A776C81EE3AA91D30E9267C0453E27CD045B5F6029DB"},"serverTime":1769528277120,"type":"decryption_update"}
21:07:57.837 > [WebSocket] Processing message type: decryption_update
21:07:57.843 > [WebSocket] Server decryption completed
21:07:57.846 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 1178
21:07:57.851 > [230.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED        
21:07:57.954 > [WebSocket] Received (697 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","deviceId":"f9641d44","healthSendCount":2,"pipeline":{"afterLFSR":"F5E097F859F53D4060FD6B78FB429056A480DC17CA0DB18B526F3F0090A2B301","afterSalt":"48522D36332053504F322D39352053544550532D313137384D50","afterTinkerbell":"5CDDB3FA43BFFE7151A0A776C81EE3AA91D30E9267C0453E27CD045B5F6029DB","afterTransposition":"5B605FFA43BF453E92C06776C81E29DBCD042751A0A771FED30E915CDDB3AAE3","finalPacket":"8102180018000408000000025B605FFA43BF453E92C06776C81E29DBCD042751A0A771FED30E915CDDB3AAE34D9CA2AA162C2460884332D6BC9A6006"},"plaintext":"HR-63 SPO2-95 STEPS-1178","timestamp":229441,"type":"encryption_pipeline","ztmEnabled":false}
21:07:58.015 > [WebSocket] Processing message type: encryption_pipeline
21:07:58.020 > [230.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.127 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":2,"message":"Health data #3 sent successfully","state":7,"success":true,"timestamp":229448,"type":"health_data_sent"}
21:07:58.144 > [WebSocket] Processing message type: health_data_sent
21:07:58.146 > [230.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED        
21:07:58.248 > [230.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.350 > [230.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.451 > [230.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.552 > [230.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.652 > [230.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.754 > [231.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.854 > [231.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:58.956 > [231.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.057 > [231.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.158 > [231.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.259 > [231.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.360 > [231.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.460 > [231.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
21:07:59.562 > [231.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED

21:08:54.241 > [286.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.342 > [286.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.443 > [286.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.543 > [286.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.644 > [286.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.745 > [287.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.847 > [287.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:08:54.852 > [RETRY] Attempting to send health data (Max retries: 3)
21:08:54.857 > [RETRY] Using nonce 7 for all retry attempts (saved: 6)
21:08:54.863 > Generated health data: HR-64 SPO2-95 STEPS-1442
21:08:54.865 > [ESP32] ========================================
21:08:54.871 > [ESP32] ENCRYPTION PIPELINE START
21:08:54.874 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:08:54.882 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:08:54.888 > [ESP32] ========================================
21:08:54.894 > [ESP32] MsgKeys: lfsrSeed=0xC715FB0D tnk[0..3]=6CAC5614 trn[0..3]=C97EEF5E
21:08:54.899 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313434324D50
21:08:54.904 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313434324D50000000000000 
21:08:54.912 > [ESP32][LFSR] Initializing - Seed: 0xC715FB0D SeedBe: 0x0DFB15C7 ChaosKey[0..3]: 6CAC5614 InitialTap: 0x0029 State: 0xC715FB0D
21:08:54.924 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
21:08:54.933 > 3_After_LFSR (32): 45A938F16FDCACDF24740B1A6B4C669A BE8442846C6241EEAAEA949E7F0CFA1E
21:08:54.940 > [ESP32][LFSR] Keystream (first 16 bytes): 0DFB15C75BFCFF8F6B4626235E6C35CE
21:08:54.946 > [ESP32][TINKERBELL] Input (first 16 bytes): 45A938F16FDCACDF24740B1A6B4C669A Nonce: 0x00000007 Buffer size: 32 bytes
21:08:54.957 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000007 Counter: 0 (must start at 0) Key[0..3]: 6CAC5614
21:08:54.965 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:08:54.974 > 4_After_Tinkerbell (32): D1886F341730F057D581742567C52143 8B77FFDC029DEBD7B464DC5AC83F31B9
21:08:54.982 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:08:54.991 > 5_After_Transposition (32): C85A3FD58174432102DC9DD1886F57F0 B4DC64341730EBD78BFF772567C531B9        
21:08:54.998 > [ESP32] === HMAC DEBUG INFO ===
21:08:55.001 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC
21:08:55.010 > [ESP32] HMAC Input length: 44 bytes
21:08:55.013 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000007C85A3FD58174432102DC9DD1886F57F0B4DC6434
21:08:55.021 > [ESP32] Nonce: 0x00000007
21:08:55.024 > [ESP32] Packet size before HMAC: 60
21:08:55.027 > [ESP32] Computed HMAC Tag: 30410B28B50142D2C90BA370BEE13488
21:08:55.032 > [ESP32] === END HMAC DEBUG ===
21:08:55.035 > 6_Final_Packet (60): 810218001800040800000007C85A3FD5 8174432102DC9DD1886F57F0B4DC6434 ...
21:08:55.043 > [RETRY] Attempt 1/3 (nonce: 7)
21:08:55.046 > POST http://10.249.92.115:8081/health-data with pipeline data
21:08:55.052 > Sending pipeline data to server (658 bytes)
21:08:56.143 > [HTTP] Response code: 400
21:08:56.143 > [HTTP] Error response: {"error":"Decryption failed"}
21:08:56.149 > [HTTP] Request failed with code: 400
21:08:56.152 > [RETRY] Send failed, waiting 100 ms before retry
21:08:56.253 > [RETRY] Attempt 2/3 (nonce: 7)
21:08:56.253 > POST http://10.249.92.115:8081/health-data with pipeline data
21:08:56.259 > Sending pipeline data to server (658 bytes)
21:08:59.774 > [HTTP] Response code: 400
21:08:59.774 > [HTTP] Error response: {"error":"Decryption failed"}
21:08:59.780 > [HTTP] Request failed with code: 400
21:08:59.783 > [RETRY] Send failed, waiting 200 ms before retry
21:08:59.982 > [RETRY] Attempt 3/3 (nonce: 7)
21:08:59.982 > POST http://10.249.92.115:8081/health-data with pipeline data
21:08:59.988 > Sending pipeline data to server (658 bytes)
21:09:01.505 > [HTTP] Response code: 400
21:09:01.505 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:01.509 > [HTTP] Request failed with code: 400
21:09:01.512 > [RETRY] All retry attempts failed - rolled back nonce to 6
21:09:01.518 > [RETRY] Consecutive failures: 1
21:09:01.521 > Health data send failed (retry count: 1/3)
21:09:01.626 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":288355,"type":"health_data_error"}
21:09:01.640 > [WebSocket] Processing message type: health_data_error
21:09:01.645 > [293.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:01.653 > [RETRY] Attempting to send health data (Max retries: 3)
21:09:01.659 > [RETRY] Using nonce 7 for all retry attempts (saved: 6)
21:09:01.665 > Generated health data: HR-64 SPO2-95 STEPS-1510
21:09:01.667 > [ESP32] ========================================
21:09:01.673 > [ESP32] ENCRYPTION PIPELINE START
21:09:01.676 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:09:01.681 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:09:01.689 > [ESP32] ========================================
21:09:01.692 > [ESP32] MsgKeys: lfsrSeed=0xC715FB0D tnk[0..3]=6CAC5614 trn[0..3]=C97EEF5E
21:09:01.700 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313531304D50
21:09:01.706 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313531304D50000000000000 
21:09:01.714 > [ESP32][LFSR] Initializing - Seed: 0xC715FB0D SeedBe: 0x0DFB15C7 ChaosKey[0..3]: 6CAC5614 InitialTap: 0x0029 State: 0xC715FB0D
21:09:01.726 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
21:09:01.734 > 3_After_LFSR (32): 45A938F16FDCACDF24740B1A6B4C669A BE8442846C6344ECAAEA949E7F0CFA1E
21:09:01.740 > [ESP32][LFSR] Keystream (first 16 bytes): 0DFB15C75BFCFF8F6B4626235E6C35CE
21:09:01.748 > [ESP32][TINKERBELL] Input (first 16 bytes): 45A938F16FDCACDF24740B1A6B4C669A Nonce: 0x00000007 Buffer size: 32 bytes
21:09:01.756 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000007 Counter: 0 (must start at 0) Key[0..3]: 6CAC5614
21:09:01.767 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:01.775 > 4_After_Tinkerbell (32): D1886F341730F057D581742567C52143 8B77FFDC029CEED5B464DC5AC83F31B9
21:09:01.783 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:01.790 > 5_After_Transposition (32): C85A3FD58174432102DC9CD1886F57F0 B4DC64341730EED58BFF772567C531B9        
21:09:01.797 > [ESP32] === HMAC DEBUG INFO ===
21:09:01.801 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC
21:09:01.809 > [ESP32] HMAC Input length: 44 bytes
21:09:01.813 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000007C85A3FD58174432102DC9CD1886F57F0B4DC6434
21:09:01.823 > [ESP32] Nonce: 0x00000007
21:09:01.826 > [ESP32] Packet size before HMAC: 60
21:09:01.828 > [ESP32] Computed HMAC Tag: 3872E6FDA1F3A23C47F50B9F6A17A3CE
21:09:01.834 > [ESP32] === END HMAC DEBUG ===
21:09:01.837 > 6_Final_Packet (60): 810218001800040800000007C85A3FD5 8174432102DC9CD1886F57F0B4DC6434 ...
21:09:01.842 > [RETRY] Attempt 1/3 (nonce: 7)
21:09:01.845 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:01.851 > Sending pipeline data to server (658 bytes)
21:09:02.876 > [HTTP] Response code: 400
21:09:02.876 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:02.882 > [HTTP] Request failed with code: 400
21:09:02.885 > [RETRY] Send failed, waiting 100 ms before retry
21:09:02.986 > [RETRY] Attempt 2/3 (nonce: 7)
21:09:02.986 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:02.991 > Sending pipeline data to server (658 bytes)
21:09:04.511 > [HTTP] Response code: 400
21:09:04.511 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:04.516 > [HTTP] Request failed with code: 400
21:09:04.518 > [RETRY] Send failed, waiting 200 ms before retry
21:09:04.720 > [RETRY] Attempt 3/3 (nonce: 7)
21:09:04.720 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:04.725 > Sending pipeline data to server (658 bytes)
21:09:05.877 > [HTTP] Response code: 400
21:09:05.877 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:05.882 > [HTTP] Request failed with code: 400
21:09:05.885 > [RETRY] All retry attempts failed - rolled back nonce to 6
21:09:05.891 > [RETRY] Consecutive failures: 2
21:09:05.893 > Health data send failed (retry count: 2/3)
21:09:05.996 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":291986,"type":"health_data_error"}
21:09:06.011 > [WebSocket] Processing message type: health_data_error
21:09:06.016 > [298.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:06.024 > [RETRY] Attempting to send health data (Max retries: 3)
21:09:06.029 > [RETRY] Using nonce 7 for all retry attempts (saved: 6)
21:09:06.035 > Generated health data: HR-64 SPO2-95 STEPS-1501
21:09:06.038 > [ESP32] ========================================
21:09:06.044 > [ESP32] ENCRYPTION PIPELINE START
21:09:06.046 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:09:06.051 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:09:06.059 > [ESP32] ========================================
21:09:06.063 > [ESP32] MsgKeys: lfsrSeed=0xC715FB0D tnk[0..3]=6CAC5614 trn[0..3]=C97EEF5E
21:09:06.071 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313530314D50
21:09:06.077 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313530314D50000000000000 
21:09:06.085 > [ESP32][LFSR] Initializing - Seed: 0xC715FB0D SeedBe: 0x0DFB15C7 ChaosKey[0..3]: 6CAC5614 InitialTap: 0x0029 State: 0xC715FB0D
21:09:06.096 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
21:09:06.104 > 3_After_LFSR (32): 45A938F16FDCACDF24740B1A6B4C669A BE8442846C6345EDAAEA949E7F0CFA1E
21:09:06.110 > [ESP32][LFSR] Keystream (first 16 bytes): 0DFB15C75BFCFF8F6B4626235E6C35CE
21:09:06.118 > [ESP32][TINKERBELL] Input (first 16 bytes): 45A938F16FDCACDF24740B1A6B4C669A Nonce: 0x00000007 Buffer size: 32 bytes
21:09:06.127 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000007 Counter: 0 (must start at 0) Key[0..3]: 6CAC5614
21:09:06.138 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:06.146 > 4_After_Tinkerbell (32): D1886F341730F057D581742567C52143 8B77FFDC029CEFD4B464DC5AC83F31B9
21:09:06.154 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:06.160 > 5_After_Transposition (32): C85A3FD58174432102DC9CD1886F57F0 B4DC64341730EFD48BFF772567C531B9        
21:09:06.168 > [ESP32] === HMAC DEBUG INFO ===
21:09:06.171 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC
21:09:06.180 > [ESP32] HMAC Input length: 44 bytes
21:09:06.185 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000007C85A3FD58174432102DC9CD1886F57F0B4DC6434
21:09:06.194 > [ESP32] Nonce: 0x00000007
21:09:06.196 > [ESP32] Packet size before HMAC: 60
21:09:06.199 > [ESP32] Computed HMAC Tag: 1150A5230DF46311B47B252C8CC4ED3C
21:09:06.204 > [ESP32] === END HMAC DEBUG ===
21:09:06.207 > 6_Final_Packet (60): 810218001800040800000007C85A3FD5 8174432102DC9CD1886F57F0B4DC6434 ...
21:09:06.213 > [RETRY] Attempt 1/3 (nonce: 7)
21:09:06.216 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:06.221 > Sending pipeline data to server (658 bytes)
21:09:07.774 > [HTTP] Response code: 400
21:09:07.774 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:07.779 > [HTTP] Request failed with code: 400
21:09:07.782 > [RETRY] Send failed, waiting 100 ms before retry
21:09:07.882 > [RETRY] Attempt 2/3 (nonce: 7)
21:09:07.882 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:07.887 > Sending pipeline data to server (658 bytes)
21:09:08.875 > [HTTP] Response code: 400
21:09:08.875 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:08.880 > [HTTP] Request failed with code: 400
21:09:08.883 > [RETRY] Send failed, waiting 200 ms before retry
21:09:09.084 > [RETRY] Attempt 3/3 (nonce: 7)
21:09:09.084 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:09.089 > Sending pipeline data to server (658 bytes)
21:09:10.526 > [HTTP] Response code: 400
21:09:10.527 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:10.532 > [HTTP] Request failed with code: 400
21:09:10.535 > [RETRY] All retry attempts failed - rolled back nonce to 6
21:09:10.540 > [RETRY] Consecutive failures: 3
21:09:10.543 > Health data send failed (retry count: 3/3)
21:09:10.546 > Health data transmission failed after max retries
21:09:10.645 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":293716,"type":"health_data_error"}
21:09:10.659 > [WebSocket] Processing message type: health_data_error
21:09:10.664 > [302.9] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:10.673 > ERROR state - attempting recovery
21:09:10.676 > [RETRY] Attempting to send health data (Max retries: 3)
21:09:10.681 > [RETRY] Using nonce 7 for all retry attempts (saved: 6)
21:09:10.684 > Generated health data: HR-65 SPO2-96 STEPS-1530
21:09:10.690 > [ESP32] ========================================
21:09:10.692 > [ESP32] ENCRYPTION PIPELINE START
21:09:10.695 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:09:10.703 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:09:10.709 > [ESP32] ========================================
21:09:10.715 > [ESP32] MsgKeys: lfsrSeed=0xC715FB0D tnk[0..3]=6CAC5614 trn[0..3]=C97EEF5E
21:09:10.720 > 1_After_Salt (26): 48522D36352053504F322D3936205354 4550532D313533304D50
21:09:10.729 > 2_After_Padding (32): 48522D36352053504F322D3936205354 4550532D313533304D50000000000000
21:09:10.734 > [ESP32][LFSR] Initializing - Seed: 0xC715FB0D SeedBe: 0x0DFB15C7 ChaosKey[0..3]: 6CAC5614 InitialTap: 0x0029 State: 0xC715FB0D
21:09:10.745 > [ESP32][LFSR] Input (first 16 bytes): 48522D36352053504F322D3936205354 Buffer size: 32 bytes
21:09:10.754 > 3_After_LFSR (32): 45A938F16EDCACDF24740B1A684C669A BE8442846C6346ECAAEA949E7F0CFA1E 
21:09:10.761 > [ESP32][LFSR] Keystream (first 16 bytes): 0DFB15C75BFCFF8F6B4626235E6C35CE
21:09:10.767 > [ESP32][TINKERBELL] Input (first 16 bytes): 45A938F16EDCACDF24740B1A684C669A Nonce: 0x00000007 Buffer size: 32 bytes
21:09:10.779 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000007 Counter: 0 (must start at 0) Key[0..3]: 6CAC5614
21:09:10.789 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:10.798 > 4_After_Tinkerbell (32): D1886F341630F057D581742564C52143 8B77FFDC029CECD5B464DC5AC83F31B9
21:09:10.804 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 942157C578EC5C88F1F57F3F0C8947D9
21:09:10.812 > 5_After_Transposition (32): C85A3FD58174432102DC9CD1886F57F0 B4DC64341630ECD58BFF772564C531B9 
21:09:10.821 > [ESP32] === HMAC DEBUG INFO ===
21:09:10.823 > [ESP32] HMAC Key being used: 1C22EA0A748395ECC125C5627139245C3576770137742E00C1E875F8A16F2EFC        
21:09:10.831 > [ESP32] HMAC Input length: 44 bytes
21:09:10.834 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000007C85A3FD58174432102DC9CD1886F57F0B4DC6434
21:09:10.845 > [ESP32] Nonce: 0x00000007
21:09:10.845 > [ESP32] Packet size before HMAC: 60
21:09:10.848 > [ESP32] Computed HMAC Tag: BD90371543BA8D0F3C782B146223A715
21:09:10.853 > [ESP32] === END HMAC DEBUG ===
21:09:10.856 > 6_Final_Packet (60): 810218001800040800000007C85A3FD5 8174432102DC9CD1886F57F0B4DC6434 ...
21:09:10.864 > [RETRY] Attempt 1/3 (nonce: 7)
21:09:10.868 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:10.873 > Sending pipeline data to server (658 bytes)
21:09:11.883 > [HTTP] Response code: 400
21:09:11.883 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:11.888 > [HTTP] Request failed with code: 400
21:09:11.892 > [RETRY] Send failed, waiting 100 ms before retry
21:09:11.992 > [RETRY] Attempt 2/3 (nonce: 7)
21:09:11.992 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:11.998 > Sending pipeline data to server (658 bytes)
21:09:15.286 > [HTTP] Response code: 400
21:09:15.287 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:15.292 > [HTTP] Request failed with code: 400
21:09:15.295 > [RETRY] Send failed, waiting 200 ms before retry
21:09:15.494 > [RETRY] Attempt 3/3 (nonce: 7)
21:09:15.494 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:15.499 > Sending pipeline data to server (658 bytes)
21:09:18.789 > [HTTP] Response code: 400
21:09:18.789 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:18.795 > [HTTP] Request failed with code: 400
21:09:18.798 > [RETRY] All retry attempts failed - rolled back nonce to 6
21:09:18.803 > [RETRY] Consecutive failures: 4
21:09:18.806 > ✗ Auto-recovery failed - restarting key exchange
21:09:20.910 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":295088,"type":"health_data_error"}
21:09:20.924 > [WebSocket] Processing message type: health_data_error
21:09:20.929 > [313.1] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:20.937 > ✓ Public key loaded from NVS
21:09:21.036 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":296722,"type":"health_data_error"}
21:09:21.050 > [WebSocket] Processing message type: health_data_error
21:09:21.056 > [313.3] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED     
21:09:21.158 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":298088,"type":"health_data_error"}
21:09:21.173 > [WebSocket] Processing message type: health_data_error
21:09:21.178 > [313.4] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED      
21:09:21.186 > Generating fresh master key from entropy...
21:09:21.195 > Generated master key (32): A5EA7ADD309E3F554DF5C30F42634723 08E4B593866DC5794A3B7FF0D090F985
21:09:21.201 > Using reduced master key (byte % 3) for NTRU encryption only
21:09:21.212 > NTRU encrypted master key (502): 00710068004F007F0018000B001B0072 0017007900120003001E006B007C0005 ...
21:09:21.220 > POST http://10.249.92.115:8081/master-key
21:09:21.802 > ✓ Master key exchange completed
21:09:21.905 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":299986,"type":"health_data_error"}
21:09:21.918 > [WebSocket] Processing message type: health_data_error
21:09:21.924 > [314.1] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:21.932 > Loading master key from NVS and deriving symmetric keys...
21:09:21.937 > Loaded master key from NVS (32): A5EA7ADD309E3F554DF5C30F42634723 08E4B593866DC5794A3B7FF0D090F985 
21:09:21.946 > Derived HMAC key (32): BB78BB43BC3B675DF485B10650FC0C81 750F0050A5FA569A418BD17163834163
21:09:21.954 > Derived Tinkerbell key (16): D4457443A35620635D5A453292128590 
21:09:21.960 > Derived Transposition key (16): 69BD15AF09432863FD263CE38C29C5EE
21:09:21.965 > ✓ Symmetric keys derived successfully
21:09:21.968 > Nonce tracker reset - new session started
21:09:22.464 > Waiting for server to process master key...
21:09:22.467 > ✓ Symmetric keys ready - starting health data transmission
21:09:22.570 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":301087,"type":"health_data_error"}
21:09:22.584 > [WebSocket] Processing message type: health_data_error
21:09:22.589 > [314.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:22.693 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":7,"success":false,"timestamp":302738,"type":"health_data_error"}
21:09:22.706 > [WebSocket] Processing message type: health_data_error
21:09:22.712 > [314.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:22.815 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":8,"success":false,"timestamp":304095,"type":"health_data_error"}
21:09:22.829 > [WebSocket] Processing message type: health_data_error
21:09:22.834 > [315.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:22.937 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":8,"success":false,"timestamp":307498,"type":"health_data_error"}
21:09:22.951 > [WebSocket] Processing message type: health_data_error
21:09:22.957 > [315.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:23.059 > [315.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.160 > [315.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.261 > [315.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.363 > [315.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.463 > [315.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.564 > [315.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.665 > [315.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.766 > [316.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.866 > [316.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:23.968 > [316.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.069 > [316.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.170 > [316.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.272 > [316.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.372 > [316.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.473 > [316.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.574 > [316.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.675 > [316.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.776 > [317.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.877 > [317.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:24.979 > [317.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.079 > [317.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.180 > [317.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.282 > [317.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.382 > [317.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.483 > [317.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.584 > [317.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.685 > [317.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.787 > [318.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:25.891 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Failed to send health data","state":8,"success":false,"timestamp":311002,"type":"health_data_error"}
21:09:25.904 > [WebSocket] Processing message type: health_data_error
21:09:25.909 > [318.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:26.012 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528361621,"type":"master_key_received"}
21:09:26.027 > [WebSocket] Processing message type: master_key_received
21:09:26.029 > [318.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:26.134 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":314007,"type":"master_key_exchanged"}        
21:09:26.151 > [WebSocket] Processing message type: master_key_exchanged
21:09:26.157 > [318.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:26.257 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":314676,"type":"symmetric_keys_derived"}
21:09:26.274 > [WebSocket] Processing message type: symmetric_keys_derived
21:09:26.280 > [318.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED        
21:09:26.379 > [318.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.481 > [318.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.582 > [318.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.682 > [318.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.783 > [319.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.884 > [319.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:26.985 > [319.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.086 > [319.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.187 > [319.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.288 > [319.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.390 > [319.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.490 > [319.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.591 > [319.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.692 > [319.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.793 > [320.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.894 > [320.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:27.995 > [320.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.097 > [320.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.198 > [320.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.298 > [320.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.399 > [320.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.500 > [320.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.601 > [320.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.702 > [320.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.804 > [321.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:28.905 > [321.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.005 > [321.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.107 > [321.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.207 > [321.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.308 > [321.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.409 > [321.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.510 > [321.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.612 > [321.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.712 > [321.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.814 > [322.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:29.914 > [322.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.015 > [322.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.115 > [322.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.217 > [322.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.318 > [322.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.419 > [322.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.520 > [322.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.621 > [322.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.722 > [322.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.823 > [323.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:30.924 > [323.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.025 > [323.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.126 > [323.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.227 > [323.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.327 > [323.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.429 > [323.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.530 > [323.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.631 > [323.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.732 > [323.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.833 > [324.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:31.934 > [324.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.035 > [324.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.136 > [324.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.237 > [324.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.338 > [324.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.439 > [324.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.540 > [324.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
21:09:32.546 > [RETRY] Attempting to send health data (Max retries: 3)
21:09:32.551 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:09:32.557 > Generated health data: HR-65 SPO2-96 STEPS-1634
21:09:32.560 > [ESP32] ========================================
21:09:32.565 > [ESP32] ENCRYPTION PIPELINE START
21:09:32.568 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:09:32.576 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:09:32.582 > [ESP32] ========================================
21:09:32.587 > [ESP32] MsgKeys: lfsrSeed=0xF3721381 tnk[0..3]=BA40E0A3 trn[0..3]=C89E7942
21:09:32.592 > 1_After_Salt (26): 48522D36352053504F322D3936205354 4550532D313633344D50
21:09:32.598 > 2_After_Padding (32): 48522D36352053504F322D3936205354 4550532D313633344D50000000000000
21:09:32.607 > [ESP32][LFSR] Initializing - Seed: 0xF3721381 SeedBe: 0x811372F3 ChaosKey[0..3]: BA40E0A3 InitialTap: 0x0029 State: 0xF3721381
21:09:32.618 > [ESP32][LFSR] Input (first 16 bytes): 48522D36352053504F322D3936205354 Buffer size: 32 bytes
21:09:32.626 > 3_After_LFSR (32): C9415FC5D01C2BD71E003A9D998A57EC B6E2E0D11754E61D3544A1FE17DF2DBB
21:09:32.635 > [ESP32][LFSR] Keystream (first 16 bytes): 811372F3E53C7887513217A4AFAA04B8
21:09:32.640 > [ESP32][TINKERBELL] Input (first 16 bytes): C9415FC5D01C2BD71E003A9D998A57EC Nonce: 0x00000001 Buffer size: 32 bytes
21:09:32.651 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: BA40E0A3
21:09:32.660 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 3D4A3777A063BA03C32FF9DFBF77C6A5
21:09:32.668 > 4_After_Tinkerbell (32): F40B68B2707F91D4DD2FC34226FD9149 15B898D30C1BFBF4796362C608038B01 
21:09:32.676 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 3D4A3777A063BA03C32FF9DFBF77C6A5
21:09:32.685 > 5_After_Transposition (32): 2FDDC308C60391D4637962F40B68F4FB 2642FD15B8984991B2707FD30C1B8B01 
21:09:32.693 > [ESP32] === HMAC DEBUG INFO ===
21:09:32.695 > [ESP32] HMAC Key being used: BB78BB43BC3B675DF485B10650FC0C81750F0050A5FA569A418BD17163834163
21:09:32.704 > [ESP32] HMAC Input length: 44 bytes
21:09:32.707 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000012FDDC308C60391D4637962F40B68F4FB2642FD15
21:09:32.715 > [ESP32] Nonce: 0x00000001
21:09:32.718 > [ESP32] Packet size before HMAC: 60
21:09:32.721 > [ESP32] Computed HMAC Tag: 7F0877F55C61FC427B370284ADAFBFD8
21:09:32.726 > [ESP32] === END HMAC DEBUG ===
21:09:32.728 > 6_Final_Packet (60): 8102180018000408000000012FDDC308 C60391D4637962F40B68F4FB2642FD15 ...
21:09:32.737 > [RETRY] Attempt 1/3 (nonce: 1)
21:09:32.740 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:32.746 > Sending pipeline data to server (658 bytes)
21:09:34.320 > [HTTP] Response code: 400
21:09:34.320 > [HTTP] Error response: {"error":"Decryption failed"}
21:09:34.325 > [HTTP] Request failed with code: 400
21:09:34.327 > [RETRY] Send failed, waiting 100 ms before retry
21:09:34.428 > [RETRY] Attempt 2/3 (nonce: 1)
21:09:34.428 > POST http://10.249.92.115:8081/health-data with pipeline data
21:09:34.433 > Sending pipeline data to server (658 bytes)


21:10:27.381 > [379.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.482 > [379.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.583 > [379.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.684 > [379.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.785 > [380.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.886 > [380.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:27.988 > [380.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.088 > [380.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.189 > [380.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.290 > [380.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.391 > [380.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.493 > [380.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.593 > [380.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.693 > [380.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.795 > [381.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.896 > [381.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:28.997 > [381.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.098 > [381.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.199 > [381.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.300 > [381.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.401 > [381.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.502 > [381.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.603 > [381.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.704 > [381.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.805 > [382.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:29.907 > [382.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.008 > [382.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.108 > [382.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.209 > [382.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.311 > [382.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.411 > [382.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.512 > [382.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.614 > [382.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.714 > [382.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.815 > [383.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:30.916 > [383.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.017 > [383.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.118 > [383.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.220 > [383.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.320 > [383.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.421 > [383.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.522 > [383.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.623 > [383.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.725 > [383.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.826 > [384.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:31.926 > [384.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.027 > [384.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.128 > [384.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.229 > [384.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.330 > [384.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.432 > [384.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.532 > [384.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.633 > [384.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.735 > [384.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.835 > [385.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:32.937 > [385.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.037 > [385.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.139 > [385.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.239 > [385.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.341 > [385.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.442 > [385.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.543 > [385.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.643 > [385.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.744 > [386.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:33.750 > [RETRY] Attempting to send health data (Max retries: 3)
21:10:33.755 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:10:33.761 > Generated health data: HR-66 SPO2-96 STEPS-1973
21:10:33.764 > [ESP32] ========================================
21:10:33.768 > [ESP32] ENCRYPTION PIPELINE START
21:10:33.772 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:10:33.780 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:10:33.786 > [ESP32] ========================================
21:10:33.791 > [ESP32] MsgKeys: lfsrSeed=0xCBB994EE tnk[0..3]=D18A8327 trn[0..3]=20BE169A
21:10:33.797 > 1_After_Salt (26): 48522D36362053504F322D3936205354 4550532D313937334D50
21:10:33.803 > 2_After_Padding (32): 48522D36362053504F322D3936205354 4550532D313937334D50000000000000
21:10:33.811 > [ESP32][LFSR] Initializing - Seed: 0xCBB994EE SeedBe: 0xEE94B9CB ChaosKey[0..3]: D18A8327 InitialTap: 0x0029 State: 0xCBB994EE
21:10:33.822 > [ESP32][LFSR] Input (first 16 bytes): 48522D36362053504F322D3936205354 Buffer size: 32 bytes
21:10:33.830 > 3_After_LFSR (32): A6C694FD6FD89F572E314806EBE11944 D4720CE5E38E60F0BEF3D84289D0138A 
21:10:33.838 > [ESP32][LFSR] Keystream (first 16 bytes): EE94B9CB59F8CC076103653FDDC14A10
21:10:33.844 > [ESP32][TINKERBELL] Input (first 16 bytes): A6C694FD6FD89F572E314806EBE11944 Nonce: 0x00000003 Buffer size: 32 bytes
21:10:33.855 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: D18A8327
21:10:33.863 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:33.871 > 4_After_Tinkerbell (32): 4860F30EA32D54E2E938B38DE793796D 406002E4F19AA5F11619EACBC835AEB2 
21:10:33.880 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:33.888 > 5_After_Transposition (32): 9AE4F14860F3F1A58DE793E938B3B2AE 35C8CB0EA32D54E2EA1916406002796D 
21:10:33.897 > [ESP32] === HMAC DEBUG INFO ===
21:10:33.900 > [ESP32] HMAC Key being used: 0BB198C3FBED353ABFCC13B2B3A7B26479BA67FF518061261AB2F808418C607B        
21:10:33.908 > [ESP32] HMAC Input length: 44 bytes
21:10:33.911 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000039AE4F14860F3F1A58DE793E938B3B2AE35C8CB0E
21:10:33.919 > [ESP32] Nonce: 0x00000003
21:10:33.922 > [ESP32] Packet size before HMAC: 60
21:10:33.925 > [ESP32] Computed HMAC Tag: DE3F7C68B343C4E881ACB91E17D0D4A7
21:10:33.930 > [ESP32] === END HMAC DEBUG ===
21:10:33.933 > 6_Final_Packet (60): 8102180018000408000000039AE4F148 60F3F1A58DE793E938B3B2AE35C8CB0E ...
21:10:33.947 > [RETRY] Attempt 1/3 (nonce: 3)
21:10:33.947 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:33.965 > Sending pipeline data to server (658 bytes)
21:10:35.620 > [HTTP] Response code: 400
21:10:35.620 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:35.625 > [HTTP] Request failed with code: 400
21:10:35.629 > [RETRY] Send failed, waiting 100 ms before retry
21:10:35.728 > [RETRY] Attempt 2/3 (nonce: 3)
21:10:35.728 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:35.734 > Sending pipeline data to server (658 bytes)
21:10:35.876 > [HTTP] Response code: 400
21:10:35.876 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:35.882 > [HTTP] Request failed with code: 400
21:10:35.884 > [RETRY] Send failed, waiting 200 ms before retry
21:10:36.083 > [RETRY] Attempt 3/3 (nonce: 3)
21:10:36.084 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:36.090 > Sending pipeline data to server (658 bytes)
21:10:37.626 > [HTTP] Response code: 400
21:10:37.626 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:37.630 > [HTTP] Request failed with code: 400
21:10:37.634 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:10:37.640 > [RETRY] Consecutive failures: 1
21:10:37.643 > Health data send failed (retry count: 1/3)
21:10:37.748 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":387835,"type":"health_data_error"}
21:10:37.762 > [WebSocket] Processing message type: health_data_error
21:10:37.768 > [390.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:10:37.776 > [RETRY] Attempting to send health data (Max retries: 3)
21:10:37.782 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:10:37.787 > Generated health data: HR-66 SPO2-96 STEPS-1982
21:10:37.790 > [ESP32] ========================================
21:10:37.795 > [ESP32] ENCRYPTION PIPELINE START
21:10:37.798 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:10:37.803 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:10:37.812 > [ESP32] ========================================
21:10:37.815 > [ESP32] MsgKeys: lfsrSeed=0xCBB994EE tnk[0..3]=D18A8327 trn[0..3]=20BE169A
21:10:37.823 > 1_After_Salt (26): 48522D36362053504F322D3936205354 4550532D313938324D50
21:10:37.828 > 2_After_Padding (32): 48522D36362053504F322D3936205354 4550532D313938324D50000000000000
21:10:37.837 > [ESP32][LFSR] Initializing - Seed: 0xCBB994EE SeedBe: 0xEE94B9CB ChaosKey[0..3]: D18A8327 InitialTap: 0x0029 State: 0xCBB994EE
21:10:37.848 > [ESP32][LFSR] Input (first 16 bytes): 48522D36362053504F322D3936205354 Buffer size: 32 bytes
21:10:37.856 > 3_After_LFSR (32): A6C694FD6FD89F572E314806EBE11944 D4720CE5E38E6FF1BEF3D84289D0138A
21:10:37.862 > [ESP32][LFSR] Keystream (first 16 bytes): EE94B9CB59F8CC076103653FDDC14A10
21:10:37.871 > [ESP32][TINKERBELL] Input (first 16 bytes): A6C694FD6FD89F572E314806EBE11944 Nonce: 0x00000003 Buffer size: 32 bytes
21:10:37.879 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: D18A8327
21:10:37.890 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:37.898 > 4_After_Tinkerbell (32): 4860F30EA32D54E2E938B38DE793796D 406002E4F19AAAF01619EACBC835AEB2 
21:10:37.906 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:37.912 > 5_After_Transposition (32): 9AE4F14860F3F0AA8DE793E938B3B2AE 35C8CB0EA32D54E2EA1916406002796D 
21:10:37.921 > [ESP32] === HMAC DEBUG INFO ===
21:10:37.923 > [ESP32] HMAC Key being used: 0BB198C3FBED353ABFCC13B2B3A7B26479BA67FF518061261AB2F808418C607B
21:10:37.932 > [ESP32] HMAC Input length: 44 bytes
21:10:37.937 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000039AE4F14860F3F0AA8DE793E938B3B2AE35C8CB0E
21:10:37.946 > [ESP32] Nonce: 0x00000003
21:10:37.948 > [ESP32] Packet size before HMAC: 60
21:10:37.951 > [ESP32] Computed HMAC Tag: 8FA9E8E375106BE74AF1C546FA22BE1B
21:10:37.956 > [ESP32] === END HMAC DEBUG ===
21:10:37.959 > 6_Final_Packet (60): 8102180018000408000000039AE4F148 60F3F0AA8DE793E938B3B2AE35C8CB0E ...
21:10:37.965 > [RETRY] Attempt 1/3 (nonce: 3)
21:10:37.967 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:37.977 > Sending pipeline data to server (658 bytes)
21:10:39.628 > [HTTP] Response code: 400
21:10:39.629 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:39.634 > [HTTP] Request failed with code: 400
21:10:39.636 > [RETRY] Send failed, waiting 100 ms before retry
21:10:39.737 > [RETRY] Attempt 2/3 (nonce: 3)
21:10:39.737 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:39.743 > Sending pipeline data to server (658 bytes)
21:10:39.882 > [HTTP] Response code: 400
21:10:39.882 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:39.888 > [HTTP] Request failed with code: 400
21:10:39.890 > [RETRY] Send failed, waiting 200 ms before retry
21:10:40.090 > [RETRY] Attempt 3/3 (nonce: 3)
21:10:40.090 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:40.095 > Sending pipeline data to server (658 bytes)
21:10:41.634 > [HTTP] Response code: 400
21:10:41.634 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:41.640 > [HTTP] Request failed with code: 400
21:10:41.643 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:10:41.648 > [RETRY] Consecutive failures: 2
21:10:41.650 > Health data send failed (retry count: 2/3)
21:10:41.753 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":388090,"type":"health_data_error"}
21:10:41.766 > [WebSocket] Processing message type: health_data_error
21:10:41.773 > [394.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:41.782 > [RETRY] Attempting to send health data (Max retries: 3)
21:10:41.787 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:10:41.792 > Generated health data: HR-66 SPO2-96 STEPS-1981
21:10:41.796 > [ESP32] ========================================
21:10:41.801 > [ESP32] ENCRYPTION PIPELINE START
21:10:41.804 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:10:41.809 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:10:41.818 > [ESP32] ========================================
21:10:41.821 > [ESP32] MsgKeys: lfsrSeed=0xCBB994EE tnk[0..3]=D18A8327 trn[0..3]=20BE169A
21:10:41.828 > 1_After_Salt (26): 48522D36362053504F322D3936205354 4550532D313938314D50
21:10:41.834 > 2_After_Padding (32): 48522D36362053504F322D3936205354 4550532D313938314D50000000000000 
21:10:41.843 > [ESP32][LFSR] Initializing - Seed: 0xCBB994EE SeedBe: 0xEE94B9CB ChaosKey[0..3]: D18A8327 InitialTap: 0x0029 State: 0xCBB994EE
21:10:41.853 > [ESP32][LFSR] Input (first 16 bytes): 48522D36362053504F322D3936205354 Buffer size: 32 bytes
21:10:41.861 > 3_After_LFSR (32): A6C694FD6FD89F572E314806EBE11944 D4720CE5E38E6FF2BEF3D84289D0138A
21:10:41.866 > [ESP32][LFSR] Keystream (first 16 bytes): EE94B9CB59F8CC076103653FDDC14A10
21:10:41.876 > [ESP32][TINKERBELL] Input (first 16 bytes): A6C694FD6FD89F572E314806EBE11944 Nonce: 0x00000003 Buffer size: 32 bytes
21:10:41.884 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: D18A8327
21:10:41.896 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:41.904 > 4_After_Tinkerbell (32): 4860F30EA32D54E2E938B38DE793796D 406002E4F19AAAF31619EACBC835AEB2 
21:10:41.912 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:41.917 > 5_After_Transposition (32): 9AE4F14860F3F3AA8DE793E938B3B2AE 35C8CB0EA32D54E2EA1916406002796D 
21:10:41.926 > [ESP32] === HMAC DEBUG INFO ===
21:10:41.929 > [ESP32] HMAC Key being used: 0BB198C3FBED353ABFCC13B2B3A7B26479BA67FF518061261AB2F808418C607B
21:10:41.937 > [ESP32] HMAC Input length: 44 bytes
21:10:41.943 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000039AE4F14860F3F3AA8DE793E938B3B2AE35C8CB0E
21:10:41.951 > [ESP32] Nonce: 0x00000003
21:10:41.953 > [ESP32] Packet size before HMAC: 60
21:10:41.956 > [ESP32] Computed HMAC Tag: B24B5BEB1EC6E33DB085D9805A69A65B
21:10:41.961 > [ESP32] === END HMAC DEBUG ===
21:10:41.965 > 6_Final_Packet (60): 8102180018000408000000039AE4F148 60F3F3AA8DE793E938B3B2AE35C8CB0E ...
21:10:41.970 > [RETRY] Attempt 1/3 (nonce: 3)
21:10:41.972 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:41.978 > Sending pipeline data to server (658 bytes)
21:10:43.640 > [HTTP] Response code: 400
21:10:43.640 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:43.645 > [HTTP] Request failed with code: 400
21:10:43.648 > [RETRY] Send failed, waiting 100 ms before retry
21:10:43.748 > [RETRY] Attempt 2/3 (nonce: 3)
21:10:43.748 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:43.754 > Sending pipeline data to server (658 bytes)
21:10:43.890 > [HTTP] Response code: 400
21:10:43.890 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:43.895 > [HTTP] Request failed with code: 400
21:10:43.898 > [RETRY] Send failed, waiting 200 ms before retry
21:10:44.098 > [RETRY] Attempt 3/3 (nonce: 3)
21:10:44.098 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:44.104 > Sending pipeline data to server (658 bytes)
21:10:45.643 > [HTTP] Response code: 400
21:10:45.643 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:45.648 > [HTTP] Request failed with code: 400
21:10:45.651 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:10:45.656 > [RETRY] Consecutive failures: 3
21:10:45.659 > Health data send failed (retry count: 3/3)
21:10:45.662 > Health data transmission failed after max retries
21:10:45.762 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":389841,"type":"health_data_error"}
21:10:45.776 > [WebSocket] Processing message type: health_data_error
21:10:45.781 > [398.0] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:45.790 > ERROR state - attempting recovery
21:10:45.793 > [RETRY] Attempting to send health data (Max retries: 3)
21:10:45.799 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:10:45.801 > Generated health data: HR-66 SPO2-96 STEPS-1990
21:10:45.806 > [ESP32] ========================================
21:10:45.810 > [ESP32] ENCRYPTION PIPELINE START
21:10:45.813 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:10:45.820 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:10:45.826 > [ESP32] ========================================
21:10:45.832 > [ESP32] MsgKeys: lfsrSeed=0xCBB994EE tnk[0..3]=D18A8327 trn[0..3]=20BE169A
21:10:45.838 > 1_After_Salt (26): 48522D36362053504F322D3936205354 4550532D313939304D50
21:10:45.846 > 2_After_Padding (32): 48522D36362053504F322D3936205354 4550532D313939304D50000000000000 
21:10:45.851 > [ESP32][LFSR] Initializing - Seed: 0xCBB994EE SeedBe: 0xEE94B9CB ChaosKey[0..3]: D18A8327 InitialTap: 0x0029 State: 0xCBB994EE
21:10:45.862 > [ESP32][LFSR] Input (first 16 bytes): 48522D36362053504F322D3936205354 Buffer size: 32 bytes
21:10:45.871 > 3_After_LFSR (32): A6C694FD6FD89F572E314806EBE11944 D4720CE5E38E6EF3BEF3D84289D0138A
21:10:45.879 > [ESP32][LFSR] Keystream (first 16 bytes): EE94B9CB59F8CC076103653FDDC14A10
21:10:45.885 > [ESP32][TINKERBELL] Input (first 16 bytes): A6C694FD6FD89F572E314806EBE11944 Nonce: 0x00000003 Buffer size: 32 bytes
21:10:45.896 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: D18A8327
21:10:45.907 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:45.915 > 4_After_Tinkerbell (32): 4860F30EA32D54E2E938B38DE793796D 406002E4F19AABF21619EACBC835AEB2 
21:10:45.921 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): EEA667F3CCF5CBB5C709FB8B0C726029
21:10:45.929 > 5_After_Transposition (32): 9AE4F14860F3F2AB8DE793E938B3B2AE 35C8CB0EA32D54E2EA1916406002796D        
21:10:45.938 > [ESP32] === HMAC DEBUG INFO ===
21:10:45.941 > [ESP32] HMAC Key being used: 0BB198C3FBED353ABFCC13B2B3A7B26479BA67FF518061261AB2F808418C607B
21:10:45.948 > [ESP32] HMAC Input length: 44 bytes
21:10:45.951 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000039AE4F14860F3F2AB8DE793E938B3B2AE35C8CB0E
21:10:45.962 > [ESP32] Nonce: 0x00000003
21:10:45.962 > [ESP32] Packet size before HMAC: 60
21:10:45.965 > [ESP32] Computed HMAC Tag: 17F2E8F562FD836A01F71A8EF1F88CB4
21:10:45.971 > [ESP32] === END HMAC DEBUG ===
21:10:45.974 > 6_Final_Packet (60): 8102180018000408000000039AE4F148 60F3F2AB8DE793E938B3B2AE35C8CB0E ...
21:10:45.982 > [RETRY] Attempt 1/3 (nonce: 3)
21:10:45.985 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:45.990 > Sending pipeline data to server (658 bytes)
21:10:49.403 > [HTTP] Response code: 400
21:10:49.404 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:49.409 > [HTTP] Request failed with code: 400
21:10:49.412 > [RETRY] Send failed, waiting 100 ms before retry
21:10:49.511 > [RETRY] Attempt 2/3 (nonce: 3)
21:10:49.511 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:49.517 > Sending pipeline data to server (658 bytes)
21:10:51.222 > [HTTP] Response code: 400
21:10:51.222 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:51.229 > [HTTP] Request failed with code: 400
21:10:51.232 > [RETRY] Send failed, waiting 200 ms before retry
21:10:51.430 > [RETRY] Attempt 3/3 (nonce: 3)
21:10:51.430 > POST http://10.249.92.115:8081/health-data with pipeline data
21:10:51.435 > Sending pipeline data to server (658 bytes)
21:10:52.377 > [HTTP] Response code: 400
21:10:52.377 > [HTTP] Error response: {"error":"Decryption failed"}
21:10:52.384 > [HTTP] Request failed with code: 400
21:10:52.386 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:10:52.392 > [RETRY] Consecutive failures: 4
21:10:52.394 > ✗ Auto-recovery failed - restarting key exchange
21:10:54.497 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":391843,"type":"health_data_error"}
21:10:54.512 > [WebSocket] Processing message type: health_data_error
21:10:54.517 > [406.7] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:10:54.526 > ✓ Public key loaded from NVS
21:10:54.624 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":392097,"type":"health_data_error"}
21:10:54.638 > [WebSocket] Processing message type: health_data_error
21:10:54.644 > [406.8] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:54.746 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":393849,"type":"health_data_error"}
21:10:54.761 > [WebSocket] Processing message type: health_data_error
21:10:54.766 > [407.0] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED      
21:10:54.774 > Generating fresh master key from entropy...
21:10:54.784 > Generated master key (32): 10FA75409E5E6769E1614809F55F4B08 FE7589673C7CDD8618CF0C77D4D8EFE6
21:10:54.789 > Using reduced master key (byte % 3) for NTRU encryption only
21:10:54.799 > NTRU encrypted master key (502): 00720069004D007E001A000A001C0071 00150078001200030020006D007A0005 ...
21:10:54.808 > POST http://10.249.92.115:8081/master-key
21:10:56.423 > ✓ Master key exchange completed
21:10:56.525 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":395854,"type":"health_data_error"}
21:10:56.538 > [WebSocket] Processing message type: health_data_error
21:10:56.544 > [408.7] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:56.552 > Loading master key from NVS and deriving symmetric keys...
21:10:56.558 > Loaded master key from NVS (32): 10FA75409E5E6769E1614809F55F4B08 FE7589673C7CDD8618CF0C77D4D8EFE6   
21:10:56.566 > Derived HMAC key (32): CA2A84998A97CA5A40A8EE6D53D70E86 3ED08F725D266702F68BD61DF800CAA2 
21:10:56.575 > Derived Tinkerbell key (16): AEC740294EF529B2F102F49D93F552C3
21:10:56.580 > Derived Transposition key (16): 73604B64B7259274939C59345F56D812 
21:10:56.585 > ✓ Symmetric keys derived successfully
21:10:56.588 > Nonce tracker reset - new session started
21:10:57.084 > Waiting for server to process master key...
21:10:57.087 > ✓ Symmetric keys ready - starting health data transmission
21:10:57.190 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":396104,"type":"health_data_error"}
21:10:57.203 > [WebSocket] Processing message type: health_data_error
21:10:57.209 > [409.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:57.313 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":397858,"type":"health_data_error"}
21:10:57.327 > [WebSocket] Processing message type: health_data_error
21:10:57.332 > [409.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:57.435 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":401619,"type":"health_data_error"}
21:10:57.449 > [WebSocket] Processing message type: health_data_error
21:10:57.454 > [409.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:57.560 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":403438,"type":"health_data_error"}
21:10:57.574 > [WebSocket] Processing message type: health_data_error
21:10:57.580 > [409.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:57.683 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":404593,"type":"health_data_error"}
21:10:57.697 > [WebSocket] Processing message type: health_data_error
21:10:57.702 > [409.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:57.804 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528456191,"type":"master_key_received"}
21:10:57.818 > [WebSocket] Processing message type: master_key_received
21:10:57.822 > [410.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:10:57.927 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":408631,"type":"master_key_exchanged"}
21:10:57.943 > [WebSocket] Processing message type: master_key_exchanged
21:10:57.949 > [410.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.050 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":409299,"type":"symmetric_keys_derived"}
21:10:58.066 > [WebSocket] Processing message type: symmetric_keys_derived
21:10:58.072 > [410.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:10:58.172 > [410.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.272 > [410.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.374 > [410.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.475 > [410.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.575 > [410.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.676 > [410.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.777 > [411.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.879 > [411.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:58.980 > [411.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.080 > [411.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.182 > [411.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.282 > [411.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.383 > [411.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.484 > [411.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.585 > [411.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.687 > [411.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.788 > [412.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.889 > [412.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:10:59.989 > [412.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.090 > [412.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.191 > [412.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.293 > [412.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.393 > [412.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.494 > [412.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.596 > [412.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.696 > [412.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.798 > [413.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:00.899 > [413.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.000 > [413.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.100 > [413.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.201 > [413.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.302 > [413.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.403 > [413.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.504 > [413.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.605 > [413.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.707 > [413.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.807 > [414.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:01.908 > [414.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.010 > [414.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.110 > [414.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.212 > [414.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.313 > [414.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.414 > [414.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.514 > [414.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.615 > [414.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.717 > [414.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.817 > [415.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:02.918 > [415.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.019 > [415.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.121 > [415.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.222 > [415.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.323 > [415.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.424 > [415.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.524 > [415.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.625 > [415.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.726 > [415.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.827 > [416.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:03.928 > [416.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.030 > [416.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.130 > [416.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.231 > [416.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.333 > [416.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.433 > [416.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.534 > [416.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.636 > [416.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.737 > [416.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.838 > [417.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:04.939 > [417.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.040 > [417.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.140 > [417.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.242 > [417.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.343 > [417.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.443 > [417.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.544 > [417.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.645 > [417.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.747 > [418.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.847 > [418.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:05.948 > [418.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.048 > [418.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.151 > [418.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.251 > [418.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.353 > [418.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.454 > [418.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.554 > [418.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.656 > [418.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.757 > [419.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.858 > [419.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:06.959 > [419.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:07.060 > [419.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:07.160 > [419.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:07.166 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:07.172 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:07.177 > Generated health data: HR-66 SPO2-96 STEPS-2097
21:11:07.180 > [ESP32] ========================================
21:11:07.186 > [ESP32] ENCRYPTION PIPELINE START
21:11:07.188 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:07.196 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:07.202 > [ESP32] ========================================
21:11:07.208 > [ESP32] MsgKeys: lfsrSeed=0xC2E0D477 tnk[0..3]=C6B5A773 trn[0..3]=D1FB416D
21:11:07.213 > 1_After_Salt (26): 48522D36362053504F322D3936205354 4550532D323039374D50
21:11:07.218 > 2_After_Padding (32): 48522D36362053504F322D3936205354 4550532D323039374D50000000000000 
21:11:07.227 > [ESP32][LFSR] Initializing - Seed: 0xC2E0D477 SeedBe: 0x77D4E0C2 ChaosKey[0..3]: C6B5A773 InitialTap: 0x0029 State: 0xC2E0D477
21:11:07.238 > [ESP32][LFSR] Input (first 16 bytes): 48522D36362053504F322D3936205354 Buffer size: 32 bytes
21:11:07.246 > 3_After_LFSR (32): 3F86CDF426A10C3FA2C917E7255445FC DC19EB27D0C689B5C96BCD17B0C9AE35
21:11:07.255 > [ESP32][LFSR] Keystream (first 16 bytes): 77D4E0C210815F6FEDFB3ADE137416A8
21:11:07.260 > [ESP32][TINKERBELL] Input (first 16 bytes): 3F86CDF426A10C3FA2C917E7255445FC Nonce: 0x00000001 Buffer size: 32 bytes
21:11:07.271 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C6B5A773
21:11:07.279 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:07.287 > 4_After_Tinkerbell (32): 99C60B5C948723F7A92D2BD609848447 66DE9CC7E0CAC22F558E7FD94CB2DC33
21:11:07.296 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:07.305 > 5_After_Transposition (32): 942387F755D97F8E0984844766C79CDE E0CAC22F990B5CC64CB2DC33A92BD62D        
21:11:07.313 > [ESP32] === HMAC DEBUG INFO ===
21:11:07.316 > [ESP32] HMAC Key being used: CA2A84998A97CA5A40A8EE6D53D70E863ED08F725D266702F68BD61DF800CAA2
21:11:07.324 > [ESP32] HMAC Input length: 44 bytes
21:11:07.326 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001942387F755D97F8E0984844766C79CDEE0CAC22F
21:11:07.335 > [ESP32] Nonce: 0x00000001
21:11:07.338 > [ESP32] Packet size before HMAC: 60
21:11:07.340 > [ESP32] Computed HMAC Tag: 944FC9D17BD973529E4E3089EA3177D9
21:11:07.346 > [ESP32] === END HMAC DEBUG ===
21:11:07.349 > 6_Final_Packet (60): 810218001800040800000001942387F7 55D97F8E0984844766C79CDEE0CAC22F ...
21:11:07.358 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:07.360 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:07.366 > Sending pipeline data to server (658 bytes)
21:11:08.324 > [HTTP] Response code: 400
21:11:08.324 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:08.330 > [HTTP] Request failed with code: 400
21:11:08.332 > [RETRY] Send failed, waiting 100 ms before retry
21:11:08.432 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:08.432 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:08.438 > Sending pipeline data to server (658 bytes)
21:11:11.923 > [HTTP] Response code: 400
21:11:11.923 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:11.930 > [HTTP] Request failed with code: 400
21:11:11.932 > [RETRY] Send failed, waiting 200 ms before retry
21:11:12.131 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:12.131 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:12.137 > Sending pipeline data to server (658 bytes)
21:11:15.684 > [HTTP] Response code: 400
21:11:15.684 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:15.689 > [HTTP] Request failed with code: 400
21:11:15.691 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:11:15.697 > [RETRY] Consecutive failures: 5
21:11:15.700 > [EMERGENCY] Triggering emergency reset!
21:11:15.703 > [CRYPTO] Resetting cryptographic state
21:11:15.708 > [CRYPTO] Crypto state reset complete
21:11:15.711 > [CRYPTO] Packet counter: 5
21:11:15.714 > [EMERGENCY] Emergency reset complete
21:11:15.717 > Health data send failed (retry count: 1/3)
21:11:15.817 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":420539,"type":"health_data_error"}
21:11:15.830 > [WebSocket] Processing message type: health_data_error
21:11:15.836 > [428.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:15.844 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:15.850 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:15.855 > Generated health data: HR-67 SPO2-96 STEPS-2169
21:11:15.858 > [ESP32] ========================================
21:11:15.863 > [ESP32] ENCRYPTION PIPELINE START
21:11:15.866 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:15.871 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:15.880 > [ESP32] ========================================
21:11:15.883 > [ESP32] MsgKeys: lfsrSeed=0xC2E0D477 tnk[0..3]=C6B5A773 trn[0..3]=D1FB416D
21:11:15.891 > 1_After_Salt (26): 48522D36372053504F322D3936205354 4550532D323136394D50
21:11:15.897 > 2_After_Padding (32): 48522D36372053504F322D3936205354 4550532D323136394D50000000000000
21:11:15.905 > [ESP32][LFSR] Initializing - Seed: 0xC2E0D477 SeedBe: 0x77D4E0C2 ChaosKey[0..3]: C6B5A773 InitialTap: 0x0029 State: 0xC2E0D477
21:11:15.915 > [ESP32][LFSR] Input (first 16 bytes): 48522D36372053504F322D3936205354 Buffer size: 32 bytes
21:11:15.925 > 3_After_LFSR (32): 3F86CDF427A10C3FA2C917E7255445FC DC19EB27D0C786BBC96BCD17B0C9AE35 
21:11:15.930 > [ESP32][LFSR] Keystream (first 16 bytes): 77D4E0C210815F6FEDFB3ADE137416A8
21:11:15.939 > [ESP32][TINKERBELL] Input (first 16 bytes): 3F86CDF427A10C3FA2C917E7255445FC Nonce: 0x00000001 Buffer size: 32 bytes
21:11:15.946 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C6B5A773
21:11:15.957 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:15.966 > 4_After_Tinkerbell (32): 99C60B5C958723F7A92D2BD609848447 66DE9CC7E0CBCD21558E7FD94CB2DC33 
21:11:15.974 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:15.980 > 5_After_Transposition (32): 952387F755D97F8E0984844766C79CDE E0CBCD21990B5CC64CB2DC33A92BD62D 
21:11:15.989 > [ESP32] === HMAC DEBUG INFO ===
21:11:15.992 > [ESP32] HMAC Key being used: CA2A84998A97CA5A40A8EE6D53D70E863ED08F725D266702F68BD61DF800CAA2        
21:11:16.000 > [ESP32] HMAC Input length: 44 bytes
21:11:16.005 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001952387F755D97F8E0984844766C79CDEE0CBCD21
21:11:16.013 > [ESP32] Nonce: 0x00000001
21:11:16.016 > [ESP32] Packet size before HMAC: 60
21:11:16.018 > [ESP32] Computed HMAC Tag: 467F3107B83147A43623F3AFAEC613EC
21:11:16.024 > [ESP32] === END HMAC DEBUG ===
21:11:16.027 > 6_Final_Packet (60): 810218001800040800000001952387F7 55D97F8E0984844766C79CDEE0CBCD21 ...
21:11:16.033 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:16.035 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:16.045 > Sending pipeline data to server (658 bytes)
21:11:17.694 > [HTTP] Response code: 400
21:11:17.694 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:17.698 > [HTTP] Request failed with code: 400
21:11:17.701 > [RETRY] Send failed, waiting 100 ms before retry
21:11:17.802 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:17.802 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:17.808 > Sending pipeline data to server (658 bytes)
21:11:17.943 > [HTTP] Response code: 400
21:11:17.943 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:17.948 > [HTTP] Request failed with code: 400
21:11:17.951 > [RETRY] Send failed, waiting 200 ms before retry
21:11:18.152 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:18.152 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:18.157 > Sending pipeline data to server (658 bytes)
21:11:19.948 > [HTTP] Response code: 400
21:11:19.948 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:19.953 > [HTTP] Request failed with code: 400
21:11:19.956 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:11:19.961 > [RETRY] Consecutive failures: 1
21:11:19.964 > Health data send failed (retry count: 2/3)
21:11:20.066 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":424139,"type":"health_data_error"}
21:11:20.080 > [WebSocket] Processing message type: health_data_error
21:11:20.086 > [432.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:20.094 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:20.100 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:20.105 > Generated health data: HR-67 SPO2-96 STEPS-2162
21:11:20.108 > [ESP32] ========================================
21:11:20.114 > [ESP32] ENCRYPTION PIPELINE START
21:11:20.116 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:20.122 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:20.130 > [ESP32] ========================================
21:11:20.133 > [ESP32] MsgKeys: lfsrSeed=0xC2E0D477 tnk[0..3]=C6B5A773 trn[0..3]=D1FB416D
21:11:20.141 > 1_After_Salt (26): 48522D36372053504F322D3936205354 4550532D323136324D50
21:11:20.147 > 2_After_Padding (32): 48522D36372053504F322D3936205354 4550532D323136324D50000000000000
21:11:20.155 > [ESP32][LFSR] Initializing - Seed: 0xC2E0D477 SeedBe: 0x77D4E0C2 ChaosKey[0..3]: C6B5A773 InitialTap: 0x0029 State: 0xC2E0D477
21:11:20.166 > [ESP32][LFSR] Input (first 16 bytes): 48522D36372053504F322D3936205354 Buffer size: 32 bytes
21:11:20.175 > 3_After_LFSR (32): 3F86CDF427A10C3FA2C917E7255445FC DC19EB27D0C786B0C96BCD17B0C9AE35 
21:11:20.181 > [ESP32][LFSR] Keystream (first 16 bytes): 77D4E0C210815F6FEDFB3ADE137416A8
21:11:20.188 > [ESP32][TINKERBELL] Input (first 16 bytes): 3F86CDF427A10C3FA2C917E7255445FC Nonce: 0x00000001 Buffer size: 32 bytes
21:11:20.196 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C6B5A773
21:11:20.208 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:20.216 > 4_After_Tinkerbell (32): 99C60B5C958723F7A92D2BD609848447 66DE9CC7E0CBCD2A558E7FD94CB2DC33 
21:11:20.224 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:20.230 > 5_After_Transposition (32): 952387F755D97F8E0984844766C79CDE E0CBCD2A990B5CC64CB2DC33A92BD62D        
21:11:20.239 > [ESP32] === HMAC DEBUG INFO ===
21:11:20.242 > [ESP32] HMAC Key being used: CA2A84998A97CA5A40A8EE6D53D70E863ED08F725D266702F68BD61DF800CAA2        
21:11:20.250 > [ESP32] HMAC Input length: 44 bytes
21:11:20.255 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001952387F755D97F8E0984844766C79CDEE0CBCD2A
21:11:20.264 > [ESP32] Nonce: 0x00000001
21:11:20.266 > [ESP32] Packet size before HMAC: 60
21:11:20.269 > [ESP32] Computed HMAC Tag: 0611D87D960E278BE482ED43BB4E7085
21:11:20.275 > [ESP32] === END HMAC DEBUG ===
21:11:20.278 > 6_Final_Packet (60): 810218001800040800000001952387F7 55D97F8E0984844766C79CDEE0CBCD2A ...
21:11:20.283 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:20.285 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:20.295 > Sending pipeline data to server (658 bytes)
21:11:21.951 > [HTTP] Response code: 400
21:11:21.952 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:21.957 > [HTTP] Request failed with code: 400
21:11:21.960 > [RETRY] Send failed, waiting 100 ms before retry
21:11:22.060 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:22.060 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:22.066 > Sending pipeline data to server (658 bytes)
21:11:23.705 > [HTTP] Response code: 400
21:11:23.705 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:23.711 > [HTTP] Request failed with code: 400
21:11:23.713 > [RETRY] Send failed, waiting 200 ms before retry
21:11:23.913 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:23.913 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:23.918 > Sending pipeline data to server (658 bytes)
21:11:27.467 > [HTTP] Response code: 400
21:11:27.467 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:27.472 > [HTTP] Request failed with code: 400
21:11:27.474 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:11:27.480 > [RETRY] Consecutive failures: 2
21:11:27.483 > Health data send failed (retry count: 3/3)
21:11:27.485 > Health data transmission failed after max retries
21:11:27.586 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":427899,"type":"health_data_error"}
21:11:27.600 > [WebSocket] Processing message type: health_data_error
21:11:27.605 > [439.8] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:27.614 > ERROR state - attempting recovery
21:11:27.617 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:27.623 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:27.624 > Generated health data: HR-67 SPO2-96 STEPS-2240
21:11:27.630 > [ESP32] ========================================
21:11:27.633 > [ESP32] ENCRYPTION PIPELINE START
21:11:27.636 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:27.644 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:27.650 > [ESP32] ========================================
21:11:27.655 > [ESP32] MsgKeys: lfsrSeed=0xC2E0D477 tnk[0..3]=C6B5A773 trn[0..3]=D1FB416D
21:11:27.661 > 1_After_Salt (26): 48522D36372053504F322D3936205354 4550532D323234304D50
21:11:27.670 > 2_After_Padding (32): 48522D36372053504F322D3936205354 4550532D323234304D50000000000000
21:11:27.675 > [ESP32][LFSR] Initializing - Seed: 0xC2E0D477 SeedBe: 0x77D4E0C2 ChaosKey[0..3]: C6B5A773 InitialTap: 0x0029 State: 0xC2E0D477
21:11:27.687 > [ESP32][LFSR] Input (first 16 bytes): 48522D36372053504F322D3936205354 Buffer size: 32 bytes
21:11:27.693 > 3_After_LFSR (32): 3F86CDF427A10C3FA2C917E7255445FC DC19EB27D0C484B2C96BCD17B0C9AE35 
21:11:27.702 > [ESP32][LFSR] Keystream (first 16 bytes): 77D4E0C210815F6FEDFB3ADE137416A8
21:11:27.708 > [ESP32][TINKERBELL] Input (first 16 bytes): 3F86CDF427A10C3FA2C917E7255445FC Nonce: 0x00000001 Buffer size: 32 bytes
21:11:27.720 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C6B5A773
21:11:27.731 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:27.739 > 4_After_Tinkerbell (32): 99C60B5C958723F7A92D2BD609848447 66DE9CC7E0C8CF28558E7FD94CB2DC33 
21:11:27.743 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): A640C6A8B2262FC80BE43C312CD0C1BB
21:11:27.753 > 5_After_Transposition (32): 952387F755D97F8E0984844766C79CDE E0C8CF28990B5CC64CB2DC33A92BD62D 
21:11:27.761 > [ESP32] === HMAC DEBUG INFO ===
21:11:27.764 > [ESP32] HMAC Key being used: CA2A84998A97CA5A40A8EE6D53D70E863ED08F725D266702F68BD61DF800CAA2        
21:11:27.773 > [ESP32] HMAC Input length: 44 bytes
21:11:27.775 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001952387F755D97F8E0984844766C79CDEE0C8CF28
21:11:27.786 > [ESP32] Nonce: 0x00000001
21:11:27.786 > [ESP32] Packet size before HMAC: 60
21:11:27.789 > [ESP32] Computed HMAC Tag: 29F8E4EF5D2141D43BBB0A913DF4D308
21:11:27.794 > [ESP32] === END HMAC DEBUG ===
21:11:27.798 > 6_Final_Packet (60): 810218001800040800000001952387F7 55D97F8E0984844766C79CDEE0C8CF28 ...
21:11:27.805 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:27.808 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:27.814 > Sending pipeline data to server (658 bytes)
21:11:27.970 > [HTTP] Response code: 400
21:11:27.971 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:27.976 > [HTTP] Request failed with code: 400
21:11:27.978 > [RETRY] Send failed, waiting 100 ms before retry
21:11:28.081 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:28.081 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:28.087 > Sending pipeline data to server (658 bytes)
21:11:29.725 > [HTTP] Response code: 400
21:11:29.725 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:29.731 > [HTTP] Request failed with code: 400
21:11:29.734 > [RETRY] Send failed, waiting 200 ms before retry
21:11:29.934 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:29.934 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:29.939 > Sending pipeline data to server (658 bytes)
21:11:30.773 > [HTTP] Response code: 400
21:11:30.774 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:30.779 > [HTTP] Request failed with code: 400
21:11:30.782 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:11:30.787 > [RETRY] Consecutive failures: 3
21:11:30.790 > ✗ Auto-recovery failed - restarting key exchange
21:11:32.896 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":429910,"type":"health_data_error"}
21:11:32.910 > [WebSocket] Processing message type: health_data_error
21:11:32.916 > [445.1] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:32.924 > ✓ Public key loaded from NVS
21:11:33.022 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":430159,"type":"health_data_error"}
21:11:33.036 > [WebSocket] Processing message type: health_data_error
21:11:33.041 > [445.2] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:33.144 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":432164,"type":"health_data_error"}
21:11:33.158 > [WebSocket] Processing message type: health_data_error
21:11:33.163 > [445.4] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:33.173 > Generating fresh master key from entropy...
21:11:33.182 > Generated master key (32): 05266E2B01216FAB6A51001714B48ACD 62E6A2F528A6FA779F390924985B31C2 
21:11:33.187 > Using reduced master key (byte % 3) for NTRU encryption only
21:11:33.197 > NTRU encrypted master key (502): 0073006A004F007E00190009001B0071 00160077001200050020006B007A0004 ...
21:11:33.206 > POST http://10.249.92.115:8081/master-key
21:11:33.741 > ✓ Master key exchange completed
21:11:33.843 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":434168,"type":"health_data_error"}
21:11:33.857 > [WebSocket] Processing message type: health_data_error
21:11:33.863 > [446.1] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:33.871 > Loading master key from NVS and deriving symmetric keys...
21:11:33.876 > Loaded master key from NVS (32): 05266E2B01216FAB6A51001714B48ACD 62E6A2F528A6FA779F390924985B31C2 
21:11:33.885 > Derived HMAC key (32): FB12C35F525F1D029E0FA31EE144E4FC E2661A84FEB140A56487D8BE47B75A8D
21:11:33.893 > Derived Tinkerbell key (16): 83D0195903F649C6A4DFBA190E2B718D
21:11:33.898 > Derived Transposition key (16): C490DD2A6DFCED8403DD3FFD4D62E64C 
21:11:33.905 > ✓ Symmetric keys derived successfully
21:11:33.907 > Nonce tracker reset - new session started
21:11:34.403 > Waiting for server to process master key...
21:11:34.407 > ✓ Symmetric keys ready - starting health data transmission
21:11:34.508 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":435921,"type":"health_data_error"}
21:11:34.523 > [WebSocket] Processing message type: health_data_error
21:11:34.528 > [446.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:34.632 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":439682,"type":"health_data_error"}
21:11:34.646 > [WebSocket] Processing message type: health_data_error
21:11:34.651 > [446.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:34.754 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":440186,"type":"health_data_error"}
21:11:34.768 > [WebSocket] Processing message type: health_data_error
21:11:34.773 > [447.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:34.876 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":441941,"type":"health_data_error"}
21:11:34.890 > [WebSocket] Processing message type: health_data_error
21:11:34.896 > [447.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:34.999 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":442989,"type":"health_data_error"}
21:11:35.013 > [WebSocket] Processing message type: health_data_error
21:11:35.018 > [447.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:35.121 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528493600,"type":"master_key_received"}
21:11:35.134 > [WebSocket] Processing message type: master_key_received
21:11:35.138 > [447.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.243 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":445950,"type":"master_key_exchanged"}
21:11:35.259 > [WebSocket] Processing message type: master_key_exchanged
21:11:35.265 > [447.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.366 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":446619,"type":"symmetric_keys_derived"}
21:11:35.381 > [WebSocket] Processing message type: symmetric_keys_derived
21:11:35.388 > [447.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.487 > [447.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.588 > [447.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.689 > [447.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.790 > [448.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.891 > [448.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:35.992 > [448.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.093 > [448.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.194 > [448.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.296 > [448.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.397 > [448.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.498 > [448.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.599 > [448.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.698 > [448.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.800 > [449.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:36.901 > [449.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.002 > [449.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.104 > [449.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.205 > [449.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.305 > [449.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.407 > [449.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.508 > [449.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.608 > [449.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.709 > [449.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.811 > [450.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:37.911 > [450.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.012 > [450.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.113 > [450.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.214 > [450.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.315 > [450.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.416 > [450.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.518 > [450.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.618 > [450.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.720 > [450.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.821 > [451.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:38.922 > [451.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.022 > [451.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.123 > [451.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.224 > [451.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.325 > [451.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.426 > [451.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.526 > [451.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.627 > [451.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.729 > [451.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.830 > [452.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:39.930 > [452.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.032 > [452.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.134 > [452.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.234 > [452.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.336 > [452.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.436 > [452.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.538 > [452.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.639 > [452.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.739 > [453.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.840 > [453.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:40.941 > [453.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.042 > [453.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.143 > [453.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.244 > [453.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.345 > [453.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.445 > [453.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.547 > [453.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.648 > [453.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.749 > [454.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.850 > [454.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:41.952 > [454.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.052 > [454.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.154 > [454.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.255 > [454.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.355 > [454.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.456 > [454.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.557 > [454.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.657 > [454.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.759 > [455.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.860 > [455.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:42.961 > [455.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.062 > [455.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.163 > [455.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.264 > [455.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.365 > [455.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.466 > [455.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.567 > [455.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.669 > [455.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.770 > [456.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.871 > [456.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:43.971 > [456.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.073 > [456.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.173 > [456.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.274 > [456.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.375 > [456.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.476 > [456.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:11:44.482 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:44.487 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:44.493 > Generated health data: HR-67 SPO2-96 STEPS-2318
21:11:44.495 > [ESP32] ========================================
21:11:44.501 > [ESP32] ENCRYPTION PIPELINE START
21:11:44.504 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:44.512 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:44.518 > [ESP32] ========================================
21:11:44.523 > [ESP32] MsgKeys: lfsrSeed=0xAC217630 tnk[0..3]=C998B0A4 trn[0..3]=D0DC81B7
21:11:44.529 > 1_After_Salt (26): 48522D36372053504F322D3936205354 4550532D323331384D50
21:11:44.535 > 2_After_Padding (32): 48522D36372053504F322D3936205354 4550532D323331384D50000000000000 
21:11:44.542 > [ESP32][LFSR] Initializing - Seed: 0xAC217630 SeedBe: 0x307621AC ChaosKey[0..3]: C998B0A4 InitialTap: 0x0029 State: 0xAC217630
21:11:44.554 > [ESP32][LFSR] Input (first 16 bytes): 48522D36372053504F322D3936205354 Buffer size: 32 bytes
21:11:44.562 > 3_After_LFSR (32): 78240C9A4CA3342E40C6F13A283D577E BF34C74461630352185AD22D005E0CEB 
21:11:44.571 > [ESP32][LFSR] Keystream (first 16 bytes): 307621AC7B83677E0FF4DC031E1D042A
21:11:44.576 > [ESP32][TINKERBELL] Input (first 16 bytes): 78240C9A4CA3342E40C6F13A283D577E Nonce: 0x00000001 Buffer size: 32 bytes
21:11:44.587 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C998B0A4
21:11:44.596 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:11:44.604 > 4_After_Tinkerbell (32): 3734EC7C07636B27BDF194143C82CD68 F8E5D46237BF98D053167BAE31A6C24D
21:11:44.612 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:11:44.621 > 5_After_Transposition (32): A6E5947CD46B823198CD3463EC07D062 F14DBF276816F8533CC2147B37BD37AE        
21:11:44.629 > [ESP32] === HMAC DEBUG INFO ===
21:11:44.632 > [ESP32] HMAC Key being used: FB12C35F525F1D029E0FA31EE144E4FCE2661A84FEB140A56487D8BE47B75A8D        
21:11:44.640 > [ESP32] HMAC Input length: 44 bytes
21:11:44.643 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001A6E5947CD46B823198CD3463EC07D062F14DBF27
21:11:44.651 > [ESP32] Nonce: 0x00000001
21:11:44.654 > [ESP32] Packet size before HMAC: 60
21:11:44.657 > [ESP32] Computed HMAC Tag: F81699441B9F45EC7A93B59EA81F099C
21:11:44.662 > [ESP32] === END HMAC DEBUG ===
21:11:44.665 > 6_Final_Packet (60): 810218001800040800000001A6E5947C D46B823198CD3463EC07D062F14DBF27 ...
21:11:44.673 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:44.676 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:44.682 > Sending pipeline data to server (658 bytes)
21:11:46.240 > [HTTP] Response code: 400
21:11:46.240 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:46.246 > [HTTP] Request failed with code: 400
21:11:46.248 > [RETRY] Send failed, waiting 100 ms before retry
21:11:46.348 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:46.348 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:46.353 > Sending pipeline data to server (658 bytes)
21:11:49.518 > [HTTP] Response code: 400
21:11:49.519 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:49.523 > [HTTP] Request failed with code: 400
21:11:49.527 > [RETRY] Send failed, waiting 200 ms before retry
21:11:49.726 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:49.728 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:49.733 > Sending pipeline data to server (658 bytes)
21:11:50.882 > [HTTP] Response code: 400
21:11:50.883 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:50.888 > [HTTP] Request failed with code: 400
21:11:50.890 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:11:50.895 > [RETRY] Consecutive failures: 4
21:11:50.898 > Health data send failed (retry count: 1/3)
21:11:51.003 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":458457,"type":"health_data_error"}
21:11:51.017 > [WebSocket] Processing message type: health_data_error
21:11:51.022 > [463.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:11:51.031 > [RETRY] Attempting to send health data (Max retries: 3)
21:11:51.036 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:11:51.042 > Generated health data: HR-67 SPO2-96 STEPS-2346
21:11:51.045 > [ESP32] ========================================
21:11:51.050 > [ESP32] ENCRYPTION PIPELINE START
21:11:51.053 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:11:51.058 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:11:51.066 > [ESP32] ========================================
21:11:51.069 > [ESP32] MsgKeys: lfsrSeed=0xAC217630 tnk[0..3]=C998B0A4 trn[0..3]=D0DC81B7
21:11:51.077 > 1_After_Salt (26): 48522D36372053504F322D3936205354 4550532D323334364D50
21:11:51.084 > 2_After_Padding (32): 48522D36372053504F322D3936205354 4550532D323334364D50000000000000
21:11:51.092 > [ESP32][LFSR] Initializing - Seed: 0xAC217630 SeedBe: 0x307621AC ChaosKey[0..3]: C998B0A4 InitialTap: 0x0029 State: 0xAC217630
21:11:51.103 > [ESP32][LFSR] Input (first 16 bytes): 48522D36372053504F322D3936205354 Buffer size: 32 bytes
21:11:51.111 > 3_After_LFSR (32): 78240C9A4CA3342E40C6F13A283D577E BF34C7446163065C185AD22D005E0CEB 
21:11:51.117 > [ESP32][LFSR] Keystream (first 16 bytes): 307621AC7B83677E0FF4DC031E1D042A
21:11:51.124 > [ESP32][TINKERBELL] Input (first 16 bytes): 78240C9A4CA3342E40C6F13A283D577E Nonce: 0x00000001 Buffer size: 32 bytes
21:11:51.133 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C998B0A4
21:11:51.144 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:11:51.153 > 4_After_Tinkerbell (32): 3734EC7C07636B27BDF194143C82CD68 F8E5D46237BF9DDE53167BAE31A6C24D 
21:11:51.161 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:11:51.167 > 5_After_Transposition (32): A6E5947CD46B82319DCD3463EC07DE62 F14DBF276816F8533CC2147B37BD37AE 
21:11:51.175 > [ESP32] === HMAC DEBUG INFO ===
21:11:51.177 > [ESP32] HMAC Key being used: FB12C35F525F1D029E0FA31EE144E4FCE2661A84FEB140A56487D8BE47B75A8D
21:11:51.186 > [ESP32] HMAC Input length: 44 bytes
21:11:51.191 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001A6E5947CD46B82319DCD3463EC07DE62F14DBF27
21:11:51.200 > [ESP32] Nonce: 0x00000001
21:11:51.202 > [ESP32] Packet size before HMAC: 60
21:11:51.206 > [ESP32] Computed HMAC Tag: 4949463DCD70F166EF4AA11F2C9CF701
21:11:51.212 > [ESP32] === END HMAC DEBUG ===
21:11:51.214 > 6_Final_Packet (60): 810218001800040800000001A6E5947C D46B82319DCD3463EC07DE62F14DBF27 ...
21:11:51.220 > [RETRY] Attempt 1/3 (nonce: 1)
21:11:51.222 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:51.227 > Sending pipeline data to server (658 bytes)
21:11:52.759 > [HTTP] Response code: 400
21:11:52.759 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:52.764 > [HTTP] Request failed with code: 400
21:11:52.767 > [RETRY] Send failed, waiting 100 ms before retry
21:11:52.868 > [RETRY] Attempt 2/3 (nonce: 1)
21:11:52.868 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:52.874 > Sending pipeline data to server (658 bytes)
21:11:56.015 > [HTTP] Response code: 400
21:11:56.015 > [HTTP] Error response: {"error":"Decryption failed"}
21:11:56.020 > [HTTP] Request failed with code: 400
21:11:56.023 > [RETRY] Send failed, waiting 200 ms before retry
21:11:56.223 > [RETRY] Attempt 3/3 (nonce: 1)
21:11:56.223 > POST http://10.249.92.115:8081/health-data with pipeline data
21:11:56.227 > Sending pipeline data to server (658 bytes)

21:12:03.030 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:03.036 > [HTTP] Request failed with code: 400
21:12:03.038 > [RETRY] Send failed, waiting 100 ms before retry
21:12:03.139 > [RETRY] Attempt 2/3 (nonce: 1)
21:12:03.139 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:03.144 > Sending pipeline data to server (658 bytes)
21:12:03.275 > [HTTP] Response code: 400
21:12:03.275 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:03.281 > [HTTP] Request failed with code: 400
21:12:03.284 > [RETRY] Send failed, waiting 200 ms before retry
21:12:03.484 > [RETRY] Attempt 3/3 (nonce: 1)
21:12:03.484 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:03.489 > Sending pipeline data to server (658 bytes)
21:12:05.051 > [HTTP] Response code: 400
21:12:05.052 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:05.057 > [HTTP] Request failed with code: 400
21:12:05.060 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:12:05.065 > [RETRY] Consecutive failures: 1
21:12:05.068 > Health data send failed (retry count: 3/3)
21:12:05.071 > Health data transmission failed after max retries
21:12:05.171 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":463099,"type":"health_data_error"}
21:12:05.185 > [WebSocket] Processing message type: health_data_error
21:12:05.190 > [477.4] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:05.198 > ERROR state - attempting recovery
21:12:05.201 > [RETRY] Attempting to send health data (Max retries: 3)
21:12:05.207 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:12:05.210 > Generated health data: HR-69 SPO2-96 STEPS-2392
21:12:05.215 > [ESP32] ========================================
21:12:05.218 > [ESP32] ENCRYPTION PIPELINE START
21:12:05.221 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:12:05.230 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:12:05.235 > [ESP32] ========================================
21:12:05.240 > [ESP32] MsgKeys: lfsrSeed=0xAC217630 tnk[0..3]=C998B0A4 trn[0..3]=D0DC81B7
21:12:05.246 > 1_After_Salt (26): 48522D36392053504F322D3936205354 4550532D323339324D50
21:12:05.255 > 2_After_Padding (32): 48522D36392053504F322D3936205354 4550532D323339324D50000000000000
21:12:05.260 > [ESP32][LFSR] Initializing - Seed: 0xAC217630 SeedBe: 0x307621AC ChaosKey[0..3]: C998B0A4 InitialTap: 0x0029 State: 0xAC217630
21:12:05.271 > [ESP32][LFSR] Input (first 16 bytes): 48522D36392053504F322D3936205354 Buffer size: 32 bytes
21:12:05.279 > 3_After_LFSR (32): 78240C9A42A3342E40C6F13A283D577E BF34C74461630B58185AD22D005E0CEB 
21:12:05.288 > [ESP32][LFSR] Keystream (first 16 bytes): 307621AC7B83677E0FF4DC031E1D042A
21:12:05.293 > [ESP32][TINKERBELL] Input (first 16 bytes): 78240C9A42A3342E40C6F13A283D577E Nonce: 0x00000001 Buffer size: 32 bytes
21:12:05.304 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: C998B0A4
21:12:05.315 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:12:05.324 > 4_After_Tinkerbell (32): 3734EC7C09636B27BDF194143C82CD68 F8E5D46237BF90DA53167BAE31A6C24D
21:12:05.329 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4F10E0E64BC05F09FD37652E14BF9A16
21:12:05.337 > 5_After_Transposition (32): A6E5947CD46B823190CD3463EC09DA62 F14DBF276816F8533CC2147B37BD37AE        
21:12:05.346 > [ESP32] === HMAC DEBUG INFO ===
21:12:05.349 > [ESP32] HMAC Key being used: FB12C35F525F1D029E0FA31EE144E4FCE2661A84FEB140A56487D8BE47B75A8D        
21:12:05.357 > [ESP32] HMAC Input length: 44 bytes
21:12:05.360 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001A6E5947CD46B823190CD3463EC09DA62F14DBF27
21:12:05.371 > [ESP32] Nonce: 0x00000001
21:12:05.371 > [ESP32] Packet size before HMAC: 60
21:12:05.374 > [ESP32] Computed HMAC Tag: F757EBB11DB13DD9AA35E03AADEC0775
21:12:05.379 > [ESP32] === END HMAC DEBUG ===
21:12:05.382 > 6_Final_Packet (60): 810218001800040800000001A6E5947C D46B823190CD3463EC09DA62F14DBF27 ...
21:12:05.390 > [RETRY] Attempt 1/3 (nonce: 1)
21:12:05.393 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:05.399 > Sending pipeline data to server (658 bytes)
21:12:08.546 > [HTTP] Response code: 400
21:12:08.546 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:08.552 > [HTTP] Request failed with code: 400
21:12:08.555 > [RETRY] Send failed, waiting 100 ms before retry
21:12:08.655 > [RETRY] Attempt 2/3 (nonce: 1)
21:12:08.655 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:08.661 > Sending pipeline data to server (658 bytes)
21:12:08.793 > [HTTP] Response code: 400
21:12:08.793 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:08.799 > [HTTP] Request failed with code: 400
21:12:08.801 > [RETRY] Send failed, waiting 200 ms before retry
21:12:09.001 > [RETRY] Attempt 3/3 (nonce: 1)
21:12:09.001 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:09.007 > Sending pipeline data to server (658 bytes)
21:12:10.550 > [HTTP] Response code: 400
21:12:10.550 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:10.556 > [HTTP] Request failed with code: 400
21:12:10.558 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:12:10.564 > [RETRY] Consecutive failures: 2
21:12:10.567 > ✗ Auto-recovery failed - restarting key exchange
21:12:12.672 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":464976,"type":"health_data_error"}
21:12:12.686 > [WebSocket] Processing message type: health_data_error
21:12:12.691 > [484.9] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:12:12.700 > ✓ Public key loaded from NVS
21:12:12.798 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":468231,"type":"health_data_error"}
21:12:12.812 > [WebSocket] Processing message type: health_data_error
21:12:12.817 > [485.0] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:12.921 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":471742,"type":"health_data_error"}
21:12:12.934 > [WebSocket] Processing message type: health_data_error
21:12:12.940 > [485.1] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED      
21:12:12.949 > Generating fresh master key from entropy...
21:12:12.957 > Generated master key (32): F274DEE28C6F8C9B4C8ECE451BEB07D5 DD78AC1EBAEB93A0D7F57D8453BC9EB6
21:12:12.963 > Using reduced master key (byte % 3) for NTRU encryption only
21:12:12.972 > NTRU encrypted master key (502): 0073006A004D007E001A0009001D0073 0016007800140003001E006C007B0003 ...
21:12:12.982 > POST http://10.249.92.115:8081/master-key
21:12:14.571 > ✓ Master key exchange completed
21:12:14.672 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":475247,"type":"health_data_error"}
21:12:14.687 > [WebSocket] Processing message type: health_data_error
21:12:14.693 > [486.9] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:14.701 > Loading master key from NVS and deriving symmetric keys...
21:12:14.706 > Loaded master key from NVS (32): F274DEE28C6F8C9B4C8ECE451BEB07D5 DD78AC1EBAEB93A0D7F57D8453BC9EB6   
21:12:14.715 > Derived HMAC key (32): CE791434DFDE498DB05FADFDDEE96311 D002C216F5196C818B9A8DF60882B270 
21:12:14.723 > Derived Tinkerbell key (16): 3EA77F7C2A08600A8F38BA1E36BAB291
21:12:14.729 > Derived Transposition key (16): B19606A5775633F3EACF26290022AFCD 
21:12:14.734 > ✓ Symmetric keys derived successfully
21:12:14.736 > Nonce tracker reset - new session started
21:12:15.233 > Waiting for server to process master key...
21:12:15.237 > ✓ Symmetric keys ready - starting health data transmission
21:12:15.339 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":475492,"type":"health_data_error"}
21:12:15.352 > [WebSocket] Processing message type: health_data_error
21:12:15.358 > [487.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:12:15.462 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":7,"success":false,"timestamp":477269,"type":"health_data_error"}
21:12:15.474 > [WebSocket] Processing message type: health_data_error
21:12:15.481 > [487.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:15.584 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":480764,"type":"health_data_error"}
21:12:15.597 > [WebSocket] Processing message type: health_data_error
21:12:15.603 > [487.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:15.706 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":481011,"type":"health_data_error"}
21:12:15.720 > [WebSocket] Processing message type: health_data_error
21:12:15.726 > [487.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:15.829 > [WebSocket] Received (154 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Failed to send health data","state":8,"success":false,"timestamp":482768,"type":"health_data_error"}
21:12:15.843 > [WebSocket] Processing message type: health_data_error
21:12:15.848 > [488.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:15.950 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528534387,"type":"master_key_received"}
21:12:15.964 > [WebSocket] Processing message type: master_key_received
21:12:15.967 > [488.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:12:16.072 > [WebSocket] Received (175 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":486778,"type":"master_key_exchanged"}        
21:12:16.090 > [WebSocket] Processing message type: master_key_exchanged
21:12:16.095 > [488.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:12:16.195 > [WebSocket] Received (167 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":487450,"type":"symmetric_keys_derived"}
21:12:16.211 > [WebSocket] Processing message type: symmetric_keys_derived
21:12:16.217 > [488.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED        
21:12:16.316 > [488.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.418 > [488.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.518 > [488.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.619 > [488.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.720 > [488.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.822 > [489.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:16.922 > [489.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.023 > [489.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.124 > [489.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.225 > [489.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.326 > [489.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.427 > [489.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.527 > [489.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.629 > [489.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.730 > [489.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.831 > [490.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:17.932 > [490.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.033 > [490.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.134 > [490.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.235 > [490.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.336 > [490.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.436 > [490.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.539 > [490.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.639 > [490.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.740 > [491.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.841 > [491.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:18.942 > [491.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.043 > [491.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.144 > [491.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.245 > [491.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.346 > [491.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.447 > [491.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.548 > [491.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.649 > [491.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.750 > [492.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.851 > [492.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:19.952 > [492.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.053 > [492.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.155 > [492.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.255 > [492.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.356 > [492.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.457 > [492.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.557 > [492.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.659 > [492.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.760 > [493.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.860 > [493.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:20.962 > [493.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.062 > [493.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.164 > [493.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.265 > [493.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.366 > [493.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.467 > [493.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.568 > [493.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.669 > [493.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.770 > [494.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.871 > [494.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:21.972 > [494.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.072 > [494.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.173 > [494.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.275 > [494.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.376 > [494.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.477 > [494.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.578 > [494.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.679 > [494.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.780 > [495.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.881 > [495.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:22.981 > [495.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.083 > [495.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.183 > [495.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.285 > [495.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.386 > [495.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.487 > [495.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.587 > [495.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.689 > [495.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.790 > [496.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.891 > [496.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:23.992 > [496.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.093 > [496.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.193 > [496.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.294 > [496.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.396 > [496.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.497 > [496.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.597 > [496.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.698 > [496.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.800 > [497.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:24.900 > [497.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:25.001 > [497.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:25.103 > [497.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:25.204 > [497.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:25.304 > [497.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
21:12:25.310 > [RETRY] Attempting to send health data (Max retries: 3)
21:12:25.316 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:12:25.322 > Generated health data: HR-68 SPO2-96 STEPS-2505
21:12:25.324 > [ESP32] ========================================
21:12:25.330 > [ESP32] ENCRYPTION PIPELINE START
21:12:25.332 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:12:25.341 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:12:25.347 > [ESP32] ========================================
21:12:25.352 > [ESP32] MsgKeys: lfsrSeed=0xE8365AFF tnk[0..3]=CDABA506 trn[0..3]=B9163C99
21:12:25.357 > 1_After_Salt (26): 48522D36382053504F322D3936205354 4550532D323530354D50
21:12:25.362 > 2_After_Padding (32): 48522D36382053504F322D3936205354 4550532D323530354D50000000000000 
21:12:25.371 > [ESP32][LFSR] Initializing - Seed: 0xE8365AFF SeedBe: 0xFF5A36E8 ChaosKey[0..3]: CDABA506 InitialTap: 0x0029 State: 0xE8365AFF
21:12:25.382 > [ESP32][LFSR] Input (first 16 bytes): 48522D36382053504F322D3936205354 Buffer size: 32 bytes
21:12:25.391 > 3_After_LFSR (32): B7081BDEFDF04C6680F4A474F6C2D0D6 20CBA682418B96A73372CA707B0655CC
21:12:25.398 > [ESP32][LFSR] Keystream (first 16 bytes): FF5A36E8C5D01F36CFC6894DC0E28382
21:12:25.404 > [ESP32][TINKERBELL] Input (first 16 bytes): B7081BDEFDF04C6680F4A474F6C2D0D6 Nonce: 0x00000001 Buffer size: 32 bytes
21:12:25.415 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: CDABA506
21:12:25.424 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): BA57EC913BB769A95433EC0C14D86421
21:12:25.432 > 4_After_Tinkerbell (32): 0D5FF74FC64725CFD4C74878E21AB4F7 881BB439D102784AE862EF648D18DBCE
21:12:25.441 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): BA57EC913BB769A95433EC0C14D86421
21:12:25.449 > 5_After_Transposition (32): 0DF75F47C64F25CFD448C71AE278B4F7 B41B88188D64CEDBEF62E802D1394A78        
21:12:25.457 > [ESP32] === HMAC DEBUG INFO ===
21:12:25.461 > [ESP32] HMAC Key being used: CE791434DFDE498DB05FADFDDEE96311D002C216F5196C818B9A8DF60882B270
21:12:25.469 > [ESP32] HMAC Input length: 44 bytes
21:12:25.472 > [ESP32] HMAC Input (first 32 bytes): 8102180018000408000000010DF75F47C64F25CFD448C71AE278B4F7B41B8818
21:12:25.480 > [ESP32] Nonce: 0x00000001
21:12:25.483 > [ESP32] Packet size before HMAC: 60
21:12:25.486 > [ESP32] Computed HMAC Tag: BE7D121E6AFA3DCF90AFF8828011E055
21:12:25.491 > [ESP32] === END HMAC DEBUG ===
21:12:25.493 > 6_Final_Packet (60): 8102180018000408000000010DF75F47 C64F25CFD448C71AE278B4F7B41B8818 ...
21:12:25.502 > [RETRY] Attempt 1/3 (nonce: 1)
21:12:25.505 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:25.511 > Sending pipeline data to server (658 bytes)
21:12:26.679 > [HTTP] Response code: 200
21:12:26.679 > [HTTP] Response: {"status":"OK:DECRYPTED"}
21:12:26.689 > [RETRY] Health data sent successfully!
21:12:26.692 > ✓ Health data #10 sent successfully
21:12:26.795 > [WebSocket] Received (183 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":13,"serverTime":1769528545625,"type":"security_update"}
21:12:26.811 > [WebSocket] Processing message type: security_update
21:12:26.817 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
21:12:26.822 > [499.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:12:26.928 > [WebSocket] Received (685 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","encData":"ENC_DATA:8102180018000408000000010DF75F47C64F25CFD448C71AE278B4F7B41B88188D64CEDBEF62E802D1394A78BE7D121E6AFA3DCF90AFF8828011E055","pipeline":{"afterLFSR":"B7081BDEFDF04C6680F4A474F6C2D0D620CBA682418B96A73372CA707B0655CC","afterSalt":"48522D36382053504F322D39362053544550532D323530354D50","afterTinkerbell":"0D5FF74FC64725CFD4C74878E21AB4F7881BB439D102784AE862EF648D18DBCE","afterTransposition":"0DF75F47C64F25CFD448C71AE278B4F7B41B88188D64CEDBEF62E802D1394A78"},"plaintext":"HR-68 SPO2-96 STEPS-2505","serverTime":1769528545625,"timestamp":497727,"type":"encryption_update","ztmEnabled":false}
21:12:26.988 > [WebSocket] Processing message type: encryption_update
21:12:26.994 > [499.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:12:27.101 > [WebSocket] Received (88 bytes): {"heartRate":68,"spo2":96,"steps":2505,"time":1769528545625,"type":"health_data_update"}
21:12:27.109 > [WebSocket] Processing message type: health_data_update
21:12:27.115 > [499.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:27.223 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":4.7188,"encryptionTime":0.0,"finalPlaintext":"HR-68 SPO2-96 STEPS-2505","handshakeSuccess":true,"totalTime":4.7188},"type":"session_summary_update"}
21:12:27.245 > [WebSocket] Processing message type: session_summary_update
21:12:27.251 > [499.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:12:27.356 > [WebSocket] Received (658 bytes): {"decryptionTime":4.7188,"encryptedPacket":"8102180018000408000000010DF75F47C64F25CFD448C71AE278B4F7B41B88188D64CEDBEF62E802D1394A78BE7D121E6AFA3DCF90AFF8828011E055","finalPlaintext":"HR-68 SPO2-96 STEPS-2505","healthData":{"heartRate":68,"spo2":96,"steps":2505},"pipeline":{"afterDepad":"48522D36382053504F322D39362053544550532D32353035000000000000","afterLFSR":"48522D36382053504F322D39362053544550532D323530354D50000000000000","afterTinkerbell":"B7081BDEFDF04C6680F4A474F6C2D0D620CBA682418B96A73372CA707B0655CC","afterTransposition":"0D5FF74FC64725CFD4C74878E21AB4F7881BB439D102784AE862EF648D18DBCE"},"serverTime":1769528545626,"type":"decryption_update"}
21:12:27.415 > [WebSocket] Processing message type: decryption_update
21:12:27.421 > [WebSocket] Server decryption completed
21:12:27.424 > [WebSocket] Health data - HR: 68, SPO2: 96, Steps: 2505
21:12:27.429 > [499.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:27.532 > [WebSocket] Received (697 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","deviceId":"f9641d44","healthSendCount":9,"pipeline":{"afterLFSR":"B7081BDEFDF04C6680F4A474F6C2D0D620CBA682418B96A73372CA707B0655CC","afterSalt":"48522D36382053504F322D39362053544550532D323530354D50","afterTinkerbell":"0D5FF74FC64725CFD4C74878E21AB4F7881BB439D102784AE862EF648D18DBCE","afterTransposition":"0DF75F47C64F25CFD448C71AE278B4F7B41B88188D64CEDBEF62E802D1394A78","finalPacket":"8102180018000408000000010DF75F47C64F25CFD448C71AE278B4F7B41B88188D64CEDBEF62E802D1394A78BE7D121E6AFA3DCF90AFF8828011E055"},"plaintext":"HR-68 SPO2-96 STEPS-2505","timestamp":498896,"type":"encryption_pipeline","ztmEnabled":false}
21:12:27.592 > [WebSocket] Processing message type: encryption_pipeline
21:12:27.598 > [499.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:27.705 > [WebSocket] Received (159 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Health data #10 sent successfully","state":7,"success":true,"timestamp":498901,"type":"health_data_sent"}
21:12:27.722 > [WebSocket] Processing message type: health_data_sent
21:12:27.725 > [499.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:27.827 > [500.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:27.928 > [500.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.028 > [500.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.130 > [500.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.231 > [500.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.332 > [500.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.433 > [500.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.535 > [500.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.635 > [500.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.736 > [501.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.837 > [501.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:28.938 > [501.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.038 > [501.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.140 > [501.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.241 > [501.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.342 > [501.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.443 > [501.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.544 > [501.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.645 > [501.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.746 > [502.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.847 > [502.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:29.948 > [502.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.049 > [502.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.150 > [502.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.250 > [502.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.352 > [502.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.453 > [502.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.554 > [502.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.654 > [502.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.756 > [503.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.856 > [503.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:30.958 > [503.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.059 > [503.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.160 > [503.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.261 > [503.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.362 > [503.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.463 > [503.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.564 > [503.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.664 > [503.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.766 > [504.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.866 > [504.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:31.968 > [504.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.068 > [504.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.170 > [504.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.271 > [504.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.372 > [504.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.473 > [504.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.574 > [504.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.675 > [504.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.776 > [505.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.876 > [505.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:32.977 > [505.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.079 > [505.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.180 > [505.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.281 > [505.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.381 > [505.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.483 > [505.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.584 > [505.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.685 > [505.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.785 > [506.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.887 > [506.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:33.988 > [506.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.088 > [506.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.190 > [506.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.291 > [506.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.392 > [506.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.492 > [506.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.594 > [506.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.694 > [506.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.796 > [507.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.896 > [507.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:34.998 > [507.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.098 > [507.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.200 > [507.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.301 > [507.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.402 > [507.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.502 > [507.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.604 > [507.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.704 > [507.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.805 > [508.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:35.907 > [508.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.007 > [508.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.109 > [508.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.210 > [508.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.311 > [508.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.412 > [508.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.513 > [508.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.613 > [508.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.715 > [508.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:36.721 > [RETRY] Attempting to send health data (Max retries: 3)
21:12:36.726 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:12:36.731 > Generated health data: HR-68 SPO2-96 STEPS-2545
21:12:36.734 > [ESP32] ========================================
21:12:36.740 > [ESP32] ENCRYPTION PIPELINE START
21:12:36.742 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:12:36.750 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:12:36.757 > [ESP32] ========================================
21:12:36.762 > [ESP32] MsgKeys: lfsrSeed=0x9B40890C tnk[0..3]=0DC4FE32 trn[0..3]=FDA11B66
21:12:36.766 > 1_After_Salt (26): 48522D36382053504F322D3936205354 4550532D323534354D50
21:12:36.773 > 2_After_Padding (32): 48522D36382053504F322D3936205354 4550532D323534354D50000000000000 
21:12:36.781 > [ESP32][LFSR] Initializing - Seed: 0x9B40890C SeedBe: 0x0C89409B ChaosKey[0..3]: 0DC4FE32 InitialTap: 0x0029 State: 0x9B40890C
21:12:36.792 > [ESP32][LFSR] Input (first 16 bytes): 48522D36382053504F322D3936205354 Buffer size: 32 bytes
21:12:36.801 > 3_After_LFSR (32): 44DB6DADA7D3568D8AD1EEF0A8AD6658 A0E6AED61AD078A6E29BAE4082B43AD2 
21:12:36.809 > [ESP32][LFSR] Keystream (first 16 bytes): 0C89409B9FF305DDC5E3C3C99E8D350C
21:12:36.815 > [ESP32][TINKERBELL] Input (first 16 bytes): 44DB6DADA7D3568D8AD1EEF0A8AD6658 Nonce: 0x00000002 Buffer size: 32 bytes
21:12:36.825 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 0DC4FE32
21:12:36.834 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:36.843 > 4_After_Tinkerbell (32): 0AE32374E21F5A806E3ECC5E74FAD8F4 083323B7F3F5578CAEC2E69AD95B84A1
21:12:36.850 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:36.859 > 5_After_Transposition (32): 33086E3E805AB723C2AE0AE3F4D89AE6 F3F52374578CE21FD95BCC5E84A174FA        
21:12:36.868 > [ESP32] === HMAC DEBUG INFO ===
21:12:36.870 > [ESP32] HMAC Key being used: CE791434DFDE498DB05FADFDDEE96311D002C216F5196C818B9A8DF60882B270
21:12:36.879 > [ESP32] HMAC Input length: 44 bytes
21:12:36.881 > [ESP32] HMAC Input (first 32 bytes): 81021800180004080000000233086E3E805AB723C2AE0AE3F4D89AE6F3F52374
21:12:36.890 > [ESP32] Nonce: 0x00000002
21:12:36.892 > [ESP32] Packet size before HMAC: 60
21:12:36.895 > [ESP32] Computed HMAC Tag: 1961BB65EFA364E4F79B9DBFE35697B8
21:12:36.901 > [ESP32] === END HMAC DEBUG ===
21:12:36.903 > 6_Final_Packet (60): 81021800180004080000000233086E3E 805AB723C2AE0AE3F4D89AE6F3F52374 ...
21:12:36.912 > [RETRY] Attempt 1/3 (nonce: 2)
21:12:36.915 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:36.921 > Sending pipeline data to server (658 bytes)
21:12:37.063 > [HTTP] Response code: 400
21:12:37.064 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:37.068 > [HTTP] Request failed with code: 400
21:12:37.072 > [RETRY] Send failed, waiting 100 ms before retry
21:12:37.171 > [RETRY] Attempt 2/3 (nonce: 2)
21:12:37.172 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:37.177 > Sending pipeline data to server (658 bytes)
21:12:40.572 > [HTTP] Response code: 400
21:12:40.572 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:40.577 > [HTTP] Request failed with code: 400
21:12:40.580 > [RETRY] Send failed, waiting 200 ms before retry
21:12:40.783 > [RETRY] Attempt 3/3 (nonce: 2)
21:12:40.783 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:40.788 > Sending pipeline data to server (658 bytes)
21:12:42.325 > [HTTP] Response code: 400
21:12:42.325 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:42.331 > [HTTP] Request failed with code: 400
21:12:42.333 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:12:42.339 > [RETRY] Consecutive failures: 1
21:12:42.341 > Health data send failed (retry count: 1/3)
21:12:42.448 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":509282,"type":"health_data_error"}
21:12:42.462 > [WebSocket] Processing message type: health_data_error
21:12:42.466 > [514.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:12:42.474 > [RETRY] Attempting to send health data (Max retries: 3)
21:12:42.481 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:12:42.487 > Generated health data: HR-68 SPO2-96 STEPS-2572
21:12:42.490 > [ESP32] ========================================
21:12:42.495 > [ESP32] ENCRYPTION PIPELINE START
21:12:42.498 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:12:42.503 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:12:42.511 > [ESP32] ========================================
21:12:42.515 > [ESP32] MsgKeys: lfsrSeed=0x9B40890C tnk[0..3]=0DC4FE32 trn[0..3]=FDA11B66
21:12:42.523 > 1_After_Salt (26): 48522D36382053504F322D3936205354 4550532D323537324D50
21:12:42.529 > 2_After_Padding (32): 48522D36382053504F322D3936205354 4550532D323537324D50000000000000 
21:12:42.536 > [ESP32][LFSR] Initializing - Seed: 0x9B40890C SeedBe: 0x0C89409B ChaosKey[0..3]: 0DC4FE32 InitialTap: 0x0029 State: 0x9B40890C
21:12:42.548 > [ESP32][LFSR] Input (first 16 bytes): 48522D36382053504F322D3936205354 Buffer size: 32 bytes
21:12:42.556 > 3_After_LFSR (32): 44DB6DADA7D3568D8AD1EEF0A8AD6658 A0E6AED61AD07BA1E29BAE4082B43AD2
21:12:42.561 > [ESP32][LFSR] Keystream (first 16 bytes): 0C89409B9FF305DDC5E3C3C99E8D350C
21:12:42.570 > [ESP32][TINKERBELL] Input (first 16 bytes): 44DB6DADA7D3568D8AD1EEF0A8AD6658 Nonce: 0x00000002 Buffer size: 32 bytes
21:12:42.579 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 0DC4FE32
21:12:42.589 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:42.598 > 4_After_Tinkerbell (32): 0AE32374E21F5A806E3ECC5E74FAD8F4 083323B7F3F5548BAEC2E69AD95B84A1
21:12:42.607 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:42.614 > 5_After_Transposition (32): 33086E3E805AB723C2AE0AE3F4D89AE6 F3F52374548BE21FD95BCC5E84A174FA        
21:12:42.623 > [ESP32] === HMAC DEBUG INFO ===
21:12:42.625 > [ESP32] HMAC Key being used: CE791434DFDE498DB05FADFDDEE96311D002C216F5196C818B9A8DF60882B270        
21:12:42.633 > [ESP32] HMAC Input length: 44 bytes
21:12:42.636 > [ESP32] HMAC Input (first 32 bytes): 81021800180004080000000233086E3E805AB723C2AE0AE3F4D89AE6F3F52374
21:12:42.645 > [ESP32] Nonce: 0x00000002
21:12:42.647 > [ESP32] Packet size before HMAC: 60
21:12:42.651 > [ESP32] Computed HMAC Tag: CD790B272280F42494198BAACF272716
21:12:42.656 > [ESP32] === END HMAC DEBUG ===
21:12:42.659 > 6_Final_Packet (60): 81021800180004080000000233086E3E 805AB723C2AE0AE3F4D89AE6F3F52374 ...
21:12:42.667 > [RETRY] Attempt 1/3 (nonce: 2)
21:12:42.670 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:42.673 > Sending pipeline data to server (658 bytes)
21:12:46.100 > [HTTP] Response code: 400
21:12:46.100 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:46.105 > [HTTP] Request failed with code: 400
21:12:46.109 > [RETRY] Send failed, waiting 100 ms before retry
21:12:46.211 > [RETRY] Attempt 2/3 (nonce: 2)
21:12:46.211 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:46.217 > Sending pipeline data to server (658 bytes)
21:12:49.583 > [HTTP] Response code: 400
21:12:49.583 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:49.589 > [HTTP] Request failed with code: 400
21:12:49.592 > [RETRY] Send failed, waiting 200 ms before retry
21:12:49.793 > [RETRY] Attempt 3/3 (nonce: 2)
21:12:49.793 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:49.800 > Sending pipeline data to server (658 bytes)
21:12:51.338 > [HTTP] Response code: 400
21:12:51.338 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:51.343 > [HTTP] Request failed with code: 400
21:12:51.346 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:12:51.351 > [RETRY] Consecutive failures: 2
21:12:51.354 > Health data send failed (retry count: 2/3)
21:12:51.457 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":512790,"type":"health_data_error"}
21:12:51.472 > [WebSocket] Processing message type: health_data_error
21:12:51.477 > [523.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:12:51.486 > [RETRY] Attempting to send health data (Max retries: 3)
21:12:51.491 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:12:51.496 > Generated health data: HR-68 SPO2-96 STEPS-2658
21:12:51.500 > [ESP32] ========================================
21:12:51.504 > [ESP32] ENCRYPTION PIPELINE START
21:12:51.508 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:12:51.513 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:12:51.521 > [ESP32] ========================================
21:12:51.524 > [ESP32] MsgKeys: lfsrSeed=0x9B40890C tnk[0..3]=0DC4FE32 trn[0..3]=FDA11B66
21:12:51.533 > 1_After_Salt (26): 48522D36382053504F322D3936205354 4550532D323635384D50
21:12:51.538 > 2_After_Padding (32): 48522D36382053504F322D3936205354 4550532D323635384D50000000000000
21:12:51.546 > [ESP32][LFSR] Initializing - Seed: 0x9B40890C SeedBe: 0x0C89409B ChaosKey[0..3]: 0DC4FE32 InitialTap: 0x0029 State: 0x9B40890C
21:12:51.557 > [ESP32][LFSR] Input (first 16 bytes): 48522D36382053504F322D3936205354 Buffer size: 32 bytes
21:12:51.566 > 3_After_LFSR (32): 44DB6DADA7D3568D8AD1EEF0A8AD6658 A0E6AED61AD379ABE29BAE4082B43AD2 
21:12:51.572 > [ESP32][LFSR] Keystream (first 16 bytes): 0C89409B9FF305DDC5E3C3C99E8D350C
21:12:51.580 > [ESP32][TINKERBELL] Input (first 16 bytes): 44DB6DADA7D3568D8AD1EEF0A8AD6658 Nonce: 0x00000002 Buffer size: 32 bytes
21:12:51.588 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 0DC4FE32
21:12:51.600 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:51.607 > 4_After_Tinkerbell (32): 0AE32374E21F5A806E3ECC5E74FAD8F4 083323B7F3F65681AEC2E69AD95B84A1
21:12:51.615 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:12:51.624 > 5_After_Transposition (32): 33086E3E805AB723C2AE0AE3F4D89AE6 F3F623745681E21FD95BCC5E84A174FA        
21:12:51.632 > [ESP32] === HMAC DEBUG INFO ===
21:12:51.635 > [ESP32] HMAC Key being used: CE791434DFDE498DB05FADFDDEE96311D002C216F5196C818B9A8DF60882B270        
21:12:51.644 > [ESP32] HMAC Input length: 44 bytes
21:12:51.646 > [ESP32] HMAC Input (first 32 bytes): 81021800180004080000000233086E3E805AB723C2AE0AE3F4D89AE6F3F62374
21:12:51.654 > [ESP32] Nonce: 0x00000002
21:12:51.657 > [ESP32] Packet size before HMAC: 60
21:12:51.661 > [ESP32] Computed HMAC Tag: E4F519555FEEAB387A945A228A49A098
21:12:51.666 > [ESP32] === END HMAC DEBUG ===
21:12:51.668 > 6_Final_Packet (60): 81021800180004080000000233086E3E 805AB723C2AE0AE3F4D89AE6F3F62374 ...
21:12:51.677 > [RETRY] Attempt 1/3 (nonce: 2)
21:12:51.680 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:51.687 > Sending pipeline data to server (658 bytes)
21:12:55.091 > [HTTP] Response code: 400
21:12:55.091 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:55.097 > [HTTP] Request failed with code: 400
21:12:55.100 > [RETRY] Send failed, waiting 100 ms before retry
21:12:55.200 > [RETRY] Attempt 2/3 (nonce: 2)
21:12:55.200 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:55.205 > Sending pipeline data to server (658 bytes)
21:12:58.650 > [HTTP] Response code: 400
21:12:58.651 > [HTTP] Error response: {"error":"Decryption failed"}
21:12:58.655 > [HTTP] Request failed with code: 400
21:12:58.658 > [RETRY] Send failed, waiting 200 ms before retry
21:12:58.859 > [RETRY] Attempt 3/3 (nonce: 2)
21:12:58.859 > POST http://10.249.92.115:8081/health-data with pipeline data
21:12:58.864 > Sending pipeline data to server (658 bytes)
21:13:00.353 > [HTTP] Response code: 400
21:13:00.354 > [HTTP] Error response: {"error":"Decryption failed"}
21:13:00.359 > [HTTP] Request failed with code: 400
21:13:00.362 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:13:00.367 > [RETRY] Consecutive failures: 3
21:13:00.371 > Health data send failed (retry count: 3/3)
21:13:00.374 > Health data transmission failed after max retries
21:13:00.473 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":514543,"type":"health_data_error"}
21:13:00.487 > [WebSocket] Processing message type: health_data_error
21:13:00.493 > [532.7] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:00.501 > ERROR state - attempting recovery
21:13:00.504 > [RETRY] Attempting to send health data (Max retries: 3)
21:13:00.510 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:13:00.513 > Generated health data: HR-68 SPO2-96 STEPS-2692
21:13:00.518 > [ESP32] ========================================
21:13:00.521 > [ESP32] ENCRYPTION PIPELINE START
21:13:00.526 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:13:00.532 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:13:00.538 > [ESP32] ========================================
21:13:00.543 > [ESP32] MsgKeys: lfsrSeed=0x9B40890C tnk[0..3]=0DC4FE32 trn[0..3]=FDA11B66
21:13:00.548 > 1_After_Salt (26): 48522D36382053504F322D3936205354 4550532D323639324D50
21:13:00.556 > 2_After_Padding (32): 48522D36382053504F322D3936205354 4550532D323639324D50000000000000 
21:13:00.562 > [ESP32][LFSR] Initializing - Seed: 0x9B40890C SeedBe: 0x0C89409B ChaosKey[0..3]: 0DC4FE32 InitialTap: 0x0029 State: 0x9B40890C
21:13:00.573 > [ESP32][LFSR] Input (first 16 bytes): 48522D36382053504F322D3936205354 Buffer size: 32 bytes
21:13:00.581 > 3_After_LFSR (32): 44DB6DADA7D3568D8AD1EEF0A8AD6658 A0E6AED61AD375A1E29BAE4082B43AD2 
21:13:00.590 > [ESP32][LFSR] Keystream (first 16 bytes): 0C89409B9FF305DDC5E3C3C99E8D350C
21:13:00.596 > [ESP32][TINKERBELL] Input (first 16 bytes): 44DB6DADA7D3568D8AD1EEF0A8AD6658 Nonce: 0x00000002 Buffer size: 32 bytes
21:13:00.606 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 0DC4FE32
21:13:00.618 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:13:00.626 > 4_After_Tinkerbell (32): 0AE32374E21F5A806E3ECC5E74FAD8F4 083323B7F3F65A8BAEC2E69AD95B84A1
21:13:00.632 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 4E384ED945CC0C0DE4EF22AEDC57BEAC
21:13:00.640 > 5_After_Transposition (32): 33086E3E805AB723C2AE0AE3F4D89AE6 F3F623745A8BE21FD95BCC5E84A174FA        
21:13:00.649 > [ESP32] === HMAC DEBUG INFO ===
21:13:00.651 > [ESP32] HMAC Key being used: CE791434DFDE498DB05FADFDDEE96311D002C216F5196C818B9A8DF60882B270        
21:13:00.660 > [ESP32] HMAC Input length: 44 bytes
21:13:00.662 > [ESP32] HMAC Input (first 32 bytes): 81021800180004080000000233086E3E805AB723C2AE0AE3F4D89AE6F3F62374
21:13:00.673 > [ESP32] Nonce: 0x00000002
21:13:00.673 > [ESP32] Packet size before HMAC: 60
21:13:00.678 > [ESP32] Computed HMAC Tag: 74C44E60A603450B1ADC7ADB46C202B1
21:13:00.682 > [ESP32] === END HMAC DEBUG ===
21:13:00.685 > 6_Final_Packet (60): 81021800180004080000000233086E3E 805AB723C2AE0AE3F4D89AE6F3F62374 ...
21:13:00.693 > [RETRY] Attempt 1/3 (nonce: 2)
21:13:00.696 > POST http://10.249.92.115:8081/health-data with pipeline data
21:13:00.701 > Sending pipeline data to server (658 bytes)
21:13:04.113 > [HTTP] Response code: 400
21:13:04.113 > [HTTP] Error response: {"error":"Decryption failed"}
21:13:04.118 > [HTTP] Request failed with code: 400
21:13:04.120 > [RETRY] Send failed, waiting 100 ms before retry
21:13:04.220 > [RETRY] Attempt 2/3 (nonce: 2)
21:13:04.220 > POST http://10.249.92.115:8081/health-data with pipeline data
21:13:04.226 > Sending pipeline data to server (658 bytes)
21:13:07.618 > [HTTP] Response code: 400
21:13:07.619 > [HTTP] Error response: {"error":"Decryption failed"}
21:13:07.624 > [HTTP] Request failed with code: 400
21:13:07.627 > [RETRY] Send failed, waiting 200 ms before retry
21:13:07.827 > [RETRY] Attempt 3/3 (nonce: 2)
21:13:07.827 > POST http://10.249.92.115:8081/health-data with pipeline data
21:13:07.833 > Sending pipeline data to server (658 bytes)
21:13:09.381 > [HTTP] Response code: 400
21:13:09.381 > [HTTP] Error response: {"error":"Decryption failed"}
21:13:09.386 > [HTTP] Request failed with code: 400
21:13:09.389 > [RETRY] All retry attempts failed - rolled back nonce to 1
21:13:09.394 > [RETRY] Consecutive failures: 4
21:13:09.397 > ✗ Auto-recovery failed - restarting key exchange
21:13:11.501 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":518319,"type":"health_data_error"}
21:13:11.515 > [WebSocket] Processing message type: health_data_error
21:13:11.520 > [543.7] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:13:11.529 > ✓ Public key loaded from NVS
21:13:11.627 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":521802,"type":"health_data_error"}
21:13:11.642 > [WebSocket] Processing message type: health_data_error
21:13:11.648 > [543.9] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED    
21:13:11.751 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":523556,"type":"health_data_error"}
21:13:11.765 > [WebSocket] Processing message type: health_data_error
21:13:11.770 > [544.0] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED     
21:13:11.779 > Generating fresh master key from entropy...
21:13:11.787 > Generated master key (32): 7204DE96D401E1B71BE5C2F0B9D28381 EF1C2E4DCE6FDF998C350AFEDB9C6A32
21:13:11.793 > Using reduced master key (byte % 3) for NTRU encryption only
21:13:11.803 > NTRU encrypted master key (502): 00710069004D007D001A000A001B0071 00150078001400030020006B007C0003 ...
21:13:11.811 > POST http://10.249.92.115:8081/master-key
21:13:12.453 > ✓ Master key exchange completed
21:13:12.555 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":527310,"type":"health_data_error"}
21:13:12.568 > [WebSocket] Processing message type: health_data_error
21:13:12.574 > [544.8] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:12.582 > Loading master key from NVS and deriving symmetric keys...
21:13:12.587 > Loaded master key from NVS (32): 7204DE96D401E1B71BE5C2F0B9D28381 EF1C2E4DCE6FDF998C350AFEDB9C6A32 
21:13:12.596 > Derived HMAC key (32): 1B8DD1636E4680858FBE8B4C6F01BE97 5E6F917FD9524FC63E55F46FA0C06609
21:13:12.604 > Derived Tinkerbell key (16): 7884375B2D2D3AC1E376333AA5C22055 
21:13:12.610 > Derived Transposition key (16): 536665C090188202306CD29BC91E85D3
21:13:12.615 > ✓ Symmetric keys derived successfully
21:13:12.618 > Nonce tracker reset - new session started
21:13:13.114 > Waiting for server to process master key...
21:13:13.118 > ✓ Symmetric keys ready - starting health data transmission
21:13:13.220 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":530869,"type":"health_data_error"}
21:13:13.234 > [WebSocket] Processing message type: health_data_error
21:13:13.239 > [545.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:13:13.343 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":7,"success":false,"timestamp":532573,"type":"health_data_error"}
21:13:13.357 > [WebSocket] Processing message type: health_data_error
21:13:13.363 > [545.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:13:13.465 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":8,"success":false,"timestamp":536331,"type":"health_data_error"}
21:13:13.479 > [WebSocket] Processing message type: health_data_error
21:13:13.484 > [545.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:13:13.590 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":8,"success":false,"timestamp":539838,"type":"health_data_error"}
21:13:13.603 > [WebSocket] Processing message type: health_data_error
21:13:13.609 > [545.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED       
21:13:13.712 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Failed to send health data","state":8,"success":false,"timestamp":541600,"type":"health_data_error"}
21:13:13.726 > [WebSocket] Processing message type: health_data_error
21:13:13.732 > [545.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:13.834 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528592201,"type":"master_key_received"}
21:13:13.848 > [WebSocket] Processing message type: master_key_received
21:13:13.851 > [546.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:13.955 > [WebSocket] Received (176 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":544664,"type":"master_key_exchanged"}
21:13:13.973 > [WebSocket] Processing message type: master_key_exchanged
21:13:13.978 > [546.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.079 > [WebSocket] Received (168 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":545333,"type":"symmetric_keys_derived"}
21:13:14.095 > [WebSocket] Processing message type: symmetric_keys_derived
21:13:14.100 > [546.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.200 > [546.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.302 > [546.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.403 > [546.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.503 > [546.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.605 > [546.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.706 > [546.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.807 > [547.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:14.908 > [547.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.009 > [547.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.110 > [547.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.210 > [547.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.311 > [547.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.413 > [547.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.513 > [547.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.614 > [547.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.715 > [547.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.817 > [548.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:15.918 > [548.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.018 > [548.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.119 > [548.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.220 > [548.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.322 > [548.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.422 > [548.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.523 > [548.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.624 > [548.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.725 > [548.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.826 > [549.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:16.927 > [549.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.029 > [549.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.129 > [549.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.230 > [549.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.331 > [549.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.432 > [549.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.534 > [549.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.634 > [549.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.735 > [550.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.836 > [550.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:17.937 > [550.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.038 > [550.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.140 > [550.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.240 > [550.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.341 > [550.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.443 > [550.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.544 > [550.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.644 > [550.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.745 > [551.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.847 > [551.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:18.948 > [551.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.048 > [551.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.150 > [551.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.250 > [551.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.351 > [551.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.452 > [551.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.553 > [551.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.654 > [551.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.756 > [552.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.856 > [552.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:19.958 > [552.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.059 > [552.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.160 > [552.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.261 > [552.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.361 > [552.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.462 > [552.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.564 > [552.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.664 > [552.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.765 > [553.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.866 > [553.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:20.968 > [553.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.068 > [553.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.169 > [553.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.270 > [553.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.371 > [553.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.472 > [553.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.573 > [553.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.675 > [553.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.775 > [554.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.877 > [554.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:21.978 > [554.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.079 > [554.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.179 > [554.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.281 > [554.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.381 > [554.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.482 > [554.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.583 > [554.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.685 > [554.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.785 > [555.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.886 > [555.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:22.987 > [555.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:23.089 > [555.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:23.189 > [555.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
21:13:23.195 > [RETRY] Attempting to send health data (Max retries: 3)
21:13:23.200 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:13:23.206 > Generated health data: HR-69 SPO2-96 STEPS-2805
21:13:23.209 > [ESP32] ========================================
21:13:23.214 > [ESP32] ENCRYPTION PIPELINE START
21:13:23.217 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:13:23.225 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:13:23.231 > [ESP32] ========================================
21:13:23.236 > [ESP32] MsgKeys: lfsrSeed=0xD8DB8770 tnk[0..3]=E095A745 trn[0..3]=084102D0
21:13:23.242 > 1_After_Salt (26): 48522D36392053504F322D3936205354 4550532D323830354D50
21:13:23.247 > 2_After_Padding (32): 48522D36392053504F322D3936205354 4550532D323830354D50000000000000 
21:13:23.255 > [ESP32][LFSR] Initializing - Seed: 0xD8DB8770 SeedBe: 0x7087DBD8 ChaosKey[0..3]: E095A745 InitialTap: 0x0029 State: 0xD8DB8770
21:13:23.266 > [ESP32][LFSR] Input (first 16 bytes): 48522D36392053504F322D3936205354 Buffer size: 32 bytes
21:13:23.275 > 3_After_LFSR (32): 38D5F6EEBFE268C8D54DB7281412E804 ED10BD588AD7A444070F8D8F46FF5268 
21:13:23.284 > [ESP32][LFSR] Keystream (first 16 bytes): 7087DBD886C23B989A7F9A112232BB50
21:13:23.289 > [ESP32][TINKERBELL] Input (first 16 bytes): 38D5F6EEBFE268C8D54DB7281412E804 Nonce: 0x00000001 Buffer size: 32 bytes
21:13:23.300 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: E095A745
21:13:23.309 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 70EDF1605C5A8889F0130229FEBDD4DC
21:13:23.316 > 4_After_Tinkerbell (32): 4838078EE3B8E041255EB501EAAF3CD8 7527C527A04FB0EE1B7A6AB504AA4F55
21:13:23.324 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 70EDF1605C5A8889F0130229FEBDD4DC
21:13:23.334 > 5_After_Transposition (32): E3B8B0EE27C57A1B078EB501A04FD83C 483841E06AB504AA7527AFEA4F555E25        
21:13:23.342 > [ESP32] === HMAC DEBUG INFO ===
21:13:23.345 > [ESP32] HMAC Key being used: 1B8DD1636E4680858FBE8B4C6F01BE975E6F917FD9524FC63E55F46FA0C06609
21:13:23.353 > [ESP32] HMAC Input length: 44 bytes
21:13:23.355 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001E3B8B0EE27C57A1B078EB501A04FD83C483841E0
21:13:23.364 > [ESP32] Nonce: 0x00000001
21:13:23.367 > [ESP32] Packet size before HMAC: 60
21:13:23.370 > [ESP32] Computed HMAC Tag: AA6D975E67DC06955F9F3498BF5A6587
21:13:23.375 > [ESP32] === END HMAC DEBUG ===
21:13:23.377 > 6_Final_Packet (60): 810218001800040800000001E3B8B0EE 27C57A1B078EB501A04FD83C483841E0 ...
21:13:23.386 > [RETRY] Attempt 1/3 (nonce: 1)

21:13:58.999 > [591.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.099 > [591.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.200 > [591.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.301 > [591.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.402 > [591.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.503 > [591.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.604 > [591.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.705 > [591.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.805 > [592.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:13:59.907 > [592.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.008 > [592.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.109 > [592.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.210 > [592.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.311 > [592.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.412 > [592.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.514 > [592.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.614 > [592.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.715 > [592.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.816 > [593.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:00.917 > [593.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.018 > [593.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.119 > [593.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.220 > [593.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.321 > [593.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.422 > [593.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.523 > [593.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.624 > [593.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.725 > [593.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.826 > [594.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:01.927 > [594.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.028 > [594.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.129 > [594.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.230 > [594.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.331 > [594.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.432 > [594.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.533 > [594.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.633 > [594.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.735 > [595.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.836 > [595.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:02.937 > [595.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.038 > [595.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.139 > [595.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.240 > [595.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.341 > [595.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.442 > [595.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.542 > [595.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.644 > [595.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.745 > [596.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.846 > [596.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:03.947 > [596.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.048 > [596.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.148 > [596.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.250 > [596.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.351 > [596.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.451 > [596.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.553 > [596.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.654 > [596.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.755 > [597.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.856 > [597.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:04.957 > [597.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.058 > [597.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.159 > [597.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.260 > [597.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.361 > [597.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.462 > [597.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.563 > [597.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.664 > [597.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.765 > [598.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.866 > [598.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:05.966 > [598.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.068 > [598.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.168 > [598.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.270 > [598.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.371 > [598.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.472 > [598.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.573 > [598.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.674 > [598.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.775 > [599.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.876 > [599.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.977 > [599.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
21:14:06.982 > [RETRY] Attempting to send health data (Max retries: 3)
21:14:06.988 > [RETRY] Using nonce 2 for all retry attempts (saved: 1)
21:14:06.994 > Generated health data: HR-69 SPO2-96 STEPS-3000
21:14:06.996 > [ESP32] ========================================
21:14:07.002 > [ESP32] ENCRYPTION PIPELINE START
21:14:07.004 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:14:07.013 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:14:07.018 > [ESP32] ========================================
21:14:07.024 > [ESP32] MsgKeys: lfsrSeed=0xF15836C6 tnk[0..3]=544FA545 trn[0..3]=63FFB212
21:14:07.030 > 1_After_Salt (26): 48522D36392053504F322D3936205354 4550532D333030304D50
21:14:07.035 > 2_After_Padding (32): 48522D36392053504F322D3936205354 4550532D333030304D50000000000000
21:14:07.044 > [ESP32][LFSR] Initializing - Seed: 0xF15836C6 SeedBe: 0xC63658F1 ChaosKey[0..3]: 544FA545 InitialTap: 0x0029 State: 0xF15836C6
21:14:07.055 > [ESP32][LFSR] Input (first 16 bytes): 48522D36392053504F322D3936205354 Buffer size: 32 bytes
21:14:07.063 > 3_After_LFSR (32): 8E6475C738F0542137C054248F0A3A78 3DDE93C328350C016214250EA828045B
21:14:07.071 > [ESP32][LFSR] Keystream (first 16 bytes): C63658F101D0077178F2791DB92A692C
21:14:07.077 > [ESP32][TINKERBELL] Input (first 16 bytes): 8E6475C738F0542137C054248F0A3A78 Nonce: 0x00000002 Buffer size: 32 bytes
21:14:07.088 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 544FA545
21:14:07.096 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 50BE2BB9D4AA675D990CB8DE92818C1F
21:14:07.104 > 4_After_Tinkerbell (32): DEDA5E7EEC5A337CAECCECFA1D8BB667 B83580340EABDD46C77445AF1D899DE1 
21:14:07.113 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 50BE2BB9D4AA675D990CB8DE92818C1F
21:14:07.121 > 5_After_Transposition (32): DEDA5E7EEC5A337CAECCECFA1D8BB667 B83580340EABDD46C77445AF1D899DE1 
21:14:07.130 > [ESP32] === HMAC DEBUG INFO ===
21:14:07.132 > [ESP32] HMAC Key being used: F3F2494021E5ED0BD098AF477B50D476068874FD55B14AD5B465DB2F2FA34F59
21:14:07.140 > [ESP32] HMAC Input length: 44 bytes
21:14:07.143 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000002DEDA5E7EEC5A337CAECCECFA1D8BB667B8358034
21:14:07.151 > [ESP32] Nonce: 0x00000002
21:14:07.154 > [ESP32] Packet size before HMAC: 60
21:14:07.157 > [ESP32] Computed HMAC Tag: 7263306C4E73A4A4D56546EFD75C4E48
21:14:07.163 > [ESP32] === END HMAC DEBUG ===
21:14:07.165 > 6_Final_Packet (60): 810218001800040800000002DEDA5E7E EC5A337CAECCECFA1D8BB667B8358034 ...
21:14:07.174 > [RETRY] Attempt 1/3 (nonce: 2)
21:14:07.177 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:07.182 > Sending pipeline data to server (658 bytes)
21:14:08.691 > [HTTP] Response code: 200
21:14:08.691 > [HTTP] Response: {"status":"OK:DECRYPTED"}
21:14:08.701 > [RETRY] Health data sent successfully!
21:14:08.704 > ✓ Health data #12 sent successfully
21:14:08.805 > [WebSocket] Received (685 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","encData":"ENC_DATA:810218001800040800000002DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE17263306C4E73A4A4D56546EFD75C4E48","pipeline":{"afterLFSR":"8E6475C738F0542137C054248F0A3A783DDE93C328350C016214250EA828045B","afterSalt":"48522D36392053504F322D39362053544550532D333030304D50","afterTinkerbell":"DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE1","afterTransposition":"DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE1"},"plaintext":"HR-69 SPO2-96 STEPS-3000","serverTime":1769528648578,"timestamp":599402,"type":"encryption_update","ztmEnabled":false}
21:14:08.867 > [WebSocket] Processing message type: encryption_update
21:14:08.872 > [601.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:08.978 > [WebSocket] Received (88 bytes): {"heartRate":69,"spo2":96,"steps":3000,"time":1769528648579,"type":"health_data_update"}
21:14:08.988 > [WebSocket] Processing message type: health_data_update
21:14:08.993 > [601.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.101 > [WebSocket] Received (222 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":3.85,"encryptionTime":0.0,"finalPlaintext":"HR-69 SPO2-96 STEPS-3000","handshakeSuccess":true,"totalTime":3.85},"type":"session_summary_update"}
21:14:09.123 > [WebSocket] Processing message type: session_summary_update
21:14:09.126 > [601.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:09.234 > [WebSocket] Received (656 bytes): {"decryptionTime":3.85,"encryptedPacket":"810218001800040800000002DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE17263306C4E73A4A4D56546EFD75C4E48","finalPlaintext":"HR-69 SPO2-96 STEPS-3000","healthData":{"heartRate":69,"spo2":96,"steps":3000},"pipeline":{"afterDepad":"48522D36392053504F322D39362053544550532D33303030000000000000","afterLFSR":"48522D36392053504F322D39362053544550532D333030304D50000000000000","afterTinkerbell":"8E6475C738F0542137C054248F0A3A783DDE93C328350C016214250EA828045B","afterTransposition":"DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE1"},"serverTime":1769528648579,"type":"decryption_update"}
21:14:09.293 > [WebSocket] Processing message type: decryption_update
21:14:09.298 > [WebSocket] Server decryption completed
21:14:09.301 > [WebSocket] Health data - HR: 69, SPO2: 96, Steps: 3000
21:14:09.307 > [601.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.408 > [WebSocket] Received (698 bytes): {"currentRecipe":"\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000","deviceId":"f9641d44","healthSendCount":11,"pipeline":{"afterLFSR":"8E6475C738F0542137C054248F0A3A783DDE93C328350C016214250EA828045B","afterSalt":"48522D36392053504F322D39362053544550532D333030304D50","afterTinkerbell":"DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE1","afterTransposition":"DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE1","finalPacket":"810218001800040800000002DEDA5E7EEC5A337CAECCECFA1D8BB667B83580340EABDD46C77445AF1D899DE17263306C4E73A4A4D56546EFD75C4E48"},"plaintext":"HR-69 SPO2-96 STEPS-3000","timestamp":600912,"type":"encryption_pipeline","ztmEnabled":false}
21:14:09.469 > [WebSocket] Processing message type: encryption_pipeline
21:14:09.474 > [601.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.582 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":11,"message":"Health data #12 sent successfully","state":7,"success":true,"timestamp":600917,"type":"health_data_sent"}
21:14:09.599 > [WebSocket] Processing message type: health_data_sent
21:14:09.601 > [601.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.703 > [601.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.805 > [602.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:09.906 > [602.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.007 > [602.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.107 > [602.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.209 > [602.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.310 > [602.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.411 > [602.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.512 > [602.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.613 > [602.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.714 > [602.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.815 > [603.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:10.915 > [603.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.016 > [603.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.117 > [603.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.219 > [603.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.320 > [603.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.421 > [603.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.522 > [603.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.622 > [603.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.724 > [603.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.825 > [604.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:11.926 > [604.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.027 > [604.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.128 > [604.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.229 > [604.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.330 > [604.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.431 > [604.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.531 > [604.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.633 > [604.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.734 > [605.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.835 > [605.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:12.935 > [605.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.037 > [605.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.137 > [605.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.239 > [605.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.340 > [605.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.441 > [605.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.542 > [605.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.643 > [605.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.743 > [606.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.845 > [606.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:13.945 > [606.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.047 > [606.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.147 > [606.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.248 > [606.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.349 > [606.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.450 > [606.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.551 > [606.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.652 > [606.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.753 > [607.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.855 > [607.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:14.955 > [607.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.057 > [607.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.158 > [607.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.259 > [607.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.360 > [607.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.461 > [607.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.562 > [607.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.663 > [607.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.763 > [608.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.864 > [608.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:15.965 > [608.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.067 > [608.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.167 > [608.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.268 > [608.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.370 > [608.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.471 > [608.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.572 > [608.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.673 > [608.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.774 > [609.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.874 > [609.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:16.976 > [609.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.076 > [609.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.178 > [609.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.279 > [609.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.380 > [609.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.481 > [609.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.581 > [609.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.682 > [609.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.783 > [610.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.884 > [610.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:17.986 > [610.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.086 > [610.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.188 > [610.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.288 > [610.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.390 > [610.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.491 > [610.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.592 > [610.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.692 > [610.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.794 > [611.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:18.798 > [RETRY] Attempting to send health data (Max retries: 3)
21:14:18.804 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:14:18.811 > Generated health data: HR-70 SPO2-97 STEPS-3090
21:14:18.813 > [ESP32] ========================================
21:14:18.819 > [ESP32] ENCRYPTION PIPELINE START
21:14:18.822 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:14:18.830 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:14:18.835 > [ESP32] ========================================
21:14:18.841 > [ESP32] MsgKeys: lfsrSeed=0x84473F88 tnk[0..3]=5B8C5EA1 trn[0..3]=107B4A8B
21:14:18.846 > 1_After_Salt (26): 48522D37302053504F322D3937205354 4550532D333039304D50
21:14:18.851 > 2_After_Padding (32): 48522D37302053504F322D3937205354 4550532D333039304D50000000000000
21:14:18.860 > [ESP32][LFSR] Initializing - Seed: 0x84473F88 SeedBe: 0x883F4784 ChaosKey[0..3]: 5B8C5EA1 InitialTap: 0x0029 State: 0x84473F88
21:14:18.871 > [ESP32][LFSR] Input (first 16 bytes): 48522D37302053504F322D3937205354 Buffer size: 32 bytes
21:14:18.880 > 3_After_LFSR (32): C06D6AB3DDF211F53027D6F11B954003 74951E48928589DB1BE44DEA24D4D253
21:14:18.888 > [ESP32][LFSR] Keystream (first 16 bytes): 883F4784EDD242A57F15FBC82CB51357
21:14:18.894 > [ESP32][TINKERBELL] Input (first 16 bytes): C06D6AB3DDF211F53027D6F11B954003 Nonce: 0x00000003 Buffer size: 32 bytes
21:14:18.904 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: 5B8C5EA1
21:14:18.912 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:18.921 > 4_After_Tinkerbell (32): 22F2AE928C0DAC956F5E7CC73D6D5D09 B910667B22B08A2D139D96A9A5477D95 
21:14:18.930 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:18.938 > 5_After_Transposition (32): 139D96A9477D95A56F5E7CC7B910667B 8C0DAC952DB08A223D6D5D0992AEF222        
21:14:18.946 > [ESP32] === HMAC DEBUG INFO ===
21:14:18.949 > [ESP32] HMAC Key being used: F3F2494021E5ED0BD098AF477B50D476068874FD55B14AD5B465DB2F2FA34F59
21:14:18.958 > [ESP32] HMAC Input length: 44 bytes
21:14:18.960 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000003139D96A9477D95A56F5E7CC7B910667B8C0DAC95
21:14:18.968 > [ESP32] Nonce: 0x00000003
21:14:18.971 > [ESP32] Packet size before HMAC: 60
21:14:18.974 > [ESP32] Computed HMAC Tag: 01699156ECF925C08F50F501380B2D93
21:14:18.980 > [ESP32] === END HMAC DEBUG ===
21:14:18.982 > 6_Final_Packet (60): 810218001800040800000003139D96A9 477D95A56F5E7CC7B910667B8C0DAC95 ...
21:14:18.990 > [RETRY] Attempt 1/3 (nonce: 3)
21:14:18.993 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:18.998 > Sending pipeline data to server (658 bytes)
21:14:20.444 > [HTTP] Response code: 400
21:14:20.444 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:20.450 > [HTTP] Request failed with code: 400
21:14:20.453 > [RETRY] Send failed, waiting 100 ms before retry
21:14:20.552 > [RETRY] Attempt 2/3 (nonce: 3)
21:14:20.552 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:20.557 > Sending pipeline data to server (658 bytes)
21:14:20.692 > [HTTP] Response code: 400
21:14:20.693 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:20.699 > [HTTP] Request failed with code: 400
21:14:20.701 > [RETRY] Send failed, waiting 200 ms before retry
21:14:20.900 > [RETRY] Attempt 3/3 (nonce: 3)
21:14:20.900 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:20.907 > Sending pipeline data to server (658 bytes)
21:14:22.198 > [HTTP] Response code: 400
21:14:22.198 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:22.205 > [HTTP] Request failed with code: 400
21:14:22.207 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:14:22.212 > [RETRY] Consecutive failures: 1
21:14:22.215 > Health data send failed (retry count: 1/3)
21:14:22.317 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":612666,"type":"health_data_error"}
21:14:22.331 > [WebSocket] Processing message type: health_data_error
21:14:22.337 > [614.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:22.345 > [RETRY] Attempting to send health data (Max retries: 3)
21:14:22.351 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:14:22.356 > Generated health data: HR-70 SPO2-97 STEPS-3108
21:14:22.359 > [ESP32] ========================================
21:14:22.365 > [ESP32] ENCRYPTION PIPELINE START
21:14:22.368 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:14:22.373 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:14:22.381 > [ESP32] ========================================
21:14:22.384 > [ESP32] MsgKeys: lfsrSeed=0x84473F88 tnk[0..3]=5B8C5EA1 trn[0..3]=107B4A8B
21:14:22.393 > 1_After_Salt (26): 48522D37302053504F322D3937205354 4550532D333130384D50
21:14:22.397 > 2_After_Padding (32): 48522D37302053504F322D3937205354 4550532D333130384D50000000000000 
21:14:22.406 > [ESP32][LFSR] Initializing - Seed: 0x84473F88 SeedBe: 0x883F4784 ChaosKey[0..3]: 5B8C5EA1 InitialTap: 0x0029 State: 0x84473F88
21:14:22.417 > [ESP32][LFSR] Input (first 16 bytes): 48522D37302053504F322D3937205354 Buffer size: 32 bytes
21:14:22.426 > 3_After_LFSR (32): C06D6AB3DDF211F53027D6F11B954003 74951E48928480D31BE44DEA24D4D253 
21:14:22.431 > [ESP32][LFSR] Keystream (first 16 bytes): 883F4784EDD242A57F15FBC82CB51357
21:14:22.440 > [ESP32][TINKERBELL] Input (first 16 bytes): C06D6AB3DDF211F53027D6F11B954003 Nonce: 0x00000003 Buffer size: 32 bytes
21:14:22.448 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: 5B8C5EA1
21:14:22.459 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:22.467 > 4_After_Tinkerbell (32): 22F2AE928C0DAC956F5E7CC73D6D5D09 B910667B22B18325139D96A9A5477D95
21:14:22.475 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:22.484 > 5_After_Transposition (32): 139D96A9477D95A56F5E7CC7B910667B 8C0DAC9525B183223D6D5D0992AEF222        
21:14:22.492 > [ESP32] === HMAC DEBUG INFO ===
21:14:22.495 > [ESP32] HMAC Key being used: F3F2494021E5ED0BD098AF477B50D476068874FD55B14AD5B465DB2F2FA34F59        
21:14:22.503 > [ESP32] HMAC Input length: 44 bytes
21:14:22.506 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000003139D96A9477D95A56F5E7CC7B910667B8C0DAC95
21:14:22.515 > [ESP32] Nonce: 0x00000003
21:14:22.518 > [ESP32] Packet size before HMAC: 60
21:14:22.520 > [ESP32] Computed HMAC Tag: FABF5057EC55416FA25D08021B465D18
21:14:22.525 > [ESP32] === END HMAC DEBUG ===
21:14:22.528 > 6_Final_Packet (60): 810218001800040800000003139D96A9 477D95A56F5E7CC7B910667B8C0DAC95 ...
21:14:22.537 > [RETRY] Attempt 1/3 (nonce: 3)
21:14:22.539 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:22.543 > Sending pipeline data to server (658 bytes)
21:14:26.207 > [HTTP] Response code: 400
21:14:26.208 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:26.213 > [HTTP] Request failed with code: 400
21:14:26.215 > [RETRY] Send failed, waiting 100 ms before retry
21:14:26.315 > [RETRY] Attempt 2/3 (nonce: 3)
21:14:26.315 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:26.320 > Sending pipeline data to server (658 bytes)
21:14:27.456 > [HTTP] Response code: 400
21:14:27.456 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:27.462 > [HTTP] Request failed with code: 400
21:14:27.464 > [RETRY] Send failed, waiting 200 ms before retry
21:14:27.664 > [RETRY] Attempt 3/3 (nonce: 3)
21:14:27.664 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:27.670 > Sending pipeline data to server (658 bytes)
21:14:30.718 > [HTTP] Response code: 400
21:14:30.719 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:30.724 > [HTTP] Request failed with code: 400
21:14:30.727 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:14:30.732 > [RETRY] Consecutive failures: 2
21:14:30.735 > Health data send failed (retry count: 2/3)
21:14:30.838 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":612914,"type":"health_data_error"}
21:14:30.851 > [WebSocket] Processing message type: health_data_error
21:14:30.857 > [623.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:30.865 > [RETRY] Attempting to send health data (Max retries: 3)
21:14:30.871 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:14:30.877 > Generated health data: HR-70 SPO2-97 STEPS-3134
21:14:30.880 > [ESP32] ========================================
21:14:30.885 > [ESP32] ENCRYPTION PIPELINE START
21:14:30.888 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:14:30.893 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:14:30.902 > [ESP32] ========================================
21:14:30.904 > [ESP32] MsgKeys: lfsrSeed=0x84473F88 tnk[0..3]=5B8C5EA1 trn[0..3]=107B4A8B
21:14:30.913 > 1_After_Salt (26): 48522D37302053504F322D3937205354 4550532D333133344D50
21:14:30.918 > 2_After_Padding (32): 48522D37302053504F322D3937205354 4550532D333133344D50000000000000
21:14:30.926 > [ESP32][LFSR] Initializing - Seed: 0x84473F88 SeedBe: 0x883F4784 ChaosKey[0..3]: 5B8C5EA1 InitialTap: 0x0029 State: 0x84473F88
21:14:30.938 > [ESP32][LFSR] Input (first 16 bytes): 48522D37302053504F322D3937205354 Buffer size: 32 bytes
21:14:30.946 > 3_After_LFSR (32): C06D6AB3DDF211F53027D6F11B954003 74951E48928483DF1BE44DEA24D4D253
21:14:30.951 > [ESP32][LFSR] Keystream (first 16 bytes): 883F4784EDD242A57F15FBC82CB51357
21:14:30.960 > [ESP32][TINKERBELL] Input (first 16 bytes): C06D6AB3DDF211F53027D6F11B954003 Nonce: 0x00000003 Buffer size: 32 bytes
21:14:30.968 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: 5B8C5EA1
21:14:30.979 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:30.988 > 4_After_Tinkerbell (32): 22F2AE928C0DAC956F5E7CC73D6D5D09 B910667B22B18029139D96A9A5477D95 
21:14:30.996 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:31.004 > 5_After_Transposition (32): 139D96A9477D95A56F5E7CC7B910667B 8C0DAC9529B180223D6D5D0992AEF222 
21:14:31.013 > [ESP32] === HMAC DEBUG INFO ===
21:14:31.015 > [ESP32] HMAC Key being used: F3F2494021E5ED0BD098AF477B50D476068874FD55B14AD5B465DB2F2FA34F59
21:14:31.023 > [ESP32] HMAC Input length: 44 bytes
21:14:31.027 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000003139D96A9477D95A56F5E7CC7B910667B8C0DAC95
21:14:31.035 > [ESP32] Nonce: 0x00000003
21:14:31.038 > [ESP32] Packet size before HMAC: 60
21:14:31.040 > [ESP32] Computed HMAC Tag: 668B6443F588B1D662D89D30DAE3AAEE
21:14:31.046 > [ESP32] === END HMAC DEBUG ===
21:14:31.049 > 6_Final_Packet (60): 810218001800040800000003139D96A9 477D95A56F5E7CC7B910667B8C0DAC95 ...
21:14:31.057 > [RETRY] Attempt 1/3 (nonce: 3)
21:14:31.060 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:31.066 > Sending pipeline data to server (658 bytes)
21:14:32.225 > [HTTP] Response code: 400
21:14:32.225 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:32.231 > [HTTP] Request failed with code: 400
21:14:32.234 > [RETRY] Send failed, waiting 100 ms before retry
21:14:32.334 > [RETRY] Attempt 2/3 (nonce: 3)
21:14:32.335 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:32.339 > Sending pipeline data to server (658 bytes)
21:14:35.984 > [HTTP] Response code: 400
21:14:35.984 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:35.989 > [HTTP] Request failed with code: 400
21:14:35.992 > [RETRY] Send failed, waiting 200 ms before retry
21:14:36.193 > [RETRY] Attempt 3/3 (nonce: 3)
21:14:36.193 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:36.198 > Sending pipeline data to server (658 bytes)
21:14:39.239 > [HTTP] Response code: 400
21:14:39.239 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:39.244 > [HTTP] Request failed with code: 400
21:14:39.246 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:14:39.252 > [RETRY] Consecutive failures: 3
21:14:39.254 > Health data send failed (retry count: 3/3)
21:14:39.258 > Health data transmission failed after max retries
21:14:39.362 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":614420,"type":"health_data_error"}
21:14:39.376 > [WebSocket] Processing message type: health_data_error
21:14:39.381 > [631.6] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:39.390 > ERROR state - attempting recovery
21:14:39.392 > [RETRY] Attempting to send health data (Max retries: 3)
21:14:39.398 > [RETRY] Using nonce 3 for all retry attempts (saved: 2)
21:14:39.401 > Generated health data: HR-70 SPO2-97 STEPS-3190
21:14:39.407 > [ESP32] ========================================
21:14:39.409 > [ESP32] ENCRYPTION PIPELINE START
21:14:39.413 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:14:39.450 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:14:39.450 > [ESP32] ========================================
21:14:39.450 > [ESP32] MsgKeys: lfsrSeed=0x84473F88 tnk[0..3]=5B8C5EA1 trn[0..3]=107B4A8B
21:14:39.450 > 1_After_Salt (26): 48522D37302053504F322D3937205354 4550532D333139304D50
21:14:39.450 > 2_After_Padding (32): 48522D37302053504F322D3937205354 4550532D333139304D50000000000000
21:14:39.451 > [ESP32][LFSR] Initializing - Seed: 0x84473F88 SeedBe: 0x883F4784 ChaosKey[0..3]: 5B8C5EA1 InitialTap: 0x0029 State: 0x84473F88
21:14:39.462 > [ESP32][LFSR] Input (first 16 bytes): 48522D37302053504F322D3937205354 Buffer size: 32 bytes
21:14:39.470 > 3_After_LFSR (32): C06D6AB3DDF211F53027D6F11B954003 74951E48928489DB1BE44DEA24D4D253
21:14:39.479 > [ESP32][LFSR] Keystream (first 16 bytes): 883F4784EDD242A57F15FBC82CB51357
21:14:39.484 > [ESP32][TINKERBELL] Input (first 16 bytes): C06D6AB3DDF211F53027D6F11B954003 Nonce: 0x00000003 Buffer size: 32 bytes
21:14:39.495 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: 5B8C5EA1
21:14:39.507 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:39.515 > 4_After_Tinkerbell (32): 22F2AE928C0DAC956F5E7CC73D6D5D09 B910667B22B18A2D139D96A9A5477D95
21:14:39.520 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): E29FC42151FFBD605F79AA3626F81D0A
21:14:39.529 > 5_After_Transposition (32): 139D96A9477D95A56F5E7CC7B910667B 8C0DAC952DB18A223D6D5D0992AEF222        
21:14:39.537 > [ESP32] === HMAC DEBUG INFO ===
21:14:39.540 > [ESP32] HMAC Key being used: F3F2494021E5ED0BD098AF477B50D476068874FD55B14AD5B465DB2F2FA34F59
21:14:39.548 > [ESP32] HMAC Input length: 44 bytes
21:14:39.551 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000003139D96A9477D95A56F5E7CC7B910667B8C0DAC95
21:14:39.562 > [ESP32] Nonce: 0x00000003
21:14:39.562 > [ESP32] Packet size before HMAC: 60
21:14:39.568 > [ESP32] Computed HMAC Tag: 70CB1C513B966ECA0EE4F541ACDC63E3
21:14:39.570 > [ESP32] === END HMAC DEBUG ===
21:14:39.572 > 6_Final_Packet (60): 810218001800040800000003139D96A9 477D95A56F5E7CC7B910667B8C0DAC95 ...
21:14:39.582 > [RETRY] Attempt 1/3 (nonce: 3)
21:14:39.585 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:39.590 > Sending pipeline data to server (658 bytes)
21:14:43.243 > [HTTP] Response code: 400
21:14:43.243 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:43.248 > [HTTP] Request failed with code: 400
21:14:43.252 > [RETRY] Send failed, waiting 100 ms before retry
21:14:43.355 > [RETRY] Attempt 2/3 (nonce: 3)
21:14:43.355 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:43.361 > Sending pipeline data to server (658 bytes)
21:14:47.001 > [HTTP] Response code: 400
21:14:47.001 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:47.007 > [HTTP] Request failed with code: 400
21:14:47.009 > [RETRY] Send failed, waiting 200 ms before retry
21:14:47.210 > [RETRY] Attempt 3/3 (nonce: 3)
21:14:47.210 > POST http://10.249.92.115:8081/health-data with pipeline data
21:14:47.216 > Sending pipeline data to server (658 bytes)
21:14:50.261 > [HTTP] Response code: 400
21:14:50.261 > [HTTP] Error response: {"error":"Decryption failed"}
21:14:50.266 > [HTTP] Request failed with code: 400
21:14:50.269 > [RETRY] All retry attempts failed - rolled back nonce to 2
21:14:50.274 > [RETRY] Consecutive failures: 4
21:14:50.277 > ✗ Auto-recovery failed - restarting key exchange
21:14:52.380 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":618428,"type":"health_data_error"}
21:14:52.394 > [WebSocket] Processing message type: health_data_error
21:14:52.399 > [644.6] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:52.408 > ✓ Public key loaded from NVS
21:14:52.506 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":619678,"type":"health_data_error"}
21:14:52.520 > [WebSocket] Processing message type: health_data_error
21:14:52.525 > [644.7] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED    
21:14:52.629 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":622940,"type":"health_data_error"}
21:14:52.643 > [WebSocket] Processing message type: health_data_error
21:14:52.648 > [644.9] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:52.657 > Generating fresh master key from entropy...
21:14:52.665 > Generated master key (32): 3DA13C01589A49B7F3F8D7F2B92B8839 7473D6DD9EA76F7AE263E38D2B4F6CEA 
21:14:52.671 > Using reduced master key (byte % 3) for NTRU encryption only
21:14:52.681 > NTRU encrypted master key (502): 0072006A004D007E0019000A001C0071 00150079001400050020006C007B0003 ...
21:14:52.690 > POST http://10.249.92.115:8081/master-key
21:14:54.328 > ✓ Master key exchange completed
21:14:54.430 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":624447,"type":"health_data_error"}
21:14:54.444 > [WebSocket] Processing message type: health_data_error
21:14:54.449 > [646.7] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:54.458 > Loading master key from NVS and deriving symmetric keys...
21:14:54.464 > Loaded master key from NVS (32): 3DA13C01589A49B7F3F8D7F2B92B8839 7473D6DD9EA76F7AE263E38D2B4F6CEA 
21:14:54.471 > Derived HMAC key (32): E77064E5DF631AE8BC8A8CA59F21E47E 660342692141B8CAF8B5DB0F24E0BFD9
21:14:54.480 > Derived Tinkerbell key (16): 19932329A45D1D1C4BC7F87AC1811F60 
21:14:54.486 > Derived Transposition key (16): 674B476B46E0FD9ADAA5FBC7DCB65257
21:14:54.492 > ✓ Symmetric keys derived successfully
21:14:54.494 > Nonce tracker reset - new session started
21:14:54.990 > Waiting for server to process master key...
21:14:54.993 > ✓ Symmetric keys ready - starting health data transmission
21:14:55.095 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":628206,"type":"health_data_error"}
21:14:55.110 > [WebSocket] Processing message type: health_data_error
21:14:55.115 > [647.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:55.219 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":631460,"type":"health_data_error"}
21:14:55.233 > [WebSocket] Processing message type: health_data_error
21:14:55.239 > [647.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:55.342 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":635465,"type":"health_data_error"}
21:14:55.355 > [WebSocket] Processing message type: health_data_error
21:14:55.361 > [647.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:55.464 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":639223,"type":"health_data_error"}
21:14:55.478 > [WebSocket] Processing message type: health_data_error
21:14:55.483 > [647.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:55.586 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":642483,"type":"health_data_error"}
21:14:55.600 > [WebSocket] Processing message type: health_data_error
21:14:55.605 > [647.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:55.708 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528694088,"type":"master_key_received"}
21:14:55.722 > [WebSocket] Processing message type: master_key_received
21:14:55.725 > [647.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:55.830 > [WebSocket] Received (176 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":646543,"type":"master_key_exchanged"}       
21:14:55.846 > [WebSocket] Processing message type: master_key_exchanged
21:14:55.851 > [648.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:55.952 > [WebSocket] Received (168 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":647212,"type":"symmetric_keys_derived"}
21:14:55.968 > [WebSocket] Processing message type: symmetric_keys_derived
21:14:55.974 > [648.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:14:56.074 > [648.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.175 > [648.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.276 > [648.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.377 > [648.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.479 > [648.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.579 > [648.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.680 > [648.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.781 > [649.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.883 > [649.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:56.983 > [649.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.084 > [649.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.186 > [649.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.286 > [649.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.387 > [649.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.488 > [649.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.589 > [649.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.690 > [649.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.792 > [650.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.893 > [650.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:57.994 > [650.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.095 > [650.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.195 > [650.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.296 > [650.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.397 > [650.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.498 > [650.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.598 > [650.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.700 > [650.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.801 > [651.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:58.902 > [651.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.003 > [651.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.105 > [651.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.205 > [651.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.306 > [651.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.407 > [651.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.508 > [651.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.610 > [651.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.710 > [651.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.812 > [652.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:14:59.912 > [652.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.013 > [652.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.114 > [652.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.215 > [652.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.316 > [652.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.417 > [652.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.518 > [652.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.620 > [652.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.721 > [652.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.822 > [653.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:00.923 > [653.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.023 > [653.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.124 > [653.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.224 > [653.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.326 > [653.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.427 > [653.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.527 > [653.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.630 > [653.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.730 > [654.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.832 > [654.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:01.933 > [654.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.034 > [654.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.134 > [654.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.236 > [654.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.337 > [654.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.437 > [654.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.538 > [654.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.639 > [654.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.740 > [655.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.841 > [655.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:02.943 > [655.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.044 > [655.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.145 > [655.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.246 > [655.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.347 > [655.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.447 > [655.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.548 > [655.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.649 > [655.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.750 > [656.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.851 > [656.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:03.952 > [656.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.053 > [656.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.154 > [656.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.255 > [656.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.356 > [656.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.457 > [656.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.558 > [656.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.660 > [656.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.761 > [657.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.861 > [657.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:04.962 > [657.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:05.063 > [657.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:05.068 > [RETRY] Attempting to send health data (Max retries: 3)
21:15:05.074 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:15:05.079 > Generated health data: HR-70 SPO2-97 STEPS-3303
21:15:05.083 > [ESP32] ========================================
21:15:05.087 > [ESP32] ENCRYPTION PIPELINE START
21:15:05.090 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:15:05.099 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:15:05.105 > [ESP32] ========================================
21:15:05.110 > [ESP32] MsgKeys: lfsrSeed=0x1B7A5B9E tnk[0..3]=1BD597DF trn[0..3]=199C7593
21:15:05.115 > 1_After_Salt (26): 48522D37302053504F322D3937205354 4550532D333330334D50
21:15:05.121 > 2_After_Padding (32): 48522D37302053504F322D3937205354 4550532D333330334D50000000000000
21:15:05.129 > [ESP32][LFSR] Initializing - Seed: 0x1B7A5B9E SeedBe: 0x9E5B7A1B ChaosKey[0..3]: 1BD597DF InitialTap: 0x0029 State: 0x1B7A5B9E
21:15:05.141 > [ESP32][LFSR] Input (first 16 bytes): 48522D37302053504F322D3937205354 Buffer size: 32 bytes
21:15:05.149 > 3_After_LFSR (32): D609572CB0B10098947F937FBD60382B C942BB40B462AE2BF9E15DA442409754
21:15:05.157 > [ESP32][LFSR] Keystream (first 16 bytes): 9E5B7A1B809153C8DB4DBE468A406B7F
21:15:05.163 > [ESP32][TINKERBELL] Input (first 16 bytes): D609572CB0B10098947F937FBD60382B Nonce: 0x00000001 Buffer size: 32 bytes
21:15:05.174 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 1BD597DF
21:15:05.183 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:05.190 > 4_After_Tinkerbell (32): D07039964315EA56C5288E03DAB96153 6AB8186F24A6B73897B00C0BBE086FD6 
21:15:05.199 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:05.207 > 5_After_Transposition (32): B7532428B939B8966F56BE70158EB003 0CEA4308C5386A6F1861DAA6D0D6970B 
21:15:05.216 > [ESP32] === HMAC DEBUG INFO ===
21:15:05.218 > [ESP32] HMAC Key being used: E77064E5DF631AE8BC8A8CA59F21E47E660342692141B8CAF8B5DB0F24E0BFD9
21:15:05.226 > [ESP32] HMAC Input length: 44 bytes
21:15:05.230 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001B7532428B939B8966F56BE70158EB0030CEA4308
21:15:05.238 > [ESP32] Nonce: 0x00000001
21:15:05.241 > [ESP32] Packet size before HMAC: 60
21:15:05.244 > [ESP32] Computed HMAC Tag: E67DB298BD9290BCB873022E836B3FCF
21:15:05.248 > [ESP32] === END HMAC DEBUG ===
21:15:05.252 > 6_Final_Packet (60): 810218001800040800000001B7532428 B939B8966F56BE70158EB0030CEA4308 ...
21:15:05.260 > [RETRY] Attempt 1/3 (nonce: 1)
21:15:05.263 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:05.269 > Sending pipeline data to server (658 bytes)
21:15:06.763 > [HTTP] Response code: 400
21:15:06.763 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:06.768 > [HTTP] Request failed with code: 400
21:15:06.771 > [RETRY] Send failed, waiting 100 ms before retry
21:15:06.871 > [RETRY] Attempt 2/3 (nonce: 1)
21:15:06.871 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:06.876 > Sending pipeline data to server (658 bytes)
21:15:07.025 > [HTTP] Response code: 400
21:15:07.025 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:07.031 > [HTTP] Request failed with code: 400
21:15:07.034 > [RETRY] Send failed, waiting 200 ms before retry
21:15:07.234 > [RETRY] Attempt 3/3 (nonce: 1)
21:15:07.234 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:07.239 > Sending pipeline data to server (658 bytes)
21:15:08.519 > [HTTP] Response code: 400
21:15:08.519 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:08.524 > [HTTP] Request failed with code: 400
21:15:08.527 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:15:08.532 > [RETRY] Consecutive failures: 5
21:15:08.535 > [EMERGENCY] Triggering emergency reset!
21:15:08.538 > [CRYPTO] Resetting cryptographic state
21:15:08.543 > [CRYPTO] Crypto state reset complete
21:15:08.546 > [CRYPTO] Packet counter: 8
21:15:08.548 > [EMERGENCY] Emergency reset complete
21:15:08.551 > Health data send failed (retry count: 1/3)
21:15:08.651 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":658986,"type":"health_data_error"}
21:15:08.665 > [WebSocket] Processing message type: health_data_error
21:15:08.671 > [660.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:15:08.679 > [RETRY] Attempting to send health data (Max retries: 3)
21:15:08.685 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:15:08.690 > Generated health data: HR-71 SPO2-97 STEPS-3323
21:15:08.693 > [ESP32] ========================================
21:15:08.698 > [ESP32] ENCRYPTION PIPELINE START
21:15:08.701 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:15:08.707 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:15:08.715 > [ESP32] ========================================
21:15:08.718 > [ESP32] MsgKeys: lfsrSeed=0x1B7A5B9E tnk[0..3]=1BD597DF trn[0..3]=199C7593
21:15:08.726 > 1_After_Salt (26): 48522D37312053504F322D3937205354 4550532D333332334D50
21:15:08.731 > 2_After_Padding (32): 48522D37312053504F322D3937205354 4550532D333332334D50000000000000
21:15:08.740 > [ESP32][LFSR] Initializing - Seed: 0x1B7A5B9E SeedBe: 0x9E5B7A1B ChaosKey[0..3]: 1BD597DF InitialTap: 0x0029 State: 0x1B7A5B9E
21:15:08.751 > [ESP32][LFSR] Input (first 16 bytes): 48522D37312053504F322D3937205354 Buffer size: 32 bytes
21:15:08.759 > 3_After_LFSR (32): D609572CB1B10098947F937FBD60382B C942BB40B462AC2BF9E15DA442409754
21:15:08.765 > [ESP32][LFSR] Keystream (first 16 bytes): 9E5B7A1B809153C8DB4DBE468A406B7F
21:15:08.774 > [ESP32][TINKERBELL] Input (first 16 bytes): D609572CB1B10098947F937FBD60382B Nonce: 0x00000001 Buffer size: 32 bytes
21:15:08.782 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 1BD597DF
21:15:08.793 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:08.801 > 4_After_Tinkerbell (32): D07039964215EA56C5288E03DAB96153 6AB8186F24A6B53897B00C0BBE086FD6 
21:15:08.810 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:08.818 > 5_After_Transposition (32): B5532428B939B8966F56BE70158EB003 0CEA4208C5386A6F1861DAA6D0D6970B 
21:15:08.827 > [ESP32] === HMAC DEBUG INFO ===
21:15:08.830 > [ESP32] HMAC Key being used: E77064E5DF631AE8BC8A8CA59F21E47E660342692141B8CAF8B5DB0F24E0BFD9        
21:15:08.838 > [ESP32] HMAC Input length: 44 bytes
21:15:08.840 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001B5532428B939B8966F56BE70158EB0030CEA4208
21:15:08.849 > [ESP32] Nonce: 0x00000001
21:15:08.851 > [ESP32] Packet size before HMAC: 60
21:15:08.854 > [ESP32] Computed HMAC Tag: 8123A002DBE366C673D57A299C67B2A3
21:15:08.859 > [ESP32] === END HMAC DEBUG ===
21:15:08.862 > 6_Final_Packet (60): 810218001800040800000001B5532428 B939B8966F56BE70158EB0030CEA4208 ...
21:15:08.871 > [RETRY] Attempt 1/3 (nonce: 1)
21:15:08.874 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:08.877 > Sending pipeline data to server (658 bytes)
21:15:10.522 > [HTTP] Response code: 400
21:15:10.524 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:10.528 > [HTTP] Request failed with code: 400
21:15:10.532 > [RETRY] Send failed, waiting 100 ms before retry
21:15:10.631 > [RETRY] Attempt 2/3 (nonce: 1)
21:15:10.631 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:10.636 > Sending pipeline data to server (658 bytes)
21:15:12.276 > [HTTP] Response code: 400
21:15:12.276 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:12.281 > [HTTP] Request failed with code: 400
21:15:12.284 > [RETRY] Send failed, waiting 200 ms before retry
21:15:12.482 > [RETRY] Attempt 3/3 (nonce: 1)
21:15:12.482 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:12.488 > Sending pipeline data to server (658 bytes)
21:15:15.784 > [HTTP] Response code: 400
21:15:15.784 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:15.789 > [HTTP] Request failed with code: 400
21:15:15.791 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:15:15.797 > [RETRY] Consecutive failures: 1
21:15:15.800 > Health data send failed (retry count: 2/3)
21:15:15.902 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":659248,"type":"health_data_error"}
21:15:15.916 > [WebSocket] Processing message type: health_data_error
21:15:15.922 > [668.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:15:15.930 > [RETRY] Attempting to send health data (Max retries: 3)
21:15:15.935 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:15:15.941 > Generated health data: HR-71 SPO2-97 STEPS-3342
21:15:15.944 > [ESP32] ========================================
21:15:15.950 > [ESP32] ENCRYPTION PIPELINE START
21:15:15.952 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:15:15.957 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:15:15.966 > [ESP32] ========================================
21:15:15.968 > [ESP32] MsgKeys: lfsrSeed=0x1B7A5B9E tnk[0..3]=1BD597DF trn[0..3]=199C7593
21:15:15.978 > 1_After_Salt (26): 48522D37312053504F322D3937205354 4550532D333334324D50
21:15:15.983 > 2_After_Padding (32): 48522D37312053504F322D3937205354 4550532D333334324D50000000000000
21:15:15.990 > [ESP32][LFSR] Initializing - Seed: 0x1B7A5B9E SeedBe: 0x9E5B7A1B ChaosKey[0..3]: 1BD597DF InitialTap: 0x0029 State: 0x1B7A5B9E
21:15:16.002 > [ESP32][LFSR] Input (first 16 bytes): 48522D37312053504F322D3937205354 Buffer size: 32 bytes
21:15:16.010 > 3_After_LFSR (32): D609572CB1B10098947F937FBD60382B C942BB40B462AA2AF9E15DA442409754 
21:15:16.016 > [ESP32][LFSR] Keystream (first 16 bytes): 9E5B7A1B809153C8DB4DBE468A406B7F
21:15:16.025 > [ESP32][TINKERBELL] Input (first 16 bytes): D609572CB1B10098947F937FBD60382B Nonce: 0x00000001 Buffer size: 32 bytes
21:15:16.033 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 1BD597DF
21:15:16.044 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:16.052 > 4_After_Tinkerbell (32): D07039964215EA56C5288E03DAB96153 6AB8186F24A6B33997B00C0BBE086FD6 
21:15:16.061 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:16.069 > 5_After_Transposition (32): B3532428B939B8966F56BE70158EB003 0CEA4208C5396A6F1861DAA6D0D6970B        
21:15:16.077 > [ESP32] === HMAC DEBUG INFO ===
21:15:16.080 > [ESP32] HMAC Key being used: E77064E5DF631AE8BC8A8CA59F21E47E660342692141B8CAF8B5DB0F24E0BFD9        
21:15:16.088 > [ESP32] HMAC Input length: 44 bytes
21:15:16.091 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001B3532428B939B8966F56BE70158EB0030CEA4208
21:15:16.100 > [ESP32] Nonce: 0x00000001
21:15:16.103 > [ESP32] Packet size before HMAC: 60
21:15:16.104 > [ESP32] Computed HMAC Tag: 2FD7F4DFF97D8FD27BC8A31E6A046B2C
21:15:16.110 > [ESP32] === END HMAC DEBUG ===
21:15:16.113 > 6_Final_Packet (60): 810218001800040800000001B3532428 B939B8966F56BE70158EB0030CEA4208 ...
21:15:16.121 > [RETRY] Attempt 1/3 (nonce: 1)
21:15:16.124 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:16.128 > Sending pipeline data to server (658 bytes)
21:15:17.789 > [HTTP] Response code: 400
21:15:17.790 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:17.794 > [HTTP] Request failed with code: 400
21:15:17.796 > [RETRY] Send failed, waiting 100 ms before retry
21:15:17.897 > [RETRY] Attempt 2/3 (nonce: 1)
21:15:17.897 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:17.902 > Sending pipeline data to server (658 bytes)
21:15:18.922 > [HTTP] Response code: 400
21:15:18.929 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:18.929 > [HTTP] Request failed with code: 400
21:15:18.935 > [RETRY] Send failed, waiting 200 ms before retry
21:15:19.132 > [RETRY] Attempt 3/3 (nonce: 1)
21:15:19.132 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:19.137 > Sending pipeline data to server (658 bytes)
21:15:20.544 > [HTTP] Response code: 400
21:15:20.545 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:20.550 > [HTTP] Request failed with code: 400
21:15:20.553 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:15:20.559 > [RETRY] Consecutive failures: 2
21:15:20.561 > Health data send failed (retry count: 3/3)
21:15:20.564 > Health data transmission failed after max retries
21:15:20.664 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":660741,"type":"health_data_error"}
21:15:20.678 > [WebSocket] Processing message type: health_data_error
21:15:20.684 > [672.9] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:20.692 > ERROR state - attempting recovery
21:15:20.694 > [RETRY] Attempting to send health data (Max retries: 3)
21:15:20.700 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
21:15:20.703 > Generated health data: HR-71 SPO2-97 STEPS-3402
21:15:20.708 > [ESP32] ========================================
21:15:20.711 > [ESP32] ENCRYPTION PIPELINE START
21:15:20.716 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
21:15:20.723 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
21:15:20.727 > [ESP32] ========================================
21:15:20.734 > [ESP32] MsgKeys: lfsrSeed=0x1B7A5B9E tnk[0..3]=1BD597DF trn[0..3]=199C7593
21:15:20.739 > 1_After_Salt (26): 48522D37312053504F322D3937205354 4550532D333430324D50
21:15:20.747 > 2_After_Padding (32): 48522D37312053504F322D3937205354 4550532D333430324D50000000000000
21:15:20.753 > [ESP32][LFSR] Initializing - Seed: 0x1B7A5B9E SeedBe: 0x9E5B7A1B ChaosKey[0..3]: 1BD597DF InitialTap: 0x0029 State: 0x1B7A5B9E
21:15:20.764 > [ESP32][LFSR] Input (first 16 bytes): 48522D37312053504F322D3937205354 Buffer size: 32 bytes
21:15:20.773 > 3_After_LFSR (32): D609572CB1B10098947F937FBD60382B C942BB40B465AE2AF9E15DA442409754 
21:15:20.781 > [ESP32][LFSR] Keystream (first 16 bytes): 9E5B7A1B809153C8DB4DBE468A406B7F
21:15:20.786 > [ESP32][TINKERBELL] Input (first 16 bytes): D609572CB1B10098947F937FBD60382B Nonce: 0x00000001 Buffer size: 32 bytes
21:15:20.797 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 1BD597DF
21:15:20.809 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:20.817 > 4_After_Tinkerbell (32): D07039964215EA56C5288E03DAB96153 6AB8186F24A1B73997B00C0BBE086FD6
21:15:20.822 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 06796EBAF3A4EACE51571D7C67D95978
21:15:20.831 > 5_After_Transposition (32): B7532428B939B8966F56BE70158EB003 0CEA4208C5396A6F1861DAA1D0D6970B        
21:15:20.839 > [ESP32] === HMAC DEBUG INFO ===
21:15:20.841 > [ESP32] HMAC Key being used: E77064E5DF631AE8BC8A8CA59F21E47E660342692141B8CAF8B5DB0F24E0BFD9        
21:15:20.851 > [ESP32] HMAC Input length: 44 bytes
21:15:20.853 > [ESP32] HMAC Input (first 32 bytes): 810218001800040800000001B7532428B939B8966F56BE70158EB0030CEA4208
21:15:20.864 > [ESP32] Nonce: 0x00000001
21:15:20.864 > [ESP32] Packet size before HMAC: 60
21:15:20.869 > [ESP32] Computed HMAC Tag: A2CECCFFFAE2E1AC7C33FBF601F8385A
21:15:20.872 > [ESP32] === END HMAC DEBUG ===
21:15:20.874 > 6_Final_Packet (60): 810218001800040800000001B7532428 B939B8966F56BE70158EB0030CEA4208 ...
21:15:20.884 > [RETRY] Attempt 1/3 (nonce: 1)
21:15:20.887 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:20.892 > Sending pipeline data to server (658 bytes)
21:15:21.048 > [HTTP] Response code: 400
21:15:21.048 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:21.054 > [HTTP] Request failed with code: 400
21:15:21.057 > [RETRY] Send failed, waiting 100 ms before retry
21:15:21.156 > [RETRY] Attempt 2/3 (nonce: 1)
21:15:21.156 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:21.161 > Sending pipeline data to server (658 bytes)
21:15:24.802 > [HTTP] Response code: 400
21:15:24.803 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:24.808 > [HTTP] Request failed with code: 400
21:15:24.811 > [RETRY] Send failed, waiting 200 ms before retry
21:15:25.011 > [RETRY] Attempt 3/3 (nonce: 1)
21:15:25.012 > POST http://10.249.92.115:8081/health-data with pipeline data
21:15:25.017 > Sending pipeline data to server (658 bytes)
21:15:28.313 > [HTTP] Response code: 400
21:15:28.313 > [HTTP] Error response: {"error":"Decryption failed"}
21:15:28.318 > [HTTP] Request failed with code: 400
21:15:28.322 > [RETRY] All retry attempts failed - rolled back nonce to 0
21:15:28.326 > [RETRY] Consecutive failures: 3
21:15:28.330 > ✗ Auto-recovery failed - restarting key exchange
21:15:30.434 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":662746,"type":"health_data_error"}
21:15:30.447 > [WebSocket] Processing message type: health_data_error
21:15:30.453 > [682.7] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:30.462 > ✓ Public key loaded from NVS
21:15:30.561 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":664499,"type":"health_data_error"}
21:15:30.575 > [WebSocket] Processing message type: health_data_error
21:15:30.580 > [682.8] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED    
21:15:30.683 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":668006,"type":"health_data_error"}
21:15:30.697 > [WebSocket] Processing message type: health_data_error
21:15:30.702 > [682.9] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:30.710 > Generating fresh master key from entropy...
21:15:30.720 > Generated master key (32): D177BCE3EDF848D864B578C09A4634B2 ED489429CBCA0099F0F492DE176A832E 
21:15:30.725 > Using reduced master key (byte % 3) for NTRU encryption only
21:15:30.735 > NTRU encrypted master key (502): 0073006A004F007F0018000B001B0071 0016007800120003001F006C007B0004 ...
21:15:30.744 > POST http://10.249.92.115:8081/master-key
21:15:32.075 > ✓ Master key exchange completed
21:15:32.177 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":670012,"type":"health_data_error"}
21:15:32.191 > [WebSocket] Processing message type: health_data_error
21:15:32.197 > [684.4] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:32.204 > Loading master key from NVS and deriving symmetric keys...
21:15:32.210 > Loaded master key from NVS (32): D177BCE3EDF848D864B578C09A4634B2 ED489429CBCA0099F0F492DE176A832E 
21:15:32.218 > Derived HMAC key (32): 91E3FBD8D750862C6C1DCCA9F583D71B 7EA387409A18252F5A6E2FCC151FCB63
21:15:32.227 > Derived Tinkerbell key (16): 975DB646777AC495666A174069554C63 
21:15:32.233 > Derived Transposition key (16): DC0B64E8A6DEDADDCF44D1470FEC707C
21:15:32.238 > ✓ Symmetric keys derived successfully
21:15:32.241 > Nonce tracker reset - new session started
21:15:32.736 > Waiting for server to process master key...
21:15:32.740 > ✓ Symmetric keys ready - starting health data transmission
21:15:32.842 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":671146,"type":"health_data_error"}
21:15:32.857 > [WebSocket] Processing message type: health_data_error
21:15:32.862 > [685.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:32.965 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":7,"success":false,"timestamp":672768,"type":"health_data_error"}
21:15:32.979 > [WebSocket] Processing message type: health_data_error
21:15:32.985 > [685.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:33.087 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":673271,"type":"health_data_error"}
21:15:33.101 > [WebSocket] Processing message type: health_data_error
21:15:33.107 > [685.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:33.212 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":677026,"type":"health_data_error"}
21:15:33.227 > [WebSocket] Processing message type: health_data_error
21:15:33.232 > [685.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:33.334 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Failed to send health data","state":8,"success":false,"timestamp":680536,"type":"health_data_error"}
21:15:33.348 > [WebSocket] Processing message type: health_data_error
21:15:33.353 > [685.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:33.457 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1769528731843,"type":"master_key_received"}
21:15:33.471 > [WebSocket] Processing message type: master_key_received
21:15:33.473 > [685.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:15:33.578 > [WebSocket] Received (176 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":684291,"type":"master_key_exchanged"}       
21:15:33.595 > [WebSocket] Processing message type: master_key_exchanged
21:15:33.600 > [685.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:15:33.701 > [WebSocket] Received (168 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":684960,"type":"symmetric_keys_derived"}
21:15:33.718 > [WebSocket] Processing message type: symmetric_keys_derived
21:15:33.723 > [685.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED       
21:15:33.823 > [686.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:33.924 > [686.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.025 > [686.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.126 > [686.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.227 > [686.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.329 > [686.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.428 > [686.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.530 > [686.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.631 > [686.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.732 > [687.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.833 > [687.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:34.935 > [687.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.035 > [687.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.136 > [687.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.237 > [687.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.338 > [687.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.439 > [687.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.541 > [687.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.641 > [687.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.742 > [688.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.843 > [688.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
21:15:35.944 > [688.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED