19:58:01.050 > ets Jul 29 2019 12:21:46
19:58:01.050 > 
19:58:01.050 > rst:0x1 (POWERON_RESET),boot:0x13 (SPI_FAST_FLASH_BOOT)
19:58:01.055 > configsip: 0, SPIWP:0xee
19:58:01.058 > clk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00
19:58:01.063 > mode:DIO, clock div:2
19:58:01.065 > load:0x3fff0030,len:1184
19:58:01.069 > load:0x40078000,len:13232
19:58:01.072 > load:0x40080400,len:3028
19:58:01.072 > entry 0x400805e4
19:58:02.508 > === XenoCipher ESP32 Booting ===
19:58:02.511 > Free heap: 293120 bytes
19:58:02.511 > Nonce counter reset for new session
19:58:02.514 > [ZTM] Forced NORMAL mode on startup - waiting for server ZTM activation
19:58:02.521 > [ZTM] (Previous ZTM settings in NVS are ignored to prevent mode desync)
19:58:02.527 > [RECIPE] Recipe map version: 1
19:58:02.530 > [RECIPE] Mapping: 1=FULL_STACK 2=CHACHA_HEAVY 3=SALSA_LIGHT 4=CHAOS_ONLY 5=STREAM_FOCUS
19:58:02.539 > [1.1] STATE: INIT_NVS | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:02.548 > ✓ NVS initialized
19:58:02.641 > [1.2] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:02.647 > Connecting to motorola edge 40_6753
19:58:02.849 > [WiFi] STA Start
19:58:02.962 > [1.5] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.062 > [1.6] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.163 > [1.7] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.262 > [1.8] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.362 > [1.9] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.463 > [2.0] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.563 > [2.1] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.663 > [2.2] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.762 > [2.3] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.863 > [2.4] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:03.962 > [2.5] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.062 > [2.6] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.154 > [WiFi] Connected to AP
19:58:04.163 > [2.7] STATE: CONNECT_WIFI | WiFi: DOWN | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.180 > [WiFi] Got IP: 10.249.92.171
19:58:04.180 > [WebSocket] Initialized - Server: 10.249.92.115:8081/api/ws
19:58:04.262 > [2.8] STATE: CONNECT_WIFI | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.269 > ✓ WiFi connected! IP: 10.249.92.171
19:58:04.364 > [2.9] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.373 > ✓ Public key loaded from NVS
19:58:04.468 > [3.0] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.568 > [3.1] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:04.577 > Generating fresh master key from entropy...
19:58:04.584 > Generated master key (32): 0039B8F3C328D8A6B745AE4A251EA69E 72446446C153D7A1CDC8EA97690034B6 
19:58:04.590 > Using reduced master key (byte % 3) for NTRU encryption only
19:58:04.599 > NTRU encrypted master key (502): 007A007A001F000F0053006000740048 006B00390012001D0051003300510017 ...
19:58:04.608 > POST http://10.249.92.115:8081/master-key
19:58:09.622 > Retry 1/3 for master key
19:58:12.738 > [11.3] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:12.747 > Generating fresh master key from entropy...
19:58:12.754 > Generated master key (32): 0D5C59F6BA86F150472332EFA848E7ED 5F602851FC9B527EED031BD14747E806 
19:58:12.760 > Using reduced master key (byte % 3) for NTRU encryption only
19:58:12.769 > NTRU encrypted master key (502): 007B007C0020000F0053006100750049 006D003B0014001D0050003300500015 ...
19:58:12.778 > POST http://10.249.92.115:8081/master-key
19:58:12.989 > ✓ Master key exchange completed
19:58:13.091 > [11.6] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: PENDING | HealthSent: 0 | WS: DISCONNECTED
19:58:13.100 > Loading master key from NVS and deriving symmetric keys...
19:58:13.102 > Loaded master key from NVS (32): 0D5C59F6BA86F150472332EFA848E7ED 5F602851FC9B527EED031BD14747E806 
19:58:13.113 > Derived HMAC key (32): 17FB6CEA7051D38F09C1EE4379E23FB5 2DE8F1D3CE7B9B144BE49056A181A1D0 
19:58:13.119 > Derived Tinkerbell key (16): 6B8283E5DB9988A3D13D29C68781BD3C 
19:58:13.125 > Derived Transposition key (16): 1B85F89FD6205CA306DA95A13D031648 
19:58:13.133 > ✓ Symmetric keys derived successfully
19:58:13.136 > Nonce tracker reset - new session started
19:58:13.639 > Waiting for server to process master key...
19:58:13.640 > ✓ Symmetric keys ready - starting health data transmission
19:58:13.739 > [12.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: DISCONNECTED
19:58:13.840 > [12.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: DISCONNECTED
19:58:13.941 > [12.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: DISCONNECTED
19:58:14.042 > [WebSocket] ========================================[WebSocket] CONNECTED to: /api/ws
19:58:14.048 > [WebSocket] WebSocket connection established[WebSocket] Ready to receive ZTM activation requests[WebSocket] ========================================[WebSocket] Sent hello message (hello_from_esp32)
19:58:14.065 > [12.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.170 > [WebSocket] Received (151 bytes): {"message":"Connected to XenoCipher Server","serverTime":1770301692737,"sessionId":"1770301692737-41","totalClients":2,"type":"connection_established"}
19:58:14.184 > [WebSocket] Processing message type: connection_established
19:58:14.190 > [WebSocket] Connection established - Session: 1770301692737-41
19:58:14.195 > [12.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.303 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1770301692853,"type":"master_key_received"}
19:58:14.317 > [WebSocket] Processing message type: master_key_received
19:58:14.320 > [12.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.425 > [WebSocket] Received (112 bytes): {"message":"ESP32 connection acknowledged","serverTime":1770301694057,"status":"ready","type":"esp32_connected"}
19:58:14.437 > [WebSocket] Processing message type: esp32_connected
19:58:14.442 > [13.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.546 > [13.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.647 > [13.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.748 > [13.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.850 > [13.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:14.950 > [13.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.052 > [13.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.153 > [13.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.253 > [13.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.354 > [13.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.456 > [14.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.557 > [14.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.658 > [14.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.759 > [14.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.859 > [14.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:15.960 > [14.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.061 > [14.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.162 > [14.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.264 > [14.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.365 > [14.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.466 > [15.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.566 > [15.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.667 > [15.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.768 > [15.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.869 > [15.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:16.970 > [15.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.072 > [15.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.173 > [15.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.274 > [15.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.374 > [15.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.476 > [16.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.576 > [16.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.678 > [16.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.779 > [16.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.880 > [16.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:17.980 > [16.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.081 > [16.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.182 > [16.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.283 > [16.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.384 > [16.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.485 > [17.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.586 > [17.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.687 > [17.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.789 > [17.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.889 > [17.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:18.990 > [17.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.092 > [17.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.193 > [17.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.294 > [17.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.395 > [17.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.495 > [18.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.597 > [18.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.698 > [18.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.799 > [18.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:19.900 > [18.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.001 > [18.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.102 > [18.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.202 > [18.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.303 > [18.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.405 > [18.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.506 > [19.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.606 > [19.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.708 > [19.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.809 > [19.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:20.909 > [19.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.010 > [19.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.112 > [19.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.212 > [19.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.314 > [19.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.415 > [19.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.516 > [20.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.616 > [20.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.717 > [20.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.818 > [20.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:21.920 > [20.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.021 > [20.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.121 > [20.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.223 > [20.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.324 > [20.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.425 > [20.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.526 > [21.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.626 > [21.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.728 > [21.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.829 > [21.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:22.929 > [21.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.031 > [21.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.132 > [21.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.233 > [21.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.333 > [21.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.434 > [22.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.535 > [22.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.636 > [22.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.738 > [22.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 0 | WS: CONNECTED
19:58:23.743 > [RETRY] Attempting to send health data (Max retries: 3)
19:58:23.748 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=0\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 1 for all retry attempts (saved: 0)
19:58:23.765 > Generated health data: HR-60 SPO2-95 STEPS-120
19:58:23.768 > [ESP32] ========================================
19:58:23.773 > [ESP32] ENCRYPTION PIPELINE START
19:58:23.776 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
19:58:23.785 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
19:58:23.790 > [ESP32] ========================================
19:58:23.795 > [ESP32] MsgKeys: lfsrSeed=0xACF768B2 tnk[0..3]=48369A6A trn[0..3]=6F2A3A6E
19:58:23.801 > 1_After_Salt (25): 48522D36302053504F322D3935205354 4550532D3132304D50
19:58:23.807 > 2_After_Padding (32): 48522D36302053504F322D3935205354 4550532D3132304D5000000000000000 
19:58:23.815 > [ESP32][LFSR] Initializing - Seed: 0xACF768B2 SeedBe: 0xB268F7AC ChaosKey[0..3]: 48369A6A InitialTap: 0x0029 State: 0xACF768B2
19:58:23.826 > [ESP32][LFSR] Input (first 16 bytes): 48522D36302053504F322D3935205354 Buffer size: 32 bytes
19:58:23.835 > 3_After_LFSR (32): FA3ADA9A4537A6AA42A0EDB64613370F C3309208ACBEA63F2A6606C61C9B69CD 
19:58:23.843 > [ESP32][LFSR] Keystream (first 16 bytes): B268F7AC7517F5FA0D92C08F7333645B
19:58:23.849 > [ESP32][4D] LFSR keystream (first 32 bytes): B268F7AC7517F5FA0D92C08F7333645B8660C1259D8C96727A6606C61C9B69CD
19:58:23.857 > [ESP32][TINKERBELL] Input (first 16 bytes): FA3ADA9A4537A6AA42A0EDB64613370F Nonce: 0x00000001 Buffer size: 32 bytes
19:58:23.868 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 48369A6A
19:58:23.879 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): AB767EDB469DAE5C7A7082E7DEB179B2
19:58:23.887 > 4_After_Tinkerbell (32): 514CA44103AA08F638D06F5198A24EBD 2CB12F804993F94BD9FE7B3E50C1E991 
19:58:23.893 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): AB767EDB469DAE5C7A7082E7DEB179B2
19:58:23.901 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): AB767EDB469DAE5C7A7082E7DEB179B2EF81BD88E52D5F74F3987DF84C5A805C
19:58:23.912 > 5_After_Transposition (32): 0393F9E9412C51C16F4E4BA49849D008 BD80AAFEF638517BB14C2F3E91D950A2 
19:58:23.921 > [ESP32] === HMAC DEBUG INFO ===
19:58:23.924 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:58:23.931 > [ESP32] HMAC Input length: 44 bytes
19:58:23.935 > [ESP32] HMAC Input (first 32 bytes): 8102170017000408000000010393F9E9412C51C16F4E4BA49849D008BD80AAFE
19:58:23.943 > [ESP32] Nonce: 0x00000001
19:58:23.945 > [ESP32] Packet size before HMAC: 60
19:58:23.949 > [ESP32] Computed HMAC Tag: D58C48C9D903DEF906B20392F583739C
19:58:23.954 > [ESP32] === END HMAC DEBUG ===
19:58:23.957 > 6_Final_Packet (60): 8102170017000408000000010393F9E9 412C51C16F4E4BA49849D008BD80AAFE ...
19:58:23.965 > [RETRY] Attempt 1/3 (nonce: 1)
19:58:23.968 > POST http://10.249.92.115:8081/health-data with pipeline data
19:58:23.975 > Sending pipeline data to server (604 bytes)
19:58:24.234 > [HTTP] Response code: 200
19:58:24.234 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:58:24.247 > [RETRY] Health data sent successfully!
19:58:24.250 > ✓ Health data #1 sent successfully
19:58:24.351 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":1,"serverTime":1770301704067,"type":"security_update"}
19:58:24.368 > [WebSocket] Processing message type: security_update
19:58:24.374 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
19:58:24.379 > [22.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:24.485 > [WebSocket] Received (631 bytes): {"currentRecipe":"CHAOS_ONLY","encData":"ENC_DATA:8102170017000408000000010393F9E9412C51C16F4E4BA49849D008BD80AAFEF638517BB14C2F3E91D950A2D58C48C9D903DEF906B20392F583739C","pipeline":{"afterLFSR":"FA3ADA9A4537A6AA42A0EDB64613370FC3309208ACBEA63F2A6606C61C9B69CD","afterSalt":"48522D36302053504F322D39352053544550532D3132304D50","afterTinkerbell":"514CA44103AA08F638D06F5198A24EBD2CB12F804993F94BD9FE7B3E50C1E991","afterTransposition":"0393F9E9412C51C16F4E4BA49849D008BD80AAFEF638517BB14C2F3E91D950A2"},"plaintext":"HR-60 SPO2-95 STEPS-120","serverTime":1770301704067,"timestamp":22500,"type":"encryption_update","ztmEnabled":false}
19:58:24.540 > [WebSocket] Processing message type: encryption_update
19:58:24.545 > [23.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:24.648 > [WebSocket] Received (87 bytes): {"heartRate":60,"spo2":95,"steps":120,"time":1770301704067,"type":"health_data_update"}
19:58:24.656 > [WebSocket] Processing message type: health_data_update
19:58:24.662 > [23.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:24.769 > [WebSocket] Received (223 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.302,"encryptionTime":0.0,"finalPlaintext":"HR-60 SPO2-95 STEPS-120","handshakeSuccess":true,"totalTime":0.302},"type":"session_summary_update"}
19:58:24.792 > [WebSocket] Processing message type: session_summary_update
19:58:24.795 > [23.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:24.902 > [WebSocket] Received (655 bytes): {"decryptionTime":0.302,"encryptedPacket":"8102170017000408000000010393F9E9412C51C16F4E4BA49849D008BD80AAFEF638517BB14C2F3E91D950A2D58C48C9D903DEF906B20392F583739C","finalPlaintext":"HR-60 SPO2-95 STEPS-120","healthData":{"heartRate":60,"spo2":95,"steps":120},"pipeline":{"afterDepad":"48522D36302053504F322D39352053544550532D31323000000000000000","afterLFSR":"48522D36302053504F322D39352053544550532D3132304D5000000000000000","afterTinkerbell":"FA3ADA9A4537A6AA42A0EDB64613370FC3309208ACBEA63F2A6606C61C9B69CD","afterTransposition":"514CA44103AA08F638D06F5198A24EBD2CB12F804993F94BD9FE7B3E50C1E991"},"serverTime":1770301704068,"type":"decryption_update"}
19:58:24.961 > [WebSocket] Processing message type: decryption_update
19:58:24.966 > [WebSocket] Server decryption completed
19:58:24.969 > [WebSocket] Health data - HR: 60, SPO2: 95, Steps: 120
19:58:24.975 > [23.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.076 > [WebSocket] Received (643 bytes): {"currentRecipe":"CHAOS_ONLY","deviceId":"f9641d44","healthSendCount":0,"pipeline":{"afterLFSR":"FA3ADA9A4537A6AA42A0EDB64613370FC3309208ACBEA63F2A6606C61C9B69CD","afterSalt":"48522D36302053504F322D39352053544550532D3132304D50","afterTinkerbell":"514CA44103AA08F638D06F5198A24EBD2CB12F804993F94BD9FE7B3E50C1E991","afterTransposition":"0393F9E9412C51C16F4E4BA49849D008BD80AAFEF638517BB14C2F3E91D950A2","finalPacket":"8102170017000408000000010393F9E9412C51C16F4E4BA49849D008BD80AAFEF638517BB14C2F3E91D950A2D58C48C9D903DEF906B20392F583739C"},"plaintext":"HR-60 SPO2-95 STEPS-120","timestamp":22760,"type":"encryption_pipeline","ztmEnabled":false}
19:58:25.134 > [WebSocket] Processing message type: encryption_pipeline
19:58:25.137 > [23.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.239 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":0,"message":"Health data #1 sent successfully","state":7,"success":true,"timestamp":22765,"type":"health_data_sent"}
19:58:25.254 > [WebSocket] Processing message type: health_data_sent
19:58:25.258 > [23.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.361 > [23.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.462 > [24.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.562 > [24.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.663 > [24.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.764 > [24.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.865 > [24.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:25.966 > [24.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.067 > [24.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.168 > [24.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.269 > [24.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.370 > [24.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.471 > [25.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.572 > [25.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.673 > [25.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.775 > [25.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.876 > [25.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:26.976 > [25.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.077 > [25.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.179 > [25.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.280 > [25.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.381 > [25.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.481 > [26.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.583 > [26.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.683 > [26.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.784 > [26.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.885 > [26.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:27.986 > [26.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.088 > [26.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.189 > [26.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.289 > [26.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.390 > [26.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.492 > [27.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.592 > [27.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.694 > [27.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.794 > [27.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.896 > [27.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:28.996 > [27.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.098 > [27.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.198 > [27.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.300 > [27.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.400 > [27.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.501 > [28.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.603 > [28.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.704 > [28.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.804 > [28.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:29.904 > [28.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.006 > [28.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.108 > [28.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.208 > [28.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.309 > [28.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.410 > [28.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.511 > [29.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.613 > [29.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.713 > [29.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.814 > [29.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:30.916 > [29.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.016 > [29.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.117 > [29.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.218 > [29.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.319 > [29.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.420 > [29.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.522 > [30.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.622 > [30.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.724 > [30.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.825 > [30.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:31.925 > [30.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.026 > [30.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.127 > [30.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.229 > [30.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.329 > [30.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.431 > [31.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.532 > [31.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.633 > [31.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.733 > [31.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.834 > [31.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:32.935 > [31.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.036 > [31.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.137 > [31.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.238 > [31.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.340 > [31.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.440 > [32.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.542 > [32.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.643 > [32.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.743 > [32.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.843 > [32.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:33.945 > [32.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:34.046 > [32.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:34.147 > [32.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:34.249 > [32.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 1 | WS: CONNECTED
19:58:34.254 > [RETRY] Attempting to send health data (Max retries: 3)
19:58:34.259 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=0\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:58:34.275 > Generated health data: HR-60 SPO2-95 STEPS-169
19:58:34.279 > [ESP32] ========================================
19:58:34.285 > [ESP32] ENCRYPTION PIPELINE START
19:58:34.287 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
19:58:34.295 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
19:58:34.301 > [ESP32] ========================================
19:58:34.307 > [ESP32] MsgKeys: lfsrSeed=0xA9209F8C tnk[0..3]=33C7F1ED trn[0..3]=9202498B
19:58:34.312 > 1_After_Salt (25): 48522D36302053504F322D3935205354 4550532D3136394D50
19:58:34.318 > 2_After_Padding (32): 48522D36302053504F322D3935205354 4550532D3136394D5000000000000000 
19:58:34.326 > [ESP32][LFSR] Initializing - Seed: 0xA9209F8C SeedBe: 0x8C9F20A9 ChaosKey[0..3]: 33C7F1ED InitialTap: 0x0029 State: 0xA9209F8C
19:58:34.337 > [ESP32][LFSR] Input (first 16 bytes): 48522D36302053504F322D3935205354 Buffer size: 32 bytes
19:58:34.345 > 3_After_LFSR (32): C4CD0D9F7E6DCAB6325ECA0B75192B9B 957DC3722971CA302384A424A0711064 
19:58:34.353 > [ESP32][LFSR] Keystream (first 16 bytes): 8C9F20A94E4D99E67D6CE732403978CF
19:58:34.359 > [ESP32][4D] LFSR keystream (first 32 bytes): 8C9F20A94E4D99E67D6CE732403978CFD02D905F1847F37D7384A424A0711064
19:58:34.368 > [ESP32][TINKERBELL] Input (first 16 bytes): C4CD0D9F7E6DCAB6325ECA0B75192B9B Nonce: 0x00000002 Buffer size: 32 bytes
19:58:34.378 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000002 Counter: 0 (must start at 0) Key[0..3]: 33C7F1ED
19:58:34.390 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 0C1F0C50F0422F8B07744F43C54593C3
19:58:34.398 > 4_After_Tinkerbell (32): C8D201CF8E2FE53D352A8548B05CB858 B6ED66D87B11FCE5752E023355F7EF4B 
19:58:34.404 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 0C1F0C50F0422F8B07744F43C54593C3
19:58:34.412 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): 0C1F0C50F0422F8B07744F43C54593C32390A5AA526036D556AAA617F586FF2F
19:58:34.423 > 5_After_Transposition (32): 02B08E334B66F7B83D7BED2FE5E58535 752A555CFCCF48D82ED25801C8B611EF 
19:58:34.432 > [ESP32] === HMAC DEBUG INFO ===
19:58:34.434 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:58:34.442 > [ESP32] HMAC Input length: 44 bytes
19:58:34.445 > [ESP32] HMAC Input (first 32 bytes): 81021700170004080000000202B08E334B66F7B83D7BED2FE5E58535752A555C
19:58:34.454 > [ESP32] Nonce: 0x00000002
19:58:34.456 > [ESP32] Packet size before HMAC: 60
19:58:34.459 > [ESP32] Computed HMAC Tag: 40A10F55D2F41733C9D223F1E3145FF8
19:58:34.465 > [ESP32] === END HMAC DEBUG ===
19:58:34.467 > 6_Final_Packet (60): 81021700170004080000000202B08E33 4B66F7B83D7BED2FE5E58535752A555C ...
19:58:34.476 > [RETRY] Attempt 1/3 (nonce: 2)
19:58:34.479 > POST http://10.249.92.115:8081/health-data with pipeline data
19:58:34.485 > Sending pipeline data to server (604 bytes)
19:58:34.739 > [HTTP] Response code: 200
19:58:34.740 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:58:34.752 > [RETRY] Health data sent successfully!
19:58:34.756 > ✓ Health data #2 sent successfully
19:58:34.857 > [WebSocket] Received (631 bytes): {"currentRecipe":"CHAOS_ONLY","encData":"ENC_DATA:81021700170004080000000202B08E334B66F7B83D7BED2FE5E58535752A555CFCCF48D82ED25801C8B611EF40A10F55D2F41733C9D223F1E3145FF8","pipeline":{"afterLFSR":"C4CD0D9F7E6DCAB6325ECA0B75192B9B957DC3722971CA302384A424A0711064","afterSalt":"48522D36302053504F322D39352053544550532D3136394D50","afterTinkerbell":"C8D201CF8E2FE53D352A8548B05CB858B6ED66D87B11FCE5752E023355F7EF4B","afterTransposition":"02B08E334B66F7B83D7BED2FE5E58535752A555CFCCF48D82ED25801C8B611EF"},"plaintext":"HR-60 SPO2-95 STEPS-169","serverTime":1770301714574,"timestamp":33011,"type":"encryption_update","ztmEnabled":false}
19:58:34.912 > [WebSocket] Processing message type: encryption_update
19:58:34.918 > [33.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.020 > [WebSocket] Received (87 bytes): {"heartRate":60,"spo2":95,"steps":169,"time":1770301714574,"type":"health_data_update"}
19:58:35.028 > [WebSocket] Processing message type: health_data_update
19:58:35.034 > [33.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.142 > [WebSocket] Received (223 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.252,"encryptionTime":0.0,"finalPlaintext":"HR-60 SPO2-95 STEPS-169","handshakeSuccess":true,"totalTime":0.252},"type":"session_summary_update"}
19:58:35.164 > [WebSocket] Processing message type: session_summary_update
19:58:35.167 > [33.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.275 > [WebSocket] Received (655 bytes): {"decryptionTime":0.252,"encryptedPacket":"81021700170004080000000202B08E334B66F7B83D7BED2FE5E58535752A555CFCCF48D82ED25801C8B611EF40A10F55D2F41733C9D223F1E3145FF8","finalPlaintext":"HR-60 SPO2-95 STEPS-169","healthData":{"heartRate":60,"spo2":95,"steps":169},"pipeline":{"afterDepad":"48522D36302053504F322D39352053544550532D31363900000000000000","afterLFSR":"48522D36302053504F322D39352053544550532D3136394D5000000000000000","afterTinkerbell":"C4CD0D9F7E6DCAB6325ECA0B75192B9B957DC3722971CA302384A424A0711064","afterTransposition":"C8D201CF8E2FE53D352A8548B05CB858B6ED66D87B11FCE5752E023355F7EF4B"},"serverTime":1770301714575,"type":"decryption_update"}
19:58:35.333 > [WebSocket] Processing message type: decryption_update
19:58:35.339 > [WebSocket] Server decryption completed
19:58:35.342 > [WebSocket] Health data - HR: 60, SPO2: 95, Steps: 169
19:58:35.347 > [33.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.449 > [WebSocket] Received (643 bytes): {"currentRecipe":"CHAOS_ONLY","deviceId":"f9641d44","healthSendCount":1,"pipeline":{"afterLFSR":"C4CD0D9F7E6DCAB6325ECA0B75192B9B957DC3722971CA302384A424A0711064","afterSalt":"48522D36302053504F322D39352053544550532D3136394D50","afterTinkerbell":"C8D201CF8E2FE53D352A8548B05CB858B6ED66D87B11FCE5752E023355F7EF4B","afterTransposition":"02B08E334B66F7B83D7BED2FE5E58535752A555CFCCF48D82ED25801C8B611EF","finalPacket":"81021700170004080000000202B08E334B66F7B83D7BED2FE5E58535752A555CFCCF48D82ED25801C8B611EF40A10F55D2F41733C9D223F1E3145FF8"},"plaintext":"HR-60 SPO2-95 STEPS-169","timestamp":33267,"type":"encryption_pipeline","ztmEnabled":false}
19:58:35.507 > [WebSocket] Processing message type: encryption_pipeline
19:58:35.510 > [34.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.612 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":1,"message":"Health data #2 sent successfully","state":7,"success":true,"timestamp":33271,"type":"health_data_sent"}
19:58:35.628 > [WebSocket] Processing message type: health_data_sent
19:58:35.631 > [34.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.733 > [34.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.834 > [34.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:35.935 > [34.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.036 > [34.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.136 > [34.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.238 > [34.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.339 > [34.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.440 > [35.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.541 > [35.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.642 > [35.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.743 > [35.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.844 > [35.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:36.945 > [35.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.045 > [35.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.148 > [35.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.248 > [35.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.349 > [35.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.449 > [36.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.551 > [36.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.652 > [36.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.752 > [36.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.854 > [36.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:37.954 > [36.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.056 > [36.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.157 > [36.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.258 > [36.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.358 > [36.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.460 > [37.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.561 > [37.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.662 > [37.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.763 > [37.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.864 > [37.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:38.965 > [37.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.065 > [37.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.167 > [37.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.267 > [37.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.369 > [37.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.470 > [38.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.571 > [38.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.672 > [38.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.773 > [38.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.874 > [38.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:39.975 > [38.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.075 > [38.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.176 > [38.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.278 > [38.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.378 > [38.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.479 > [39.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.580 > [39.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.682 > [39.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.782 > [39.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.884 > [39.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:40.985 > [39.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.086 > [39.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.187 > [39.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.288 > [39.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.389 > [39.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.490 > [40.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.591 > [40.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.691 > [40.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.793 > [40.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.893 > [40.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:41.995 > [40.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.096 > [40.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.197 > [40.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.298 > [40.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.399 > [40.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.499 > [41.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.601 > [41.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.702 > [41.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.802 > [41.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:42.904 > [41.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.004 > [41.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.106 > [41.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.207 > [41.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.308 > [41.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.409 > [41.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.510 > [42.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.611 > [42.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.711 > [42.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.813 > [42.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:43.914 > [42.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.015 > [42.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.116 > [42.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.217 > [42.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.317 > [42.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.419 > [42.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.520 > [43.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.620 > [43.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.721 > [43.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.823 > [43.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 2 | WS: CONNECTED
19:58:44.828 > [RETRY] Attempting to send health data (Max retries: 3)
19:58:44.834 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=0\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 3 for all retry attempts (saved: 2)
19:58:44.850 > Generated health data: HR-60 SPO2-95 STEPS-238
19:58:44.854 > [ESP32] ========================================
19:58:44.859 > [ESP32] ENCRYPTION PIPELINE START
19:58:44.862 > [ESP32] Mode: NORMAL | ZTM Enabled: FALSE | Recipe: CHAOS_ONLY (Normal Baseline)
19:58:44.870 > [ESP32] Active Algorithms: LFSR + Tinkerbell + Transposition (Normal Mode)
19:58:44.876 > [ESP32] ========================================
19:58:44.881 > [ESP32] MsgKeys: lfsrSeed=0xDF6DC6D0 tnk[0..3]=3B7E89DE trn[0..3]=D83A2FD9
19:58:44.887 > 1_After_Salt (25): 48522D36302053504F322D3935205354 4550532D3233384D50
19:58:44.892 > 2_After_Padding (32): 48522D36302053504F322D3935205354 4550532D3233384D5000000000000000 
19:58:44.900 > [ESP32][LFSR] Initializing - Seed: 0xDF6DC6D0 SeedBe: 0xD0C66DDF ChaosKey[0..3]: 3B7E89DE InitialTap: 0x0029 State: 0xDF6DC6D0
19:58:44.911 > [ESP32][LFSR] Input (first 16 bytes): 48522D36302053504F322D3935205354 Buffer size: 32 bytes
19:58:44.920 > 3_After_LFSR (32): 989440E920FAFCBB36B8F11C0B5F0AC3 014122DD4A144B8D26951DB34E1379AB 
19:58:44.928 > [ESP32][LFSR] Keystream (first 16 bytes): D0C66DDF10DAAFEB798ADC253E7F5997
19:58:44.934 > [ESP32][4D] LFSR keystream (first 32 bytes): D0C66DDF10DAAFEB798ADC253E7F5997441171F0782773C076951DB34E1379AB
19:58:44.942 > [ESP32][TINKERBELL] Input (first 16 bytes): 989440E920FAFCBB36B8F11C0B5F0AC3 Nonce: 0x00000003 Buffer size: 32 bytes
19:58:44.954 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000003 Counter: 0 (must start at 0) Key[0..3]: 3B7E89DE
19:58:44.965 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): D62C5FC7E21360F688EB99045B92F9FA
19:58:44.973 > 4_After_Tinkerbell (32): 4EB81F2EC2E99C4DBE53681850CDF339 E9A8B6A28B7379D8B56EB59A084DDCA4 
19:58:44.978 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): D62C5FC7E21360F688EB99045B92F9FA
19:58:44.987 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): D62C5FC7E21360F688EB99045B92F9FAE8E9947FC167325593FBA829465EA50F
19:58:44.998 > 5_After_Transposition (32): F373A4A24E39E99C50B65379CDA84D4D B8D8C21868E9B51F2E088BDCBE6E9AB5 
19:58:45.006 > [ESP32] === HMAC DEBUG INFO ===
19:58:45.008 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:58:45.017 > [ESP32] HMAC Input length: 44 bytes
19:58:45.020 > [ESP32] HMAC Input (first 32 bytes): 810217001700040800000003F373A4A24E39E99C50B65379CDA84D4DB8D8C218
19:58:45.028 > [ESP32] Nonce: 0x00000003
19:58:45.031 > [ESP32] Packet size before HMAC: 60
19:58:45.034 > [ESP32] Computed HMAC Tag: 6E7215CF838F5ADD92D08F126A75514B
19:58:45.040 > [ESP32] === END HMAC DEBUG ===
19:58:45.042 > 6_Final_Packet (60): 810217001700040800000003F373A4A2 4E39E99C50B65379CDA84D4DB8D8C218 ...
19:58:45.051 > [RETRY] Attempt 1/3 (nonce: 3)
19:58:45.053 > POST http://10.249.92.115:8081/health-data with pipeline data
19:58:45.061 > Sending pipeline data to server (604 bytes)
19:58:45.245 > [HTTP] Response code: 200
19:58:45.245 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:58:45.256 > [RETRY] Health data sent successfully!
19:58:45.260 > ✓ Health data #3 sent successfully
19:58:45.362 > [WebSocket] Received (631 bytes): {"currentRecipe":"CHAOS_ONLY","encData":"ENC_DATA:810217001700040800000003F373A4A24E39E99C50B65379CDA84D4DB8D8C21868E9B51F2E088BDCBE6E9AB56E7215CF838F5ADD92D08F126A75514B","pipeline":{"afterLFSR":"989440E920FAFCBB36B8F11C0B5F0AC3014122DD4A144B8D26951DB34E1379AB","afterSalt":"48522D36302053504F322D39352053544550532D3233384D50","afterTinkerbell":"4EB81F2EC2E99C4DBE53681850CDF339E9A8B6A28B7379D8B56EB59A084DDCA4","afterTransposition":"F373A4A24E39E99C50B65379CDA84D4DB8D8C21868E9B51F2E088BDCBE6E9AB5"},"plaintext":"HR-60 SPO2-95 STEPS-238","serverTime":1770301725179,"timestamp":43586,"type":"encryption_update","ztmEnabled":false}
19:58:45.417 > [WebSocket] Processing message type: encryption_update
19:58:45.423 > [43.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:45.526 > [WebSocket] Received (87 bytes): {"heartRate":60,"spo2":95,"steps":238,"time":1770301725179,"type":"health_data_update"}
19:58:45.535 > [WebSocket] Processing message type: health_data_update
19:58:45.540 > [44.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:45.649 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.3459,"encryptionTime":0.0,"finalPlaintext":"HR-60 SPO2-95 STEPS-238","handshakeSuccess":true,"totalTime":0.3459},"type":"session_summary_update"}
19:58:45.670 > [WebSocket] Processing message type: session_summary_update
19:58:45.676 > [44.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:45.781 > [WebSocket] Received (656 bytes): {"decryptionTime":0.3459,"encryptedPacket":"810217001700040800000003F373A4A24E39E99C50B65379CDA84D4DB8D8C21868E9B51F2E088BDCBE6E9AB56E7215CF838F5ADD92D08F126A75514B","finalPlaintext":"HR-60 SPO2-95 STEPS-238","healthData":{"heartRate":60,"spo2":95,"steps":238},"pipeline":{"afterDepad":"48522D36302053504F322D39352053544550532D32333800000000000000","afterLFSR":"48522D36302053504F322D39352053544550532D3233384D5000000000000000","afterTinkerbell":"989440E920FAFCBB36B8F11C0B5F0AC3014122DD4A144B8D26951DB34E1379AB","afterTransposition":"4EB81F2EC2E99C4DBE53681850CDF339E9A8B6A28B7379D8B56EB59A084DDCA4"},"serverTime":1770301725180,"type":"decryption_update"}
19:58:45.839 > [WebSocket] Processing message type: decryption_update
19:58:45.845 > [WebSocket] Server decryption completed
19:58:45.848 > [WebSocket] Health data - HR: 60, SPO2: 95, Steps: 238
19:58:45.852 > [44.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:45.954 > [WebSocket] Received (643 bytes): {"currentRecipe":"CHAOS_ONLY","deviceId":"f9641d44","healthSendCount":2,"pipeline":{"afterLFSR":"989440E920FAFCBB36B8F11C0B5F0AC3014122DD4A144B8D26951DB34E1379AB","afterSalt":"48522D36302053504F322D39352053544550532D3233384D50","afterTinkerbell":"4EB81F2EC2E99C4DBE53681850CDF339E9A8B6A28B7379D8B56EB59A084DDCA4","afterTransposition":"F373A4A24E39E99C50B65379CDA84D4DB8D8C21868E9B51F2E088BDCBE6E9AB5","finalPacket":"810217001700040800000003F373A4A24E39E99C50B65379CDA84D4DB8D8C21868E9B51F2E088BDCBE6E9AB56E7215CF838F5ADD92D08F126A75514B"},"plaintext":"HR-60 SPO2-95 STEPS-238","timestamp":43772,"type":"encryption_pipeline","ztmEnabled":false}
19:58:46.013 > [WebSocket] Processing message type: encryption_pipeline
19:58:46.015 > [44.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.117 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":2,"message":"Health data #3 sent successfully","state":7,"success":true,"timestamp":43777,"type":"health_data_sent"}
19:58:46.134 > [WebSocket] Processing message type: health_data_sent
19:58:46.137 > [44.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.239 > [44.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.339 > [44.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.441 > [45.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.542 > [45.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.643 > [45.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.743 > [45.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.845 > [45.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:46.945 > [45.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.047 > [45.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.148 > [45.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.248 > [45.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.350 > [45.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.451 > [46.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.552 > [46.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.652 > [46.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.754 > [46.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.854 > [46.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:47.956 > [46.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.056 > [46.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.158 > [46.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.259 > [46.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.360 > [46.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.461 > [47.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.562 > [47.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.663 > [47.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.764 > [47.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.864 > [47.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:48.965 > [47.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.066 > [47.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.167 > [47.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.269 > [47.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.370 > [47.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.471 > [48.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.572 > [48.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.673 > [48.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.774 > [48.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.874 > [48.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:49.976 > [48.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.077 > [48.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.178 > [48.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.278 > [48.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.380 > [48.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.480 > [49.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.582 > [49.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.681 > [49.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.784 > [49.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.884 > [49.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:50.985 > [49.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.086 > [49.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.187 > [49.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.289 > [49.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.389 > [49.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.491 > [50.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.591 > [50.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.692 > [50.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.794 > [50.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:51.897 > [WebSocket] Received (493 bytes): {"activatedAt":1770301731830,"active":true,"epoch":1,"heuristics":{"cpuUsage":20.0,"decryptFailures":0,"entropy":7.5,"hmacFailures":0,"latency":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"lastCommitNonce":0,"lastSeenNonce":1011,"lastSwitchReason":"ZTM activated - baseline recipe","message":"Zero Trust Mode activated successfully","pendingProposals":0,"recipe":"CHAOS_ONLY","serverTime":1770301731830,"success":true,"threatLevel":0,"type":"ztm_activation_acknowledged"}
19:58:51.942 > [WebSocket] Processing message type: ztm_activation_acknowledged
19:58:51.948 > [WebSocket] ========================================
19:58:51.953 > [WebSocket] ZTM ACTIVATION RECEIVED (type: ztm_activation_acknowledged, fromFrontend: NO)
19:58:51.961 > [WebSocket] ========================================
19:58:51.964 > [ZTM] Settings saved successfully
19:58:51.967 > [WebSocket] ✓ ZTM activated successfully
19:58:51.973 > [WebSocket] ✓ Normal Mode encryption STOPPED
19:58:51.976 > [WebSocket] ✓ ZTM encryption pipeline ACTIVE
19:58:51.981 > [WebSocket] ✓ Current recipe: CHAOS_ONLY
19:58:51.984 > [WebSocket] ========================================
19:58:51.988 > [WebSocket] Received server ack - not sending duplicate ack (prevents loop)
19:58:51.996 > [50.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.100 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":3,"message":"Zero Trust Mode activated successfully","state":7,"success":true,"timestamp":50519,"type":"ztm_activated"}
19:58:52.116 > [WebSocket] Processing message type: ztm_activated
19:58:52.118 > [50.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.222 > [50.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.322 > [50.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.423 > [50.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.525 > [51.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.626 > [51.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.726 > [51.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.828 > [51.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:52.929 > [WebSocket] Received (314 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":1011,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301732845,"threatLevel":0,"type":"heuristics_update"}
19:58:52.957 > [WebSocket] Processing message type: heuristics_update
19:58:52.962 > [51.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.071 > [51.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.172 > [51.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.273 > [51.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.375 > [51.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.475 > [52.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.576 > [52.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.678 > [52.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.779 > [52.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:53.880 > [WebSocket] Received (314 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":1011,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301733861,"threatLevel":0,"type":"heuristics_update"}
19:58:53.908 > [WebSocket] Processing message type: heuristics_update
19:58:53.913 > [52.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.022 > [52.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.123 > [52.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.224 > [52.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.325 > [52.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.426 > [53.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.527 > [53.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.628 > [53.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.729 > [53.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.830 > [53.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:54.932 > [WebSocket] Received (314 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":1011,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301734868,"threatLevel":0,"type":"heuristics_update"}
19:58:54.960 > [WebSocket] Processing message type: heuristics_update
19:58:54.965 > [53.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:55.075 > [53.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:55.176 > [53.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:55.276 > [53.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 3 | WS: CONNECTED
19:58:55.282 > [RETRY] Attempting to send health data (Max retries: 3)
19:58:55.287 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=0\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 4 for all retry attempts (saved: 3)
19:58:55.304 > Generated health data: HR-60 SPO2-95 STEPS-275
19:58:55.307 > [ESP32] ========================================
19:58:55.313 > [ESP32] ENCRYPTION PIPELINE START
19:58:55.316 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: CHAOS_ONLY
19:58:55.321 > [ESP32] Active Algorithms for this packet:
19:58:55.324 > [ESP32]   + LFSR
19:58:55.326 > [ESP32]   + Tinkerbell
19:58:55.329 > [ESP32]   + Transposition
19:58:55.329 > [ESP32]   - ChaCha20
19:58:55.332 > [ESP32]   - Salsa20
19:58:55.335 > [ESP32] ========================================
19:58:55.338 > [ESP32] MsgKeys: lfsrSeed=0x8B9ACB28 tnk[0..3]=A7149FF0 trn[0..3]=E8589084
19:58:55.346 > 1_After_Salt (25): 48522D36302053504F322D3935205354 4550532D3237354D50
19:58:55.351 > 2_After_Padding (32): 48522D36302053504F322D3935205354 4550532D3237354D5000000000000000 
19:58:55.360 > [ESP32][LFSR] Initializing - Seed: 0x8B9ACB28 SeedBe: 0x28CB9A8B ChaosKey[0..3]: A7149FF0 InitialTap: 0x0029 State: 0x8B9ACB28
19:58:55.371 > [ESP32][LFSR] Input (first 16 bytes): 48522D36302053504F322D3935205354 Buffer size: 32 bytes
19:58:55.379 > 3_After_LFSR (32): 6099B7BD2DAFD423082820CF40B47D20 ABE0169EAED06CDE3773BDE52AC6D8B4 
19:58:55.385 > [ESP32][LFSR] Keystream (first 16 bytes): 28CB9A8B1D8F8773471A0DF675942E74
19:58:55.393 > [ESP32][4D] LFSR keystream (first 32 bytes): 28CB9A8B1D8F8773471A0DF675942E74EEB045B39CE759936773BDE52AC6D8B4
19:58:55.401 > [ESP32][TINKERBELL] Input (first 16 bytes): 6099B7BD2DAFD423082820CF40B47D20 Nonce: 0x00000004 Buffer size: 32 bytes
19:58:55.412 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000004 Counter: 0 (must start at 0) Key[0..3]: A7149FF0
19:58:55.420 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): 651C09276359B1521F529952A8A8F9EC
19:58:55.429 > 4_After_Tinkerbell (32): 0585BE9A4EF66571177AB99DE81C84CC 10378E2F6749DD221E50D78A6A63338C 
19:58:55.437 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): 651C09276359B1521F529952A8A8F9EC
19:58:55.446 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): 651C09276359B1521F529952A8A8F9ECBBD798B1C999B1FC29236A6F40A5EB38
19:58:55.456 > 5_After_Transposition (32): 8E637ACCE88C1C229D17338A65490571 D72F9A67374E101EB95085F66A84DDBE 
19:58:55.465 > [ESP32][4B] recipeId=4 (CHAOS_ONLY) nonce=0x00000004
19:58:55.468 > [ESP32] === HMAC DEBUG INFO ===
19:58:55.470 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:58:55.479 > [ESP32] HMAC Input length: 45 bytes
19:58:55.482 > [ESP32] HMAC Input (first 32 bytes): 820217001700040804000000048E637ACCE88C1C229D17338A65490571D72F9A
19:58:55.492 > [ESP32] Nonce: 0x00000004
19:58:55.492 > [ESP32] Packet size before HMAC: 61
19:58:55.498 > [ESP32] Computed HMAC Tag: 7EC18C37E5F6C193D836B6E353A4272C
19:58:55.501 > [ESP32] === END HMAC DEBUG ===
19:58:55.505 > 6_Final_Packet (61): 820217001700040804000000048E637A CCE88C1C229D17338A65490571D72F9A ...
19:58:55.513 > [RETRY] Attempt 1/3 (nonce: 4)
19:58:55.515 > POST http://10.249.92.115:8081/health-data with pipeline data
19:58:55.521 > Sending pipeline data to server (605 bytes)
19:58:55.769 > [HTTP] Response code: 200
19:58:55.769 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:58:55.781 > [RETRY] Health data sent successfully!
19:58:55.785 > ✓ Health data #4 sent successfully
19:58:55.885 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":4,"serverTime":1770301735605,"type":"security_update"}
19:58:55.902 > [WebSocket] Processing message type: security_update
19:58:55.908 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
19:58:55.913 > [54.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.019 > [WebSocket] Received (632 bytes): {"currentRecipe":"CHAOS_ONLY","encData":"ENC_DATA:820217001700040804000000048E637ACCE88C1C229D17338A65490571D72F9A67374E101EB95085F66A84DDBE7EC18C37E5F6C193D836B6E353A4272C","pipeline":{"afterLFSR":"6099B7BD2DAFD423082820CF40B47D20ABE0169EAED06CDE3773BDE52AC6D8B4","afterSalt":"48522D36302053504F322D39352053544550532D3237354D50","afterTinkerbell":"0585BE9A4EF66571177AB99DE81C84CC10378E2F6749DD221E50D78A6A63338C","afterTransposition":"8E637ACCE88C1C229D17338A65490571D72F9A67374E101EB95085F66A84DDBE"},"plaintext":"HR-60 SPO2-95 STEPS-275","serverTime":1770301735605,"timestamp":54040,"type":"encryption_update","ztmEnabled":true}
19:58:56.074 > [WebSocket] Processing message type: encryption_update
19:58:56.080 > [54.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.181 > [WebSocket] Received (87 bytes): {"heartRate":60,"spo2":95,"steps":275,"time":1770301735605,"type":"health_data_update"}
19:58:56.190 > [WebSocket] Processing message type: health_data_update
19:58:56.195 > [54.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.304 > [WebSocket] Received (223 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.255,"encryptionTime":0.0,"finalPlaintext":"HR-60 SPO2-95 STEPS-275","handshakeSuccess":true,"totalTime":0.255},"type":"session_summary_update"}
19:58:56.326 > [WebSocket] Processing message type: session_summary_update
19:58:56.329 > [54.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.436 > [WebSocket] Received (657 bytes): {"decryptionTime":0.255,"encryptedPacket":"820217001700040804000000048E637ACCE88C1C229D17338A65490571D72F9A67374E101EB95085F66A84DDBE7EC18C37E5F6C193D836B6E353A4272C","finalPlaintext":"HR-60 SPO2-95 STEPS-275","healthData":{"heartRate":60,"spo2":95,"steps":275},"pipeline":{"afterDepad":"48522D36302053504F322D39352053544550532D32373500000000000000","afterLFSR":"48522D36302053504F322D39352053544550532D3237354D5000000000000000","afterTinkerbell":"6099B7BD2DAFD423082820CF40B47D20ABE0169EAED06CDE3773BDE52AC6D8B4","afterTransposition":"0585BE9A4EF66571177AB99DE81C84CC10378E2F6749DD221E50D78A6A63338C"},"serverTime":1770301735606,"type":"decryption_update"}
19:58:56.495 > [WebSocket] Processing message type: decryption_update
19:58:56.500 > [WebSocket] Server decryption completed
19:58:56.503 > [WebSocket] Health data - HR: 60, SPO2: 95, Steps: 275
19:58:56.507 > [55.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.610 > [WebSocket] Received (644 bytes): {"currentRecipe":"CHAOS_ONLY","deviceId":"f9641d44","healthSendCount":3,"pipeline":{"afterLFSR":"6099B7BD2DAFD423082820CF40B47D20ABE0169EAED06CDE3773BDE52AC6D8B4","afterSalt":"48522D36302053504F322D39352053544550532D3237354D50","afterTinkerbell":"0585BE9A4EF66571177AB99DE81C84CC10378E2F6749DD221E50D78A6A63338C","afterTransposition":"8E637ACCE88C1C229D17338A65490571D72F9A67374E101EB95085F66A84DDBE","finalPacket":"820217001700040804000000048E637ACCE88C1C229D17338A65490571D72F9A67374E101EB95085F66A84DDBE7EC18C37E5F6C193D836B6E353A4272C"},"plaintext":"HR-60 SPO2-95 STEPS-275","timestamp":54295,"type":"encryption_pipeline","ztmEnabled":true}
19:58:56.668 > [WebSocket] Processing message type: encryption_pipeline
19:58:56.674 > [55.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.772 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":3,"message":"Health data #4 sent successfully","state":7,"success":true,"timestamp":54300,"type":"health_data_sent"}
19:58:56.789 > [WebSocket] Processing message type: health_data_sent
19:58:56.792 > [55.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:56.897 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301735880,"threatLevel":0,"type":"heuristics_update"}
19:58:56.924 > [WebSocket] Processing message type: heuristics_update
19:58:56.931 > [55.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.040 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301736890,"threatLevel":0,"type":"heuristics_update"}
19:58:57.068 > [WebSocket] Processing message type: heuristics_update
19:58:57.074 > [55.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.182 > [55.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.283 > [55.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.383 > [55.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.485 > [56.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.586 > [56.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.687 > [56.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.788 > [56.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.889 > [56.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:57.991 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301737903,"threatLevel":0,"type":"heuristics_update"}
19:58:58.019 > [WebSocket] Processing message type: heuristics_update
19:58:58.024 > [56.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.133 > [56.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.234 > [56.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.335 > [56.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.436 > [57.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.538 > [57.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.639 > [57.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.739 > [57.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.840 > [57.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:58.942 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301738916,"threatLevel":0,"type":"heuristics_update"}
19:58:58.969 > [WebSocket] Processing message type: heuristics_update
19:58:58.975 > [57.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.085 > [57.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.185 > [57.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.286 > [57.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.387 > [57.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.488 > [58.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.589 > [58.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.690 > [58.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.791 > [58.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.892 > [58.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:58:59.993 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301739925,"threatLevel":0,"type":"heuristics_update"}
19:59:00.022 > [WebSocket] Processing message type: heuristics_update
19:59:00.028 > [58.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.136 > [58.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.237 > [58.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.337 > [58.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.439 > [59.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.540 > [59.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.641 > [59.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.742 > [59.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.843 > [59.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:00.947 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":7.5,"hmacFailures":0,"latencyMs":45.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301740933,"threatLevel":0,"type":"heuristics_update"}
19:59:00.991 > [WebSocket] Processing message type: heuristics_update
19:59:00.991 > [59.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.089 > [59.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.190 > [59.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.291 > [59.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.392 > [59.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.493 > [60.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.596 > [WebSocket] Received (339 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301741539,"simulated":true,"threatLevel":0,"type":"simulate_heuristics_response"}
19:59:01.626 > [WebSocket] Processing message type: simulate_heuristics_response
19:59:01.632 > [60.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.738 > [60.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.839 > [60.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:01.940 > [60.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.042 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":1,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301741939,"threatLevel":0,"type":"heuristics_update"}
19:59:02.070 > [WebSocket] Processing message type: heuristics_update
19:59:02.075 > [60.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.184 > [60.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.286 > [60.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.387 > [60.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.487 > [61.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.589 > [61.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.689 > [61.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.790 > [61.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.892 > [61.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:02.993 > [WebSocket] Received (250 bytes): {"payload":{"epoch":2,"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f","proposedAt":"2026-02-05T14:29:02Z","targetRecipe":"FULL_STACK"},"signature":"f532093a9c354f8b98ee404aaf7f263886e1480e57ad0ca8e9ebf0f6da5d22b9","type":"switch_propose"}
19:59:03.015 > [WebSocket] Processing message type: switch_propose
19:59:03.020 > [WS_RX] switch_propose (new format) proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f targetRecipe=FULL_STACK epoch=2
19:59:03.032 > [ZTM] Master key is zero - reloading from NVS
19:59:03.035 > [ZTM] Successfully reloaded master key from NVS
19:59:03.040 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:03.045 > [ZTM] HMAC verify: canonical={"epoch":2,"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f","proposedAt":"2026-02-05T14:29:02Z","targetRecipe":"FULL_STACK"}
19:59:03.060 > [ZTM] HMAC verify: computed=f532093a9c354f8b98ee404aaf7f263886e1480e57ad0ca8e9ebf0f6da5d22b9 expected=f532093a9c354f8b98ee404aaf7f263886e1480e57ad0ca8e9ebf0f6da5d22b9
19:59:03.073 > [EPOCH_UPDATE] Updating from 1 to 2 (from switch_propose)\n[ACK_SENT] proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f epoch=2 lastSeenNonce=0
19:59:03.087 > [ACK_SENT] payload={"deviceId":"f9641d44","epoch":2,"lastSeenNonce":0,"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f","ready":true} signature=1b4f671c864e3216ef14a7e05428576a55a4a0710a8c7aa9f3513e1824c661fd
19:59:03.107 > [PROPOSE_ACCEPT] proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f epoch=2 targetRecipe=FULL_STACK\n[61.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.223 > [WebSocket] Received (311 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":2,"lastCommitNonce":0,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301742949,"threatLevel":1,"type":"heuristics_update"}
19:59:03.250 > [WebSocket] Processing message type: heuristics_update
19:59:03.256 > [61.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.356 > [WebSocket] Received (247 bytes): {"payload":{"commitNonce":8589934593,"committedAt":"2026-02-05T14:29:03Z","epoch":2,"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f"},"signature":"45313009145c54721c6cb55aefbaf8572554b71042f37ca3401f8e1cfb40ad41","type":"switch_commit"}
19:59:03.378 > [WebSocket] Processing message type: switch_commit
19:59:03.383 > [WS_RX] switch_commit (new format) proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f commitNonce=8589934593
19:59:03.392 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:03.399 > [ZTM] HMAC verify: canonical={"commitNonce":8589934593,"committedAt":"2026-02-05T14:29:03Z","epoch":2,"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f"}
19:59:03.414 > [ZTM] HMAC verify: computed=45313009145c54721c6cb55aefbaf8572554b71042f37ca3401f8e1cfb40ad41 expected=45313009145c54721c6cb55aefbaf8572554b71042f37ca3401f8e1cfb40ad41
19:59:03.427 > [COMMIT_RECEIVED] proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f commitNonce=8589934593 epoch=2
19:59:03.436 > [62.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.543 > [WebSocket] Received (117 bytes): {"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f","serverTime":1770301743075,"type":"switch_ack_received"}
19:59:03.554 > [WebSocket] Processing message type: switch_ack_received
19:59:03.560 > [62.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.664 > [62.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.766 > [62.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.867 > [62.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:03.968 > [WebSocket] Received (250 bytes): {"payload":{"epoch":3,"proposalId":"d0fe6548-7293-4a2f-8ba2-000000f6fcbfcd8a041d","proposedAt":"2026-02-05T14:29:03Z","targetRecipe":"FULL_STACK"},"signature":"f3d81356119f961f6c094c62e854bfe5f0b9b9f2baa828cd59ecac5af9013dd8","type":"switch_propose"}
19:59:03.990 > [WebSocket] Processing message type: switch_propose
19:59:03.997 > [WS_RX] switch_propose (new format) proposalId=d0fe6548-7293-4a2f-8ba2-000000f6fcbfcd8a041d targetRecipe=FULL_STACK epoch=3
19:59:04.007 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:04.014 > [ZTM] HMAC verify: canonical={"epoch":3,"proposalId":"d0fe6548-7293-4a2f-8ba2-000000f6fcbfcd8a041d","proposedAt":"2026-02-05T14:29:03Z","targetRecipe":"FULL_STACK"}
19:59:04.027 > [ZTM] HMAC verify: computed=f3d81356119f961f6c094c62e854bfe5f0b9b9f2baa828cd59ecac5af9013dd8 expected=f3d81356119f961f6c094c62e854bfe5f0b9b9f2baa828cd59ecac5af9013dd8
19:59:04.041 > [EPOCH_UPDATE] Updating from 2 to 3 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:04.052 > [NACK_SENT] proposalId=d0fe6548-7293-4a2f-8ba2-000000f6fcbfcd8a041d reason=overlapping currentEpoch=3
19:59:04.061 > [62.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.163 > [WebSocket] Received (320 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":3,"lastCommitNonce":8589934593,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301743950,"threatLevel":1,"type":"heuristics_update"}
19:59:04.194 > [WebSocket] Processing message type: heuristics_update
19:59:04.197 > [62.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.306 > [WebSocket] Received (118 bytes): {"proposalId":"d0fe6548-7293-4a2f-8ba2-000000f6fcbfcd8a041d","serverTime":1770301744051,"type":"switch_nack_received"}
19:59:04.318 > [WebSocket] Processing message type: switch_nack_received
19:59:04.323 > [62.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.428 > [63.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.529 > [63.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.630 > [63.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.731 > [63.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.832 > [63.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:04.933 > [63.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.035 > [WebSocket] Received (250 bytes): {"payload":{"epoch":4,"proposalId":"fd5726c5-1528-4957-a625-000000bd3bedb8985828","proposedAt":"2026-02-05T14:29:04Z","targetRecipe":"FULL_STACK"},"signature":"88234c2984b82f3a1cb1a9f796fcca44f6ba0f09ab541d70a466136f38aec7ed","type":"switch_propose"}
19:59:05.056 > [WebSocket] Processing message type: switch_propose
19:59:05.062 > [WS_RX] switch_propose (new format) proposalId=fd5726c5-1528-4957-a625-000000bd3bedb8985828 targetRecipe=FULL_STACK epoch=4
19:59:05.074 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:05.079 > [ZTM] HMAC verify: canonical={"epoch":4,"proposalId":"fd5726c5-1528-4957-a625-000000bd3bedb8985828","proposedAt":"2026-02-05T14:29:04Z","targetRecipe":"FULL_STACK"}
19:59:05.093 > [ZTM] HMAC verify: computed=88234c2984b82f3a1cb1a9f796fcca44f6ba0f09ab541d70a466136f38aec7ed expected=88234c2984b82f3a1cb1a9f796fcca44f6ba0f09ab541d70a466136f38aec7ed
19:59:05.107 > [EPOCH_UPDATE] Updating from 3 to 4 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:05.118 > [NACK_SENT] proposalId=fd5726c5-1528-4957-a625-000000bd3bedb8985828 reason=overlapping currentEpoch=4
19:59:05.126 > [63.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.231 > [WebSocket] Received (320 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301744958,"threatLevel":1,"type":"heuristics_update"}
19:59:05.262 > [WebSocket] Processing message type: heuristics_update
19:59:05.265 > [63.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.375 > [WebSocket] Received (118 bytes): {"proposalId":"fd5726c5-1528-4957-a625-000000bd3bedb8985828","serverTime":1770301745116,"type":"switch_nack_received"}
19:59:05.386 > [WebSocket] Processing message type: switch_nack_received
19:59:05.392 > [63.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.497 > [64.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.596 > [64.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.698 > [64.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.799 > [64.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 4 | WS: CONNECTED
19:59:05.804 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:05.810 > [BOUNDARY_CHECK] SwitchState=3 PendingActive=1 CommitNonce=8589934593\n[BOUNDARY_CHECK] nextTxNonce=17179869185 commitNonce=8589934593 (epoch=4 packet=1)\n[SWITCH] commit boundary reached — applying recipe proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f
19:59:05.831 > [SWITCH] applyRecipe: FULL_STACK
19:59:05.838 > [ZTM] Settings saved successfully
19:59:05.840 > [SWITCH] Protocol complete — returning to NORMAL state. Applied recipe at nonce: 8589934593
19:59:05.852 > [DONE_SENT] proposalId=ff8e6f6f-6601-41fc-ae20-000000106858be63df2f commitNonce=8589934593 epoch=2
19:59:05.861 > [SWITCH_DONE] Recipe switch completed at nonce=8589934593
19:59:05.864 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
19:59:05.870 > Generated health data: HR-61 SPO2-95 STEPS-362
19:59:05.876 > [ESP32] ========================================
19:59:05.878 > [ESP32] ENCRYPTION PIPELINE START
19:59:05.881 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: FULL_STACK
19:59:05.887 > [ESP32] Active Algorithms for this packet:
19:59:05.889 > [ESP32]   + LFSR
19:59:05.891 > [ESP32]   + Tinkerbell
19:59:05.894 > [ESP32]   + Transposition
19:59:05.897 > [ESP32]   + ChaCha20
19:59:05.897 > [ESP32]   + Salsa20
19:59:05.900 > [ESP32] ========================================
19:59:05.903 > [ESP32] MsgKeys: lfsrSeed=0xACF768B2 tnk[0..3]=48369A6A trn[0..3]=6F2A3A6E
19:59:05.911 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3336324D50
19:59:05.917 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3336324D5000000000000000 
19:59:05.925 > [ESP32][LFSR] Initializing - Seed: 0xACF768B2 SeedBe: 0xB268F7AC ChaosKey[0..3]: 48369A6A InitialTap: 0x0029 State: 0xACF768B2
19:59:05.936 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:05.945 > 3_After_LFSR (32): FA3ADA9A4437A6AA42A0EDB64613370F C3309208AEBAA43F2A6606C61C9B69CD 
19:59:05.950 > [ESP32][LFSR] Keystream (first 16 bytes): B268F7AC7517F5FA0D92C08F7333645B
19:59:05.958 > [ESP32][4D] LFSR keystream (first 32 bytes): B268F7AC7517F5FA0D92C08F7333645B8660C1259D8C96727A6606C61C9B69CD
19:59:05.966 > [ESP32][TINKERBELL] Input (first 16 bytes): FA3ADA9A4437A6AA42A0EDB64613370F Nonce: 0x00000001 Buffer size: 32 bytes
19:59:05.978 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: 48369A6A
19:59:05.989 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): AB767EDB469DAE5C7A7082E7DEB179B2
19:59:05.994 > 4_After_Tinkerbell (32): 514CA44102AA08F638D06F5198A24EBD 2CB12F804B97FB4BD9FE7B3E50C1E991 
19:59:06.003 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): AB767EDB469DAE5C7A7082E7DEB179B2
19:59:06.011 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): AB767EDB469DAE5C7A7082E7DEB179B2EF81BD88E52D5F74F3987DF84C5A805C
19:59:06.023 > 5_After_Transposition (32): 0297FBE9412C51C16F4E4BA4984BD008 BD80AAFEF638517BB14C2F3E91D950A2 
19:59:06.030 > [ESP32][CHACHA20] Initializing - Nonce: 0x00000001
19:59:06.034 > [ESP32][CHACHA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:06.038 > [ESP32][CHACHA20] Full Nonce (12 bytes): 010000000000000000000000
19:59:06.045 > [ESP32][CHACHA20] Input (first 16 bytes): 0297FBE9412C51C16F4E4BA4984BD008
19:59:06.053 > 6_After_ChaCha20 (32): 7C10930FF55D0AF1E0956D960ACD31AB 06A096BD923F0E0644684759A7B68FC1 
19:59:06.058 > [ESP32][CHACHA20] Encryption complete - Output size: 32 bytes
19:59:06.064 > [ESP32][SALSA20] Initializing - Nonce: 0x00000001
19:59:06.070 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:06.075 > [ESP32][SALSA20] Full Nonce (8 bytes): 0100000000000000
19:59:06.078 > [ESP32][SALSA20] Input (first 16 bytes): 7C10930FF55D0AF1E0956D960ACD31AB
19:59:06.086 > 7_After_Salsa20 (32): CEA52C766A7E797773D9EF0176DED0AE 5238B6F2C365AFF10071A490D05A9117 
19:59:06.094 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:06.100 > [ESP32][4B] recipeId=1 (FULL_STACK) nonce=0x00000001
19:59:06.102 > [ESP32] === HMAC DEBUG INFO ===
19:59:06.106 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:06.116 > [ESP32] HMAC Input length: 45 bytes
19:59:06.117 > [ESP32] HMAC Input (first 32 bytes): 82021700170004080100000001CEA52C766A7E797773D9EF0176DED0AE5238B6
19:59:06.128 > [ESP32] Nonce: 0x00000001
19:59:06.128 > [ESP32] Packet size before HMAC: 61
19:59:06.132 > [ESP32] Computed HMAC Tag: 5BD1FCF38D0633525D11207DDF284E95
19:59:06.136 > [ESP32] === END HMAC DEBUG ===
19:59:06.139 > 6_Final_Packet (61): 82021700170004080100000001CEA52C 766A7E797773D9EF0176DED0AE5238B6 ...
19:59:06.147 > [RETRY] Attempt 1/3 (nonce: 1)
19:59:06.150 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:06.156 > Sending pipeline data to server (770 bytes)
19:59:06.298 > [HTTP] Response code: 200
19:59:06.298 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:59:06.315 > [RETRY] Health data sent successfully!
19:59:06.317 > ✓ Health data #5 sent successfully
19:59:06.417 > [WebSocket] Received (421 bytes): {"activatedAt":1770301731830,"active":true,"epoch":4,"heuristics":{"cpuUsage":20.0,"decryptFailures":0,"entropy":6.8,"hmacFailures":1,"latency":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"lastCommitNonce":8589934593,"lastSeenNonce":4,"lastSwitchReason":"Committed via switch_done","pendingProposals":0,"recipe":"FULL_STACK","serverTime":1770301745851,"threatLevel":1,"type":"active_recipe_updated"}
19:59:06.456 > [WebSocket] Processing message type: active_recipe_updated
19:59:06.461 > [65.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:06.560 > [WebSocket] Received (135 bytes): {"proposalId":"ff8e6f6f-6601-41fc-ae20-000000106858be63df2f","serverTime":1770301745851,"status":"committed","type":"switch_committed"}
19:59:06.574 > [WebSocket] Processing message type: switch_committed
19:59:06.579 > [65.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:06.682 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301745967,"threatLevel":1,"type":"heuristics_update"}
19:59:06.712 > [WebSocket] Processing message type: heuristics_update
19:59:06.716 > [65.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:06.825 > [WebSocket] Received (797 bytes): {"currentRecipe":"FULL_STACK","encData":"ENC_DATA:82021700170004080100000001CEA52C766A7E797773D9EF0176DED0AE5238B6F2C365AFF10071A490D05A91175BD1FCF38D0633525D11207DDF284E95","pipeline":{"afterChaCha20":"7C10930FF55D0AF1E0956D960ACD31AB06A096BD923F0E0644684759A7B68FC1","afterLFSR":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEBAA43F2A6606C61C9B69CD","afterSalsa20":"CEA52C766A7E797773D9EF0176DED0AE5238B6F2C365AFF10071A490D05A9117","afterSalt":"48522D36312053504F322D39352053544550532D3336324D50","afterTinkerbell":"514CA44102AA08F638D06F5198A24EBD2CB12F804B97FB4BD9FE7B3E50C1E991","afterTransposition":"0297FBE9412C51C16F4E4BA4984BD008BD80AAFEF638517BB14C2F3E91D950A2"},"plaintext":"HR-61 SPO2-95 STEPS-362","serverTime":1770301746238,"timestamp":64683,"type":"encryption_update","ztmEnabled":true}
19:59:06.898 > [WebSocket] Processing message type: encryption_update
19:59:06.901 > [65.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.009 > [WebSocket] Received (87 bytes): {"heartRate":61,"spo2":95,"steps":362,"time":1770301746238,"type":"health_data_update"}
19:59:07.017 > [WebSocket] Processing message type: health_data_update
19:59:07.023 > [65.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.131 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.3247,"encryptionTime":0.0,"finalPlaintext":"HR-61 SPO2-95 STEPS-362","handshakeSuccess":true,"totalTime":0.3247},"type":"session_summary_update"}
19:59:07.153 > [WebSocket] Processing message type: session_summary_update
19:59:07.159 > [65.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.262 > [WebSocket] Received (658 bytes): {"decryptionTime":0.3247,"encryptedPacket":"82021700170004080100000001CEA52C766A7E797773D9EF0176DED0AE5238B6F2C365AFF10071A490D05A91175BD1FCF38D0633525D11207DDF284E95","finalPlaintext":"HR-61 SPO2-95 STEPS-362","healthData":{"heartRate":61,"spo2":95,"steps":362},"pipeline":{"afterDepad":"48522D36312053504F322D39352053544550532D33363200000000000000","afterLFSR":"48522D36312053504F322D39352053544550532D3336324D5000000000000000","afterTinkerbell":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEBAA43F2A6606C61C9B69CD","afterTransposition":"514CA44102AA08F638D06F5198A24EBD2CB12F804B97FB4BD9FE7B3E50C1E991"},"serverTime":1770301746239,"type":"decryption_update"}
19:59:07.322 > [WebSocket] Processing message type: decryption_update
19:59:07.327 > [WebSocket] Server decryption completed
19:59:07.329 > [WebSocket] Health data - HR: 61, SPO2: 95, Steps: 362
19:59:07.335 > [65.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.438 > [WebSocket] Received (809 bytes): {"currentRecipe":"FULL_STACK","deviceId":"f9641d44","healthSendCount":4,"pipeline":{"afterChaCha20":"7C10930FF55D0AF1E0956D960ACD31AB06A096BD923F0E0644684759A7B68FC1","afterLFSR":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEBAA43F2A6606C61C9B69CD","afterSalsa20":"CEA52C766A7E797773D9EF0176DED0AE5238B6F2C365AFF10071A490D05A9117","afterSalt":"48522D36312053504F322D39352053544550532D3336324D50","afterTinkerbell":"514CA44102AA08F638D06F5198A24EBD2CB12F804B97FB4BD9FE7B3E50C1E991","afterTransposition":"0297FBE9412C51C16F4E4BA4984BD008BD80AAFEF638517BB14C2F3E91D950A2","finalPacket":"82021700170004080100000001CEA52C766A7E797773D9EF0176DED0AE5238B6F2C365AFF10071A490D05A91175BD1FCF38D0633525D11207DDF284E95"},"plaintext":"HR-61 SPO2-95 STEPS-362","timestamp":64826,"type":"encryption_pipeline","ztmEnabled":true}
19:59:07.510 > [WebSocket] Processing message type: encryption_pipeline
19:59:07.516 > [66.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.621 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":4,"message":"Health data #5 sent successfully","state":7,"success":true,"timestamp":64832,"type":"health_data_sent"}
19:59:07.638 > [WebSocket] Processing message type: health_data_sent
19:59:07.641 > [66.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.743 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301746973,"threatLevel":1,"type":"heuristics_update"}
19:59:07.774 > [WebSocket] Processing message type: heuristics_update
19:59:07.777 > [66.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.885 > [66.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:07.987 > [66.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.088 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301747986,"threatLevel":1,"type":"heuristics_update"}
19:59:08.119 > [WebSocket] Processing message type: heuristics_update
19:59:08.122 > [66.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.231 > [66.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.332 > [66.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.432 > [67.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.534 > [67.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.635 > [67.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.736 > [67.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.837 > [67.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:08.938 > [67.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.042 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":1,"latencyMs":52.0,"malformedPackets":2,"replayAttempts":0,"timingAnomalies":1},"serverTime":1770301748997,"threatLevel":2,"type":"heuristics_update"}
19:59:09.072 > [WebSocket] Processing message type: heuristics_update
19:59:09.075 > [67.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.184 > [67.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.285 > [67.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.386 > [67.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.486 > [68.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.588 > [68.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.689 > [68.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.790 > [68.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.891 > [68.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:09.992 > [68.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.094 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":4,"lastCommitNonce":8589934593,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301750008,"threatLevel":2,"type":"heuristics_update"}
19:59:10.125 > [WebSocket] Processing message type: heuristics_update
19:59:10.127 > [68.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.236 > [68.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.337 > [68.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.437 > [69.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.538 > [69.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.640 > [69.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.741 > [69.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.842 > [69.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:10.943 > [69.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.044 > [WebSocket] Received (251 bytes): {"payload":{"epoch":5,"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92","proposedAt":"2026-02-05T14:29:11Z","targetRecipe":"SALSA_LIGHT"},"signature":"6b4c40afe0fd3aa6bce7f933da134fc4310941668296c977c7edff85811587fa","type":"switch_propose"}
19:59:11.067 > [WebSocket] Processing message type: switch_propose
19:59:11.072 > [WS_RX] switch_propose (new format) proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 targetRecipe=SALSA_LIGHT epoch=5
19:59:11.083 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:11.089 > [ZTM] HMAC verify: canonical={"epoch":5,"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92","proposedAt":"2026-02-05T14:29:11Z","targetRecipe":"SALSA_LIGHT"}
19:59:11.103 > [ZTM] HMAC verify: computed=6b4c40afe0fd3aa6bce7f933da134fc4310941668296c977c7edff85811587fa expected=6b4c40afe0fd3aa6bce7f933da134fc4310941668296c977c7edff85811587fa
19:59:11.119 > [EPOCH_UPDATE] Updating from 2 to 5 (from switch_propose)\n[ACK_SENT] proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 epoch=5 lastSeenNonce=0
19:59:11.132 > [ACK_SENT] payload={"deviceId":"f9641d44","epoch":5,"lastSeenNonce":0,"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92","ready":true} signature=eeb27f31b9003d1dd6668eb34115c09b887af740eb7786493575e620d9983297
19:59:11.152 > [PROPOSE_ACCEPT] proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 epoch=5 targetRecipe=SALSA_LIGHT\n[69.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.271 > [WebSocket] Received (320 bytes): {"currentRecipe":"FULL_STACK","epoch":5,"lastCommitNonce":8589934593,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301751018,"threatLevel":2,"type":"heuristics_update"}
19:59:11.302 > [WebSocket] Processing message type: heuristics_update
19:59:11.305 > [69.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.415 > [WebSocket] Received (248 bytes): {"payload":{"commitNonce":21474836481,"committedAt":"2026-02-05T14:29:11Z","epoch":5,"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92"},"signature":"5dbbf948414b0dda6c1d89d9d5e22262ccb44c37c7c5f025098a20cd9a353e41","type":"switch_commit"}
19:59:11.436 > [WebSocket] Processing message type: switch_commit
19:59:11.442 > [WS_RX] switch_commit (new format) proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 commitNonce=21474836481
19:59:11.453 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:11.459 > [ZTM] HMAC verify: canonical={"commitNonce":21474836481,"committedAt":"2026-02-05T14:29:11Z","epoch":5,"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92"}
19:59:11.472 > [ZTM] HMAC verify: computed=5dbbf948414b0dda6c1d89d9d5e22262ccb44c37c7c5f025098a20cd9a353e41 expected=5dbbf948414b0dda6c1d89d9d5e22262ccb44c37c7c5f025098a20cd9a353e41
19:59:11.487 > [COMMIT_RECEIVED] proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 commitNonce=21474836481 epoch=5
19:59:11.495 > [70.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.602 > [WebSocket] Received (117 bytes): {"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92","serverTime":1770301751126,"type":"switch_ack_received"}
19:59:11.612 > [WebSocket] Processing message type: switch_ack_received
19:59:11.618 > [70.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.725 > [70.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.825 > [70.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:11.926 > [70.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.030 > [WebSocket] Received (251 bytes): {"payload":{"epoch":6,"proposalId":"ced1a833-69f4-43aa-96f5-0000002a238626b36544","proposedAt":"2026-02-05T14:29:12Z","targetRecipe":"SALSA_LIGHT"},"signature":"01a27980c3d1c9f61db035cf87ef3a41001f147ebe9ecf4b8fdb671e6dd6387e","type":"switch_propose"}
19:59:12.053 > [WebSocket] Processing message type: switch_propose
19:59:12.058 > [WS_RX] switch_propose (new format) proposalId=ced1a833-69f4-43aa-96f5-0000002a238626b36544 targetRecipe=SALSA_LIGHT epoch=6
19:59:12.069 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:12.074 > [ZTM] HMAC verify: canonical={"epoch":6,"proposalId":"ced1a833-69f4-43aa-96f5-0000002a238626b36544","proposedAt":"2026-02-05T14:29:12Z","targetRecipe":"SALSA_LIGHT"}
19:59:12.088 > [ZTM] HMAC verify: computed=01a27980c3d1c9f61db035cf87ef3a41001f147ebe9ecf4b8fdb671e6dd6387e expected=01a27980c3d1c9f61db035cf87ef3a41001f147ebe9ecf4b8fdb671e6dd6387e
19:59:12.105 > [EPOCH_UPDATE] Updating from 5 to 6 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:12.114 > [NACK_SENT] proposalId=ced1a833-69f4-43aa-96f5-0000002a238626b36544 reason=overlapping currentEpoch=6
19:59:12.121 > [70.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.224 > [WebSocket] Received (321 bytes): {"currentRecipe":"FULL_STACK","epoch":6,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301752019,"threatLevel":2,"type":"heuristics_update"}
19:59:12.254 > [WebSocket] Processing message type: heuristics_update
19:59:12.257 > [70.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.368 > [WebSocket] Received (118 bytes): {"proposalId":"ced1a833-69f4-43aa-96f5-0000002a238626b36544","serverTime":1770301752110,"type":"switch_nack_received"}
19:59:12.378 > [WebSocket] Processing message type: switch_nack_received
19:59:12.384 > [70.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.489 > [71.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.590 > [71.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.690 > [71.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.792 > [71.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.893 > [71.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:12.994 > [71.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.096 > [WebSocket] Received (251 bytes): {"payload":{"epoch":7,"proposalId":"025317b6-1c77-45f5-b363-0000003bc9bba4cf6e77","proposedAt":"2026-02-05T14:29:13Z","targetRecipe":"SALSA_LIGHT"},"signature":"fd37e10890752dc530eb0a9e0967a6ff9c67e9064aa314bf7214fd396515c433","type":"switch_propose"}
19:59:13.117 > [WebSocket] Processing message type: switch_propose
19:59:13.124 > [WS_RX] switch_propose (new format) proposalId=025317b6-1c77-45f5-b363-0000003bc9bba4cf6e77 targetRecipe=SALSA_LIGHT epoch=7
19:59:13.135 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:13.140 > [ZTM] HMAC verify: canonical={"epoch":7,"proposalId":"025317b6-1c77-45f5-b363-0000003bc9bba4cf6e77","proposedAt":"2026-02-05T14:29:13Z","targetRecipe":"SALSA_LIGHT"}
19:59:13.154 > [ZTM] HMAC verify: computed=fd37e10890752dc530eb0a9e0967a6ff9c67e9064aa314bf7214fd396515c433 expected=fd37e10890752dc530eb0a9e0967a6ff9c67e9064aa314bf7214fd396515c433
19:59:13.171 > [EPOCH_UPDATE] Updating from 6 to 7 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:13.179 > [NACK_SENT] proposalId=025317b6-1c77-45f5-b363-0000003bc9bba4cf6e77 reason=overlapping currentEpoch=7
19:59:13.188 > [71.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.290 > [WebSocket] Received (321 bytes): {"currentRecipe":"FULL_STACK","epoch":7,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301753033,"threatLevel":2,"type":"heuristics_update"}
19:59:13.321 > [WebSocket] Processing message type: heuristics_update
19:59:13.324 > [71.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.433 > [WebSocket] Received (118 bytes): {"proposalId":"025317b6-1c77-45f5-b363-0000003bc9bba4cf6e77","serverTime":1770301753200,"type":"switch_nack_received"}
19:59:13.445 > [WebSocket] Processing message type: switch_nack_received
19:59:13.450 > [72.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.556 > [72.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.656 > [72.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.758 > [72.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.859 > [72.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:13.960 > [72.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.061 > [WebSocket] Received (251 bytes): {"payload":{"epoch":8,"proposalId":"5955b89e-b226-4122-900d-000000d2fe431e2e0592","proposedAt":"2026-02-05T14:29:14Z","targetRecipe":"SALSA_LIGHT"},"signature":"dcfab8a0fe693fb58cd7095a33d45fe1e0550355780a0177f7b2bbbd9e9323b5","type":"switch_propose"}
19:59:14.084 > [WebSocket] Processing message type: switch_propose
19:59:14.089 > [WS_RX] switch_propose (new format) proposalId=5955b89e-b226-4122-900d-000000d2fe431e2e0592 targetRecipe=SALSA_LIGHT epoch=8
19:59:14.100 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:14.106 > [ZTM] HMAC verify: canonical={"epoch":8,"proposalId":"5955b89e-b226-4122-900d-000000d2fe431e2e0592","proposedAt":"2026-02-05T14:29:14Z","targetRecipe":"SALSA_LIGHT"}
19:59:14.120 > [ZTM] HMAC verify: computed=dcfab8a0fe693fb58cd7095a33d45fe1e0550355780a0177f7b2bbbd9e9323b5 expected=dcfab8a0fe693fb58cd7095a33d45fe1e0550355780a0177f7b2bbbd9e9323b5
19:59:14.137 > [EPOCH_UPDATE] Updating from 7 to 8 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:14.145 > [NACK_SENT] proposalId=5955b89e-b226-4122-900d-000000d2fe431e2e0592 reason=overlapping currentEpoch=8
19:59:14.153 > [72.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.258 > [WebSocket] Received (321 bytes): {"currentRecipe":"FULL_STACK","epoch":8,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301754045,"threatLevel":2,"type":"heuristics_update"}
19:59:14.289 > [WebSocket] Processing message type: heuristics_update
19:59:14.291 > [72.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.402 > [WebSocket] Received (118 bytes): {"proposalId":"5955b89e-b226-4122-900d-000000d2fe431e2e0592","serverTime":1770301754146,"type":"switch_nack_received"}
19:59:14.412 > [WebSocket] Processing message type: switch_nack_received
19:59:14.418 > [72.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.523 > [73.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.625 > [73.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.725 > [73.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.826 > [73.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:14.927 > [73.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.028 > [73.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.130 > [WebSocket] Received (251 bytes): {"payload":{"epoch":9,"proposalId":"b90fa07f-add3-4887-82ab-000000c7ff25817295d5","proposedAt":"2026-02-05T14:29:15Z","targetRecipe":"SALSA_LIGHT"},"signature":"5fb5eb05c8d96664e44d05c96f48f70ce92b579efac6375d92e45a180787a104","type":"switch_propose"}
19:59:15.152 > [WebSocket] Processing message type: switch_propose
19:59:15.157 > [WS_RX] switch_propose (new format) proposalId=b90fa07f-add3-4887-82ab-000000c7ff25817295d5 targetRecipe=SALSA_LIGHT epoch=9
19:59:15.168 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:15.173 > [ZTM] HMAC verify: canonical={"epoch":9,"proposalId":"b90fa07f-add3-4887-82ab-000000c7ff25817295d5","proposedAt":"2026-02-05T14:29:15Z","targetRecipe":"SALSA_LIGHT"}
19:59:15.187 > [ZTM] HMAC verify: computed=5fb5eb05c8d96664e44d05c96f48f70ce92b579efac6375d92e45a180787a104 expected=5fb5eb05c8d96664e44d05c96f48f70ce92b579efac6375d92e45a180787a104
19:59:15.205 > [EPOCH_UPDATE] Updating from 8 to 9 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:15.212 > [NACK_SENT] proposalId=b90fa07f-add3-4887-82ab-000000c7ff25817295d5 reason=overlapping currentEpoch=9
19:59:15.221 > [73.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.323 > [WebSocket] Received (321 bytes): {"currentRecipe":"FULL_STACK","epoch":9,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301755054,"threatLevel":2,"type":"heuristics_update"}
19:59:15.354 > [WebSocket] Processing message type: heuristics_update
19:59:15.356 > [73.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.466 > [WebSocket] Received (118 bytes): {"proposalId":"b90fa07f-add3-4887-82ab-000000c7ff25817295d5","serverTime":1770301755215,"type":"switch_nack_received"}
19:59:15.477 > [WebSocket] Processing message type: switch_nack_received
19:59:15.483 > [74.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.589 > [74.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.690 > [74.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.790 > [74.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.892 > [74.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:15.993 > [74.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:16.095 > [WebSocket] Received (252 bytes): {"payload":{"epoch":10,"proposalId":"6f1aa676-ce2b-4005-b015-000000ec211f5f6c8df2","proposedAt":"2026-02-05T14:29:16Z","targetRecipe":"SALSA_LIGHT"},"signature":"9dedd793e17bc5fa5b7d2ae31f860a20e42ffaff86346781771129dea77eb674","type":"switch_propose"}
19:59:16.117 > [WebSocket] Processing message type: switch_propose
19:59:16.122 > [WS_RX] switch_propose (new format) proposalId=6f1aa676-ce2b-4005-b015-000000ec211f5f6c8df2 targetRecipe=SALSA_LIGHT epoch=10
19:59:16.133 > [ZTM] Master key (first 16 bytes): 0D5C59F6BA86F150472332EFA848E7ED
19:59:16.139 > [ZTM] HMAC verify: canonical={"epoch":10,"proposalId":"6f1aa676-ce2b-4005-b015-000000ec211f5f6c8df2","proposedAt":"2026-02-05T14:29:16Z","targetRecipe":"SALSA_LIGHT"}
19:59:16.152 > [ZTM] HMAC verify: computed=9dedd793e17bc5fa5b7d2ae31f860a20e42ffaff86346781771129dea77eb674 expected=9dedd793e17bc5fa5b7d2ae31f860a20e42ffaff86346781771129dea77eb674
19:59:16.170 > [EPOCH_UPDATE] Updating from 9 to 10 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
19:59:16.178 > [NACK_SENT] proposalId=6f1aa676-ce2b-4005-b015-000000ec211f5f6c8df2 reason=overlapping currentEpoch=10
19:59:16.186 > [74.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:16.288 > [WebSocket] Received (322 bytes): {"currentRecipe":"FULL_STACK","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301756065,"threatLevel":2,"type":"heuristics_update"}
19:59:16.319 > [WebSocket] Processing message type: heuristics_update
19:59:16.322 > [74.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 5 | WS: CONNECTED
19:59:16.330 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:16.336 > [BOUNDARY_CHECK] SwitchState=3 PendingActive=1 CommitNonce=21474836481\n[BOUNDARY_CHECK] nextTxNonce=42949672961 commitNonce=21474836481 (epoch=10 packet=1)\n[SWITCH] commit boundary reached — applying recipe proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92
19:59:16.358 > [SWITCH] applyRecipe: SALSA_LIGHT
19:59:16.367 > [ZTM] Settings saved successfully
19:59:16.369 > [SWITCH] Protocol complete — returning to NORMAL state. Applied recipe at nonce: 21474836481
19:59:16.378 > [DONE_SENT] proposalId=e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92 commitNonce=21474836481 epoch=5
19:59:16.386 > [SWITCH_DONE] Recipe switch completed at nonce=21474836481
19:59:16.392 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
19:59:16.394 > Generated health data: HR-61 SPO2-95 STEPS-384
19:59:16.400 > [ESP32] ========================================
19:59:16.403 > [ESP32] ENCRYPTION PIPELINE START
19:59:16.406 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:16.411 > [ESP32] Active Algorithms for this packet:
19:59:16.417 > [ESP32]   + LFSR
19:59:16.417 > [ESP32]   - Tinkerbell
19:59:16.419 > [ESP32]   - Transposition
19:59:16.422 > [ESP32]   - ChaCha20
19:59:16.422 > [ESP32]   + Salsa20
19:59:16.425 > [ESP32] ========================================
19:59:16.430 > [ESP32] MsgKeys: lfsrSeed=0xACF768B2 tnk[0..3]=48369A6A trn[0..3]=6F2A3A6E
19:59:16.436 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3338344D50
19:59:16.442 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3338344D5000000000000000 
19:59:16.449 > [ESP32][LFSR] Initializing - Seed: 0xACF768B2 SeedBe: 0xB268F7AC ChaosKey[0..3]: 48369A6A InitialTap: 0x0029 State: 0xACF768B2
19:59:16.461 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:16.470 > 3_After_LFSR (32): FA3ADA9A4437A6AA42A0EDB64613370F C3309208AEB4A23F2A6606C61C9B69CD 
19:59:16.478 > [ESP32][LFSR] Keystream (first 16 bytes): B268F7AC7517F5FA0D92C08F7333645B
19:59:16.483 > [ESP32][4D] LFSR keystream (first 32 bytes): B268F7AC7517F5FA0D92C08F7333645B8660C1259D8C96727A6606C61C9B69CD
19:59:16.492 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:16.498 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:16.503 > [ESP32][SALSA20] Initializing - Nonce: 0x00000001
19:59:16.506 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:16.511 > [ESP32][SALSA20] Full Nonce (8 bytes): 0100000000000000
19:59:16.517 > [ESP32][SALSA20] Input (first 16 bytes): FA3ADA9A4437A6AA42A0EDB64613370F
19:59:16.522 > 7_After_Salsa20 (32): 488F65E3DB14D52CD1EC6F213A00D60A 97A8B247FFEE03C86E7FE50F6B77771B 
19:59:16.530 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:16.536 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000001
19:59:16.541 > [ESP32] === HMAC DEBUG INFO ===
19:59:16.544 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:16.550 > [ESP32] HMAC Input length: 45 bytes
19:59:16.555 > [ESP32] HMAC Input (first 32 bytes): 82021700170004080300000001488F65E3DB14D52CD1EC6F213A00D60A97A8B2
19:59:16.564 > [ESP32] Nonce: 0x00000001
19:59:16.567 > [ESP32] Packet size before HMAC: 61
19:59:16.569 > [ESP32] Computed HMAC Tag: 1D99CC6E9A32855E8CAA93BFF04B3AB0
19:59:16.575 > [ESP32] === END HMAC DEBUG ===
19:59:16.578 > 6_Final_Packet (61): 82021700170004080300000001488F65 E3DB14D52CD1EC6F213A00D60A97A8B2 ...
19:59:16.586 > [RETRY] Attempt 1/3 (nonce: 1)
19:59:16.587 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:16.591 > Sending pipeline data to server (515 bytes)
19:59:16.844 > [HTTP] Response code: 200
19:59:16.844 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:59:16.858 > [RETRY] Health data sent successfully!
19:59:16.861 > ✓ Health data #6 sent successfully
19:59:16.963 > [WebSocket] Received (118 bytes): {"proposalId":"6f1aa676-ce2b-4005-b015-000000ec211f5f6c8df2","serverTime":1770301756177,"type":"switch_nack_received"}
19:59:16.974 > [WebSocket] Processing message type: switch_nack_received
19:59:16.979 > [75.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.086 > [WebSocket] Received (424 bytes): {"activatedAt":1770301731830,"active":true,"epoch":10,"heuristics":{"cpuUsage":20.0,"decryptFailures":0,"entropy":6.8,"hmacFailures":0,"latency":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"lastCommitNonce":21474836481,"lastSeenNonce":1,"lastSwitchReason":"Committed via switch_done","pendingProposals":0,"recipe":"SALSA_LIGHT","serverTime":1770301756389,"threatLevel":2,"type":"active_recipe_updated"}
19:59:17.125 > [WebSocket] Processing message type: active_recipe_updated
19:59:17.130 > [75.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.229 > [WebSocket] Received (135 bytes): {"proposalId":"e4492f04-4279-4e98-a11f-0000003d41d5e5b57f92","serverTime":1770301756389,"status":"committed","type":"switch_committed"}
19:59:17.243 > [WebSocket] Processing message type: switch_committed
19:59:17.248 > [75.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.351 > [WebSocket] Received (542 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021700170004080300000001488F65E3DB14D52CD1EC6F213A00D60A97A8B247FFEE03C86E7FE50F6B77771B1D99CC6E9A32855E8CAA93BFF04B3AB0","pipeline":{"afterLFSR":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEB4A23F2A6606C61C9B69CD","afterSalsa20":"488F65E3DB14D52CD1EC6F213A00D60A97A8B247FFEE03C86E7FE50F6B77771B","afterSalt":"48522D36312053504F322D39352053544550532D3338344D50"},"plaintext":"HR-61 SPO2-95 STEPS-384","serverTime":1770301756692,"timestamp":75115,"type":"encryption_update","ztmEnabled":true}
19:59:17.401 > [WebSocket] Processing message type: encryption_update
19:59:17.403 > [75.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.503 > [WebSocket] Received (87 bytes): {"heartRate":61,"spo2":95,"steps":384,"time":1770301756692,"type":"health_data_update"}
19:59:17.512 > [WebSocket] Processing message type: health_data_update
19:59:17.517 > [76.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.627 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2814,"encryptionTime":0.0,"finalPlaintext":"HR-61 SPO2-95 STEPS-384","handshakeSuccess":true,"totalTime":0.2814},"type":"session_summary_update"}
19:59:17.648 > [WebSocket] Processing message type: session_summary_update
19:59:17.654 > [76.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.759 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2814,"encryptedPacket":"82021700170004080300000001488F65E3DB14D52CD1EC6F213A00D60A97A8B247FFEE03C86E7FE50F6B77771B1D99CC6E9A32855E8CAA93BFF04B3AB0","finalPlaintext":"HR-61 SPO2-95 STEPS-384","healthData":{"heartRate":61,"spo2":95,"steps":384},"pipeline":{"afterDepad":"48522D36312053504F322D39352053544550532D33383400000000000000","afterLFSR":"48522D36312053504F322D39352053544550532D3338344D5000000000000000","afterTinkerbell":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEB4A23F2A6606C61C9B69CD","afterTransposition":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEB4A23F2A6606C61C9B69CD"},"serverTime":1770301756693,"type":"decryption_update"}
19:59:17.817 > [WebSocket] Processing message type: decryption_update
19:59:17.823 > [WebSocket] Server decryption completed
19:59:17.826 > [WebSocket] Health data - HR: 61, SPO2: 95, Steps: 384
19:59:17.832 > [76.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:17.933 > [WebSocket] Received (554 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":5,"pipeline":{"afterLFSR":"FA3ADA9A4437A6AA42A0EDB64613370FC3309208AEB4A23F2A6606C61C9B69CD","afterSalsa20":"488F65E3DB14D52CD1EC6F213A00D60A97A8B247FFEE03C86E7FE50F6B77771B","afterSalt":"48522D36312053504F322D39352053544550532D3338344D50","finalPacket":"82021700170004080300000001488F65E3DB14D52CD1EC6F213A00D60A97A8B247FFEE03C86E7FE50F6B77771B1D99CC6E9A32855E8CAA93BFF04B3AB0"},"plaintext":"HR-61 SPO2-95 STEPS-384","timestamp":75372,"type":"encryption_pipeline","ztmEnabled":true}
19:59:17.983 > [WebSocket] Processing message type: encryption_pipeline
19:59:17.989 > [76.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.096 > [WebSocket] Received (157 bytes): {"deviceId":"f9641d44","healthSendCount":5,"message":"Health data #6 sent successfully","state":7,"success":true,"timestamp":75377,"type":"health_data_sent"}
19:59:18.113 > [WebSocket] Processing message type: health_data_sent
19:59:18.116 > [76.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.220 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301757072,"threatLevel":2,"type":"heuristics_update"}
19:59:18.250 > [WebSocket] Processing message type: heuristics_update
19:59:18.252 > [76.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.362 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301758083,"threatLevel":2,"type":"heuristics_update"}
19:59:18.392 > [WebSocket] Processing message type: heuristics_update
19:59:18.395 > [76.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.505 > [77.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.606 > [77.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.707 > [77.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.807 > [77.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:18.908 > [77.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.010 > [77.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.111 > [77.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.213 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301759093,"threatLevel":2,"type":"heuristics_update"}
19:59:19.243 > [WebSocket] Processing message type: heuristics_update
19:59:19.245 > [77.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.355 > [77.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.456 > [78.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.556 > [78.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.658 > [78.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.758 > [78.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.860 > [78.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:19.960 > [78.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.062 > [78.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.163 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301760108,"threatLevel":2,"type":"heuristics_update"}
19:59:20.193 > [WebSocket] Processing message type: heuristics_update
19:59:20.197 > [78.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.306 > [78.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.406 > [78.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.508 > [79.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.609 > [79.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.710 > [79.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.811 > [79.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:20.912 > [79.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.013 > [79.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.113 > [79.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.217 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301761118,"threatLevel":2,"type":"heuristics_update"}
19:59:21.248 > [WebSocket] Processing message type: heuristics_update
19:59:21.251 > [79.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.360 > [79.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.461 > [80.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.562 > [80.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.663 > [80.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.763 > [80.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.864 > [80.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:21.966 > [80.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.067 > [80.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.169 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301762132,"threatLevel":2,"type":"heuristics_update"}
19:59:22.198 > [WebSocket] Processing message type: heuristics_update
19:59:22.202 > [80.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.310 > [80.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.412 > [80.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.513 > [81.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.613 > [81.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.714 > [81.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.815 > [81.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:22.916 > [81.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.017 > [81.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.119 > [81.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.220 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301763141,"threatLevel":2,"type":"heuristics_update"}
19:59:23.251 > [WebSocket] Processing message type: heuristics_update
19:59:23.254 > [81.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.363 > [81.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.463 > [82.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.564 > [82.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.665 > [82.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.766 > [82.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.868 > [82.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:23.969 > [82.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.069 > [82.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.172 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301764153,"threatLevel":2,"type":"heuristics_update"}
19:59:24.202 > [WebSocket] Processing message type: heuristics_update
19:59:24.205 > [82.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.313 > [82.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.414 > [82.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.516 > [83.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.616 > [83.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.717 > [83.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.818 > [83.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:24.920 > [83.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.020 > [83.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.121 > [83.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.223 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301765160,"threatLevel":2,"type":"heuristics_update"}
19:59:25.253 > [WebSocket] Processing message type: heuristics_update
19:59:25.257 > [83.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.366 > [83.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.466 > [84.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.568 > [84.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.668 > [84.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.769 > [84.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.870 > [84.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:25.972 > [84.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.072 > [84.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.173 > [84.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.277 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301766166,"threatLevel":2,"type":"heuristics_update"}
19:59:26.308 > [WebSocket] Processing message type: heuristics_update
19:59:26.311 > [84.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.421 > [84.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.522 > [85.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.622 > [85.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.724 > [85.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.825 > [85.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.925 > [85.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:26.931 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:26.937 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:59:26.953 > Generated health data: HR-61 SPO2-95 STEPS-443
19:59:26.959 > [ESP32] ========================================
19:59:26.962 > [ESP32] ENCRYPTION PIPELINE START
19:59:26.964 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:26.970 > [ESP32] Active Algorithms for this packet:
19:59:26.975 > [ESP32]   + LFSR
19:59:26.975 > [ESP32]   - Tinkerbell
19:59:26.978 > [ESP32]   - Transposition
19:59:26.980 > [ESP32]   - ChaCha20
19:59:26.980 > [ESP32]   + Salsa20
19:59:26.984 > [ESP32] ========================================
19:59:26.989 > [ESP32] MsgKeys: lfsrSeed=0xA9209F8C tnk[0..3]=33C7F1ED trn[0..3]=9202498B
19:59:26.995 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3434334D50
19:59:27.000 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3434334D5000000000000000 
19:59:27.009 > [ESP32][LFSR] Initializing - Seed: 0xA9209F8C SeedBe: 0x8C9F20A9 ChaosKey[0..3]: 33C7F1ED InitialTap: 0x0029 State: 0xA9209F8C
19:59:27.019 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:27.028 > 3_After_LFSR (32): C4CD0D9F7F6DCAB6325ECA0B75192B9B 957DC3722C73C0302384A424A0711064 
19:59:27.037 > [ESP32][LFSR] Keystream (first 16 bytes): 8C9F20A94E4D99E67D6CE732403978CF
19:59:27.042 > [ESP32][4D] LFSR keystream (first 32 bytes): 8C9F20A94E4D99E67D6CE732403978CFD02D905F1847F37D7384A424A0711064
19:59:27.050 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:27.056 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:27.062 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
19:59:27.064 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:27.070 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
19:59:27.075 > [ESP32][SALSA20] Input (first 16 bytes): C4CD0D9F7F6DCAB6325ECA0B75192B9B
19:59:27.080 > 7_After_Salsa20 (32): 7678B2E6E04EB9305BBE8CF1090ACA9E C1E5E33D7D2961C704CBFC4ED79D0EB2 
19:59:27.089 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:27.095 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
19:59:27.101 > [ESP32] === HMAC DEBUG INFO ===
19:59:27.102 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:27.111 > [ESP32] HMAC Input length: 45 bytes
19:59:27.114 > [ESP32] HMAC Input (first 32 bytes): 820217001700040803000000027678B2E6E04EB9305BBE8CF1090ACA9EC1E5E3
19:59:27.123 > [ESP32] Nonce: 0x00000002
19:59:27.125 > [ESP32] Packet size before HMAC: 61
19:59:27.128 > [ESP32] Computed HMAC Tag: 328C87021F0E5B7B724614B580A70047
19:59:27.133 > [ESP32] === END HMAC DEBUG ===
19:59:27.137 > 6_Final_Packet (61): 820217001700040803000000027678B2 E6E04EB9305BBE8CF1090ACA9EC1E5E3 ...
19:59:27.144 > [RETRY] Attempt 1/3 (nonce: 2)
19:59:27.147 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:27.150 > Sending pipeline data to server (515 bytes)
19:59:27.383 > [HTTP] Response code: 400
19:59:27.384 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:27.389 > [HTTP] Request failed with code: 400
19:59:27.391 > [RETRY] Send failed, waiting 100 ms before retry
19:59:27.492 > [RETRY] Attempt 2/3 (nonce: 2)
19:59:27.493 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:27.498 > Sending pipeline data to server (515 bytes)
19:59:27.625 > [HTTP] Response code: 400
19:59:27.625 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:27.630 > [HTTP] Request failed with code: 400
19:59:27.632 > [RETRY] Send failed, waiting 200 ms before retry
19:59:27.832 > [RETRY] Attempt 3/3 (nonce: 2)
19:59:27.832 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:27.838 > Sending pipeline data to server (515 bytes)
19:59:28.129 > [HTTP] Response code: 400
19:59:28.130 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:28.135 > [HTTP] Request failed with code: 400
19:59:28.138 > [RETRY] All retry attempts failed - rolled back nonce to 1
19:59:28.143 > [RETRY] Consecutive failures: 1
19:59:28.146 > Health data send failed (retry count: 1/3)
19:59:28.250 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301767175,"threatLevel":2,"type":"heuristics_update"}
19:59:28.280 > [WebSocket] Processing message type: heuristics_update
19:59:28.282 > [86.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:28.291 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:28.296 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:59:28.313 > Generated health data: HR-61 SPO2-95 STEPS-438
19:59:28.319 > [ESP32] ========================================
19:59:28.322 > [ESP32] ENCRYPTION PIPELINE START
19:59:28.324 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:28.330 > [ESP32] Active Algorithms for this packet:
19:59:28.336 > [ESP32]   + LFSR
19:59:28.336 > [ESP32]   - Tinkerbell
19:59:28.338 > [ESP32]   - Transposition
19:59:28.342 > [ESP32]   - ChaCha20
19:59:28.342 > [ESP32]   + Salsa20
19:59:28.344 > [ESP32] ========================================
19:59:28.346 > [ESP32] MsgKeys: lfsrSeed=0xA9209F8C tnk[0..3]=33C7F1ED trn[0..3]=9202498B
19:59:28.355 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3433384D50
19:59:28.360 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3433384D5000000000000000 
19:59:28.369 > [ESP32][LFSR] Initializing - Seed: 0xA9209F8C SeedBe: 0x8C9F20A9 ChaosKey[0..3]: 33C7F1ED InitialTap: 0x0029 State: 0xA9209F8C
19:59:28.379 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:28.389 > 3_After_LFSR (32): C4CD0D9F7F6DCAB6325ECA0B75192B9B 957DC3722C74CB302384A424A0711064 
19:59:28.394 > [ESP32][LFSR] Keystream (first 16 bytes): 8C9F20A94E4D99E67D6CE732403978CF
19:59:28.401 > [ESP32][4D] LFSR keystream (first 32 bytes): 8C9F20A94E4D99E67D6CE732403978CFD02D905F1847F37D7384A424A0711064
19:59:28.411 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:28.416 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:28.421 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
19:59:28.424 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:28.429 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
19:59:28.435 > [ESP32][SALSA20] Input (first 16 bytes): C4CD0D9F7F6DCAB6325ECA0B75192B9B
19:59:28.441 > 7_After_Salsa20 (32): 7678B2E6E04EB9305BBE8CF1090ACA9E C1E5E33D7D2E6AC704CBFC4ED79D0EB2 
19:59:28.449 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:28.454 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
19:59:28.458 > [ESP32] === HMAC DEBUG INFO ===
19:59:28.461 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:28.469 > [ESP32] HMAC Input length: 45 bytes
19:59:28.474 > [ESP32] HMAC Input (first 32 bytes): 820217001700040803000000027678B2E6E04EB9305BBE8CF1090ACA9EC1E5E3
19:59:28.483 > [ESP32] Nonce: 0x00000002
19:59:28.486 > [ESP32] Packet size before HMAC: 61
19:59:28.489 > [ESP32] Computed HMAC Tag: D0570630A58F530DA758E93CDC007F06
19:59:28.494 > [ESP32] === END HMAC DEBUG ===
19:59:28.496 > 6_Final_Packet (61): 820217001700040803000000027678B2 E6E04EB9305BBE8CF1090ACA9EC1E5E3 ...
19:59:28.502 > [RETRY] Attempt 1/3 (nonce: 2)
19:59:28.504 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:28.511 > Sending pipeline data to server (515 bytes)
19:59:28.635 > [HTTP] Response code: 400
19:59:28.635 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:28.640 > [HTTP] Request failed with code: 400
19:59:28.643 > [RETRY] Send failed, waiting 100 ms before retry
19:59:28.743 > [RETRY] Attempt 2/3 (nonce: 2)
19:59:28.754 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:28.754 > Sending pipeline data to server (515 bytes)
19:59:28.886 > [HTTP] Response code: 400
19:59:28.886 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:28.891 > [HTTP] Request failed with code: 400
19:59:28.894 > [RETRY] Send failed, waiting 200 ms before retry
19:59:29.094 > [RETRY] Attempt 3/3 (nonce: 2)
19:59:29.094 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:29.100 > Sending pipeline data to server (515 bytes)
19:59:29.395 > [HTTP] Response code: 400
19:59:29.395 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:29.400 > [HTTP] Request failed with code: 400
19:59:29.403 > [RETRY] All retry attempts failed - rolled back nonce to 1
19:59:29.408 > [RETRY] Consecutive failures: 2
19:59:29.410 > Health data send failed (retry count: 2/3)
19:59:29.512 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":85912,"type":"health_data_error"}
19:59:29.526 > [WebSocket] Processing message type: health_data_error
19:59:29.532 > [88.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:29.539 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:29.545 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:59:29.562 > Generated health data: HR-61 SPO2-95 STEPS-463
19:59:29.565 > [ESP32] ========================================
19:59:29.570 > [ESP32] ENCRYPTION PIPELINE START
19:59:29.573 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:29.578 > [ESP32] Active Algorithms for this packet:
19:59:29.580 > [ESP32]   + LFSR
19:59:29.584 > [ESP32]   - Tinkerbell
19:59:29.587 > [ESP32]   - Transposition
19:59:29.587 > [ESP32]   - ChaCha20
19:59:29.589 > [ESP32]   + Salsa20
19:59:29.593 > [ESP32] ========================================
19:59:29.595 > [ESP32] MsgKeys: lfsrSeed=0xA9209F8C tnk[0..3]=33C7F1ED trn[0..3]=9202498B
19:59:29.603 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3436334D50
19:59:29.609 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3436334D5000000000000000 
19:59:29.617 > [ESP32][LFSR] Initializing - Seed: 0xA9209F8C SeedBe: 0x8C9F20A9 ChaosKey[0..3]: 33C7F1ED InitialTap: 0x0029 State: 0xA9209F8C
19:59:29.628 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:29.634 > 3_After_LFSR (32): C4CD0D9F7F6DCAB6325ECA0B75192B9B 957DC3722C71C0302384A424A0711064 
19:59:29.643 > [ESP32][LFSR] Keystream (first 16 bytes): 8C9F20A94E4D99E67D6CE732403978CF
19:59:29.650 > [ESP32][4D] LFSR keystream (first 32 bytes): 8C9F20A94E4D99E67D6CE732403978CFD02D905F1847F37D7384A424A0711064
19:59:29.659 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:29.665 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:29.667 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
19:59:29.673 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:29.678 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
19:59:29.682 > [ESP32][SALSA20] Input (first 16 bytes): C4CD0D9F7F6DCAB6325ECA0B75192B9B
19:59:29.690 > 7_After_Salsa20 (32): 7678B2E6E04EB9305BBE8CF1090ACA9E C1E5E33D7D2B61C704CBFC4ED79D0EB2 
19:59:29.697 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:29.700 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
19:59:29.707 > [ESP32] === HMAC DEBUG INFO ===
19:59:29.709 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:29.717 > [ESP32] HMAC Input length: 45 bytes
19:59:29.720 > [ESP32] HMAC Input (first 32 bytes): 820217001700040803000000027678B2E6E04EB9305BBE8CF1090ACA9EC1E5E3
19:59:29.728 > [ESP32] Nonce: 0x00000002
19:59:29.731 > [ESP32] Packet size before HMAC: 61
19:59:29.734 > [ESP32] Computed HMAC Tag: 5E183B37ACE7427018B0D5E87081681A
19:59:29.739 > [ESP32] === END HMAC DEBUG ===
19:59:29.743 > 6_Final_Packet (61): 820217001700040803000000027678B2 E6E04EB9305BBE8CF1090ACA9EC1E5E3 ...
19:59:29.750 > [RETRY] Attempt 1/3 (nonce: 2)
19:59:29.753 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:29.759 > Sending pipeline data to server (515 bytes)
19:59:29.897 > [HTTP] Response code: 400
19:59:29.897 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:29.902 > [HTTP] Request failed with code: 400
19:59:29.905 > [RETRY] Send failed, waiting 100 ms before retry
19:59:30.005 > [RETRY] Attempt 2/3 (nonce: 2)
19:59:30.006 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:30.011 > Sending pipeline data to server (515 bytes)
19:59:30.147 > [HTTP] Response code: 400
19:59:30.147 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:30.152 > [HTTP] Request failed with code: 400
19:59:30.156 > [RETRY] Send failed, waiting 200 ms before retry
19:59:30.356 > [RETRY] Attempt 3/3 (nonce: 2)
19:59:30.357 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:30.362 > Sending pipeline data to server (515 bytes)
19:59:30.654 > [HTTP] Response code: 400
19:59:30.654 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:30.659 > [HTTP] Request failed with code: 400
19:59:30.662 > [RETRY] All retry attempts failed - rolled back nonce to 1
19:59:30.667 > [RETRY] Consecutive failures: 3
19:59:30.670 > Health data send failed (retry count: 3/3)
19:59:30.673 > Health data transmission failed after max retries
19:59:30.773 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":86153,"type":"health_data_error"}
19:59:30.787 > [WebSocket] Processing message type: health_data_error
19:59:30.793 > [89.3] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:30.800 > ERROR state - attempting recovery
19:59:30.803 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:30.809 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:59:30.825 > Generated health data: HR-61 SPO2-95 STEPS-464
19:59:30.829 > [ESP32] ========================================
19:59:30.834 > [ESP32] ENCRYPTION PIPELINE START
19:59:30.836 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:30.842 > [ESP32] Active Algorithms for this packet:
19:59:30.845 > [ESP32]   + LFSR
19:59:30.848 > [ESP32]   - Tinkerbell
19:59:30.848 > [ESP32]   - Transposition
19:59:30.851 > [ESP32]   - ChaCha20
19:59:30.854 > [ESP32]   + Salsa20
19:59:30.854 > [ESP32] ========================================
19:59:30.859 > [ESP32] MsgKeys: lfsrSeed=0xA9209F8C tnk[0..3]=33C7F1ED trn[0..3]=9202498B
19:59:30.864 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3436344D50
19:59:30.873 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3436344D5000000000000000 
19:59:30.879 > [ESP32][LFSR] Initializing - Seed: 0xA9209F8C SeedBe: 0x8C9F20A9 ChaosKey[0..3]: 33C7F1ED InitialTap: 0x0029 State: 0xA9209F8C
19:59:30.889 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:30.897 > 3_After_LFSR (32): C4CD0D9F7F6DCAB6325ECA0B75192B9B 957DC3722C71C7302384A424A0711064 
19:59:30.906 > [ESP32][LFSR] Keystream (first 16 bytes): 8C9F20A94E4D99E67D6CE732403978CF
19:59:30.911 > [ESP32][4D] LFSR keystream (first 32 bytes): 8C9F20A94E4D99E67D6CE732403978CFD02D905F1847F37D7384A424A0711064
19:59:30.923 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:30.925 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:30.932 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
19:59:30.936 > [ESP32][SALSA20] Key (first 8 bytes): 17FB6CEA7051D38F
19:59:30.939 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
19:59:30.945 > [ESP32][SALSA20] Input (first 16 bytes): C4CD0D9F7F6DCAB6325ECA0B75192B9B
19:59:30.951 > 7_After_Salsa20 (32): 7678B2E6E04EB9305BBE8CF1090ACA9E C1E5E33D7D2B66C704CBFC4ED79D0EB2 
19:59:30.959 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:30.964 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
19:59:30.970 > [ESP32] === HMAC DEBUG INFO ===
19:59:30.973 > [ESP32] HMAC Key being used: 17FB6CEA7051D38F09C1EE4379E23FB52DE8F1D3CE7B9B144BE49056A181A1D0
19:59:30.981 > [ESP32] HMAC Input length: 45 bytes
19:59:30.984 > [ESP32] HMAC Input (first 32 bytes): 820217001700040803000000027678B2E6E04EB9305BBE8CF1090ACA9EC1E5E3
19:59:30.992 > [ESP32] Nonce: 0x00000002
19:59:30.995 > [ESP32] Packet size before HMAC: 61
19:59:30.998 > [ESP32] Computed HMAC Tag: 3C58B8BB90D696285F52D7948D690975
19:59:31.003 > [ESP32] === END HMAC DEBUG ===
19:59:31.006 > 6_Final_Packet (61): 820217001700040803000000027678B2 E6E04EB9305BBE8CF1090ACA9EC1E5E3 ...
19:59:31.013 > [RETRY] Attempt 1/3 (nonce: 2)
19:59:31.017 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:31.022 > Sending pipeline data to server (515 bytes)
19:59:31.164 > [HTTP] Response code: 400
19:59:31.164 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:31.169 > [HTTP] Request failed with code: 400
19:59:31.172 > [RETRY] Send failed, waiting 100 ms before retry
19:59:31.272 > [RETRY] Attempt 2/3 (nonce: 2)
19:59:31.272 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:31.278 > Sending pipeline data to server (515 bytes)
19:59:31.409 > [HTTP] Response code: 400
19:59:31.409 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:31.415 > [HTTP] Request failed with code: 400
19:59:31.417 > [RETRY] Send failed, waiting 200 ms before retry
19:59:31.618 > [RETRY] Attempt 3/3 (nonce: 2)
19:59:31.618 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:31.623 > Sending pipeline data to server (515 bytes)
19:59:31.912 > [HTTP] Response code: 400
19:59:31.912 > [HTTP] Error response: {"error":"Decryption failed"}
19:59:31.917 > [HTTP] Request failed with code: 400
19:59:31.920 > [RETRY] All retry attempts failed - rolled back nonce to 1
19:59:31.925 > [RETRY] Consecutive failures: 4
19:59:31.929 > ✗ Auto-recovery failed - restarting key exchange
19:59:34.032 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":86658,"type":"health_data_error"}
19:59:34.045 > [WebSocket] Processing message type: health_data_error
19:59:34.052 > [92.6] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:34.059 > ✓ Public key loaded from NVS
19:59:34.162 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301768177,"threatLevel":2,"type":"heuristics_update"}
19:59:34.192 > [WebSocket] Processing message type: heuristics_update
19:59:34.194 > [92.7] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:34.305 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":87163,"type":"health_data_error"}
19:59:34.318 > [WebSocket] Processing message type: health_data_error
19:59:34.324 > [92.8] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:34.333 > Generating fresh master key from entropy...
19:59:34.341 > Generated master key (32): B5DFD64AAE1153584FDF4FE3A7692456 A08A3D64BB78F96FF9732369A5EBA3B5 
19:59:34.347 > Using reduced master key (byte % 3) for NTRU encryption only
19:59:34.356 > NTRU encrypted master key (502): 007B007B001F00110053006100760048 006C003A0013001D0052003300500017 ...
19:59:34.364 > POST http://10.249.92.115:8081/master-key
19:59:34.675 > ✓ Master key exchange completed
19:59:34.777 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":87414,"type":"health_data_error"}
19:59:34.791 > [WebSocket] Processing message type: health_data_error
19:59:34.797 > [93.3] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:34.805 > Loading master key from NVS and deriving symmetric keys...
19:59:34.810 > Loaded master key from NVS (32): B5DFD64AAE1153584FDF4FE3A7692456 A08A3D64BB78F96FF9732369A5EBA3B5 
19:59:34.819 > Derived HMAC key (32): 894CCB3C110CD45EDF52901816EC3FB5 BB56F261ECF74EB5DB6EDC37C8A2489D 
19:59:34.827 > Derived Tinkerbell key (16): E0CD6C8A8359A4209895467680C5B4D0 
19:59:34.832 > Derived Transposition key (16): 045D19A99AFA0321D7ADA001EB99CBC5 
19:59:34.838 > ✓ Symmetric keys derived successfully
19:59:34.841 > Nonce tracker reset - new session started
19:59:35.336 > Waiting for server to process master key...
19:59:35.340 > ✓ Symmetric keys ready - starting health data transmission
19:59:35.442 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301769182,"threatLevel":2,"type":"heuristics_update"}
19:59:35.472 > [WebSocket] Processing message type: heuristics_update
19:59:35.475 > [94.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:35.585 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":87922,"type":"health_data_error"}
19:59:35.598 > [WebSocket] Processing message type: health_data_error
19:59:35.604 > [94.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:35.707 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":88425,"type":"health_data_error"}
19:59:35.720 > [WebSocket] Processing message type: health_data_error
19:59:35.726 > [94.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:35.829 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":88676,"type":"health_data_error"}
19:59:35.843 > [WebSocket] Processing message type: health_data_error
19:59:35.849 > [94.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:35.952 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301770192,"threatLevel":2,"type":"heuristics_update"}
19:59:35.981 > [WebSocket] Processing message type: heuristics_update
19:59:35.985 > [94.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.094 > [94.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.195 > [94.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.296 > [94.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.397 > [94.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.498 > [95.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.602 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":7,"success":false,"timestamp":89182,"type":"health_data_error"}
19:59:36.616 > [WebSocket] Processing message type: health_data_error
19:59:36.621 > [95.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.725 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":8,"success":false,"timestamp":89692,"type":"health_data_error"}
19:59:36.738 > [WebSocket] Processing message type: health_data_error
19:59:36.744 > [95.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.846 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301771201,"threatLevel":2,"type":"heuristics_update"}
19:59:36.877 > [WebSocket] Processing message type: heuristics_update
19:59:36.879 > [95.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:36.989 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":8,"success":false,"timestamp":89937,"type":"health_data_error"}
19:59:37.003 > [WebSocket] Processing message type: health_data_error
19:59:37.009 > [95.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.112 > [WebSocket] Received (153 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Failed to send health data","state":8,"success":false,"timestamp":90441,"type":"health_data_error"}
19:59:37.125 > [WebSocket] Processing message type: health_data_error
19:59:37.131 > [95.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.233 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301772212,"threatLevel":2,"type":"heuristics_update"}
19:59:37.264 > [WebSocket] Processing message type: heuristics_update
19:59:37.266 > [95.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.376 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301773227,"threatLevel":2,"type":"heuristics_update"}
19:59:37.407 > [WebSocket] Processing message type: heuristics_update
19:59:37.410 > [95.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.520 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301774242,"threatLevel":2,"type":"heuristics_update"}
19:59:37.550 > [WebSocket] Processing message type: heuristics_update
19:59:37.552 > [96.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.662 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1770301774470,"type":"master_key_received"}
19:59:37.677 > [WebSocket] Processing message type: master_key_received
19:59:37.679 > [96.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.785 > [WebSocket] Received (174 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":93193,"type":"master_key_exchanged"}
19:59:37.801 > [WebSocket] Processing message type: master_key_exchanged
19:59:37.807 > [96.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:37.906 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301775256,"threatLevel":2,"type":"heuristics_update"}
19:59:37.937 > [WebSocket] Processing message type: heuristics_update
19:59:37.939 > [96.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.049 > [WebSocket] Received (166 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":93864,"type":"symmetric_keys_derived"}
19:59:38.066 > [WebSocket] Processing message type: symmetric_keys_derived
19:59:38.071 > [96.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.172 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301776269,"threatLevel":2,"type":"heuristics_update"}
19:59:38.202 > [WebSocket] Processing message type: heuristics_update
19:59:38.204 > [96.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.314 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301777277,"threatLevel":2,"type":"heuristics_update"}
19:59:38.345 > [WebSocket] Processing message type: heuristics_update
19:59:38.347 > [96.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.458 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301778290,"threatLevel":2,"type":"heuristics_update"}
19:59:38.489 > [WebSocket] Processing message type: heuristics_update
19:59:38.491 > [97.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.600 > [97.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.701 > [97.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.802 > [97.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:38.902 > [97.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.004 > [97.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.105 > [97.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.206 > [97.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.307 > [97.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.409 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301779300,"threatLevel":2,"type":"heuristics_update"}
19:59:39.439 > [WebSocket] Processing message type: heuristics_update
19:59:39.442 > [98.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.551 > [98.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.652 > [98.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.752 > [98.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.854 > [98.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:39.954 > [98.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.056 > [98.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.157 > [98.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.258 > [98.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.362 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301780308,"threatLevel":2,"type":"heuristics_update"}
19:59:40.393 > [WebSocket] Processing message type: heuristics_update
19:59:40.395 > [98.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.504 > [99.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.605 > [99.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.706 > [99.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.807 > [99.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:40.908 > [99.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.009 > [99.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.110 > [99.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.211 > [99.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.312 > [99.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.414 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301781319,"threatLevel":2,"type":"heuristics_update"}
19:59:41.444 > [WebSocket] Processing message type: heuristics_update
19:59:41.446 > [100.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.556 > [100.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.657 > [100.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.758 > [100.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.859 > [100.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:41.960 > [100.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.061 > [100.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.162 > [100.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.262 > [100.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.364 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301782332,"threatLevel":2,"type":"heuristics_update"}
19:59:42.395 > [WebSocket] Processing message type: heuristics_update
19:59:42.399 > [100.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.508 > [101.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.608 > [101.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.709 > [101.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.810 > [101.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:42.911 > [101.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.011 > [101.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.113 > [101.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.214 > [101.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.315 > [101.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.416 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301783347,"threatLevel":2,"type":"heuristics_update"}
19:59:43.447 > [WebSocket] Processing message type: heuristics_update
19:59:43.450 > [102.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.559 > [102.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.660 > [102.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.761 > [102.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.862 > [102.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:43.963 > [102.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.064 > [102.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.165 > [102.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.266 > [102.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.367 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301784358,"threatLevel":2,"type":"heuristics_update"}
19:59:44.398 > [WebSocket] Processing message type: heuristics_update
19:59:44.401 > [102.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.510 > [103.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.610 > [103.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.712 > [103.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.813 > [103.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:44.914 > [103.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.014 > [103.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.116 > [103.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.217 > [103.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.318 > [103.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.422 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301785368,"threatLevel":2,"type":"heuristics_update"}
19:59:45.452 > [WebSocket] Processing message type: heuristics_update
19:59:45.455 > [104.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 6 | WS: CONNECTED
19:59:45.464 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:45.469 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 1 for all retry attempts (saved: 0)
19:59:45.486 > Generated health data: HR-61 SPO2-95 STEPS-533
19:59:45.491 > [ESP32] ========================================
19:59:45.494 > [ESP32] ENCRYPTION PIPELINE START
19:59:45.496 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:45.502 > [ESP32] Active Algorithms for this packet:
19:59:45.508 > [ESP32]   + LFSR
19:59:45.508 > [ESP32]   - Tinkerbell
19:59:45.511 > [ESP32]   - Transposition
19:59:45.513 > [ESP32]   - ChaCha20
19:59:45.513 > [ESP32]   + Salsa20
19:59:45.516 > [ESP32] ========================================
19:59:45.521 > [ESP32] MsgKeys: lfsrSeed=0x2B84CD17 tnk[0..3]=A8C70EC8 trn[0..3]=1EF8F705
19:59:45.528 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3533334D50
19:59:45.533 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3533334D5000000000000000 
19:59:45.541 > [ESP32][LFSR] Initializing - Seed: 0x2B84CD17 SeedBe: 0x17CD842B ChaosKey[0..3]: A8C70EC8 InitialTap: 0x0029 State: 0x2B84CD17
19:59:45.552 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:45.561 > 3_After_LFSR (32): 5F9FA91DAC4F65011EA66A2F037571D6 3C5AAEF6814C50B5E05FEC0EDBEF8FB7 
19:59:45.569 > [ESP32][LFSR] Keystream (first 16 bytes): 17CD842B9D6F36515194471636552282
19:59:45.574 > [ESP32][4D] LFSR keystream (first 32 bytes): 17CD842B9D6F36515194471636552282790AFDDBB47F63F8B05FEC0EDBEF8FB7
19:59:45.583 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:45.589 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:45.594 > [ESP32][SALSA20] Initializing - Nonce: 0x00000001
19:59:45.596 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
19:59:45.602 > [ESP32][SALSA20] Full Nonce (8 bytes): 0100000000000000
19:59:45.608 > [ESP32][SALSA20] Input (first 16 bytes): 5F9FA91DAC4F65011EA66A2F037571D6
19:59:45.614 > 7_After_Salsa20 (32): 01AF1DC6A1AF787216BD9595A2994673 FC2316D727FC19CFD343A46AE606A5CF 
19:59:45.621 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:45.627 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000001
19:59:45.630 > [ESP32] === HMAC DEBUG INFO ===
19:59:45.632 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
19:59:45.642 > [ESP32] HMAC Input length: 45 bytes
19:59:45.647 > [ESP32] HMAC Input (first 32 bytes): 8202170017000408030000000101AF1DC6A1AF787216BD9595A2994673FC2316
19:59:45.655 > [ESP32] Nonce: 0x00000001
19:59:45.658 > [ESP32] Packet size before HMAC: 61
19:59:45.660 > [ESP32] Computed HMAC Tag: 7CFD3AE929DF7A9957738F272C54D0BC
19:59:45.666 > [ESP32] === END HMAC DEBUG ===
19:59:45.669 > 6_Final_Packet (61): 8202170017000408030000000101AF1D C6A1AF787216BD9595A2994673FC2316 ...
19:59:45.675 > [RETRY] Attempt 1/3 (nonce: 1)
19:59:45.677 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:45.683 > Sending pipeline data to server (516 bytes)
19:59:45.943 > [HTTP] Response code: 200
19:59:45.943 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:59:45.954 > [RETRY] Health data sent successfully!
19:59:45.956 > ✓ Health data #7 sent successfully
19:59:46.056 > [WebSocket] Received (184 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":12,"requests_per_minute":14,"serverTime":1770301785747,"type":"security_update"}
19:59:46.072 > [WebSocket] Processing message type: security_update
19:59:46.079 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
19:59:46.084 > [104.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.189 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202170017000408030000000101AF1DC6A1AF787216BD9595A2994673FC2316D727FC19CFD343A46AE606A5CF7CFD3AE929DF7A9957738F272C54D0BC","pipeline":{"afterLFSR":"5F9FA91DAC4F65011EA66A2F037571D63C5AAEF6814C50B5E05FEC0EDBEF8FB7","afterSalsa20":"01AF1DC6A1AF787216BD9595A2994673FC2316D727FC19CFD343A46AE606A5CF","afterSalt":"48522D36312053504F322D39352053544550532D3533334D50"},"plaintext":"HR-61 SPO2-95 STEPS-533","serverTime":1770301785747,"timestamp":104205,"type":"encryption_update","ztmEnabled":true}
19:59:46.239 > [WebSocket] Processing message type: encryption_update
19:59:46.242 > [104.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.342 > [WebSocket] Received (87 bytes): {"heartRate":61,"spo2":95,"steps":533,"time":1770301785747,"type":"health_data_update"}
19:59:46.351 > [WebSocket] Processing message type: health_data_update
19:59:46.356 > [104.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.464 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2516,"encryptionTime":0.0,"finalPlaintext":"HR-61 SPO2-95 STEPS-533","handshakeSuccess":true,"totalTime":0.2516},"type":"session_summary_update"}
19:59:46.486 > [WebSocket] Processing message type: session_summary_update
19:59:46.492 > [105.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.597 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2516,"encryptedPacket":"8202170017000408030000000101AF1DC6A1AF787216BD9595A2994673FC2316D727FC19CFD343A46AE606A5CF7CFD3AE929DF7A9957738F272C54D0BC","finalPlaintext":"HR-61 SPO2-95 STEPS-533","healthData":{"heartRate":61,"spo2":95,"steps":533},"pipeline":{"afterDepad":"48522D36312053504F322D39352053544550532D35333300000000000000","afterLFSR":"48522D36312053504F322D39352053544550532D3533334D5000000000000000","afterTinkerbell":"5F9FA91DAC4F65011EA66A2F037571D63C5AAEF6814C50B5E05FEC0EDBEF8FB7","afterTransposition":"5F9FA91DAC4F65011EA66A2F037571D63C5AAEF6814C50B5E05FEC0EDBEF8FB7"},"serverTime":1770301785749,"type":"decryption_update"}
19:59:46.656 > [WebSocket] Processing message type: decryption_update
19:59:46.661 > [WebSocket] Server decryption completed
19:59:46.664 > [WebSocket] Health data - HR: 61, SPO2: 95, Steps: 533
19:59:46.669 > [105.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.770 > [WebSocket] Received (555 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":6,"pipeline":{"afterLFSR":"5F9FA91DAC4F65011EA66A2F037571D63C5AAEF6814C50B5E05FEC0EDBEF8FB7","afterSalsa20":"01AF1DC6A1AF787216BD9595A2994673FC2316D727FC19CFD343A46AE606A5CF","afterSalt":"48522D36312053504F322D39352053544550532D3533334D50","finalPacket":"8202170017000408030000000101AF1DC6A1AF787216BD9595A2994673FC2316D727FC19CFD343A46AE606A5CF7CFD3AE929DF7A9957738F272C54D0BC"},"plaintext":"HR-61 SPO2-95 STEPS-533","timestamp":104471,"type":"encryption_pipeline","ztmEnabled":true}
19:59:46.821 > [WebSocket] Processing message type: encryption_pipeline
19:59:46.826 > [105.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:46.934 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":6,"message":"Health data #7 sent successfully","state":7,"success":true,"timestamp":104476,"type":"health_data_sent"}
19:59:46.950 > [WebSocket] Processing message type: health_data_sent
19:59:46.952 > [105.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.056 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301786379,"threatLevel":2,"type":"heuristics_update"}
19:59:47.086 > [WebSocket] Processing message type: heuristics_update
19:59:47.089 > [105.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.198 > [105.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.299 > [105.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.403 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301787386,"threatLevel":2,"type":"heuristics_update"}
19:59:47.434 > [WebSocket] Processing message type: heuristics_update
19:59:47.436 > [106.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.545 > [106.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.645 > [106.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.747 > [106.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.848 > [106.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:47.948 > [106.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.049 > [106.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.150 > [106.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.252 > [106.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.353 > [106.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.455 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301788401,"threatLevel":2,"type":"heuristics_update"}
19:59:48.485 > [WebSocket] Processing message type: heuristics_update
19:59:48.487 > [107.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.596 > [107.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.698 > [107.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.798 > [107.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:48.900 > [107.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.000 > [107.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.102 > [107.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.203 > [107.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.304 > [107.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.405 > [107.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.507 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301789408,"threatLevel":2,"type":"heuristics_update"}
19:59:49.537 > [WebSocket] Processing message type: heuristics_update
19:59:49.539 > [108.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.648 > [108.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.750 > [108.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.851 > [108.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:49.952 > [108.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.052 > [108.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.154 > [108.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.254 > [108.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.356 > [108.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.458 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301790419,"threatLevel":2,"type":"heuristics_update"}
19:59:50.488 > [WebSocket] Processing message type: heuristics_update
19:59:50.490 > [109.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.600 > [109.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.701 > [109.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.802 > [109.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:50.903 > [109.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.004 > [109.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.104 > [109.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.206 > [109.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.306 > [109.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.408 > [109.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.509 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301791429,"threatLevel":2,"type":"heuristics_update"}
19:59:51.540 > [WebSocket] Processing message type: heuristics_update
19:59:51.543 > [110.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.651 > [110.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.752 > [110.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.853 > [110.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:51.954 > [110.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.056 > [110.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.156 > [110.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.258 > [110.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.359 > [110.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.463 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301792442,"threatLevel":2,"type":"heuristics_update"}
19:59:52.494 > [WebSocket] Processing message type: heuristics_update
19:59:52.496 > [111.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.605 > [111.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.706 > [111.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.807 > [111.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:52.908 > [111.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.009 > [111.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.109 > [111.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.210 > [111.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.311 > [111.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.412 > [111.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.514 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301793458,"threatLevel":2,"type":"heuristics_update"}
19:59:53.545 > [WebSocket] Processing message type: heuristics_update
19:59:53.548 > [112.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.657 > [112.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.758 > [112.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.859 > [112.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:53.960 > [112.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.060 > [112.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.161 > [112.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.262 > [112.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.364 > [112.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.465 > [113.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.566 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301794465,"threatLevel":2,"type":"heuristics_update"}
19:59:54.597 > [WebSocket] Processing message type: heuristics_update
19:59:54.599 > [113.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.708 > [113.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.809 > [113.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:54.911 > [113.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.011 > [113.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.113 > [113.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.214 > [113.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.315 > [113.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.415 > [113.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.517 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301795475,"threatLevel":2,"type":"heuristics_update"}
19:59:55.547 > [WebSocket] Processing message type: heuristics_update
19:59:55.550 > [114.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.660 > [114.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.761 > [114.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.861 > [114.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.962 > [114.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 7 | WS: CONNECTED
19:59:55.968 > [RETRY] Attempting to send health data (Max retries: 3)
19:59:55.974 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
19:59:55.991 > Generated health data: HR-61 SPO2-95 STEPS-615
19:59:55.995 > [ESP32] ========================================
19:59:55.999 > [ESP32] ENCRYPTION PIPELINE START
19:59:56.001 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
19:59:56.006 > [ESP32] Active Algorithms for this packet:
19:59:56.013 > [ESP32]   + LFSR
19:59:56.013 > [ESP32]   - Tinkerbell
19:59:56.015 > [ESP32]   - Transposition
19:59:56.018 > [ESP32]   - ChaCha20
19:59:56.018 > [ESP32]   + Salsa20
19:59:56.021 > [ESP32] ========================================
19:59:56.026 > [ESP32] MsgKeys: lfsrSeed=0x87BD003E tnk[0..3]=8E112524 trn[0..3]=C6C6B684
19:59:56.032 > 1_After_Salt (25): 48522D36312053504F322D3935205354 4550532D3631354D50
19:59:56.038 > 2_After_Padding (32): 48522D36312053504F322D3935205354 4550532D3631354D5000000000000000 
19:59:56.045 > [ESP32][LFSR] Initializing - Seed: 0x87BD003E SeedBe: 0x3E00BD87 ChaosKey[0..3]: 8E112524 InitialTap: 0x0029 State: 0x87BD003E
19:59:56.057 > [ESP32][LFSR] Input (first 16 bytes): 48522D36312053504F322D3935205354 Buffer size: 32 bytes
19:59:56.065 > 3_After_LFSR (32): 765290B1445EEAE7B1F3307D3AAD5717 654C008B30211A48C260953EAFDD4858 
19:59:56.074 > [ESP32][LFSR] Keystream (first 16 bytes): 3E00BD87757EB9B7FEC11D440F8D0443
19:59:56.079 > [ESP32][4D] LFSR keystream (first 32 bytes): 3E00BD87757EB9B7FEC11D440F8D0443201C53A606102F059260953EAFDD4858
19:59:56.087 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
19:59:56.093 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
19:59:56.098 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
19:59:56.101 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
19:59:56.107 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
19:59:56.113 > [ESP32][SALSA20] Input (first 16 bytes): 765290B1445EEAE7B1F3307D3AAD5717
19:59:56.118 > 7_After_Salsa20 (32): 2862246A49BEF794C21435359B4160B2 A535B8AA96915332F6A853F492346220 
19:59:56.126 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
19:59:56.132 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
19:59:56.137 > [ESP32] === HMAC DEBUG INFO ===
19:59:56.140 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
19:59:56.148 > [ESP32] HMAC Input length: 45 bytes
19:59:56.151 > [ESP32] HMAC Input (first 32 bytes): 820217001700040803000000022862246A49BEF794C21435359B4160B2A535B8
19:59:56.160 > [ESP32] Nonce: 0x00000002
19:59:56.163 > [ESP32] Packet size before HMAC: 61
19:59:56.165 > [ESP32] Computed HMAC Tag: B711CE2BA2764FB9F974347132B6E2D4
19:59:56.171 > [ESP32] === END HMAC DEBUG ===
19:59:56.174 > 6_Final_Packet (61): 82021700170004080300000002286224 6A49BEF794C21435359B4160B2A535B8 ...
19:59:56.181 > [RETRY] Attempt 1/3 (nonce: 2)
19:59:56.185 > POST http://10.249.92.115:8081/health-data with pipeline data
19:59:56.187 > Sending pipeline data to server (516 bytes)
19:59:56.466 > [HTTP] Response code: 200
19:59:56.466 > [HTTP] Response: {"status":"OK:DECRYPTED"}
19:59:56.476 > [RETRY] Health data sent successfully!
19:59:56.478 > ✓ Health data #8 sent successfully
19:59:56.580 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:820217001700040803000000022862246A49BEF794C21435359B4160B2A535B8AA96915332F6A853F492346220B711CE2BA2764FB9F974347132B6E2D4","pipeline":{"afterLFSR":"765290B1445EEAE7B1F3307D3AAD5717654C008B30211A48C260953EAFDD4858","afterSalsa20":"2862246A49BEF794C21435359B4160B2A535B8AA96915332F6A853F492346220","afterSalt":"48522D36312053504F322D39352053544550532D3631354D50"},"plaintext":"HR-61 SPO2-95 STEPS-615","serverTime":1770301796274,"timestamp":114715,"type":"encryption_update","ztmEnabled":true}
19:59:56.629 > [WebSocket] Processing message type: encryption_update
19:59:56.632 > [115.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:56.732 > [WebSocket] Received (87 bytes): {"heartRate":61,"spo2":95,"steps":615,"time":1770301796274,"type":"health_data_update"}
19:59:56.741 > [WebSocket] Processing message type: health_data_update
19:59:56.747 > [115.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:56.855 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2212,"encryptionTime":0.0,"finalPlaintext":"HR-61 SPO2-95 STEPS-615","handshakeSuccess":true,"totalTime":0.2212},"type":"session_summary_update"}
19:59:56.877 > [WebSocket] Processing message type: session_summary_update
19:59:56.883 > [115.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:56.988 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2212,"encryptedPacket":"820217001700040803000000022862246A49BEF794C21435359B4160B2A535B8AA96915332F6A853F492346220B711CE2BA2764FB9F974347132B6E2D4","finalPlaintext":"HR-61 SPO2-95 STEPS-615","healthData":{"heartRate":61,"spo2":95,"steps":615},"pipeline":{"afterDepad":"48522D36312053504F322D39352053544550532D36313500000000000000","afterLFSR":"48522D36312053504F322D39352053544550532D3631354D5000000000000000","afterTinkerbell":"765290B1445EEAE7B1F3307D3AAD5717654C008B30211A48C260953EAFDD4858","afterTransposition":"765290B1445EEAE7B1F3307D3AAD5717654C008B30211A48C260953EAFDD4858"},"serverTime":1770301796276,"type":"decryption_update"}
19:59:57.045 > [WebSocket] Processing message type: decryption_update
19:59:57.052 > [WebSocket] Server decryption completed
19:59:57.054 > [WebSocket] Health data - HR: 61, SPO2: 95, Steps: 615
19:59:57.059 > [115.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.161 > [WebSocket] Received (555 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":7,"pipeline":{"afterLFSR":"765290B1445EEAE7B1F3307D3AAD5717654C008B30211A48C260953EAFDD4858","afterSalsa20":"2862246A49BEF794C21435359B4160B2A535B8AA96915332F6A853F492346220","afterSalt":"48522D36312053504F322D39352053544550532D3631354D50","finalPacket":"820217001700040803000000022862246A49BEF794C21435359B4160B2A535B8AA96915332F6A853F492346220B711CE2BA2764FB9F974347132B6E2D4"},"plaintext":"HR-61 SPO2-95 STEPS-615","timestamp":114995,"type":"encryption_pipeline","ztmEnabled":true}
19:59:57.211 > [WebSocket] Processing message type: encryption_pipeline
19:59:57.217 > [115.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.325 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":7,"message":"Health data #8 sent successfully","state":7,"success":true,"timestamp":114999,"type":"health_data_sent"}
19:59:57.341 > [WebSocket] Processing message type: health_data_sent
19:59:57.343 > [115.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.446 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301796483,"threatLevel":2,"type":"heuristics_update"}
19:59:57.477 > [WebSocket] Processing message type: heuristics_update
19:59:57.480 > [116.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.593 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301797493,"threatLevel":2,"type":"heuristics_update"}
19:59:57.622 > [WebSocket] Processing message type: heuristics_update
19:59:57.625 > [116.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.735 > [116.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.835 > [116.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:57.936 > [116.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.038 > [116.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.139 > [116.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.240 > [116.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.340 > [116.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.442 > [117.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.543 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301798504,"threatLevel":2,"type":"heuristics_update"}
19:59:58.574 > [WebSocket] Processing message type: heuristics_update
19:59:58.577 > [117.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.685 > [117.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.786 > [117.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.888 > [117.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:58.988 > [117.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.089 > [117.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.190 > [117.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.291 > [117.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.393 > [117.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.494 > [118.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.595 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301799516,"threatLevel":2,"type":"heuristics_update"}
19:59:59.626 > [WebSocket] Processing message type: heuristics_update
19:59:59.628 > [118.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.738 > [118.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.838 > [118.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
19:59:59.939 > [118.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.040 > [118.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.142 > [118.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.242 > [118.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.343 > [118.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.444 > [119.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.545 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301800527,"threatLevel":2,"type":"heuristics_update"}
20:00:00.577 > [WebSocket] Processing message type: heuristics_update
20:00:00.579 > [119.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.688 > [119.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.789 > [119.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.890 > [119.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:00.992 > [119.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.092 > [119.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.193 > [119.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.294 > [119.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.396 > [119.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.496 > [120.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.599 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301801542,"threatLevel":2,"type":"heuristics_update"}
20:00:01.629 > [WebSocket] Processing message type: heuristics_update
20:00:01.632 > [120.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.740 > [120.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.842 > [120.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:01.942 > [120.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.044 > [120.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.143 > [120.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.245 > [120.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.347 > [120.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.447 > [121.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.549 > [121.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.649 > [121.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.751 > [121.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.855 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301802550,"threatLevel":2,"type":"heuristics_update"}
20:00:02.885 > [WebSocket] Processing message type: heuristics_update
20:00:02.888 > [121.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:02.996 > [121.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.097 > [121.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.199 > [121.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.299 > [121.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.401 > [121.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.502 > [122.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.603 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301803563,"threatLevel":2,"type":"heuristics_update"}
20:00:03.633 > [WebSocket] Processing message type: heuristics_update
20:00:03.637 > [122.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.745 > [122.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.846 > [122.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:03.948 > [122.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.048 > [122.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.150 > [122.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.250 > [122.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.352 > [122.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.452 > [123.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.553 > [123.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.654 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301804575,"threatLevel":2,"type":"heuristics_update"}
20:00:04.685 > [WebSocket] Processing message type: heuristics_update
20:00:04.688 > [123.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.798 > [123.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.898 > [123.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:04.999 > [123.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.101 > [123.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.202 > [123.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.302 > [123.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.403 > [123.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.504 > [124.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.606 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301805584,"threatLevel":2,"type":"heuristics_update"}
20:00:05.636 > [WebSocket] Processing message type: heuristics_update
20:00:05.638 > [124.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.748 > [124.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.849 > [124.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:05.950 > [124.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.051 > [124.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.151 > [124.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.254 > [124.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.355 > [124.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.454 > [125.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.556 > [125.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 8 | WS: CONNECTED
20:00:06.562 > [RETRY] Attempting to send health data (Max retries: 3)
20:00:06.567 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 3 for all retry attempts (saved: 2)
20:00:06.584 > Generated health data: HR-62 SPO2-95 STEPS-633
20:00:06.589 > [ESP32] ========================================
20:00:06.592 > [ESP32] ENCRYPTION PIPELINE START
20:00:06.595 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:00:06.600 > [ESP32] Active Algorithms for this packet:
20:00:06.606 > [ESP32]   + LFSR
20:00:06.606 > [ESP32]   - Tinkerbell
20:00:06.609 > [ESP32]   - Transposition
20:00:06.612 > [ESP32]   - ChaCha20
20:00:06.612 > [ESP32]   + Salsa20
20:00:06.615 > [ESP32] ========================================
20:00:06.620 > [ESP32] MsgKeys: lfsrSeed=0xB994D220 tnk[0..3]=8DE2B4F9 trn[0..3]=7619FB9D
20:00:06.625 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3633334D50
20:00:06.631 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3633334D5000000000000000 
20:00:06.638 > [ESP32][LFSR] Initializing - Seed: 0xB994D220 SeedBe: 0x20D294B9 ChaosKey[0..3]: 8DE2B4F9 InitialTap: 0x0029 State: 0xB994D220
20:00:06.650 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
20:00:06.659 > 3_After_LFSR (32): 6880B98F52BA3384F34932B176F04B85 27F5FF3F060A0ACBA4DC8127C48B5D21 
20:00:06.667 > [ESP32][LFSR] Keystream (first 16 bytes): 20D294B9609A60D4BC7B1F8843D018D1
20:00:06.673 > [ESP32][4D] LFSR keystream (first 32 bytes): 20D294B9609A60D4BC7B1F8843D018D162A5AC1230393986F4DC8127C48B5D21
20:00:06.681 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:00:06.686 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:00:06.692 > [ESP32][SALSA20] Initializing - Nonce: 0x00000003
20:00:06.695 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:00:06.701 > [ESP32][SALSA20] Full Nonce (8 bytes): 0300000000000000
20:00:06.706 > [ESP32][SALSA20] Input (first 16 bytes): 6880B98F52BA3384F34932B176F04B85
20:00:06.711 > 7_After_Salsa20 (32): 36B00D545F5A2EF72DD3E952D71C7C20 E78C471EA0BA43B1CA20958AF9627759 
20:00:06.720 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:00:06.726 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000003
20:00:06.732 > [ESP32] === HMAC DEBUG INFO ===
20:00:06.734 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:00:06.742 > [ESP32] HMAC Input length: 45 bytes
20:00:06.744 > [ESP32] HMAC Input (first 32 bytes): 8202170017000408030000000336B00D545F5A2EF72DD3E952D71C7C20E78C47
20:00:06.754 > [ESP32] Nonce: 0x00000003
20:00:06.756 > [ESP32] Packet size before HMAC: 61
20:00:06.759 > [ESP32] Computed HMAC Tag: 4E39426920F6362EBEFE4D6B549B0ADC
20:00:06.764 > [ESP32] === END HMAC DEBUG ===
20:00:06.767 > 6_Final_Packet (61): 8202170017000408030000000336B00D 545F5A2EF72DD3E952D71C7C20E78C47 ...
20:00:06.775 > [RETRY] Attempt 1/3 (nonce: 3)
20:00:06.778 > POST http://10.249.92.115:8081/health-data with pipeline data
20:00:06.781 > Sending pipeline data to server (516 bytes)
20:00:06.987 > [HTTP] Response code: 200
20:00:06.987 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:00:07.000 > [RETRY] Health data sent successfully!
20:00:07.003 > ✓ Health data #9 sent successfully
20:00:07.105 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301806594,"threatLevel":2,"type":"heuristics_update"}
20:00:07.136 > [WebSocket] Processing message type: heuristics_update
20:00:07.138 > [125.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.249 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202170017000408030000000336B00D545F5A2EF72DD3E952D71C7C20E78C471EA0BA43B1CA20958AF96277594E39426920F6362EBEFE4D6B549B0ADC","pipeline":{"afterLFSR":"6880B98F52BA3384F34932B176F04B8527F5FF3F060A0ACBA4DC8127C48B5D21","afterSalsa20":"36B00D545F5A2EF72DD3E952D71C7C20E78C471EA0BA43B1CA20958AF9627759","afterSalt":"48522D36322053504F322D39352053544550532D3633334D50"},"plaintext":"HR-62 SPO2-95 STEPS-633","serverTime":1770301806854,"timestamp":125309,"type":"encryption_update","ztmEnabled":true}
20:00:07.299 > [WebSocket] Processing message type: encryption_update
20:00:07.302 > [125.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.401 > [WebSocket] Received (87 bytes): {"heartRate":62,"spo2":95,"steps":633,"time":1770301806854,"type":"health_data_update"}
20:00:07.410 > [WebSocket] Processing message type: health_data_update
20:00:07.415 > [125.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.523 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2405,"encryptionTime":0.0,"finalPlaintext":"HR-62 SPO2-95 STEPS-633","handshakeSuccess":true,"totalTime":0.2405},"type":"session_summary_update"}
20:00:07.545 > [WebSocket] Processing message type: session_summary_update
20:00:07.551 > [126.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.656 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2405,"encryptedPacket":"8202170017000408030000000336B00D545F5A2EF72DD3E952D71C7C20E78C471EA0BA43B1CA20958AF96277594E39426920F6362EBEFE4D6B549B0ADC","finalPlaintext":"HR-62 SPO2-95 STEPS-633","healthData":{"heartRate":62,"spo2":95,"steps":633},"pipeline":{"afterDepad":"48522D36322053504F322D39352053544550532D36333300000000000000","afterLFSR":"48522D36322053504F322D39352053544550532D3633334D5000000000000000","afterTinkerbell":"6880B98F52BA3384F34932B176F04B8527F5FF3F060A0ACBA4DC8127C48B5D21","afterTransposition":"6880B98F52BA3384F34932B176F04B8527F5FF3F060A0ACBA4DC8127C48B5D21"},"serverTime":1770301806855,"type":"decryption_update"}
20:00:07.714 > [WebSocket] Processing message type: decryption_update
20:00:07.720 > [WebSocket] Server decryption completed
20:00:07.723 > [WebSocket] Health data - HR: 62, SPO2: 95, Steps: 633
20:00:07.728 > [126.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.830 > [WebSocket] Received (555 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":8,"pipeline":{"afterLFSR":"6880B98F52BA3384F34932B176F04B8527F5FF3F060A0ACBA4DC8127C48B5D21","afterSalsa20":"36B00D545F5A2EF72DD3E952D71C7C20E78C471EA0BA43B1CA20958AF9627759","afterSalt":"48522D36322053504F322D39352053544550532D3633334D50","finalPacket":"8202170017000408030000000336B00D545F5A2EF72DD3E952D71C7C20E78C471EA0BA43B1CA20958AF96277594E39426920F6362EBEFE4D6B549B0ADC"},"plaintext":"HR-62 SPO2-95 STEPS-633","timestamp":125517,"type":"encryption_pipeline","ztmEnabled":true}
20:00:07.880 > [WebSocket] Processing message type: encryption_pipeline
20:00:07.885 > [126.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:07.993 > [WebSocket] Received (158 bytes): {"deviceId":"f9641d44","healthSendCount":8,"message":"Health data #9 sent successfully","state":7,"success":true,"timestamp":125521,"type":"health_data_sent"}
20:00:08.009 > [WebSocket] Processing message type: health_data_sent
20:00:08.012 > [126.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.115 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301807606,"threatLevel":2,"type":"heuristics_update"}
20:00:08.145 > [WebSocket] Processing message type: heuristics_update
20:00:08.148 > [126.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.258 > [126.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.358 > [126.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.459 > [127.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.560 > [127.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.662 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301808612,"threatLevel":2,"type":"heuristics_update"}
20:00:08.692 > [WebSocket] Processing message type: heuristics_update
20:00:08.695 > [127.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.805 > [127.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:08.906 > [127.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.006 > [127.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.107 > [127.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.208 > [127.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.310 > [127.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.410 > [127.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.511 > [128.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.612 > [128.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.714 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301809625,"threatLevel":2,"type":"heuristics_update"}
20:00:09.744 > [WebSocket] Processing message type: heuristics_update
20:00:09.747 > [128.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.856 > [128.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:09.957 > [128.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.058 > [128.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.159 > [128.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.260 > [128.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.361 > [128.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.461 > [129.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.563 > [129.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.665 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301810634,"threatLevel":2,"type":"heuristics_update"}
20:00:10.695 > [WebSocket] Processing message type: heuristics_update
20:00:10.698 > [129.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.806 > [129.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:10.908 > [129.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.009 > [129.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.110 > [129.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.211 > [129.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.312 > [129.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.413 > [129.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.514 > [130.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.614 > [130.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.716 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301811647,"threatLevel":2,"type":"heuristics_update"}
20:00:11.747 > [WebSocket] Processing message type: heuristics_update
20:00:11.750 > [130.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.859 > [130.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:11.960 > [130.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.061 > [130.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.162 > [130.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.263 > [130.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.364 > [130.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.465 > [131.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.566 > [131.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.670 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301812659,"threatLevel":2,"type":"heuristics_update"}
20:00:12.700 > [WebSocket] Processing message type: heuristics_update
20:00:12.703 > [131.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.812 > [131.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:12.913 > [131.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.014 > [131.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.115 > [131.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.216 > [131.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.317 > [131.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.418 > [131.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.519 > [132.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.620 > [132.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.722 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301813669,"threatLevel":2,"type":"heuristics_update"}
20:00:13.752 > [WebSocket] Processing message type: heuristics_update
20:00:13.755 > [132.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.864 > [132.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:13.965 > [132.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.066 > [132.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.167 > [132.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.268 > [132.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.369 > [132.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.470 > [133.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.571 > [133.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.671 > [133.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.774 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301814682,"threatLevel":2,"type":"heuristics_update"}
20:00:14.804 > [WebSocket] Processing message type: heuristics_update
20:00:14.807 > [133.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:14.917 > [133.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.016 > [133.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.118 > [133.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.219 > [133.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.320 > [133.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.421 > [133.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.523 > [134.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.623 > [134.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.725 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301815696,"threatLevel":2,"type":"heuristics_update"}
20:00:15.756 > [WebSocket] Processing message type: heuristics_update
20:00:15.758 > [134.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.868 > [134.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:15.968 > [134.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.069 > [134.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.170 > [134.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.271 > [134.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.372 > [134.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.473 > [135.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.574 > [135.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.675 > [135.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.775 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301816707,"threatLevel":2,"type":"heuristics_update"}
20:00:16.807 > [WebSocket] Processing message type: heuristics_update
20:00:16.810 > [135.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:16.919 > [135.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:17.020 > [135.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 9 | WS: CONNECTED
20:00:17.025 > [RETRY] Attempting to send health data (Max retries: 3)
20:00:17.031 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 4 for all retry attempts (saved: 3)
20:00:17.047 > Generated health data: HR-63 SPO2-95 STEPS-703
20:00:17.053 > [ESP32] ========================================
20:00:17.056 > [ESP32] ENCRYPTION PIPELINE START
20:00:17.059 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:00:17.064 > [ESP32] Active Algorithms for this packet:
20:00:17.069 > [ESP32]   + LFSR
20:00:17.069 > [ESP32]   - Tinkerbell
20:00:17.073 > [ESP32]   - Transposition
20:00:17.076 > [ESP32]   - ChaCha20
20:00:17.076 > [ESP32]   + Salsa20
20:00:17.078 > [ESP32] ========================================
20:00:17.084 > [ESP32] MsgKeys: lfsrSeed=0xD54E1CCE tnk[0..3]=9931E140 trn[0..3]=3079E60F
20:00:17.089 > 1_After_Salt (25): 48522D36332053504F322D3935205354 4550532D3730334D50
20:00:17.095 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D3730334D5000000000000000 
20:00:17.103 > [ESP32][LFSR] Initializing - Seed: 0xD54E1CCE SeedBe: 0xCE1C4ED5 ChaosKey[0..3]: 9931E140 InitialTap: 0x0029 State: 0xD54E1CCE
20:00:17.114 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:00:17.122 > 3_After_LFSR (32): 864E63E3720A5A366595BA2698F76A90 DB3E05AF0D77327B79FA4C71A32FF6C2 
20:00:17.131 > [ESP32][LFSR] Keystream (first 16 bytes): CE1C4ED5412A09662AA7971FADD739C4
20:00:17.137 > [ESP32][4D] LFSR keystream (first 32 bytes): CE1C4ED5412A09662AA7971FADD739C49E6E56823A47013629FA4C71A32FF6C2
20:00:17.145 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:00:17.151 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:00:17.156 > [ESP32][SALSA20] Initializing - Nonce: 0x00000004
20:00:17.159 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:00:17.165 > [ESP32][SALSA20] Full Nonce (8 bytes): 0400000000000000
20:00:17.169 > [ESP32][SALSA20] Input (first 16 bytes): 864E63E3720A5A366595BA2698F76A90
20:00:17.175 > 7_After_Salsa20 (32): D87ED7387FEA4745DEC2A125391B5D35 1B47BD8EABC77B014CA8433B9EC6DCBA 
20:00:17.184 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:00:17.189 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000004
20:00:17.195 > [ESP32] === HMAC DEBUG INFO ===
20:00:17.197 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:00:17.206 > [ESP32] HMAC Input length: 45 bytes
20:00:17.208 > [ESP32] HMAC Input (first 32 bytes): 82021700170004080300000004D87ED7387FEA4745DEC2A125391B5D351B47BD
20:00:17.217 > [ESP32] Nonce: 0x00000004
20:00:17.220 > [ESP32] Packet size before HMAC: 61
20:00:17.223 > [ESP32] Computed HMAC Tag: 67D44606EBA0C54549436A0CA87B8882
20:00:17.228 > [ESP32] === END HMAC DEBUG ===
20:00:17.231 > 6_Final_Packet (61): 82021700170004080300000004D87ED7 387FEA4745DEC2A125391B5D351B47BD ...
20:00:17.239 > [RETRY] Attempt 1/3 (nonce: 4)
20:00:17.242 > POST http://10.249.92.115:8081/health-data with pipeline data
20:00:17.245 > Sending pipeline data to server (516 bytes)
20:00:17.515 > [HTTP] Response code: 200
20:00:17.515 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:00:17.528 > [RETRY] Health data sent successfully!
20:00:17.531 > ✓ Health data #10 sent successfully
20:00:17.632 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":1,"serverTime":1770301817321,"type":"security_update"}
20:00:17.649 > [WebSocket] Processing message type: security_update
20:00:17.655 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
20:00:17.660 > [136.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:17.764 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021700170004080300000004D87ED7387FEA4745DEC2A125391B5D351B47BD8EABC77B014CA8433B9EC6DCBA67D44606EBA0C54549436A0CA87B8882","pipeline":{"afterLFSR":"864E63E3720A5A366595BA2698F76A90DB3E05AF0D77327B79FA4C71A32FF6C2","afterSalsa20":"D87ED7387FEA4745DEC2A125391B5D351B47BD8EABC77B014CA8433B9EC6DCBA","afterSalt":"48522D36332053504F322D39352053544550532D3730334D50"},"plaintext":"HR-63 SPO2-95 STEPS-703","serverTime":1770301817321,"timestamp":135773,"type":"encryption_update","ztmEnabled":true}
20:00:17.816 > [WebSocket] Processing message type: encryption_update
20:00:17.818 > [136.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:17.918 > [WebSocket] Received (87 bytes): {"heartRate":63,"spo2":95,"steps":703,"time":1770301817321,"type":"health_data_update"}
20:00:17.926 > [WebSocket] Processing message type: health_data_update
20:00:17.932 > [136.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.040 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2312,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-703","handshakeSuccess":true,"totalTime":0.2312},"type":"session_summary_update"}
20:00:18.063 > [WebSocket] Processing message type: session_summary_update
20:00:18.068 > [136.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.173 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2312,"encryptedPacket":"82021700170004080300000004D87ED7387FEA4745DEC2A125391B5D351B47BD8EABC77B014CA8433B9EC6DCBA67D44606EBA0C54549436A0CA87B8882","finalPlaintext":"HR-63 SPO2-95 STEPS-703","healthData":{"heartRate":63,"spo2":95,"steps":703},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D37303300000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D3730334D5000000000000000","afterTinkerbell":"864E63E3720A5A366595BA2698F76A90DB3E05AF0D77327B79FA4C71A32FF6C2","afterTransposition":"864E63E3720A5A366595BA2698F76A90DB3E05AF0D77327B79FA4C71A32FF6C2"},"serverTime":1770301817323,"type":"decryption_update"}
20:00:18.231 > [WebSocket] Processing message type: decryption_update
20:00:18.237 > [WebSocket] Server decryption completed
20:00:18.240 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 703
20:00:18.245 > [136.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.347 > [WebSocket] Received (555 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":9,"pipeline":{"afterLFSR":"864E63E3720A5A366595BA2698F76A90DB3E05AF0D77327B79FA4C71A32FF6C2","afterSalsa20":"D87ED7387FEA4745DEC2A125391B5D351B47BD8EABC77B014CA8433B9EC6DCBA","afterSalt":"48522D36332053504F322D39352053544550532D3730334D50","finalPacket":"82021700170004080300000004D87ED7387FEA4745DEC2A125391B5D351B47BD8EABC77B014CA8433B9EC6DCBA67D44606EBA0C54549436A0CA87B8882"},"plaintext":"HR-63 SPO2-95 STEPS-703","timestamp":136045,"type":"encryption_pipeline","ztmEnabled":true}
20:00:18.396 > [WebSocket] Processing message type: encryption_pipeline
20:00:18.402 > [136.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.510 > [WebSocket] Received (159 bytes): {"deviceId":"f9641d44","healthSendCount":9,"message":"Health data #10 sent successfully","state":7,"success":true,"timestamp":136050,"type":"health_data_sent"}
20:00:18.526 > [WebSocket] Processing message type: health_data_sent
20:00:18.529 > [137.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.631 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301817716,"threatLevel":2,"type":"heuristics_update"}
20:00:18.661 > [WebSocket] Processing message type: heuristics_update
20:00:18.664 > [137.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.775 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301818729,"threatLevel":2,"type":"heuristics_update"}
20:00:18.807 > [WebSocket] Processing message type: heuristics_update
20:00:18.810 > [137.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:18.919 > [137.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.020 > [137.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.121 > [137.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.222 > [137.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.323 > [137.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.424 > [138.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.525 > [138.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.626 > [138.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.727 > [138.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.829 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301819740,"threatLevel":2,"type":"heuristics_update"}
20:00:19.861 > [WebSocket] Processing message type: heuristics_update
20:00:19.864 > [138.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:19.973 > [138.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.074 > [138.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.174 > [138.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.276 > [138.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.376 > [138.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.477 > [139.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.579 > [139.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.679 > [139.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.782 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301820753,"threatLevel":2,"type":"heuristics_update"}
20:00:20.812 > [WebSocket] Processing message type: heuristics_update
20:00:20.814 > [139.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:20.924 > [139.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.024 > [139.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.126 > [139.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.226 > [139.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.327 > [139.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.429 > [140.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.529 > [140.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.631 > [140.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.732 > [140.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.833 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301821757,"threatLevel":2,"type":"heuristics_update"}
20:00:21.864 > [WebSocket] Processing message type: heuristics_update
20:00:21.867 > [140.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:21.976 > [140.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.077 > [140.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.178 > [140.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.279 > [140.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.379 > [140.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.480 > [141.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.582 > [141.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.682 > [141.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.784 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301822766,"threatLevel":2,"type":"heuristics_update"}
20:00:22.815 > [WebSocket] Processing message type: heuristics_update
20:00:22.818 > [141.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:22.927 > [141.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.027 > [141.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.128 > [141.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.230 > [141.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.330 > [141.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.432 > [142.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.533 > [142.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.634 > [142.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.735 > [142.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.839 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301823778,"threatLevel":2,"type":"heuristics_update"}
20:00:23.869 > [WebSocket] Processing message type: heuristics_update
20:00:23.871 > [142.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:23.981 > [142.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.081 > [142.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.182 > [142.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.284 > [142.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.385 > [142.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.485 > [143.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.587 > [143.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.688 > [143.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.788 > [143.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:24.891 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301824789,"threatLevel":2,"type":"heuristics_update"}
20:00:24.920 > [WebSocket] Processing message type: heuristics_update
20:00:24.924 > [143.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.033 > [143.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.133 > [143.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.235 > [143.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.336 > [143.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.437 > [144.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.538 > [144.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.639 > [144.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.740 > [144.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.842 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301825802,"threatLevel":2,"type":"heuristics_update"}
20:00:25.872 > [WebSocket] Processing message type: heuristics_update
20:00:25.874 > [144.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:25.984 > [144.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.085 > [144.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.186 > [144.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.287 > [144.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.387 > [144.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.488 > [145.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.589 > [145.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.691 > [145.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.791 > [145.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:26.893 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301826809,"threatLevel":2,"type":"heuristics_update"}
20:00:26.924 > [WebSocket] Processing message type: heuristics_update
20:00:26.927 > [145.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.036 > [145.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.136 > [145.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.238 > [145.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.338 > [145.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.440 > [146.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.540 > [146.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 10 | WS: CONNECTED
20:00:27.546 > [RETRY] Attempting to send health data (Max retries: 3)
20:00:27.552 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 5 for all retry attempts (saved: 4)
20:00:27.569 > Generated health data: HR-62 SPO2-95 STEPS-769
20:00:27.574 > [ESP32] ========================================
20:00:27.576 > [ESP32] ENCRYPTION PIPELINE START
20:00:27.579 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:00:27.585 > [ESP32] Active Algorithms for this packet:
20:00:27.591 > [ESP32]   + LFSR
20:00:27.591 > [ESP32]   - Tinkerbell
20:00:27.593 > [ESP32]   - Transposition
20:00:27.596 > [ESP32]   - ChaCha20
20:00:27.596 > [ESP32]   + Salsa20
20:00:27.598 > [ESP32] ========================================
20:00:27.604 > [ESP32] MsgKeys: lfsrSeed=0xBFF081F8 tnk[0..3]=E59B5C71 trn[0..3]=829D699B
20:00:27.610 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3736394D50
20:00:27.615 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3736394D5000000000000000 
20:00:27.623 > [ESP32][LFSR] Initializing - Seed: 0xBFF081F8 SeedBe: 0xF881F0BF ChaosKey[0..3]: E59B5C71 InitialTap: 0x0029 State: 0xBFF081F8
20:00:27.635 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
20:00:27.643 > 3_After_LFSR (32): B0D3DD89EEE33CDF1C0420F70842E925 22B7760EF90DF807AAC2EE4C3C3E8A15 
20:00:27.652 > [ESP32][LFSR] Keystream (first 16 bytes): F881F0BFDCC36F8F53360DCE3D62BA71
20:00:27.658 > [ESP32][4D] LFSR keystream (first 32 bytes): F881F0BFDCC36F8F53360DCE3D62BA7167E72523CE3BC14AFAC2EE4C3C3E8A15
20:00:27.666 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:00:27.671 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:00:27.676 > [ESP32][SALSA20] Initializing - Nonce: 0x00000005
20:00:27.680 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:00:27.685 > [ESP32][SALSA20] Full Nonce (8 bytes): 0500000000000000
20:00:27.690 > [ESP32][SALSA20] Input (first 16 bytes): B0D3DD89EEE33CDF1C0420F70842E925
20:00:27.696 > 7_After_Salsa20 (32): EEE36952E30321AC4E39A9DDA9AEDE80 E2CECE2F5FBDB17DBDB3F6FD01D7A06D 
20:00:27.705 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:00:27.710 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000005
20:00:27.715 > [ESP32] === HMAC DEBUG INFO ===
20:00:27.719 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:00:27.727 > [ESP32] HMAC Input length: 45 bytes
20:00:27.729 > [ESP32] HMAC Input (first 32 bytes): 82021700170004080300000005EEE36952E30321AC4E39A9DDA9AEDE80E2CECE
20:00:27.738 > [ESP32] Nonce: 0x00000005
20:00:27.740 > [ESP32] Packet size before HMAC: 61
20:00:27.743 > [ESP32] Computed HMAC Tag: E157F25C19D6B19B6848E2377D730474
20:00:27.749 > [ESP32] === END HMAC DEBUG ===
20:00:27.752 > 6_Final_Packet (61): 82021700170004080300000005EEE369 52E30321AC4E39A9DDA9AEDE80E2CECE ...
20:00:27.760 > [RETRY] Attempt 1/3 (nonce: 5)
20:00:27.763 > POST http://10.249.92.115:8081/health-data with pipeline data
20:00:27.768 > Sending pipeline data to server (516 bytes)
20:00:30.281 > [HTTP] Response code: 200
20:00:30.281 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:00:30.293 > [RETRY] Health data sent successfully!
20:00:30.295 > ✓ Health data #11 sent successfully
20:00:30.397 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301827821,"threatLevel":2,"type":"heuristics_update"}
20:00:30.427 > [WebSocket] Processing message type: heuristics_update
20:00:30.430 > [149.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:30.540 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301828821,"threatLevel":2,"type":"heuristics_update"}
20:00:30.571 > [WebSocket] Processing message type: heuristics_update
20:00:30.574 > [149.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:30.683 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301829831,"threatLevel":2,"type":"heuristics_update"}
20:00:30.713 > [WebSocket] Processing message type: heuristics_update
20:00:30.716 > [149.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:30.826 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021700170004080300000005EEE36952E30321AC4E39A9DDA9AEDE80E2CECE2F5FBDB17DBDB3F6FD01D7A06DE157F25C19D6B19B6848E2377D730474","pipeline":{"afterLFSR":"B0D3DD89EEE33CDF1C0420F70842E92522B7760EF90DF807AAC2EE4C3C3E8A15","afterSalsa20":"EEE36952E30321AC4E39A9DDA9AEDE80E2CECE2F5FBDB17DBDB3F6FD01D7A06D","afterSalt":"48522D36322053504F322D39352053544550532D3736394D50"},"plaintext":"HR-62 SPO2-95 STEPS-769","serverTime":1770301830044,"timestamp":146294,"type":"encryption_update","ztmEnabled":true}
20:00:30.876 > [WebSocket] Processing message type: encryption_update
20:00:30.879 > [149.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:30.979 > [WebSocket] Received (87 bytes): {"heartRate":62,"spo2":95,"steps":769,"time":1770301830044,"type":"health_data_update"}
20:00:30.987 > [WebSocket] Processing message type: health_data_update
20:00:30.992 > [149.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.101 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.5752,"encryptionTime":0.0,"finalPlaintext":"HR-62 SPO2-95 STEPS-769","handshakeSuccess":true,"totalTime":0.5752},"type":"session_summary_update"}
20:00:31.123 > [WebSocket] Processing message type: session_summary_update
20:00:31.128 > [149.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.233 > [WebSocket] Received (658 bytes): {"decryptionTime":0.5752,"encryptedPacket":"82021700170004080300000005EEE36952E30321AC4E39A9DDA9AEDE80E2CECE2F5FBDB17DBDB3F6FD01D7A06DE157F25C19D6B19B6848E2377D730474","finalPlaintext":"HR-62 SPO2-95 STEPS-769","healthData":{"heartRate":62,"spo2":95,"steps":769},"pipeline":{"afterDepad":"48522D36322053504F322D39352053544550532D37363900000000000000","afterLFSR":"48522D36322053504F322D39352053544550532D3736394D5000000000000000","afterTinkerbell":"B0D3DD89EEE33CDF1C0420F70842E92522B7760EF90DF807AAC2EE4C3C3E8A15","afterTransposition":"B0D3DD89EEE33CDF1C0420F70842E92522B7760EF90DF807AAC2EE4C3C3E8A15"},"serverTime":1770301830045,"type":"decryption_update"}
20:00:31.291 > [WebSocket] Processing message type: decryption_update
20:00:31.296 > [WebSocket] Server decryption completed
20:00:31.299 > [WebSocket] Health data - HR: 62, SPO2: 95, Steps: 769
20:00:31.305 > [149.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.407 > [WebSocket] Received (556 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":10,"pipeline":{"afterLFSR":"B0D3DD89EEE33CDF1C0420F70842E92522B7760EF90DF807AAC2EE4C3C3E8A15","afterSalsa20":"EEE36952E30321AC4E39A9DDA9AEDE80E2CECE2F5FBDB17DBDB3F6FD01D7A06D","afterSalt":"48522D36322053504F322D39352053544550532D3736394D50","finalPacket":"82021700170004080300000005EEE36952E30321AC4E39A9DDA9AEDE80E2CECE2F5FBDB17DBDB3F6FD01D7A06DE157F25C19D6B19B6848E2377D730474"},"plaintext":"HR-62 SPO2-95 STEPS-769","timestamp":148811,"type":"encryption_pipeline","ztmEnabled":true}
20:00:31.456 > [WebSocket] Processing message type: encryption_pipeline
20:00:31.462 > [150.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.571 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":10,"message":"Health data #11 sent successfully","state":7,"success":true,"timestamp":148815,"type":"health_data_sent"}
20:00:31.587 > [WebSocket] Processing message type: health_data_sent
20:00:31.589 > [150.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.692 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301830844,"threatLevel":2,"type":"heuristics_update"}
20:00:31.723 > [WebSocket] Processing message type: heuristics_update
20:00:31.725 > [150.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.834 > [150.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:31.936 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301831855,"threatLevel":2,"type":"heuristics_update"}
20:00:31.967 > [WebSocket] Processing message type: heuristics_update
20:00:31.970 > [150.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.078 > [150.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.180 > [150.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.280 > [150.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.382 > [150.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.482 > [151.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.583 > [151.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.685 > [151.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.785 > [151.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:32.887 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301832870,"threatLevel":2,"type":"heuristics_update"}
20:00:32.918 > [WebSocket] Processing message type: heuristics_update
20:00:32.921 > [151.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.029 > [151.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.130 > [151.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.232 > [151.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.332 > [151.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.433 > [152.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.534 > [152.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.635 > [152.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.736 > [152.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.838 > [152.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:33.942 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301833878,"threatLevel":2,"type":"heuristics_update"}
20:00:33.972 > [WebSocket] Processing message type: heuristics_update
20:00:33.975 > [152.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.083 > [152.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.185 > [152.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.286 > [152.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.387 > [152.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.488 > [153.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.589 > [153.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.690 > [153.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.790 > [153.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.891 > [153.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:34.993 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301834887,"threatLevel":2,"type":"heuristics_update"}
20:00:35.024 > [WebSocket] Processing message type: heuristics_update
20:00:35.026 > [153.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.135 > [153.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.236 > [153.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.338 > [153.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.438 > [154.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.539 > [154.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.640 > [154.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.742 > [154.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.842 > [154.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:35.944 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301835898,"threatLevel":2,"type":"heuristics_update"}
20:00:35.975 > [WebSocket] Processing message type: heuristics_update
20:00:35.977 > [154.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.087 > [154.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.187 > [154.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.288 > [154.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.388 > [154.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.490 > [155.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.592 > [155.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.692 > [155.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.793 > [155.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.894 > [155.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:36.996 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301836911,"threatLevel":2,"type":"heuristics_update"}
20:00:37.027 > [WebSocket] Processing message type: heuristics_update
20:00:37.030 > [155.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.138 > [155.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.239 > [155.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.340 > [155.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.442 > [156.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.542 > [156.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.643 > [156.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.744 > [156.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.845 > [156.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:37.947 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301837924,"threatLevel":2,"type":"heuristics_update"}
20:00:37.977 > [WebSocket] Processing message type: heuristics_update
20:00:37.980 > [156.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.089 > [156.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.190 > [156.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.292 > [156.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.392 > [156.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.492 > [157.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.594 > [157.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.695 > [157.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.796 > [157.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:38.897 > [157.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.001 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301838934,"threatLevel":2,"type":"heuristics_update"}
20:00:39.032 > [WebSocket] Processing message type: heuristics_update
20:00:39.035 > [157.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.144 > [157.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.244 > [157.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.345 > [157.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.446 > [158.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.547 > [158.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.648 > [158.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.749 > [158.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.850 > [158.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:39.952 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301839943,"threatLevel":2,"type":"heuristics_update"}
20:00:39.983 > [WebSocket] Processing message type: heuristics_update
20:00:39.985 > [158.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:40.094 > [158.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:40.195 > [158.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:40.296 > [158.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 11 | WS: CONNECTED
20:00:40.302 > [RETRY] Attempting to send health data (Max retries: 3)
20:00:40.307 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 6 for all retry attempts (saved: 5)
20:00:40.324 > Generated health data: HR-62 SPO2-95 STEPS-812
20:00:40.330 > [ESP32] ========================================
20:00:40.332 > [ESP32] ENCRYPTION PIPELINE START
20:00:40.335 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:00:40.340 > [ESP32] Active Algorithms for this packet:
20:00:40.346 > [ESP32]   + LFSR
20:00:40.346 > [ESP32]   - Tinkerbell
20:00:40.349 > [ESP32]   - Transposition
20:00:40.352 > [ESP32]   - ChaCha20
20:00:40.352 > [ESP32]   + Salsa20
20:00:40.355 > [ESP32] ========================================
20:00:40.360 > [ESP32] MsgKeys: lfsrSeed=0xEFE2F3A7 tnk[0..3]=43311FA3 trn[0..3]=2D0D6066
20:00:40.366 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3831324D50
20:00:40.371 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3831324D5000000000000000 
20:00:40.380 > [ESP32][LFSR] Initializing - Seed: 0xEFE2F3A7 SeedBe: 0xA7F3E2EF ChaosKey[0..3]: 43311FA3 InitialTap: 0x0029 State: 0xEFE2F3A7
20:00:40.390 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
20:00:40.399 > 3_After_LFSR (32): EFA1CFD96D343B1A54E7BEABAC9036D8 8B98CF7705C8D70A3DF1541F7524434E 
20:00:40.406 > [ESP32][LFSR] Keystream (first 16 bytes): A7F3E2EF5F14684A1BD5939299B0658C
20:00:40.413 > [ESP32][4D] LFSR keystream (first 32 bytes): A7F3E2EF5F14684A1BD5939299B0658CCEC89C5A3DF9E5476DF1541F7524434E
20:00:40.421 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:00:40.426 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:00:40.432 > [ESP32][SALSA20] Initializing - Nonce: 0x00000006
20:00:40.435 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:00:40.440 > [ESP32][SALSA20] Full Nonce (8 bytes): 0600000000000000
20:00:40.447 > [ESP32][SALSA20] Input (first 16 bytes): EFA1CFD96D343B1A54E7BEABAC9036D8
20:00:40.452 > 7_After_Salsa20 (32): B1917B0260D42669698F15000D7C017D 4BE17756A3789E704EB1083248CD6936 
20:00:40.460 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:00:40.465 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000006
20:00:40.471 > [ESP32] === HMAC DEBUG INFO ===
20:00:40.474 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:00:40.482 > [ESP32] HMAC Input length: 45 bytes
20:00:40.485 > [ESP32] HMAC Input (first 32 bytes): 82021700170004080300000006B1917B0260D42669698F15000D7C017D4BE177
20:00:40.494 > [ESP32] Nonce: 0x00000006
20:00:40.496 > [ESP32] Packet size before HMAC: 61
20:00:40.499 > [ESP32] Computed HMAC Tag: D0BE8E0DB94CFDAE15D0B46AA230545D
20:00:40.505 > [ESP32] === END HMAC DEBUG ===
20:00:40.506 > 6_Final_Packet (61): 82021700170004080300000006B1917B 0260D42669698F15000D7C017D4BE177 ...
20:00:40.516 > [RETRY] Attempt 1/3 (nonce: 6)
20:00:40.518 > POST http://10.249.92.115:8081/health-data with pipeline data
20:00:40.523 > Sending pipeline data to server (516 bytes)
20:00:40.832 > [HTTP] Response code: 200
20:00:40.832 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:00:40.844 > [RETRY] Health data sent successfully!
20:00:40.846 > ✓ Health data #12 sent successfully
20:00:40.949 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021700170004080300000006B1917B0260D42669698F15000D7C017D4BE17756A3789E704EB1083248CD6936D0BE8E0DB94CFDAE15D0B46AA230545D","pipeline":{"afterLFSR":"EFA1CFD96D343B1A54E7BEABAC9036D88B98CF7705C8D70A3DF1541F7524434E","afterSalsa20":"B1917B0260D42669698F15000D7C017D4BE17756A3789E704EB1083248CD6936","afterSalt":"48522D36322053504F322D39352053544550532D3831324D50"},"plaintext":"HR-62 SPO2-95 STEPS-812","serverTime":1770301840700,"timestamp":159050,"type":"encryption_update","ztmEnabled":true}
20:00:40.999 > [WebSocket] Processing message type: encryption_update
20:00:41.002 > [159.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.102 > [WebSocket] Received (87 bytes): {"heartRate":62,"spo2":95,"steps":812,"time":1770301840700,"type":"health_data_update"}
20:00:41.112 > [WebSocket] Processing message type: health_data_update
20:00:41.116 > [159.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.224 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2508,"encryptionTime":0.0,"finalPlaintext":"HR-62 SPO2-95 STEPS-812","handshakeSuccess":true,"totalTime":0.2508},"type":"session_summary_update"}
20:00:41.246 > [WebSocket] Processing message type: session_summary_update
20:00:41.252 > [159.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.357 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2508,"encryptedPacket":"82021700170004080300000006B1917B0260D42669698F15000D7C017D4BE17756A3789E704EB1083248CD6936D0BE8E0DB94CFDAE15D0B46AA230545D","finalPlaintext":"HR-62 SPO2-95 STEPS-812","healthData":{"heartRate":62,"spo2":95,"steps":812},"pipeline":{"afterDepad":"48522D36322053504F322D39352053544550532D38313200000000000000","afterLFSR":"48522D36322053504F322D39352053544550532D3831324D5000000000000000","afterTinkerbell":"EFA1CFD96D343B1A54E7BEABAC9036D88B98CF7705C8D70A3DF1541F7524434E","afterTransposition":"EFA1CFD96D343B1A54E7BEABAC9036D88B98CF7705C8D70A3DF1541F7524434E"},"serverTime":1770301840700,"type":"decryption_update"}
20:00:41.416 > [WebSocket] Processing message type: decryption_update
20:00:41.421 > [WebSocket] Server decryption completed
20:00:41.424 > [WebSocket] Health data - HR: 62, SPO2: 95, Steps: 812
20:00:41.429 > [159.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.530 > [WebSocket] Received (556 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":11,"pipeline":{"afterLFSR":"EFA1CFD96D343B1A54E7BEABAC9036D88B98CF7705C8D70A3DF1541F7524434E","afterSalsa20":"B1917B0260D42669698F15000D7C017D4BE17756A3789E704EB1083248CD6936","afterSalt":"48522D36322053504F322D39352053544550532D3831324D50","finalPacket":"82021700170004080300000006B1917B0260D42669698F15000D7C017D4BE17756A3789E704EB1083248CD6936D0BE8E0DB94CFDAE15D0B46AA230545D"},"plaintext":"HR-62 SPO2-95 STEPS-812","timestamp":159363,"type":"encryption_pipeline","ztmEnabled":true}
20:00:41.583 > [WebSocket] Processing message type: encryption_pipeline
20:00:41.592 > [160.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.693 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":11,"message":"Health data #12 sent successfully","state":7,"success":true,"timestamp":159367,"type":"health_data_sent"}
20:00:41.711 > [WebSocket] Processing message type: health_data_sent
20:00:41.712 > [160.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.814 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301840956,"threatLevel":2,"type":"heuristics_update"}
20:00:41.845 > [WebSocket] Processing message type: heuristics_update
20:00:41.849 > [160.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:41.958 > [160.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.062 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301841958,"threatLevel":2,"type":"heuristics_update"}
20:00:42.093 > [WebSocket] Processing message type: heuristics_update
20:00:42.095 > [160.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.204 > [160.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.305 > [160.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.406 > [160.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.506 > [161.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.608 > [161.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.708 > [161.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.810 > [161.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:42.910 > [161.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.013 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301842966,"threatLevel":2,"type":"heuristics_update"}
20:00:43.044 > [WebSocket] Processing message type: heuristics_update
20:00:43.046 > [161.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.154 > [161.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.256 > [161.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.357 > [161.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.458 > [162.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.559 > [162.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.660 > [162.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.761 > [162.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.862 > [162.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:43.963 > [162.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.064 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301843977,"threatLevel":2,"type":"heuristics_update"}
20:00:44.096 > [WebSocket] Processing message type: heuristics_update
20:00:44.098 > [162.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.207 > [162.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.308 > [162.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.409 > [162.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.510 > [163.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.611 > [163.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.711 > [163.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.814 > [163.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:44.914 > [163.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.016 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301844989,"threatLevel":2,"type":"heuristics_update"}
20:00:45.047 > [WebSocket] Processing message type: heuristics_update
20:00:45.049 > [163.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.158 > [163.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.259 > [163.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.360 > [163.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.461 > [164.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.562 > [164.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.663 > [164.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.764 > [164.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.865 > [164.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:45.966 > [164.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.068 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301846002,"threatLevel":2,"type":"heuristics_update"}
20:00:46.098 > [WebSocket] Processing message type: heuristics_update
20:00:46.101 > [164.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.210 > [164.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.311 > [164.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.412 > [164.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.513 > [165.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.614 > [165.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.715 > [165.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.816 > [165.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:46.917 > [165.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.021 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301847006,"threatLevel":2,"type":"heuristics_update"}
20:00:47.051 > [WebSocket] Processing message type: heuristics_update
20:00:47.055 > [165.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.163 > [165.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.264 > [165.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.365 > [165.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.466 > [166.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.567 > [166.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.668 > [166.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.769 > [166.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.870 > [166.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:47.970 > [166.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.073 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301848017,"threatLevel":2,"type":"heuristics_update"}
20:00:48.103 > [WebSocket] Processing message type: heuristics_update
20:00:48.106 > [166.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.215 > [166.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.316 > [166.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.417 > [166.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.518 > [167.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.619 > [167.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.720 > [167.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.821 > [167.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:48.921 > [167.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.023 > [167.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.125 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301849027,"threatLevel":2,"type":"heuristics_update"}
20:00:49.154 > [WebSocket] Processing message type: heuristics_update
20:00:49.158 > [167.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.267 > [167.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.368 > [167.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.468 > [168.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.570 > [168.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.671 > [168.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.772 > [168.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.873 > [168.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:49.974 > [168.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.075 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301850037,"threatLevel":2,"type":"heuristics_update"}
20:00:50.106 > [WebSocket] Processing message type: heuristics_update
20:00:50.109 > [168.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.218 > [168.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.319 > [168.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.419 > [168.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.521 > [169.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.622 > [169.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.722 > [169.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.824 > [169.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.924 > [169.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 12 | WS: CONNECTED
20:00:50.931 > [RETRY] Attempting to send health data (Max retries: 3)
20:00:50.936 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=21474836481\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 7 for all retry attempts (saved: 6)
20:00:50.953 > Generated health data: HR-62 SPO2-95 STEPS-879
20:00:50.958 > [ESP32] ========================================
20:00:50.961 > [ESP32] ENCRYPTION PIPELINE START
20:00:50.964 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:00:50.969 > [ESP32] Active Algorithms for this packet:
20:00:50.975 > [ESP32]   + LFSR
20:00:50.975 > [ESP32]   - Tinkerbell
20:00:50.977 > [ESP32]   - Transposition
20:00:50.981 > [ESP32]   - ChaCha20
20:00:50.981 > [ESP32]   + Salsa20
20:00:50.983 > [ESP32] ========================================
20:00:50.989 > [ESP32] MsgKeys: lfsrSeed=0x6D2BB043 tnk[0..3]=4C182D02 trn[0..3]=A76E952F
20:00:50.994 > 1_After_Salt (25): 48522D36322053504F322D3935205354 4550532D3837394D50
20:00:50.999 > 2_After_Padding (32): 48522D36322053504F322D3935205354 4550532D3837394D5000000000000000 
20:00:51.008 > [ESP32][LFSR] Initializing - Seed: 0x6D2BB043 SeedBe: 0x43B02B6D ChaosKey[0..3]: 4C182D02 InitialTap: 0x0029 State: 0x6D2BB043
20:00:51.019 > [ESP32][LFSR] Input (first 16 bytes): 48522D36322053504F322D3935205354 Buffer size: 32 bytes
20:00:51.028 > 3_After_LFSR (32): 0BE2065B0432A5D0BB0EFDC24E32C23A 5A5088D434F521B34A61C2B9499E4F45 
20:00:51.036 > [ESP32][LFSR] Keystream (first 16 bytes): 43B02B6D3612F680F43CD0FB7B12916E
20:00:51.041 > [ESP32][4D] LFSR keystream (first 32 bytes): 43B02B6D3612F680F43CD0FB7B12916E1F00DBF90CC218FE1A61C2B9499E4F45
20:00:51.050 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:00:51.056 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:00:51.061 > [ESP32][SALSA20] Initializing - Nonce: 0x00000007
20:00:51.064 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:00:51.069 > [ESP32][SALSA20] Full Nonce (8 bytes): 0700000000000000
20:00:51.074 > [ESP32][SALSA20] Input (first 16 bytes): 0BE2065B0432A5D0BB0EFDC24E32C23A
20:00:51.081 > 7_After_Salsa20 (32): 55D2B28009D2B8A35F7BC714EFDEF59F 9A2930F5924568C971FF0D0D7477653D 
20:00:51.088 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:00:51.094 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000007
20:00:51.099 > [ESP32] === HMAC DEBUG INFO ===
20:00:51.102 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:00:51.111 > [ESP32] HMAC Input length: 45 bytes
20:00:51.114 > [ESP32] HMAC Input (first 32 bytes): 8202170017000408030000000755D2B28009D2B8A35F7BC714EFDEF59F9A2930
20:00:51.122 > [ESP32] Nonce: 0x00000007
20:00:51.125 > [ESP32] Packet size before HMAC: 61
20:00:51.127 > [ESP32] Computed HMAC Tag: 55E230D0551DAA8AB6C4A4B665B73B52
20:00:51.133 > [ESP32] === END HMAC DEBUG ===
20:00:51.136 > 6_Final_Packet (61): 8202170017000408030000000755D2B2 8009D2B8A35F7BC714EFDEF59F9A2930 ...
20:00:51.144 > [RETRY] Attempt 1/3 (nonce: 7)
20:00:51.147 > POST http://10.249.92.115:8081/health-data with pipeline data
20:00:51.152 > Sending pipeline data to server (516 bytes)
20:00:51.381 > [HTTP] Response code: 200
20:00:51.381 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:00:51.393 > [RETRY] Health data sent successfully!
20:00:51.396 > ✓ Health data #13 sent successfully
20:00:51.498 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":6,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301851048,"threatLevel":2,"type":"heuristics_update"}
20:00:51.528 > [WebSocket] Processing message type: heuristics_update
20:00:51.532 > [170.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:51.641 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":4,"serverTime":1770301851227,"type":"security_update"}
20:00:51.658 > [WebSocket] Processing message type: security_update
20:00:51.663 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
20:00:51.669 > [170.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:51.773 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202170017000408030000000755D2B28009D2B8A35F7BC714EFDEF59F9A2930F5924568C971FF0D0D7477653D55E230D0551DAA8AB6C4A4B665B73B52","pipeline":{"afterLFSR":"0BE2065B0432A5D0BB0EFDC24E32C23A5A5088D434F521B34A61C2B9499E4F45","afterSalsa20":"55D2B28009D2B8A35F7BC714EFDEF59F9A2930F5924568C971FF0D0D7477653D","afterSalt":"48522D36322053504F322D39352053544550532D3837394D50"},"plaintext":"HR-62 SPO2-95 STEPS-879","serverTime":1770301851227,"timestamp":169680,"type":"encryption_update","ztmEnabled":true}
20:00:51.824 > [WebSocket] Processing message type: encryption_update
20:00:51.826 > [170.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:51.936 > [WebSocket] Received (87 bytes): {"heartRate":62,"spo2":95,"steps":879,"time":1770301851227,"type":"health_data_update"}
20:00:51.944 > [WebSocket] Processing message type: health_data_update
20:00:51.950 > [170.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.058 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2491,"encryptionTime":0.0,"finalPlaintext":"HR-62 SPO2-95 STEPS-879","handshakeSuccess":true,"totalTime":0.2491},"type":"session_summary_update"}
20:00:52.080 > [WebSocket] Processing message type: session_summary_update
20:00:52.086 > [170.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.191 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2491,"encryptedPacket":"8202170017000408030000000755D2B28009D2B8A35F7BC714EFDEF59F9A2930F5924568C971FF0D0D7477653D55E230D0551DAA8AB6C4A4B665B73B52","finalPlaintext":"HR-62 SPO2-95 STEPS-879","healthData":{"heartRate":62,"spo2":95,"steps":879},"pipeline":{"afterDepad":"48522D36322053504F322D39352053544550532D38373900000000000000","afterLFSR":"48522D36322053504F322D39352053544550532D3837394D5000000000000000","afterTinkerbell":"0BE2065B0432A5D0BB0EFDC24E32C23A5A5088D434F521B34A61C2B9499E4F45","afterTransposition":"0BE2065B0432A5D0BB0EFDC24E32C23A5A5088D434F521B34A61C2B9499E4F45"},"serverTime":1770301851228,"type":"decryption_update"}
20:00:52.250 > [WebSocket] Processing message type: decryption_update
20:00:52.255 > [WebSocket] Server decryption completed
20:00:52.258 > [WebSocket] Health data - HR: 62, SPO2: 95, Steps: 879
20:00:52.262 > [170.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.364 > [WebSocket] Received (556 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":12,"pipeline":{"afterLFSR":"0BE2065B0432A5D0BB0EFDC24E32C23A5A5088D434F521B34A61C2B9499E4F45","afterSalsa20":"55D2B28009D2B8A35F7BC714EFDEF59F9A2930F5924568C971FF0D0D7477653D","afterSalt":"48522D36322053504F322D39352053544550532D3837394D50","finalPacket":"8202170017000408030000000755D2B28009D2B8A35F7BC714EFDEF59F9A2930F5924568C971FF0D0D7477653D55E230D0551DAA8AB6C4A4B665B73B52"},"plaintext":"HR-62 SPO2-95 STEPS-879","timestamp":169912,"type":"encryption_pipeline","ztmEnabled":true}
20:00:52.415 > [WebSocket] Processing message type: encryption_pipeline
20:00:52.421 > [170.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.527 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":12,"message":"Health data #13 sent successfully","state":7,"success":true,"timestamp":169917,"type":"health_data_sent"}
20:00:52.543 > [WebSocket] Processing message type: health_data_sent
20:00:52.546 > [171.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.652 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":10,"lastCommitNonce":21474836481,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301852057,"threatLevel":2,"type":"heuristics_update"}
20:00:52.682 > [WebSocket] Processing message type: heuristics_update
20:00:52.685 > [171.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.794 > [171.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.895 > [171.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:52.995 > [171.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.097 > [WebSocket] Received (251 bytes): {"payload":{"epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","proposedAt":"2026-02-05T14:30:53Z","targetRecipe":"CHAOS_ONLY"},"signature":"8195dd29ea789fa7ef1157a3e51587b68d8d2091dea8c961bb2dc58cc783a7ae","type":"switch_propose"}
20:00:53.120 > [WebSocket] Processing message type: switch_propose
20:00:53.125 > [WS_RX] switch_propose (new format) proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f targetRecipe=CHAOS_ONLY epoch=11
20:00:53.137 > [ZTM] Master key is zero - reloading from NVS
20:00:53.139 > [ZTM] Successfully reloaded master key from NVS
20:00:53.145 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:00:53.150 > [ZTM] HMAC verify: canonical={"epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","proposedAt":"2026-02-05T14:30:53Z","targetRecipe":"CHAOS_ONLY"}
20:00:53.164 > [ZTM] HMAC verify: computed=8195dd29ea789fa7ef1157a3e51587b68d8d2091dea8c961bb2dc58cc783a7ae expected=8195dd29ea789fa7ef1157a3e51587b68d8d2091dea8c961bb2dc58cc783a7ae
20:00:53.181 > [EPOCH_UPDATE] Updating from 5 to 11 (from switch_propose)\n[ACK_SENT] proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f epoch=11 lastSeenNonce=0
20:00:53.197 > [ACK_SENT] payload={"deviceId":"f9641d44","epoch":11,"lastSeenNonce":0,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","ready":true} signature=c465c6224ee2db18a670fdf52b70cb50fc576e30eb20a1e2e64731060fcf5815
20:00:53.217 > [PROPOSE_ACCEPT] proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f epoch=11 targetRecipe=CHAOS_ONLY\n[171.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.335 > [WebSocket] Received (211 bytes): {"pending":true,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","reason":"Manual switch request","recipe":"CHAOS_ONLY","serverTime":1770301853034,"success":true,"type":"adaptive_switch_acknowledged"}
20:00:53.354 > [WebSocket] Processing message type: adaptive_switch_acknowledged
20:00:53.360 > [WebSocket] ========================================
20:00:53.365 > [WebSocket] Received message type: adaptive_switch_acknowledged
20:00:53.371 > [WebSocket] Mode from message: 'ztm'
20:00:53.374 > [WebSocket] Recipe from message: 'CHAOS_ONLY'
20:00:53.379 > [WebSocket] Current gZTMEnabled: TRUE
20:00:53.382 > [WebSocket] Current gCurrentMode: ZTM
20:00:53.385 > [WebSocket] Current gCurrentRecipe: SALSA_LIGHT
20:00:53.387 > [WebSocket] ========================================
20:00:53.393 > [WebSocket] Parsed newMode: ZTM, newRecipe: CHAOS_ONLY
20:00:53.398 > [WebSocket] Waiting for switch_propose from server for recipe CHAOS_ONLY
20:00:53.404 > [171.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.505 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":21474836481,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301853058,"threatLevel":2,"type":"heuristics_update"}
20:00:53.535 > [WebSocket] Processing message type: heuristics_update
20:00:53.538 > [172.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.648 > [WebSocket] Received (249 bytes): {"payload":{"commitNonce":47244640257,"committedAt":"2026-02-05T14:30:53Z","epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f"},"signature":"88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf","type":"switch_commit"}
20:00:53.669 > [WebSocket] Processing message type: switch_commit
20:00:53.675 > [WS_RX] switch_commit (new format) proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f commitNonce=47244640257
20:00:53.686 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:00:53.691 > [ZTM] HMAC verify: canonical={"commitNonce":47244640257,"committedAt":"2026-02-05T14:30:53Z","epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f"}
20:00:53.706 > [ZTM] HMAC verify: computed=88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf expected=88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf
20:00:53.719 > [COMMIT_RECEIVED] proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f commitNonce=47244640257 epoch=11
20:00:53.728 > [172.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.835 > [WebSocket] Received (117 bytes): {"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","serverTime":1770301853190,"type":"switch_ack_received"}
20:00:53.846 > [WebSocket] Processing message type: switch_ack_received
20:00:53.852 > [172.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:53.957 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":13,"message":"Mode: ztm, Recipe: CHAOS_ONLY","state":7,"success":true,"timestamp":171928,"type":"mode_changed_pending"}
20:00:53.974 > [WebSocket] Processing message type: mode_changed_pending
20:00:53.976 > [172.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.082 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301854065,"threatLevel":2,"type":"heuristics_update"}
20:00:54.112 > [WebSocket] Processing message type: heuristics_update
20:00:54.115 > [172.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.225 > [172.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.326 > [172.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.426 > [173.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.528 > [173.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.628 > [173.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.729 > [173.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.831 > [173.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:54.931 > [173.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.032 > [173.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.135 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301855072,"threatLevel":2,"type":"heuristics_update"}
20:00:55.165 > [WebSocket] Processing message type: heuristics_update
20:00:55.168 > [173.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.276 > [173.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.377 > [173.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.479 > [174.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.580 > [174.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.681 > [174.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.782 > [174.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.883 > [174.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:55.984 > [174.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.085 > [174.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.186 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301856084,"threatLevel":2,"type":"heuristics_update"}
20:00:56.217 > [WebSocket] Processing message type: heuristics_update
20:00:56.220 > [174.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.329 > [174.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.430 > [175.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.530 > [175.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.632 > [175.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.733 > [175.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.833 > [175.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:56.935 > [175.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.036 > [175.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.137 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301857094,"threatLevel":2,"type":"heuristics_update"}
20:00:57.168 > [WebSocket] Processing message type: heuristics_update
20:00:57.171 > [175.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.280 > [175.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.381 > [175.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.481 > [176.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.583 > [176.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.684 > [176.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.785 > [176.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.886 > [176.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:57.986 > [176.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.088 > [176.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.189 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301858107,"threatLevel":2,"type":"heuristics_update"}
20:00:58.220 > [WebSocket] Processing message type: heuristics_update
20:00:58.223 > [176.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.331 > [176.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.433 > [177.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.533 > [177.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.635 > [177.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.735 > [177.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.837 > [177.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:58.938 > [177.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.039 > [177.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.142 > [WebSocket] Received (249 bytes): {"payload":{"commitNonce":47244640257,"committedAt":"2026-02-05T14:30:53Z","epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f"},"signature":"88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf","type":"switch_commit"}
20:00:59.165 > [WebSocket] Processing message type: switch_commit
20:00:59.170 > [WS_RX] switch_commit (new format) proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f commitNonce=47244640257
20:00:59.182 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:00:59.187 > [ZTM] HMAC verify: canonical={"commitNonce":47244640257,"committedAt":"2026-02-05T14:30:53Z","epoch":11,"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f"}
20:00:59.200 > [ZTM] HMAC verify: computed=88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf expected=88cbee8532614c43367f7e597bbdf8a9eb5408569177eb612d441e8bbf88bacf
20:00:59.215 > [COMMIT_RECEIVED] proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f commitNonce=47244640257 epoch=11
20:00:59.223 > [177.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.329 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301859119,"threatLevel":2,"type":"heuristics_update"}
20:00:59.359 > [WebSocket] Processing message type: heuristics_update
20:00:59.363 > [177.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.472 > [178.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.572 > [178.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.674 > [178.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.775 > [178.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.876 > [178.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:00:59.977 > [178.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.077 > [178.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.179 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301860129,"threatLevel":2,"type":"heuristics_update"}
20:01:00.210 > [WebSocket] Processing message type: heuristics_update
20:01:00.213 > [178.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.322 > [178.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.423 > [179.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.524 > [179.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.625 > [179.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.725 > [179.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.827 > [179.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:00.927 > [179.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.029 > [179.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.130 > [179.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.231 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":7,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301861141,"threatLevel":2,"type":"heuristics_update"}
20:01:01.262 > [WebSocket] Processing message type: heuristics_update
20:01:01.265 > [179.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.374 > [179.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.474 > [180.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 13 | WS: CONNECTED
20:01:01.481 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:01.486 > [BOUNDARY_CHECK] SwitchState=3 PendingActive=1 CommitNonce=47244640257\n[BOUNDARY_CHECK] nextTxNonce=47244640257 commitNonce=47244640257 (epoch=11 packet=1)\n[SWITCH] commit boundary reached — applying recipe proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f
20:01:01.510 > [SWITCH] applyRecipe: CHAOS_ONLY
20:01:01.513 > [ZTM] Settings saved successfully
20:01:01.517 > [SWITCH] Protocol complete — returning to NORMAL state. Applied recipe at nonce: 47244640257
20:01:01.528 > [DONE_SENT] proposalId=d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f commitNonce=47244640257 epoch=11
20:01:01.536 > [SWITCH_DONE] Recipe switch completed at nonce=47244640257
20:01:01.542 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
20:01:01.545 > Generated health data: HR-63 SPO2-95 STEPS-904
20:01:01.550 > [ESP32] ========================================
20:01:01.554 > [ESP32] ENCRYPTION PIPELINE START
20:01:01.556 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: CHAOS_ONLY
20:01:01.562 > [ESP32] Active Algorithms for this packet:
20:01:01.567 > [ESP32]   + LFSR
20:01:01.567 > [ESP32]   + Tinkerbell
20:01:01.570 > [ESP32]   + Transposition
20:01:01.573 > [ESP32]   - ChaCha20
20:01:01.573 > [ESP32]   - Salsa20
20:01:01.576 > [ESP32] ========================================
20:01:01.578 > [ESP32] MsgKeys: lfsrSeed=0x2B84CD17 tnk[0..3]=A8C70EC8 trn[0..3]=1EF8F705
20:01:01.586 > 1_After_Salt (25): 48522D36332053504F322D3935205354 4550532D3930344D50
20:01:01.592 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D3930344D5000000000000000 
20:01:01.601 > [ESP32][LFSR] Initializing - Seed: 0x2B84CD17 SeedBe: 0x17CD842B ChaosKey[0..3]: A8C70EC8 InitialTap: 0x0029 State: 0x2B84CD17
20:01:01.612 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:01.620 > 3_After_LFSR (32): 5F9FA91DAE4F65011EA66A2F037571D6 3C5AAEF68D4F57B5E05FEC0EDBEF8FB7 
20:01:01.626 > [ESP32][LFSR] Keystream (first 16 bytes): 17CD842B9D6F36515194471636552282
20:01:01.634 > [ESP32][4D] LFSR keystream (first 32 bytes): 17CD842B9D6F36515194471636552282790AFDDBB47F63F8B05FEC0EDBEF8FB7
20:01:01.642 > [ESP32][TINKERBELL] Input (first 16 bytes): 5F9FA91DAE4F65011EA66A2F037571D6 Nonce: 0x00000001 Buffer size: 32 bytes
20:01:01.654 > [ESP32][TINKERBELL] Generating keystream block - Nonce: 0x00000001 Counter: 0 (must start at 0) Key[0..3]: A8C70EC8
20:01:01.665 > [ESP32][TINKERBELL] Keystream block[0] (first 16 bytes): E34E6701B9123F71A3F8D03D83314B4B
20:01:01.670 > 4_After_Tinkerbell (32): BCD1CE1C175D5A70BD5EBA1280443A9D 322E67639902968552C67F0C015BB78E 
20:01:01.677 > [ESP32][TINKERBELL] Applied keystream (first 16 bytes): E34E6701B9123F71A3F8D03D83314B4B
20:01:01.687 > [ESP32][4D] Tinkerbell keystream (first 32 bytes): E34E6701B9123F71A3F8D03D83314B4B0E74C995144DC130B2999302DAB43839
20:01:01.698 > 5_After_Transposition (32): 7F8012CE992E5EB71C965D520217D185 443263BD5A8E67700CBAC601BC5B3A9D 
20:01:01.707 > [ESP32][4B] recipeId=4 (CHAOS_ONLY) nonce=0x00000001
20:01:01.712 > [ESP32] === HMAC DEBUG INFO ===
20:01:01.715 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:01.720 > [ESP32] HMAC Input length: 45 bytes
20:01:01.725 > [ESP32] HMAC Input (first 32 bytes): 820217001700040804000000017F8012CE992E5EB71C965D520217D185443263
20:01:01.734 > [ESP32] Nonce: 0x00000001
20:01:01.737 > [ESP32] Packet size before HMAC: 61
20:01:01.739 > [ESP32] Computed HMAC Tag: 9BE59EDAB6BCA0DD6020C27F38D898D0
20:01:01.745 > [ESP32] === END HMAC DEBUG ===
20:01:01.747 > 6_Final_Packet (61): 820217001700040804000000017F8012 CE992E5EB71C965D520217D185443263 ...
20:01:01.756 > [RETRY] Attempt 1/3 (nonce: 1)
20:01:01.756 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:01.762 > Sending pipeline data to server (606 bytes)
20:01:01.901 > [HTTP] Response code: 200
20:01:01.901 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:01:01.917 > [RETRY] Health data sent successfully!
20:01:01.920 > ✓ Health data #14 sent successfully
20:01:02.021 > [WebSocket] Received (423 bytes): {"activatedAt":1770301731830,"active":true,"epoch":11,"heuristics":{"cpuUsage":20.0,"decryptFailures":0,"entropy":6.8,"hmacFailures":0,"latency":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"lastCommitNonce":47244640257,"lastSeenNonce":7,"lastSwitchReason":"Committed via switch_done","pendingProposals":0,"recipe":"CHAOS_ONLY","serverTime":1770301861532,"threatLevel":2,"type":"active_recipe_updated"}
20:01:02.060 > [WebSocket] Processing message type: active_recipe_updated
20:01:02.066 > [180.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.165 > [WebSocket] Received (135 bytes): {"proposalId":"d68c65c0-83d8-4293-94e1-000000dfaacc3f54a43f","serverTime":1770301861532,"status":"committed","type":"switch_committed"}
20:01:02.179 > [WebSocket] Processing message type: switch_committed
20:01:02.184 > [180.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.287 > [WebSocket] Received (633 bytes): {"currentRecipe":"CHAOS_ONLY","encData":"ENC_DATA:820217001700040804000000017F8012CE992E5EB71C965D520217D185443263BD5A8E67700CBAC601BC5B3A9D9BE59EDAB6BCA0DD6020C27F38D898D0","pipeline":{"afterLFSR":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4F57B5E05FEC0EDBEF8FB7","afterSalt":"48522D36332053504F322D39352053544550532D3930344D50","afterTinkerbell":"BCD1CE1C175D5A70BD5EBA1280443A9D322E67639902968552C67F0C015BB78E","afterTransposition":"7F8012CE992E5EB71C965D520217D185443263BD5A8E67700CBAC601BC5B3A9D"},"plaintext":"HR-63 SPO2-95 STEPS-904","serverTime":1770301861833,"timestamp":180286,"type":"encryption_update","ztmEnabled":true}
20:01:02.342 > [WebSocket] Processing message type: encryption_update
20:01:02.348 > [180.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.450 > [WebSocket] Received (87 bytes): {"heartRate":63,"spo2":95,"steps":904,"time":1770301861833,"type":"health_data_update"}
20:01:02.458 > [WebSocket] Processing message type: health_data_update
20:01:02.464 > [181.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.573 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2796,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-904","handshakeSuccess":true,"totalTime":0.2796},"type":"session_summary_update"}
20:01:02.595 > [WebSocket] Processing message type: session_summary_update
20:01:02.600 > [181.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.705 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2796,"encryptedPacket":"820217001700040804000000017F8012CE992E5EB71C965D520217D185443263BD5A8E67700CBAC601BC5B3A9D9BE59EDAB6BCA0DD6020C27F38D898D0","finalPlaintext":"HR-63 SPO2-95 STEPS-904","healthData":{"heartRate":63,"spo2":95,"steps":904},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D39303400000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D3930344D5000000000000000","afterTinkerbell":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4F57B5E05FEC0EDBEF8FB7","afterTransposition":"BCD1CE1C175D5A70BD5EBA1280443A9D322E67639902968552C67F0C015BB78E"},"serverTime":1770301861834,"type":"decryption_update"}
20:01:02.764 > [WebSocket] Processing message type: decryption_update
20:01:02.769 > [WebSocket] Server decryption completed
20:01:02.772 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 904
20:01:02.777 > [181.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:02.879 > [WebSocket] Received (646 bytes): {"currentRecipe":"CHAOS_ONLY","deviceId":"f9641d44","healthSendCount":13,"pipeline":{"afterLFSR":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4F57B5E05FEC0EDBEF8FB7","afterSalt":"48522D36332053504F322D39352053544550532D3930344D50","afterTinkerbell":"BCD1CE1C175D5A70BD5EBA1280443A9D322E67639902968552C67F0C015BB78E","afterTransposition":"7F8012CE992E5EB71C965D520217D185443263BD5A8E67700CBAC601BC5B3A9D","finalPacket":"820217001700040804000000017F8012CE992E5EB71C965D520217D185443263BD5A8E67700CBAC601BC5B3A9D9BE59EDAB6BCA0DD6020C27F38D898D0"},"plaintext":"HR-63 SPO2-95 STEPS-904","timestamp":180432,"type":"encryption_pipeline","ztmEnabled":true}
20:01:02.937 > [WebSocket] Processing message type: encryption_pipeline
20:01:02.943 > [181.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.045 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":13,"message":"Health data #14 sent successfully","state":7,"success":true,"timestamp":180437,"type":"health_data_sent"}
20:01:03.061 > [WebSocket] Processing message type: health_data_sent
20:01:03.064 > [181.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.167 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301862154,"threatLevel":2,"type":"heuristics_update"}
20:01:03.198 > [WebSocket] Processing message type: heuristics_update
20:01:03.200 > [181.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.310 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301863166,"threatLevel":2,"type":"heuristics_update"}
20:01:03.341 > [WebSocket] Processing message type: heuristics_update
20:01:03.343 > [181.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.453 > [182.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.554 > [182.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.655 > [182.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.756 > [182.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.857 > [182.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:03.958 > [182.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.057 > [182.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.160 > [182.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.261 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301864177,"threatLevel":2,"type":"heuristics_update"}
20:01:04.291 > [WebSocket] Processing message type: heuristics_update
20:01:04.295 > [182.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.404 > [182.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.504 > [183.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.606 > [183.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.706 > [183.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.808 > [183.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:04.908 > [183.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.009 > [183.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.110 > [183.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.212 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301865189,"threatLevel":2,"type":"heuristics_update"}
20:01:05.242 > [WebSocket] Processing message type: heuristics_update
20:01:05.245 > [183.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.355 > [183.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.456 > [184.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.557 > [184.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.658 > [184.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.758 > [184.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.860 > [184.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:05.961 > [184.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.061 > [184.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.162 > [184.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.265 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":11,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301866201,"threatLevel":2,"type":"heuristics_update"}
20:01:06.295 > [WebSocket] Processing message type: heuristics_update
20:01:06.298 > [184.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.407 > [184.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.508 > [185.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.608 > [185.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.709 > [185.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.811 > [185.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:06.912 > [185.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.012 > [185.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.114 > [185.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.214 > [185.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.318 > [WebSocket] Received (252 bytes): {"payload":{"epoch":12,"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce","proposedAt":"2026-02-05T14:31:07Z","targetRecipe":"SALSA_LIGHT"},"signature":"bfbfa38cad714dd5f06fa5b215daa8693a055f83f7df26f12c42c2060d918508","type":"switch_propose"}
20:01:07.341 > [WebSocket] Processing message type: switch_propose
20:01:07.346 > [WS_RX] switch_propose (new format) proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce targetRecipe=SALSA_LIGHT epoch=12
20:01:07.357 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:07.363 > [ZTM] HMAC verify: canonical={"epoch":12,"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce","proposedAt":"2026-02-05T14:31:07Z","targetRecipe":"SALSA_LIGHT"}
20:01:07.376 > [ZTM] HMAC verify: computed=bfbfa38cad714dd5f06fa5b215daa8693a055f83f7df26f12c42c2060d918508 expected=bfbfa38cad714dd5f06fa5b215daa8693a055f83f7df26f12c42c2060d918508
20:01:07.393 > [EPOCH_UPDATE] Updating from 11 to 12 (from switch_propose)\n[ACK_SENT] proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce epoch=12 lastSeenNonce=0
20:01:07.406 > [ACK_SENT] payload={"deviceId":"f9641d44","epoch":12,"lastSeenNonce":0,"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce","ready":true} signature=3b5eaa754d99ad859b4a47f514809c4653a80805133c897d5fb922958a53b67b
20:01:07.425 > [PROPOSE_ACCEPT] proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce epoch=12 targetRecipe=SALSA_LIGHT\n[186.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.545 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":12,"lastCommitNonce":47244640257,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301867218,"threatLevel":2,"type":"heuristics_update"}
20:01:07.575 > [WebSocket] Processing message type: heuristics_update
20:01:07.577 > [186.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.688 > [WebSocket] Received (249 bytes): {"payload":{"commitNonce":51539607553,"committedAt":"2026-02-05T14:31:07Z","epoch":12,"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce"},"signature":"17884f8ea1f52b925ef3cc9b28e649d296e1492868c3dc7df4800e0f84ee55d8","type":"switch_commit"}
20:01:07.710 > [WebSocket] Processing message type: switch_commit
20:01:07.716 > [WS_RX] switch_commit (new format) proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce commitNonce=51539607553
20:01:07.727 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:07.732 > [ZTM] HMAC verify: canonical={"commitNonce":51539607553,"committedAt":"2026-02-05T14:31:07Z","epoch":12,"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce"}
20:01:07.746 > [ZTM] HMAC verify: computed=17884f8ea1f52b925ef3cc9b28e649d296e1492868c3dc7df4800e0f84ee55d8 expected=17884f8ea1f52b925ef3cc9b28e649d296e1492868c3dc7df4800e0f84ee55d8
20:01:07.760 > [COMMIT_RECEIVED] proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce commitNonce=51539607553 epoch=12
20:01:07.768 > [186.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.875 > [WebSocket] Received (117 bytes): {"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce","serverTime":1770301867400,"type":"switch_ack_received"}
20:01:07.886 > [WebSocket] Processing message type: switch_ack_received
20:01:07.891 > [186.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:07.997 > [186.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.098 > [186.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.199 > [186.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.301 > [WebSocket] Received (251 bytes): {"payload":{"epoch":13,"proposalId":"46dd26dc-19ed-443f-b2b6-000000107ac6bb6975c","proposedAt":"2026-02-05T14:31:08Z","targetRecipe":"SALSA_LIGHT"},"signature":"c5df0c4bbb4db80a394660d889f2717185b3216448c0c0b45973f2ac26df266b","type":"switch_propose"}
20:01:08.323 > [WebSocket] Processing message type: switch_propose
20:01:08.328 > [WS_RX] switch_propose (new format) proposalId=46dd26dc-19ed-443f-b2b6-000000107ac6bb6975c targetRecipe=SALSA_LIGHT epoch=13
20:01:08.339 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:08.344 > [ZTM] HMAC verify: canonical={"epoch":13,"proposalId":"46dd26dc-19ed-443f-b2b6-000000107ac6bb6975c","proposedAt":"2026-02-05T14:31:08Z","targetRecipe":"SALSA_LIGHT"}
20:01:08.359 > [ZTM] HMAC verify: computed=c5df0c4bbb4db80a394660d889f2717185b3216448c0c0b45973f2ac26df266b expected=c5df0c4bbb4db80a394660d889f2717185b3216448c0c0b45973f2ac26df266b
20:01:08.375 > [EPOCH_UPDATE] Updating from 12 to 13 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
20:01:08.383 > [NACK_SENT] proposalId=46dd26dc-19ed-443f-b2b6-000000107ac6bb6975c reason=overlapping currentEpoch=13
20:01:08.391 > [186.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.494 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":13,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301868224,"threatLevel":2,"type":"heuristics_update"}
20:01:08.525 > [WebSocket] Processing message type: heuristics_update
20:01:08.527 > [187.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.638 > [WebSocket] Received (117 bytes): {"proposalId":"46dd26dc-19ed-443f-b2b6-000000107ac6bb6975c","serverTime":1770301868382,"type":"switch_nack_received"}
20:01:08.648 > [WebSocket] Processing message type: switch_nack_received
20:01:08.655 > [187.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.759 > [187.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.860 > [187.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:08.962 > [187.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.063 > [187.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.163 > [187.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.267 > [WebSocket] Received (252 bytes): {"payload":{"epoch":14,"proposalId":"8d0b43fa-0d28-48b3-a4ac-0000006b001ea2560d42","proposedAt":"2026-02-05T14:31:09Z","targetRecipe":"SALSA_LIGHT"},"signature":"c3088f5ce066675e70287a9d1fa8f2ecbdb41bda803bf0b19e97e6f10155cc62","type":"switch_propose"}
20:01:09.289 > [WebSocket] Processing message type: switch_propose
20:01:09.295 > [WS_RX] switch_propose (new format) proposalId=8d0b43fa-0d28-48b3-a4ac-0000006b001ea2560d42 targetRecipe=SALSA_LIGHT epoch=14
20:01:09.306 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:09.312 > [ZTM] HMAC verify: canonical={"epoch":14,"proposalId":"8d0b43fa-0d28-48b3-a4ac-0000006b001ea2560d42","proposedAt":"2026-02-05T14:31:09Z","targetRecipe":"SALSA_LIGHT"}
20:01:09.325 > [ZTM] HMAC verify: computed=c3088f5ce066675e70287a9d1fa8f2ecbdb41bda803bf0b19e97e6f10155cc62 expected=c3088f5ce066675e70287a9d1fa8f2ecbdb41bda803bf0b19e97e6f10155cc62
20:01:09.342 > [EPOCH_UPDATE] Updating from 13 to 14 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
20:01:09.350 > [NACK_SENT] proposalId=8d0b43fa-0d28-48b3-a4ac-0000006b001ea2560d42 reason=overlapping currentEpoch=14
20:01:09.359 > [187.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.462 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":14,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301869237,"threatLevel":2,"type":"heuristics_update"}
20:01:09.493 > [WebSocket] Processing message type: heuristics_update
20:01:09.495 > [188.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.606 > [WebSocket] Received (118 bytes): {"proposalId":"8d0b43fa-0d28-48b3-a4ac-0000006b001ea2560d42","serverTime":1770301869348,"type":"switch_nack_received"}
20:01:09.616 > [WebSocket] Processing message type: switch_nack_received
20:01:09.623 > [188.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.727 > [188.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.828 > [188.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:09.929 > [188.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.031 > [WebSocket] Received (252 bytes): {"payload":{"epoch":15,"proposalId":"e833fcae-49d8-42e9-b745-000000665abbafe1057e","proposedAt":"2026-02-05T14:31:09Z","targetRecipe":"SALSA_LIGHT"},"signature":"5aa6ae0d92f4d4e2f87b21fa250aabaf0a6f9d9599ef0ba9870ebcf82c3b389a","type":"switch_propose"}
20:01:10.053 > [WebSocket] Processing message type: switch_propose
20:01:10.058 > [WS_RX] switch_propose (new format) proposalId=e833fcae-49d8-42e9-b745-000000665abbafe1057e targetRecipe=SALSA_LIGHT epoch=15
20:01:10.070 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:10.075 > [ZTM] HMAC verify: canonical={"epoch":15,"proposalId":"e833fcae-49d8-42e9-b745-000000665abbafe1057e","proposedAt":"2026-02-05T14:31:09Z","targetRecipe":"SALSA_LIGHT"}
20:01:10.089 > [ZTM] HMAC verify: computed=5aa6ae0d92f4d4e2f87b21fa250aabaf0a6f9d9599ef0ba9870ebcf82c3b389a expected=5aa6ae0d92f4d4e2f87b21fa250aabaf0a6f9d9599ef0ba9870ebcf82c3b389a
20:01:10.106 > [EPOCH_UPDATE] Updating from 14 to 15 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
20:01:10.114 > [NACK_SENT] proposalId=e833fcae-49d8-42e9-b745-000000665abbafe1057e reason=overlapping currentEpoch=15
20:01:10.122 > [188.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.226 > [WebSocket] Received (118 bytes): {"proposalId":"e833fcae-49d8-42e9-b745-000000665abbafe1057e","serverTime":1770301870117,"type":"switch_nack_received"}
20:01:10.238 > [WebSocket] Processing message type: switch_nack_received
20:01:10.243 > [188.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.349 > [WebSocket] Received (252 bytes): {"payload":{"epoch":16,"proposalId":"8121e87b-1035-4423-b3fb-0000006adf1c35fec300","proposedAt":"2026-02-05T14:31:10Z","targetRecipe":"SALSA_LIGHT"},"signature":"f448461a272ed90d985554db14d47456435b5c72117068167e1c3eb3b54638e8","type":"switch_propose"}
20:01:10.375 > [WebSocket] Processing message type: switch_propose
20:01:10.379 > [WS_RX] switch_propose (new format) proposalId=8121e87b-1035-4423-b3fb-0000006adf1c35fec300 targetRecipe=SALSA_LIGHT epoch=16
20:01:10.390 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:10.393 > [ZTM] HMAC verify: canonical={"epoch":16,"proposalId":"8121e87b-1035-4423-b3fb-0000006adf1c35fec300","proposedAt":"2026-02-05T14:31:10Z","targetRecipe":"SALSA_LIGHT"}
20:01:10.407 > [ZTM] HMAC verify: computed=f448461a272ed90d985554db14d47456435b5c72117068167e1c3eb3b54638e8 expected=f448461a272ed90d985554db14d47456435b5c72117068167e1c3eb3b54638e8
20:01:10.424 > [EPOCH_UPDATE] Updating from 15 to 16 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
20:01:10.432 > [NACK_SENT] proposalId=8121e87b-1035-4423-b3fb-0000006adf1c35fec300 reason=overlapping currentEpoch=16
20:01:10.440 > [189.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.546 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":16,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301870246,"threatLevel":2,"type":"heuristics_update"}
20:01:10.577 > [WebSocket] Processing message type: heuristics_update
20:01:10.580 > [189.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.689 > [WebSocket] Received (118 bytes): {"proposalId":"8121e87b-1035-4423-b3fb-0000006adf1c35fec300","serverTime":1770301870430,"type":"switch_nack_received"}
20:01:10.701 > [WebSocket] Processing message type: switch_nack_received
20:01:10.706 > [189.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.811 > [189.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:10.912 > [189.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.013 > [189.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.114 > [189.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.214 > [189.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.316 > [WebSocket] Received (252 bytes): {"payload":{"epoch":17,"proposalId":"c3f7d5ee-b41d-4b54-9175-0000003d83847f41c377","proposedAt":"2026-02-05T14:31:11Z","targetRecipe":"SALSA_LIGHT"},"signature":"93efee9007ed3822232143287d223bd0cce55b8c340c6ba104d13c4612906f91","type":"switch_propose"}
20:01:11.339 > [WebSocket] Processing message type: switch_propose
20:01:11.345 > [WS_RX] switch_propose (new format) proposalId=c3f7d5ee-b41d-4b54-9175-0000003d83847f41c377 targetRecipe=SALSA_LIGHT epoch=17
20:01:11.356 > [ZTM] Master key (first 16 bytes): B5DFD64AAE1153584FDF4FE3A7692456
20:01:11.361 > [ZTM] HMAC verify: canonical={"epoch":17,"proposalId":"c3f7d5ee-b41d-4b54-9175-0000003d83847f41c377","proposedAt":"2026-02-05T14:31:11Z","targetRecipe":"SALSA_LIGHT"}
20:01:11.375 > [ZTM] HMAC verify: computed=93efee9007ed3822232143287d223bd0cce55b8c340c6ba104d13c4612906f91 expected=93efee9007ed3822232143287d223bd0cce55b8c340c6ba104d13c4612906f91
20:01:11.392 > [EPOCH_UPDATE] Updating from 16 to 17 (from switch_propose)\n[PROPOSE_REJECT] overlapping transaction
20:01:11.400 > [NACK_SENT] proposalId=c3f7d5ee-b41d-4b54-9175-0000003d83847f41c377 reason=overlapping currentEpoch=17
20:01:11.409 > [189.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.511 > [WebSocket] Received (322 bytes): {"currentRecipe":"CHAOS_ONLY","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301871256,"threatLevel":2,"type":"heuristics_update"}
20:01:11.542 > [WebSocket] Processing message type: heuristics_update
20:01:11.545 > [190.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.654 > [WebSocket] Received (118 bytes): {"proposalId":"c3f7d5ee-b41d-4b54-9175-0000003d83847f41c377","serverTime":1770301871397,"type":"switch_nack_received"}
20:01:11.666 > [WebSocket] Processing message type: switch_nack_received
20:01:11.671 > [190.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.776 > [190.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.877 > [190.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.979 > [190.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 14 | WS: CONNECTED
20:01:11.984 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:11.989 > [BOUNDARY_CHECK] SwitchState=3 PendingActive=1 CommitNonce=51539607553\n[BOUNDARY_CHECK] nextTxNonce=73014444033 commitNonce=51539607553 (epoch=17 packet=1)\n[SWITCH] commit boundary reached — applying recipe proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce
20:01:12.014 > [SWITCH] applyRecipe: SALSA_LIGHT
20:01:12.017 > [ZTM] Settings saved successfully
20:01:12.020 > [SWITCH] Protocol complete — returning to NORMAL state. Applied recipe at nonce: 51539607553
20:01:12.032 > [DONE_SENT] proposalId=adc47f19-e3a7-45f5-a529-00000091b50bf8134fce commitNonce=51539607553 epoch=12
20:01:12.040 > [SWITCH_DONE] Recipe switch completed at nonce=51539607553
20:01:12.046 > [RETRY] Using nonce 1 for all retry attempts (saved: 0)
20:01:12.048 > Generated health data: HR-63 SPO2-95 STEPS-987
20:01:12.054 > [ESP32] ========================================
20:01:12.056 > [ESP32] ENCRYPTION PIPELINE START
20:01:12.060 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:12.066 > [ESP32] Active Algorithms for this packet:
20:01:12.071 > [ESP32]   + LFSR
20:01:12.071 > [ESP32]   - Tinkerbell
20:01:12.073 > [ESP32]   - Transposition
20:01:12.076 > [ESP32]   - ChaCha20
20:01:12.076 > [ESP32]   + Salsa20
20:01:12.079 > [ESP32] ========================================
20:01:12.085 > [ESP32] MsgKeys: lfsrSeed=0x2B84CD17 tnk[0..3]=A8C70EC8 trn[0..3]=1EF8F705
20:01:12.090 > 1_After_Salt (25): 48522D36332053504F322D3935205354 4550532D3938374D50
20:01:12.096 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D3938374D5000000000000000 
20:01:12.105 > [ESP32][LFSR] Initializing - Seed: 0x2B84CD17 SeedBe: 0x17CD842B ChaosKey[0..3]: A8C70EC8 InitialTap: 0x0029 State: 0x2B84CD17
20:01:12.116 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:12.124 > 3_After_LFSR (32): 5F9FA91DAE4F65011EA66A2F037571D6 3C5AAEF68D4754B5E05FEC0EDBEF8FB7 
20:01:12.132 > [ESP32][LFSR] Keystream (first 16 bytes): 17CD842B9D6F36515194471636552282
20:01:12.138 > [ESP32][4D] LFSR keystream (first 32 bytes): 17CD842B9D6F36515194471636552282790AFDDBB47F63F8B05FEC0EDBEF8FB7
20:01:12.145 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:12.151 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:12.156 > [ESP32][SALSA20] Initializing - Nonce: 0x00000001
20:01:12.160 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:01:12.166 > [ESP32][SALSA20] Full Nonce (8 bytes): 0100000000000000
20:01:12.171 > [ESP32][SALSA20] Input (first 16 bytes): 5F9FA91DAE4F65011EA66A2F037571D6
20:01:12.176 > 7_After_Salsa20 (32): 01AF1DC6A3AF787216BD9595A2994673 FC2316D72BF71DCFD343A46AE606A5CF 
20:01:12.185 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:12.190 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000001
20:01:12.193 > [ESP32] === HMAC DEBUG INFO ===
20:01:12.196 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:12.205 > [ESP32] HMAC Input length: 45 bytes
20:01:12.210 > [ESP32] HMAC Input (first 32 bytes): 8202170017000408030000000101AF1DC6A3AF787216BD9595A2994673FC2316
20:01:12.218 > [ESP32] Nonce: 0x00000001
20:01:12.221 > [ESP32] Packet size before HMAC: 61
20:01:12.224 > [ESP32] Computed HMAC Tag: 32F27A788DB2003A2796045EE193BDB7
20:01:12.230 > [ESP32] === END HMAC DEBUG ===
20:01:12.232 > 6_Final_Packet (61): 8202170017000408030000000101AF1D C6A3AF787216BD9595A2994673FC2316 ...
20:01:12.238 > [RETRY] Attempt 1/3 (nonce: 1)
20:01:12.241 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:12.245 > Sending pipeline data to server (516 bytes)
20:01:12.439 > [HTTP] Response code: 200
20:01:12.439 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:01:12.451 > [RETRY] Health data sent successfully!
20:01:12.454 > ✓ Health data #15 sent successfully
20:01:12.556 > [WebSocket] Received (424 bytes): {"activatedAt":1770301731830,"active":true,"epoch":17,"heuristics":{"cpuUsage":20.0,"decryptFailures":0,"entropy":6.8,"hmacFailures":0,"latency":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"lastCommitNonce":51539607553,"lastSeenNonce":1,"lastSwitchReason":"Committed via switch_done","pendingProposals":0,"recipe":"SALSA_LIGHT","serverTime":1770301872046,"threatLevel":2,"type":"active_recipe_updated"}
20:01:12.595 > [WebSocket] Processing message type: active_recipe_updated
20:01:12.601 > [191.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:12.700 > [WebSocket] Received (135 bytes): {"proposalId":"adc47f19-e3a7-45f5-a529-00000091b50bf8134fce","serverTime":1770301872046,"status":"committed","type":"switch_committed"}
20:01:12.713 > [WebSocket] Processing message type: switch_committed
20:01:12.719 > [191.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:12.822 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301872269,"threatLevel":2,"type":"heuristics_update"}
20:01:12.852 > [WebSocket] Processing message type: heuristics_update
20:01:12.854 > [191.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:12.966 > [WebSocket] Received (543 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202170017000408030000000101AF1DC6A3AF787216BD9595A2994673FC2316D72BF71DCFD343A46AE606A5CF32F27A788DB2003A2796045EE193BDB7","pipeline":{"afterLFSR":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4754B5E05FEC0EDBEF8FB7","afterSalsa20":"01AF1DC6A3AF787216BD9595A2994673FC2316D72BF71DCFD343A46AE606A5CF","afterSalt":"48522D36332053504F322D39352053544550532D3938374D50"},"plaintext":"HR-63 SPO2-95 STEPS-987","serverTime":1770301872339,"timestamp":190777,"type":"encryption_update","ztmEnabled":true}
20:01:13.015 > [WebSocket] Processing message type: encryption_update
20:01:13.018 > [191.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.118 > [WebSocket] Received (87 bytes): {"heartRate":63,"spo2":95,"steps":987,"time":1770301872339,"type":"health_data_update"}
20:01:13.126 > [WebSocket] Processing message type: health_data_update
20:01:13.132 > [191.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.239 > [WebSocket] Received (225 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2911,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-987","handshakeSuccess":true,"totalTime":0.2911},"type":"session_summary_update"}
20:01:13.262 > [WebSocket] Processing message type: session_summary_update
20:01:13.267 > [191.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.372 > [WebSocket] Received (658 bytes): {"decryptionTime":0.2911,"encryptedPacket":"8202170017000408030000000101AF1DC6A3AF787216BD9595A2994673FC2316D72BF71DCFD343A46AE606A5CF32F27A788DB2003A2796045EE193BDB7","finalPlaintext":"HR-63 SPO2-95 STEPS-987","healthData":{"heartRate":63,"spo2":95,"steps":987},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D39383700000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D3938374D5000000000000000","afterTinkerbell":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4754B5E05FEC0EDBEF8FB7","afterTransposition":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4754B5E05FEC0EDBEF8FB7"},"serverTime":1770301872341,"type":"decryption_update"}
20:01:13.429 > [WebSocket] Processing message type: decryption_update
20:01:13.435 > [WebSocket] Server decryption completed
20:01:13.438 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 987
20:01:13.444 > [192.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.545 > [WebSocket] Received (556 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":14,"pipeline":{"afterLFSR":"5F9FA91DAE4F65011EA66A2F037571D63C5AAEF68D4754B5E05FEC0EDBEF8FB7","afterSalsa20":"01AF1DC6A3AF787216BD9595A2994673FC2316D72BF71DCFD343A46AE606A5CF","afterSalt":"48522D36332053504F322D39352053544550532D3938374D50","finalPacket":"8202170017000408030000000101AF1DC6A3AF787216BD9595A2994673FC2316D72BF71DCFD343A46AE606A5CF32F27A788DB2003A2796045EE193BDB7"},"plaintext":"HR-63 SPO2-95 STEPS-987","timestamp":190970,"type":"encryption_pipeline","ztmEnabled":true}
20:01:13.595 > [WebSocket] Processing message type: encryption_pipeline
20:01:13.601 > [192.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.709 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":14,"message":"Health data #15 sent successfully","state":7,"success":true,"timestamp":190974,"type":"health_data_sent"}
20:01:13.725 > [WebSocket] Processing message type: health_data_sent
20:01:13.728 > [192.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.830 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301873281,"threatLevel":2,"type":"heuristics_update"}
20:01:13.861 > [WebSocket] Processing message type: heuristics_update
20:01:13.864 > [192.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:13.973 > [192.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.074 > [192.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.175 > [192.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.276 > [192.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.377 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301874292,"threatLevel":2,"type":"heuristics_update"}
20:01:14.409 > [WebSocket] Processing message type: heuristics_update
20:01:14.411 > [192.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.520 > [193.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.621 > [193.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.722 > [193.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.823 > [193.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:14.924 > [193.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.025 > [193.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.127 > [193.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.227 > [193.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.329 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301875297,"threatLevel":2,"type":"heuristics_update"}
20:01:15.360 > [WebSocket] Processing message type: heuristics_update
20:01:15.362 > [193.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.471 > [194.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.573 > [194.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.673 > [194.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.774 > [194.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.875 > [194.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:15.976 > [194.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.078 > [194.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.178 > [194.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.279 > [194.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.383 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301876309,"threatLevel":2,"type":"heuristics_update"}
20:01:16.414 > [WebSocket] Processing message type: heuristics_update
20:01:16.416 > [194.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.525 > [195.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.626 > [195.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.727 > [195.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.829 > [195.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:16.930 > [195.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.030 > [195.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.132 > [195.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.232 > [195.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.334 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301877322,"threatLevel":2,"type":"heuristics_update"}
20:01:17.364 > [WebSocket] Processing message type: heuristics_update
20:01:17.367 > [195.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.477 > [196.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.577 > [196.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.678 > [196.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.779 > [196.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.880 > [196.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:17.981 > [196.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.082 > [196.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.184 > [196.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.284 > [196.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.386 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301878330,"threatLevel":2,"type":"heuristics_update"}
20:01:18.416 > [WebSocket] Processing message type: heuristics_update
20:01:18.419 > [196.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.528 > [197.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.629 > [197.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.730 > [197.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.831 > [197.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:18.931 > [197.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.033 > [197.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.134 > [197.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.235 > [197.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.336 > [197.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.438 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301879341,"threatLevel":2,"type":"heuristics_update"}
20:01:19.468 > [WebSocket] Processing message type: heuristics_update
20:01:19.471 > [198.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.580 > [198.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.681 > [198.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.782 > [198.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.883 > [198.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:19.984 > [198.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.085 > [198.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.186 > [198.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.287 > [198.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.389 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301880350,"threatLevel":2,"type":"heuristics_update"}
20:01:20.419 > [WebSocket] Processing message type: heuristics_update
20:01:20.422 > [198.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.532 > [199.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.632 > [199.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.733 > [199.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.834 > [199.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:20.935 > [199.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.036 > [199.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.137 > [199.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.238 > [199.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.339 > [199.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.443 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301881362,"threatLevel":2,"type":"heuristics_update"}
20:01:21.474 > [WebSocket] Processing message type: heuristics_update
20:01:21.476 > [200.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.587 > [200.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.687 > [200.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.788 > [200.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.889 > [200.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:21.989 > [200.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.090 > [200.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.192 > [200.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.292 > [200.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.395 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301882375,"threatLevel":2,"type":"heuristics_update"}
20:01:22.426 > [WebSocket] Processing message type: heuristics_update
20:01:22.429 > [201.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.538 > [201.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:22.543 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:22.549 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
20:01:22.566 > Generated health data: HR-63 SPO2-95 STEPS-1006
20:01:22.572 > [ESP32] ========================================
20:01:22.574 > [ESP32] ENCRYPTION PIPELINE START
20:01:22.579 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:22.582 > [ESP32] Active Algorithms for this packet:
20:01:22.588 > [ESP32]   + LFSR
20:01:22.588 > [ESP32]   - Tinkerbell
20:01:22.591 > [ESP32]   - Transposition
20:01:22.594 > [ESP32]   - ChaCha20
20:01:22.594 > [ESP32]   + Salsa20
20:01:22.596 > [ESP32] ========================================
20:01:22.602 > [ESP32] MsgKeys: lfsrSeed=0x87BD003E tnk[0..3]=8E112524 trn[0..3]=C6C6B684
20:01:22.608 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313030364D50
20:01:22.613 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313030364D50000000000000 
20:01:22.622 > [ESP32][LFSR] Initializing - Seed: 0x87BD003E SeedBe: 0x3E00BD87 ChaosKey[0..3]: 8E112524 InitialTap: 0x0029 State: 0x87BD003E
20:01:22.639 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:22.641 > 3_After_LFSR (32): 765290B1465EEAE7B1F3307D3AAD5717 654C008B37201F33DF30953EAFDD4858 
20:01:22.649 > [ESP32][LFSR] Keystream (first 16 bytes): 3E00BD87757EB9B7FEC11D440F8D0443
20:01:22.655 > [ESP32][4D] LFSR keystream (first 32 bytes): 3E00BD87757EB9B7FEC11D440F8D0443201C53A606102F059260953EAFDD4858
20:01:22.666 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:22.668 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:22.674 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
20:01:22.677 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:01:22.682 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
20:01:22.688 > [ESP32][SALSA20] Input (first 16 bytes): 765290B1465EEAE7B1F3307D3AAD5717
20:01:22.693 > 7_After_Salsa20 (32): 2862246A4BBEF794C21435359B4160B2 A535B8AA91905649EBF853F492346220 
20:01:22.702 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:22.708 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
20:01:22.713 > [ESP32] === HMAC DEBUG INFO ===
20:01:22.716 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:22.724 > [ESP32] HMAC Input length: 45 bytes
20:01:22.727 > [ESP32] HMAC Input (first 32 bytes): 820218001800040803000000022862246A4BBEF794C21435359B4160B2A535B8
20:01:22.735 > [ESP32] Nonce: 0x00000002
20:01:22.738 > [ESP32] Packet size before HMAC: 61
20:01:22.741 > [ESP32] Computed HMAC Tag: 2FC31B962C6F92A88C9DBCC3D403822C
20:01:22.747 > [ESP32] === END HMAC DEBUG ===
20:01:22.749 > 6_Final_Packet (61): 82021800180004080300000002286224 6A4BBEF794C21435359B4160B2A535B8 ...
20:01:22.758 > [RETRY] Attempt 1/3 (nonce: 2)
20:01:22.760 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:22.766 > Sending pipeline data to server (519 bytes)
20:01:22.965 > [HTTP] Response code: 400
20:01:22.966 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:22.971 > [HTTP] Request failed with code: 400
20:01:22.974 > [RETRY] Send failed, waiting 100 ms before retry
20:01:23.075 > [RETRY] Attempt 2/3 (nonce: 2)
20:01:23.075 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:23.080 > Sending pipeline data to server (519 bytes)
20:01:23.220 > [HTTP] Response code: 400
20:01:23.220 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:23.226 > [HTTP] Request failed with code: 400
20:01:23.227 > [RETRY] Send failed, waiting 200 ms before retry
20:01:23.428 > [RETRY] Attempt 3/3 (nonce: 2)
20:01:23.428 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:23.433 > Sending pipeline data to server (519 bytes)
20:01:23.753 > [HTTP] Response code: 400
20:01:23.753 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:23.759 > [HTTP] Request failed with code: 400
20:01:23.762 > [RETRY] All retry attempts failed - rolled back nonce to 1
20:01:23.767 > [RETRY] Consecutive failures: 1
20:01:23.769 > Health data send failed (retry count: 1/3)
20:01:23.873 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":201498,"type":"health_data_error"}
20:01:23.887 > [WebSocket] Processing message type: health_data_error
20:01:23.893 > [202.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:23.901 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:23.906 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
20:01:23.922 > Generated health data: HR-63 SPO2-95 STEPS-1026
20:01:23.929 > [ESP32] ========================================
20:01:23.931 > [ESP32] ENCRYPTION PIPELINE START
20:01:23.934 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:23.940 > [ESP32] Active Algorithms for this packet:
20:01:23.942 > [ESP32]   + LFSR
20:01:23.945 > [ESP32]   - Tinkerbell
20:01:23.948 > [ESP32]   - Transposition
20:01:23.948 > [ESP32]   - ChaCha20
20:01:23.951 > [ESP32]   + Salsa20
20:01:23.953 > [ESP32] ========================================
20:01:23.956 > [ESP32] MsgKeys: lfsrSeed=0x87BD003E tnk[0..3]=8E112524 trn[0..3]=C6C6B684
20:01:23.965 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313032364D50
20:01:23.970 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313032364D50000000000000 
20:01:23.978 > [ESP32][LFSR] Initializing - Seed: 0x87BD003E SeedBe: 0x3E00BD87 ChaosKey[0..3]: 8E112524 InitialTap: 0x0029 State: 0x87BD003E
20:01:23.990 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:23.998 > 3_After_LFSR (32): 765290B1465EEAE7B1F3307D3AAD5717 654C008B37201D33DF30953EAFDD4858 
20:01:24.004 > [ESP32][LFSR] Keystream (first 16 bytes): 3E00BD87757EB9B7FEC11D440F8D0443
20:01:24.011 > [ESP32][4D] LFSR keystream (first 32 bytes): 3E00BD87757EB9B7FEC11D440F8D0443201C53A606102F059260953EAFDD4858
20:01:24.021 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:24.025 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:24.031 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
20:01:24.034 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:01:24.039 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
20:01:24.045 > [ESP32][SALSA20] Input (first 16 bytes): 765290B1465EEAE7B1F3307D3AAD5717
20:01:24.051 > 7_After_Salsa20 (32): 2862246A4BBEF794C21435359B4160B2 A535B8AA91905449EBF853F492346220 
20:01:24.059 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:24.065 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
20:01:24.068 > [ESP32] === HMAC DEBUG INFO ===
20:01:24.070 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:24.078 > [ESP32] HMAC Input length: 45 bytes
20:01:24.081 > [ESP32] HMAC Input (first 32 bytes): 820218001800040803000000022862246A4BBEF794C21435359B4160B2A535B8
20:01:24.092 > [ESP32] Nonce: 0x00000002
20:01:24.092 > [ESP32] Packet size before HMAC: 61
20:01:24.098 > [ESP32] Computed HMAC Tag: CCA28C2F6107D131E6C416269D12B80A
20:01:24.103 > [ESP32] === END HMAC DEBUG ===
20:01:24.103 > 6_Final_Packet (61): 82021800180004080300000002286224 6A4BBEF794C21435359B4160B2A535B8 ...
20:01:24.112 > [RETRY] Attempt 1/3 (nonce: 2)
20:01:24.115 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:24.120 > Sending pipeline data to server (519 bytes)
20:01:24.457 > [HTTP] Response code: 400
20:01:24.457 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:24.462 > [HTTP] Request failed with code: 400
20:01:24.464 > [RETRY] Send failed, waiting 100 ms before retry
20:01:24.564 > [RETRY] Attempt 2/3 (nonce: 2)
20:01:24.564 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:24.570 > Sending pipeline data to server (519 bytes)
20:01:24.731 > [HTTP] Response code: 400
20:01:24.731 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:24.735 > [HTTP] Request failed with code: 400
20:01:24.738 > [RETRY] Send failed, waiting 200 ms before retry
20:01:24.939 > [RETRY] Attempt 3/3 (nonce: 2)
20:01:24.939 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:24.944 > Sending pipeline data to server (519 bytes)
20:01:25.231 > [HTTP] Response code: 400
20:01:25.231 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:25.236 > [HTTP] Request failed with code: 400
20:01:25.239 > [RETRY] All retry attempts failed - rolled back nonce to 1
20:01:25.245 > [RETRY] Consecutive failures: 2
20:01:25.247 > Health data send failed (retry count: 2/3)
20:01:25.351 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":201751,"type":"health_data_error"}
20:01:25.365 > [WebSocket] Processing message type: health_data_error
20:01:25.370 > [203.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:25.379 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:25.385 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
20:01:25.401 > Generated health data: HR-63 SPO2-95 STEPS-1039
20:01:25.407 > [ESP32] ========================================
20:01:25.409 > [ESP32] ENCRYPTION PIPELINE START
20:01:25.412 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:25.417 > [ESP32] Active Algorithms for this packet:
20:01:25.420 > [ESP32]   + LFSR
20:01:25.423 > [ESP32]   - Tinkerbell
20:01:25.425 > [ESP32]   - Transposition
20:01:25.425 > [ESP32]   - ChaCha20
20:01:25.429 > [ESP32]   + Salsa20
20:01:25.432 > [ESP32] ========================================
20:01:25.435 > [ESP32] MsgKeys: lfsrSeed=0x87BD003E tnk[0..3]=8E112524 trn[0..3]=C6C6B684
20:01:25.443 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313033394D50
20:01:25.448 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313033394D50000000000000 
20:01:25.457 > [ESP32][LFSR] Initializing - Seed: 0x87BD003E SeedBe: 0x3E00BD87 ChaosKey[0..3]: 8E112524 InitialTap: 0x0029 State: 0x87BD003E
20:01:25.468 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:25.476 > 3_After_LFSR (32): 765290B1465EEAE7B1F3307D3AAD5717 654C008B37201C3CDF30953EAFDD4858 
20:01:25.482 > [ESP32][LFSR] Keystream (first 16 bytes): 3E00BD87757EB9B7FEC11D440F8D0443
20:01:25.490 > [ESP32][4D] LFSR keystream (first 32 bytes): 3E00BD87757EB9B7FEC11D440F8D0443201C53A606102F059260953EAFDD4858
20:01:25.498 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:25.504 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:25.510 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
20:01:25.513 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:01:25.518 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
20:01:25.523 > [ESP32][SALSA20] Input (first 16 bytes): 765290B1465EEAE7B1F3307D3AAD5717
20:01:25.529 > 7_After_Salsa20 (32): 2862246A4BBEF794C21435359B4160B2 A535B8AA91905546EBF853F492346220 
20:01:25.538 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:25.543 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
20:01:25.546 > [ESP32] === HMAC DEBUG INFO ===
20:01:25.548 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:25.556 > [ESP32] HMAC Input length: 45 bytes
20:01:25.559 > [ESP32] HMAC Input (first 32 bytes): 820218001800040803000000022862246A4BBEF794C21435359B4160B2A535B8
20:01:25.571 > [ESP32] Nonce: 0x00000002
20:01:25.571 > [ESP32] Packet size before HMAC: 61
20:01:25.576 > [ESP32] Computed HMAC Tag: 5D1F1B17377BD5E5BFDECCCA4AD3956C
20:01:25.581 > [ESP32] === END HMAC DEBUG ===
20:01:25.581 > 6_Final_Packet (61): 82021800180004080300000002286224 6A4BBEF794C21435359B4160B2A535B8 ...
20:01:25.590 > [RETRY] Attempt 1/3 (nonce: 2)
20:01:25.593 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:25.598 > Sending pipeline data to server (519 bytes)
20:01:25.756 > [HTTP] Response code: 400
20:01:25.756 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:25.762 > [HTTP] Request failed with code: 400
20:01:25.765 > [RETRY] Send failed, waiting 100 ms before retry
20:01:25.865 > [RETRY] Attempt 2/3 (nonce: 2)
20:01:25.865 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:25.870 > Sending pipeline data to server (519 bytes)
20:01:25.992 > [HTTP] Response code: 400
20:01:25.992 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:25.998 > [HTTP] Request failed with code: 400
20:01:26.001 > [RETRY] Send failed, waiting 200 ms before retry
20:01:26.201 > [RETRY] Attempt 3/3 (nonce: 2)
20:01:26.201 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:26.206 > Sending pipeline data to server (519 bytes)
20:01:26.496 > [HTTP] Response code: 400
20:01:26.496 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:26.502 > [HTTP] Request failed with code: 400
20:01:26.505 > [RETRY] All retry attempts failed - rolled back nonce to 1
20:01:26.511 > [RETRY] Consecutive failures: 3
20:01:26.514 > Health data send failed (retry count: 3/3)
20:01:26.516 > Health data transmission failed after max retries
20:01:26.616 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301883380,"threatLevel":2,"type":"heuristics_update"}
20:01:26.646 > [WebSocket] Processing message type: heuristics_update
20:01:26.649 > [205.2] STATE: ERROR | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:26.658 > ERROR state - attempting recovery
20:01:26.661 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:26.667 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
20:01:26.683 > Generated health data: HR-63 SPO2-95 STEPS-1055
20:01:26.689 > [ESP32] ========================================
20:01:26.691 > [ESP32] ENCRYPTION PIPELINE START
20:01:26.694 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:26.699 > [ESP32] Active Algorithms for this packet:
20:01:26.702 > [ESP32]   + LFSR
20:01:26.705 > [ESP32]   - Tinkerbell
20:01:26.708 > [ESP32]   - Transposition
20:01:26.708 > [ESP32]   - ChaCha20
20:01:26.711 > [ESP32]   + Salsa20
20:01:26.714 > [ESP32] ========================================
20:01:26.716 > [ESP32] MsgKeys: lfsrSeed=0x87BD003E tnk[0..3]=8E112524 trn[0..3]=C6C6B684
20:01:26.725 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313035354D50
20:01:26.730 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313035354D50000000000000 
20:01:26.739 > [ESP32][LFSR] Initializing - Seed: 0x87BD003E SeedBe: 0x3E00BD87 ChaosKey[0..3]: 8E112524 InitialTap: 0x0029 State: 0x87BD003E
20:01:26.750 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:26.758 > 3_After_LFSR (32): 765290B1465EEAE7B1F3307D3AAD5717 654C008B37201A30DF30953EAFDD4858 
20:01:26.764 > [ESP32][LFSR] Keystream (first 16 bytes): 3E00BD87757EB9B7FEC11D440F8D0443
20:01:26.772 > [ESP32][4D] LFSR keystream (first 32 bytes): 3E00BD87757EB9B7FEC11D440F8D0443201C53A606102F059260953EAFDD4858
20:01:26.780 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:26.786 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:26.791 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
20:01:26.794 > [ESP32][SALSA20] Key (first 8 bytes): 894CCB3C110CD45E
20:01:26.799 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
20:01:26.804 > [ESP32][SALSA20] Input (first 16 bytes): 765290B1465EEAE7B1F3307D3AAD5717
20:01:26.811 > 7_After_Salsa20 (32): 2862246A4BBEF794C21435359B4160B2 A535B8AA9190534AEBF853F492346220 
20:01:26.819 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:26.824 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
20:01:26.828 > [ESP32] === HMAC DEBUG INFO ===
20:01:26.830 > [ESP32] HMAC Key being used: 894CCB3C110CD45EDF52901816EC3FB5BB56F261ECF74EB5DB6EDC37C8A2489D
20:01:26.838 > [ESP32] HMAC Input length: 45 bytes
20:01:26.841 > [ESP32] HMAC Input (first 32 bytes): 820218001800040803000000022862246A4BBEF794C21435359B4160B2A535B8
20:01:26.852 > [ESP32] Nonce: 0x00000002
20:01:26.852 > [ESP32] Packet size before HMAC: 61
20:01:26.858 > [ESP32] Computed HMAC Tag: 581FFD0ADECD973D9B6BC6B58C6FE1D9
20:01:26.864 > [ESP32] === END HMAC DEBUG ===
20:01:26.864 > 6_Final_Packet (61): 82021800180004080300000002286224 6A4BBEF794C21435359B4160B2A535B8 ...
20:01:26.872 > [RETRY] Attempt 1/3 (nonce: 2)
20:01:26.875 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:26.881 > Sending pipeline data to server (519 bytes)
20:01:27.001 > [HTTP] Response code: 400
20:01:27.001 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:27.006 > [HTTP] Request failed with code: 400
20:01:27.009 > [RETRY] Send failed, waiting 100 ms before retry
20:01:27.111 > [RETRY] Attempt 2/3 (nonce: 2)
20:01:27.111 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:27.116 > Sending pipeline data to server (519 bytes)
20:01:27.251 > [HTTP] Response code: 400
20:01:27.251 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:27.256 > [HTTP] Request failed with code: 400
20:01:27.259 > [RETRY] Send failed, waiting 200 ms before retry
20:01:27.458 > [RETRY] Attempt 3/3 (nonce: 2)
20:01:27.459 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:27.464 > Sending pipeline data to server (519 bytes)
20:01:27.764 > [HTTP] Response code: 400
20:01:27.764 > [HTTP] Error response: {"error":"Decryption failed"}
20:01:27.771 > [HTTP] Request failed with code: 400
20:01:27.774 > [RETRY] All retry attempts failed - rolled back nonce to 1
20:01:27.779 > [RETRY] Consecutive failures: 4
20:01:27.782 > ✗ Auto-recovery failed - restarting key exchange
20:01:29.885 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":202285,"type":"health_data_error"}
20:01:29.899 > [WebSocket] Processing message type: health_data_error
20:01:29.904 > [208.4] STATE: CHECK_PUBLIC_KEY | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:29.913 > ✓ Public key loaded from NVS
20:01:30.014 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301884395,"threatLevel":2,"type":"heuristics_update"}
20:01:30.045 > [WebSocket] Processing message type: heuristics_update
20:01:30.048 > [208.6] STATE: GENERATE_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:30.157 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":202989,"type":"health_data_error"}
20:01:30.171 > [WebSocket] Processing message type: health_data_error
20:01:30.176 > [208.7] STATE: ENCRYPT_MASTER_KEY | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:30.185 > Generating fresh master key from entropy...
20:01:30.193 > Generated master key (32): 48AC7BBA9A22A87053EC2242B83A7412 D5FC30F8711FDF3E7B4DDBB1EF271490 
20:01:30.199 > Using reduced master key (byte % 3) for NTRU encryption only
20:01:30.208 > NTRU encrypted master key (502): 007A007B001E000F0054006000740048 006D003B0013001B0051003400520015 ...
20:01:30.217 > POST http://10.249.92.115:8081/master-key
20:01:30.512 > ✓ Master key exchange completed
20:01:30.614 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":203262,"type":"health_data_error"}
20:01:30.627 > [WebSocket] Processing message type: health_data_error
20:01:30.633 > [209.2] STATE: DERIVE_SYMMETRIC | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:30.641 > Loading master key from NVS and deriving symmetric keys...
20:01:30.647 > Loaded master key from NVS (32): 48AC7BBA9A22A87053EC2242B83A7412 D5FC30F8711FDF3E7B4DDBB1EF271490 
20:01:30.654 > Derived HMAC key (32): 4A6A30343E64485DBFA843A1B3DF3815 DBF0C6497B88D4555E313645B9C56044 
20:01:30.663 > Derived Tinkerbell key (16): E96EED614CFC9C55B9251BE05A5AF7B1 
20:01:30.669 > Derived Transposition key (16): C1FE9E2F09C9591733C6851E949A89A9 
20:01:30.675 > ✓ Symmetric keys derived successfully
20:01:30.677 > Nonce tracker reset - new session started
20:01:31.172 > Waiting for server to process master key...
20:01:31.176 > ✓ Symmetric keys ready - starting health data transmission
20:01:31.278 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":203763,"type":"health_data_error"}
20:01:31.292 > [WebSocket] Processing message type: health_data_error
20:01:31.297 > [209.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:31.401 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301885407,"threatLevel":2,"type":"heuristics_update"}
20:01:31.432 > [WebSocket] Processing message type: heuristics_update
20:01:31.434 > [210.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:31.543 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":204288,"type":"health_data_error"}
20:01:31.558 > [WebSocket] Processing message type: health_data_error
20:01:31.563 > [210.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:31.667 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":204524,"type":"health_data_error"}
20:01:31.681 > [WebSocket] Processing message type: health_data_error
20:01:31.686 > [210.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:31.789 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301886416,"threatLevel":2,"type":"heuristics_update"}
20:01:31.820 > [WebSocket] Processing message type: heuristics_update
20:01:31.823 > [210.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:31.931 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":7,"success":false,"timestamp":205029,"type":"health_data_error"}
20:01:31.946 > [WebSocket] Processing message type: health_data_error
20:01:31.952 > [210.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.054 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":8,"success":false,"timestamp":205533,"type":"health_data_error"}
20:01:32.068 > [WebSocket] Processing message type: health_data_error
20:01:32.073 > [210.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.176 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":8,"success":false,"timestamp":205782,"type":"health_data_error"}
20:01:32.190 > [WebSocket] Processing message type: health_data_error
20:01:32.195 > [210.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.298 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301887421,"threatLevel":2,"type":"heuristics_update"}
20:01:32.328 > [WebSocket] Processing message type: heuristics_update
20:01:32.331 > [210.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.441 > [WebSocket] Received (155 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Failed to send health data","state":8,"success":false,"timestamp":206297,"type":"health_data_error"}
20:01:32.455 > [WebSocket] Processing message type: health_data_error
20:01:32.461 > [211.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.563 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301888431,"threatLevel":2,"type":"heuristics_update"}
20:01:32.594 > [WebSocket] Processing message type: heuristics_update
20:01:32.597 > [211.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.706 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301889437,"threatLevel":2,"type":"heuristics_update"}
20:01:32.736 > [WebSocket] Processing message type: heuristics_update
20:01:32.739 > [211.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.848 > [WebSocket] Received (126 bytes): {"keySize":32,"message":"Master key successfully received from ESP32","serverTime":1770301890298,"type":"master_key_received"}
20:01:32.863 > [WebSocket] Processing message type: master_key_received
20:01:32.865 > [211.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:32.971 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301890445,"threatLevel":2,"type":"heuristics_update"}
20:01:33.002 > [WebSocket] Processing message type: heuristics_update
20:01:33.004 > [211.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.114 > [WebSocket] Received (176 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Master key successfully exchanged with server","state":5,"success":true,"timestamp":209036,"type":"master_key_exchanged"}
20:01:33.130 > [WebSocket] Processing message type: master_key_exchanged
20:01:33.136 > [211.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.236 > [WebSocket] Received (168 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Symmetric keys successfully derived","state":6,"success":true,"timestamp":209704,"type":"symmetric_keys_derived"}
20:01:33.252 > [WebSocket] Processing message type: symmetric_keys_derived
20:01:33.258 > [211.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.361 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301891451,"threatLevel":2,"type":"heuristics_update"}
20:01:33.391 > [WebSocket] Processing message type: heuristics_update
20:01:33.394 > [211.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.503 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301892464,"threatLevel":2,"type":"heuristics_update"}
20:01:33.534 > [WebSocket] Processing message type: heuristics_update
20:01:33.537 > [212.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.647 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301893479,"threatLevel":2,"type":"heuristics_update"}
20:01:33.677 > [WebSocket] Processing message type: heuristics_update
20:01:33.680 > [212.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.789 > [212.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.889 > [212.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:33.990 > [212.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.092 > [212.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.192 > [212.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.293 > [212.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.395 > [212.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.496 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301894488,"threatLevel":2,"type":"heuristics_update"}
20:01:34.527 > [WebSocket] Processing message type: heuristics_update
20:01:34.530 > [213.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.639 > [213.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.738 > [213.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.840 > [213.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:34.941 > [213.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.043 > [213.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.143 > [213.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.244 > [213.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.346 > [213.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.447 > [214.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.549 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301895497,"threatLevel":2,"type":"heuristics_update"}
20:01:35.578 > [WebSocket] Processing message type: heuristics_update
20:01:35.582 > [214.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.690 > [214.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.791 > [214.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.892 > [214.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:35.993 > [214.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.095 > [214.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.195 > [214.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.297 > [214.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.398 > [214.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.498 > [215.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.601 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301896508,"threatLevel":2,"type":"heuristics_update"}
20:01:36.631 > [WebSocket] Processing message type: heuristics_update
20:01:36.633 > [215.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.743 > [215.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.844 > [215.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:36.945 > [215.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.045 > [215.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.147 > [215.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.247 > [215.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.348 > [215.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.450 > [216.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.554 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301897518,"threatLevel":2,"type":"heuristics_update"}
20:01:37.584 > [WebSocket] Processing message type: heuristics_update
20:01:37.587 > [216.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.697 > [216.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.798 > [216.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:37.899 > [216.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.000 > [216.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.100 > [216.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.202 > [216.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.303 > [216.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.404 > [216.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.505 > [217.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.606 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301898533,"threatLevel":2,"type":"heuristics_update"}
20:01:38.637 > [WebSocket] Processing message type: heuristics_update
20:01:38.639 > [217.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.749 > [217.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.849 > [217.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:38.951 > [217.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.052 > [217.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.152 > [217.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.254 > [217.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.354 > [217.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.455 > [218.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.556 > [218.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.658 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301899547,"threatLevel":2,"type":"heuristics_update"}
20:01:39.689 > [WebSocket] Processing message type: heuristics_update
20:01:39.691 > [218.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.801 > [218.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:39.902 > [218.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.002 > [218.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.103 > [218.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.205 > [218.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.306 > [218.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.406 > [218.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.508 > [219.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.609 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301900559,"threatLevel":2,"type":"heuristics_update"}
20:01:40.639 > [WebSocket] Processing message type: heuristics_update
20:01:40.642 > [219.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.752 > [219.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.852 > [219.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:40.953 > [219.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:41.054 > [219.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:41.155 > [219.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:41.256 > [219.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 15 | WS: CONNECTED
20:01:41.261 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:41.268 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 1 for all retry attempts (saved: 0)
20:01:41.284 > Generated health data: HR-63 SPO2-95 STEPS-1114
20:01:41.290 > [ESP32] ========================================
20:01:41.293 > [ESP32] ENCRYPTION PIPELINE START
20:01:41.297 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:41.300 > [ESP32] Active Algorithms for this packet:
20:01:41.306 > [ESP32]   + LFSR
20:01:41.306 > [ESP32]   - Tinkerbell
20:01:41.309 > [ESP32]   - Transposition
20:01:41.312 > [ESP32]   - ChaCha20
20:01:41.312 > [ESP32]   + Salsa20
20:01:41.315 > [ESP32] ========================================
20:01:41.321 > [ESP32] MsgKeys: lfsrSeed=0x5D706E08 tnk[0..3]=F6688396 trn[0..3]=7CD03637
20:01:41.326 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313131344D50
20:01:41.331 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313131344D50000000000000 
20:01:41.340 > [ESP32][LFSR] Initializing - Seed: 0x5D706E08 SeedBe: 0x086E705D ChaosKey[0..3]: F6688396 InitialTap: 0x0029 State: 0x5D706E08
20:01:41.351 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:41.359 > 3_After_LFSR (32): 403C5D6B03B28BB1B98ADCB0A75801AF 9E2E2FD044462E6C5C4A8D50B8461358 
20:01:41.367 > [ESP32][LFSR] Keystream (first 16 bytes): 086E705D3092D8E1F6B8F189927852FB
20:01:41.373 > [ESP32][4D] LFSR keystream (first 32 bytes): 086E705D3092D8E1F6B8F189927852FBDB7E7CFD75771F58111A8D50B8461358
20:01:41.384 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:41.387 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:41.393 > [ESP32][SALSA20] Initializing - Nonce: 0x00000001
20:01:41.395 > [ESP32][SALSA20] Key (first 8 bytes): 4A6A30343E64485D
20:01:41.401 > [ESP32][SALSA20] Full Nonce (8 bytes): 0100000000000000
20:01:41.407 > [ESP32][SALSA20] Input (first 16 bytes): 403C5D6B03B28BB1B98ADCB0A75801AF
20:01:41.411 > 7_After_Salsa20 (32): 80A46CBA7E5B485275B95A39033B11E8 CD048D51B18835F06F8899DB80C364BC 
20:01:41.420 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:41.426 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000001
20:01:41.431 > [ESP32] === HMAC DEBUG INFO ===
20:01:41.434 > [ESP32] HMAC Key being used: 4A6A30343E64485DBFA843A1B3DF3815DBF0C6497B88D4555E313645B9C56044
20:01:41.442 > [ESP32] HMAC Input length: 45 bytes
20:01:41.446 > [ESP32] HMAC Input (first 32 bytes): 8202180018000408030000000180A46CBA7E5B485275B95A39033B11E8CD048D
20:01:41.454 > [ESP32] Nonce: 0x00000001
20:01:41.456 > [ESP32] Packet size before HMAC: 61
20:01:41.459 > [ESP32] Computed HMAC Tag: 1EBD54ECB951235641BF24BCD9416F14
20:01:41.465 > [ESP32] === END HMAC DEBUG ===
20:01:41.468 > 6_Final_Packet (61): 8202180018000408030000000180A46C BA7E5B485275B95A39033B11E8CD048D ...
20:01:41.476 > [RETRY] Attempt 1/3 (nonce: 1)
20:01:41.478 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:41.484 > Sending pipeline data to server (519 bytes)
20:01:41.782 > [HTTP] Response code: 200
20:01:41.782 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:01:41.799 > [RETRY] Health data sent successfully!
20:01:41.799 > ✓ Health data #16 sent successfully
20:01:41.900 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301901567,"threatLevel":2,"type":"heuristics_update"}
20:01:41.930 > [WebSocket] Processing message type: heuristics_update
20:01:41.933 > [220.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.042 > [WebSocket] Received (184 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":12,"requests_per_minute":14,"serverTime":1770301901581,"type":"security_update"}
20:01:42.059 > [WebSocket] Processing message type: security_update
20:01:42.065 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
20:01:42.071 > [220.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.175 > [WebSocket] Received (546 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202180018000408030000000180A46CBA7E5B485275B95A39033B11E8CD048D51B18835F06F8899DB80C364BC1EBD54ECB951235641BF24BCD9416F14","pipeline":{"afterLFSR":"403C5D6B03B28BB1B98ADCB0A75801AF9E2E2FD044462E6C5C4A8D50B8461358","afterSalsa20":"80A46CBA7E5B485275B95A39033B11E8CD048D51B18835F06F8899DB80C364BC","afterSalt":"48522D36332053504F322D39352053544550532D313131344D50"},"plaintext":"HR-63 SPO2-95 STEPS-1114","serverTime":1770301901581,"timestamp":220012,"type":"encryption_update","ztmEnabled":true}
20:01:42.225 > [WebSocket] Processing message type: encryption_update
20:01:42.227 > [220.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.337 > [WebSocket] Received (88 bytes): {"heartRate":63,"spo2":95,"steps":1114,"time":1770301901581,"type":"health_data_update"}
20:01:42.346 > [WebSocket] Processing message type: health_data_update
20:01:42.352 > [220.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.460 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2496,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-1114","handshakeSuccess":true,"totalTime":0.2496},"type":"session_summary_update"}
20:01:42.482 > [WebSocket] Processing message type: session_summary_update
20:01:42.487 > [221.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.592 > [WebSocket] Received (660 bytes): {"decryptionTime":0.2496,"encryptedPacket":"8202180018000408030000000180A46CBA7E5B485275B95A39033B11E8CD048D51B18835F06F8899DB80C364BC1EBD54ECB951235641BF24BCD9416F14","finalPlaintext":"HR-63 SPO2-95 STEPS-1114","healthData":{"heartRate":63,"spo2":95,"steps":1114},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D31313134000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D313131344D50000000000000","afterTinkerbell":"403C5D6B03B28BB1B98ADCB0A75801AF9E2E2FD044462E6C5C4A8D50B8461358","afterTransposition":"403C5D6B03B28BB1B98ADCB0A75801AF9E2E2FD044462E6C5C4A8D50B8461358"},"serverTime":1770301901581,"type":"decryption_update"}
20:01:42.651 > [WebSocket] Processing message type: decryption_update
20:01:42.656 > [WebSocket] Server decryption completed
20:01:42.659 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 1114
20:01:42.664 > [221.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.766 > [WebSocket] Received (559 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":15,"pipeline":{"afterLFSR":"403C5D6B03B28BB1B98ADCB0A75801AF9E2E2FD044462E6C5C4A8D50B8461358","afterSalsa20":"80A46CBA7E5B485275B95A39033B11E8CD048D51B18835F06F8899DB80C364BC","afterSalt":"48522D36332053504F322D39352053544550532D313131344D50","finalPacket":"8202180018000408030000000180A46CBA7E5B485275B95A39033B11E8CD048D51B18835F06F8899DB80C364BC1EBD54ECB951235641BF24BCD9416F14"},"plaintext":"HR-63 SPO2-95 STEPS-1114","timestamp":220314,"type":"encryption_pipeline","ztmEnabled":true}
20:01:42.816 > [WebSocket] Processing message type: encryption_pipeline
20:01:42.821 > [221.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:42.929 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":15,"message":"Health data #16 sent successfully","state":7,"success":true,"timestamp":220319,"type":"health_data_sent"}
20:01:42.945 > [WebSocket] Processing message type: health_data_sent
20:01:42.948 > [221.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.052 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301902580,"threatLevel":2,"type":"heuristics_update"}
20:01:43.081 > [WebSocket] Processing message type: heuristics_update
20:01:43.084 > [221.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.193 > [221.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.295 > [221.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.395 > [221.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.497 > [222.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.597 > [222.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.699 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301903593,"threatLevel":2,"type":"heuristics_update"}
20:01:43.729 > [WebSocket] Processing message type: heuristics_update
20:01:43.732 > [222.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.841 > [222.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:43.942 > [222.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.043 > [222.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.145 > [222.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.245 > [222.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.347 > [222.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.446 > [223.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.548 > [223.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.650 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301904599,"threatLevel":2,"type":"heuristics_update"}
20:01:44.680 > [WebSocket] Processing message type: heuristics_update
20:01:44.683 > [223.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.793 > [223.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.893 > [223.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:44.994 > [223.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.095 > [223.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.196 > [223.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.298 > [223.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.398 > [223.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.500 > [224.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.600 > [224.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.702 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301905600,"threatLevel":2,"type":"heuristics_update"}
20:01:45.732 > [WebSocket] Processing message type: heuristics_update
20:01:45.735 > [224.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.844 > [224.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:45.945 > [224.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.046 > [224.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.148 > [224.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.248 > [224.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.349 > [224.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.451 > [225.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.552 > [225.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.655 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301906610,"threatLevel":2,"type":"heuristics_update"}
20:01:46.685 > [WebSocket] Processing message type: heuristics_update
20:01:46.688 > [225.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.797 > [225.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.899 > [225.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:46.999 > [225.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.101 > [225.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.201 > [225.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.302 > [225.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.404 > [225.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.503 > [226.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.604 > [226.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.707 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301907622,"threatLevel":2,"type":"heuristics_update"}
20:01:47.737 > [WebSocket] Processing message type: heuristics_update
20:01:47.740 > [226.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.850 > [226.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:47.950 > [226.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.052 > [226.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.153 > [226.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.253 > [226.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.354 > [226.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.455 > [227.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.556 > [227.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.658 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301908636,"threatLevel":2,"type":"heuristics_update"}
20:01:48.688 > [WebSocket] Processing message type: heuristics_update
20:01:48.691 > [227.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.801 > [227.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:48.901 > [227.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.002 > [227.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.104 > [227.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.204 > [227.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.305 > [227.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.406 > [227.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.508 > [228.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.608 > [228.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.710 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301909645,"threatLevel":2,"type":"heuristics_update"}
20:01:49.740 > [WebSocket] Processing message type: heuristics_update
20:01:49.744 > [228.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.852 > [228.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:49.954 > [228.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.054 > [228.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.154 > [228.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.256 > [228.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.356 > [228.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.458 > [229.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.559 > [229.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.660 > [229.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.761 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301910657,"threatLevel":2,"type":"heuristics_update"}
20:01:50.792 > [WebSocket] Processing message type: heuristics_update
20:01:50.795 > [229.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:50.904 > [229.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.004 > [229.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.106 > [229.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.207 > [229.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.308 > [229.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.409 > [229.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.510 > [230.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.611 > [230.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.715 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":1,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301911666,"threatLevel":2,"type":"heuristics_update"}
20:01:51.747 > [WebSocket] Processing message type: heuristics_update
20:01:51.749 > [230.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.858 > [230.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 16 | WS: CONNECTED
20:01:51.864 > [RETRY] Attempting to send health data (Max retries: 3)
20:01:51.870 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 2 for all retry attempts (saved: 1)
20:01:51.886 > Generated health data: HR-63 SPO2-95 STEPS-1180
20:01:51.892 > [ESP32] ========================================
20:01:51.894 > [ESP32] ENCRYPTION PIPELINE START
20:01:51.899 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:01:51.902 > [ESP32] Active Algorithms for this packet:
20:01:51.908 > [ESP32]   + LFSR
20:01:51.908 > [ESP32]   - Tinkerbell
20:01:51.911 > [ESP32]   - Transposition
20:01:51.913 > [ESP32]   - ChaCha20
20:01:51.913 > [ESP32]   + Salsa20
20:01:51.917 > [ESP32] ========================================
20:01:51.922 > [ESP32] MsgKeys: lfsrSeed=0x61360CFC tnk[0..3]=20D696B6 trn[0..3]=C40495BD
20:01:51.928 > 1_After_Salt (26): 48522D36332053504F322D3935205354 4550532D313138304D50
20:01:51.933 > 2_After_Padding (32): 48522D36332053504F322D3935205354 4550532D313138304D50000000000000 
20:01:51.941 > [ESP32][LFSR] Initializing - Seed: 0x61360CFC SeedBe: 0xFC0C3661 ChaosKey[0..3]: 20D696B6 InitialTap: 0x0029 State: 0x61360CFC
20:01:51.953 > [ESP32][LFSR] Input (first 16 bytes): 48522D36332053504F322D3935205354 Buffer size: 32 bytes
20:01:51.961 > 3_After_LFSR (32): B45E1B5740ED61C65565B0B28B6E0F95 A83D5936344E824746AAA234E6F4C26D 
20:01:51.969 > [ESP32][LFSR] Keystream (first 16 bytes): FC0C366173CD32961A579D8BBE4E5CC1
20:01:51.975 > [ESP32][4D] LFSR keystream (first 32 bytes): FC0C366173CD32961A579D8BBE4E5CC1ED6D0A1B057FBA770BFAA234E6F4C26D
20:01:51.986 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:01:51.989 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:01:51.995 > [ESP32][SALSA20] Initializing - Nonce: 0x00000002
20:01:51.997 > [ESP32][SALSA20] Key (first 8 bytes): 4A6A30343E64485D
20:01:52.002 > [ESP32][SALSA20] Full Nonce (8 bytes): 0200000000000000
20:01:52.008 > [ESP32][SALSA20] Input (first 16 bytes): B45E1B5740ED61C65565B0B28B6E0F95
20:01:52.013 > 7_After_Salsa20 (32): 74C62A863D04A225B52841522F0D1FD2 FB17FBB7C18099DB77D5C4F5DE71B589 
20:01:52.022 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:01:52.028 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000002
20:01:52.033 > [ESP32] === HMAC DEBUG INFO ===
20:01:52.036 > [ESP32] HMAC Key being used: 4A6A30343E64485DBFA843A1B3DF3815DBF0C6497B88D4555E313645B9C56044
20:01:52.044 > [ESP32] HMAC Input length: 45 bytes
20:01:52.047 > [ESP32] HMAC Input (first 32 bytes): 8202180018000408030000000274C62A863D04A225B52841522F0D1FD2FB17FB
20:01:52.054 > [ESP32] Nonce: 0x00000002
20:01:52.058 > [ESP32] Packet size before HMAC: 61
20:01:52.061 > [ESP32] Computed HMAC Tag: 43E79EB655DDBEC410C73861A4834ED7
20:01:52.066 > [ESP32] === END HMAC DEBUG ===
20:01:52.069 > 6_Final_Packet (61): 8202180018000408030000000274C62A 863D04A225B52841522F0D1FD2FB17FB ...
20:01:52.078 > [RETRY] Attempt 1/3 (nonce: 2)
20:01:52.081 > POST http://10.249.92.115:8081/health-data with pipeline data
20:01:52.086 > Sending pipeline data to server (519 bytes)
20:01:52.334 > [HTTP] Response code: 200
20:01:52.334 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:01:52.347 > [RETRY] Health data sent successfully!
20:01:52.350 > ✓ Health data #17 sent successfully
20:01:52.449 > [WebSocket] Received (546 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:8202180018000408030000000274C62A863D04A225B52841522F0D1FD2FB17FBB7C18099DB77D5C4F5DE71B58943E79EB655DDBEC410C73861A4834ED7","pipeline":{"afterLFSR":"B45E1B5740ED61C65565B0B28B6E0F95A83D5936344E824746AAA234E6F4C26D","afterSalsa20":"74C62A863D04A225B52841522F0D1FD2FB17FBB7C18099DB77D5C4F5DE71B589","afterSalt":"48522D36332053504F322D39352053544550532D313138304D50"},"plaintext":"HR-63 SPO2-95 STEPS-1180","serverTime":1770301912155,"timestamp":230614,"type":"encryption_update","ztmEnabled":true}
20:01:52.499 > [WebSocket] Processing message type: encryption_update
20:01:52.502 > [231.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:52.602 > [WebSocket] Received (88 bytes): {"heartRate":63,"spo2":95,"steps":1180,"time":1770301912155,"type":"health_data_update"}
20:01:52.610 > [WebSocket] Processing message type: health_data_update
20:01:52.616 > [231.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:52.724 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.3554,"encryptionTime":0.0,"finalPlaintext":"HR-63 SPO2-95 STEPS-1180","handshakeSuccess":true,"totalTime":0.3554},"type":"session_summary_update"}
20:01:52.746 > [WebSocket] Processing message type: session_summary_update
20:01:52.752 > [231.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:52.857 > [WebSocket] Received (660 bytes): {"decryptionTime":0.3554,"encryptedPacket":"8202180018000408030000000274C62A863D04A225B52841522F0D1FD2FB17FBB7C18099DB77D5C4F5DE71B58943E79EB655DDBEC410C73861A4834ED7","finalPlaintext":"HR-63 SPO2-95 STEPS-1180","healthData":{"heartRate":63,"spo2":95,"steps":1180},"pipeline":{"afterDepad":"48522D36332053504F322D39352053544550532D31313830000000000000","afterLFSR":"48522D36332053504F322D39352053544550532D313138304D50000000000000","afterTinkerbell":"B45E1B5740ED61C65565B0B28B6E0F95A83D5936344E824746AAA234E6F4C26D","afterTransposition":"B45E1B5740ED61C65565B0B28B6E0F95A83D5936344E824746AAA234E6F4C26D"},"serverTime":1770301912156,"type":"decryption_update"}
20:01:52.915 > [WebSocket] Processing message type: decryption_update
20:01:52.921 > [WebSocket] Server decryption completed
20:01:52.923 > [WebSocket] Health data - HR: 63, SPO2: 95, Steps: 1180
20:01:52.929 > [231.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.031 > [WebSocket] Received (559 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":16,"pipeline":{"afterLFSR":"B45E1B5740ED61C65565B0B28B6E0F95A83D5936344E824746AAA234E6F4C26D","afterSalsa20":"74C62A863D04A225B52841522F0D1FD2FB17FBB7C18099DB77D5C4F5DE71B589","afterSalt":"48522D36332053504F322D39352053544550532D313138304D50","finalPacket":"8202180018000408030000000274C62A863D04A225B52841522F0D1FD2FB17FBB7C18099DB77D5C4F5DE71B58943E79EB655DDBEC410C73861A4834ED7"},"plaintext":"HR-63 SPO2-95 STEPS-1180","timestamp":230867,"type":"encryption_pipeline","ztmEnabled":true}
20:01:53.081 > [WebSocket] Processing message type: encryption_pipeline
20:01:53.086 > [231.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.193 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":16,"message":"Health data #17 sent successfully","state":7,"success":true,"timestamp":230871,"type":"health_data_sent"}
20:01:53.210 > [WebSocket] Processing message type: health_data_sent
20:01:53.213 > [231.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.315 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301912677,"threatLevel":2,"type":"heuristics_update"}
20:01:53.346 > [WebSocket] Processing message type: heuristics_update
20:01:53.349 > [231.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.458 > [232.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.559 > [232.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.660 > [232.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.764 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301913693,"threatLevel":2,"type":"heuristics_update"}
20:01:53.795 > [WebSocket] Processing message type: heuristics_update
20:01:53.797 > [232.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:53.906 > [232.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.007 > [232.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.108 > [232.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.209 > [232.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.310 > [232.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.411 > [232.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.512 > [233.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.613 > [233.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.714 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301914700,"threatLevel":2,"type":"heuristics_update"}
20:01:54.745 > [WebSocket] Processing message type: heuristics_update
20:01:54.748 > [233.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.857 > [233.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:54.958 > [233.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.059 > [233.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.160 > [233.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.261 > [233.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.362 > [233.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.463 > [234.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.564 > [234.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.665 > [234.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.766 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301915712,"threatLevel":2,"type":"heuristics_update"}
20:01:55.798 > [WebSocket] Processing message type: heuristics_update
20:01:55.800 > [234.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:55.909 > [234.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.010 > [234.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.110 > [234.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.212 > [234.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.314 > [234.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.414 > [234.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.514 > [235.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.616 > [235.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.717 > [235.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.822 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301916723,"threatLevel":2,"type":"heuristics_update"}
20:01:56.852 > [WebSocket] Processing message type: heuristics_update
20:01:56.854 > [235.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:56.964 > [235.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.065 > [235.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.166 > [235.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.267 > [235.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.368 > [235.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.469 > [236.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.570 > [236.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.671 > [236.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.772 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301917737,"threatLevel":2,"type":"heuristics_update"}
20:01:57.802 > [WebSocket] Processing message type: heuristics_update
20:01:57.806 > [236.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:57.915 > [236.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.016 > [236.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.117 > [236.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.218 > [236.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.319 > [236.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.420 > [237.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.521 > [237.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.622 > [237.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.723 > [237.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.829 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301918750,"threatLevel":2,"type":"heuristics_update"}
20:01:58.858 > [WebSocket] Processing message type: heuristics_update
20:01:58.862 > [237.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:58.971 > [237.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.072 > [237.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.173 > [237.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.275 > [237.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.376 > [237.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.476 > [238.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.577 > [238.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.678 > [238.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.779 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301919761,"threatLevel":2,"type":"heuristics_update"}
20:01:59.824 > [WebSocket] Processing message type: heuristics_update
20:01:59.824 > [238.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:01:59.921 > [238.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.023 > [238.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.123 > [238.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.225 > [238.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.326 > [238.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.426 > [239.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.528 > [239.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.629 > [239.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.730 > [239.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.832 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301920770,"threatLevel":2,"type":"heuristics_update"}
20:02:00.862 > [WebSocket] Processing message type: heuristics_update
20:02:00.864 > [239.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:00.974 > [239.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.075 > [239.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.176 > [239.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.277 > [239.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.378 > [239.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.479 > [240.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.580 > [240.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.680 > [240.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.781 > [240.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:01.883 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":2,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301921781,"threatLevel":2,"type":"heuristics_update"}
20:02:01.914 > [WebSocket] Processing message type: heuristics_update
20:02:01.917 > [240.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.026 > [240.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.126 > [240.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.228 > [240.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.329 > [240.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.430 > [241.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 17 | WS: CONNECTED
20:02:02.436 > [RETRY] Attempting to send health data (Max retries: 3)
20:02:02.440 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 3 for all retry attempts (saved: 2)
20:02:02.458 > Generated health data: HR-64 SPO2-95 STEPS-1210
20:02:02.463 > [ESP32] ========================================
20:02:02.466 > [ESP32] ENCRYPTION PIPELINE START
20:02:02.471 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:02:02.474 > [ESP32] Active Algorithms for this packet:
20:02:02.480 > [ESP32]   + LFSR
20:02:02.480 > [ESP32]   - Tinkerbell
20:02:02.482 > [ESP32]   - Transposition
20:02:02.485 > [ESP32]   - ChaCha20
20:02:02.485 > [ESP32]   + Salsa20
20:02:02.488 > [ESP32] ========================================
20:02:02.494 > [ESP32] MsgKeys: lfsrSeed=0xD717DD6D tnk[0..3]=80E9520C trn[0..3]=32292259
20:02:02.499 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313231304D50
20:02:02.505 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313231304D50000000000000 
20:02:02.512 > [ESP32][LFSR] Initializing - Seed: 0xD717DD6D SeedBe: 0x6DDD17D7 ChaosKey[0..3]: 80E9520C InitialTap: 0x0029 State: 0xD717DD6D
20:02:02.525 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
20:02:02.533 > 3_After_LFSR (32): 258F3AE1D2FF269690BF66C4CE984944 66FFEF7CA07D4B3A61C417D56E9D463E 
20:02:02.541 > [ESP32][LFSR] Keystream (first 16 bytes): 6DDD17D7E6DF75C6DF8D4BFDFBB81A10
20:02:02.546 > [ESP32][4D] LFSR keystream (first 32 bytes): 6DDD17D7E6DF75C6DF8D4BFDFBB81A1023AFBC51914F7A0A2C9417D56E9D463E
20:02:02.558 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:02:02.560 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:02:02.566 > [ESP32][SALSA20] Initializing - Nonce: 0x00000003
20:02:02.568 > [ESP32][SALSA20] Key (first 8 bytes): 4A6A30343E64485D
20:02:02.574 > [ESP32][SALSA20] Full Nonce (8 bytes): 0300000000000000
20:02:02.579 > [ESP32][SALSA20] Input (first 16 bytes): 258F3AE1D2FF269690BF66C4CE984944
20:02:02.586 > 7_After_Salsa20 (32): E5170B30AF16E5753C8351086AFB5903 35D54DFD55B350A6E22CF583561831DA 
20:02:02.593 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:02:02.599 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000003
20:02:02.604 > [ESP32] === HMAC DEBUG INFO ===
20:02:02.608 > [ESP32] HMAC Key being used: 4A6A30343E64485DBFA843A1B3DF3815DBF0C6497B88D4555E313645B9C56044
20:02:02.616 > [ESP32] HMAC Input length: 45 bytes
20:02:02.618 > [ESP32] HMAC Input (first 32 bytes): 82021800180004080300000003E5170B30AF16E5753C8351086AFB590335D54D
20:02:02.627 > [ESP32] Nonce: 0x00000003
20:02:02.629 > [ESP32] Packet size before HMAC: 61
20:02:02.631 > [ESP32] Computed HMAC Tag: 0B77FE36BB56BF85D8E439312BF88428
20:02:02.638 > [ESP32] === END HMAC DEBUG ===
20:02:02.640 > 6_Final_Packet (61): 82021800180004080300000003E5170B 30AF16E5753C8351086AFB590335D54D ...
20:02:02.649 > [RETRY] Attempt 1/3 (nonce: 3)
20:02:02.652 > POST http://10.249.92.115:8081/health-data with pipeline data
20:02:02.658 > Sending pipeline data to server (519 bytes)
20:02:02.967 > [HTTP] Response code: 200
20:02:02.967 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:02:02.978 > [RETRY] Health data sent successfully!
20:02:02.980 > ✓ Health data #18 sent successfully
20:02:03.082 > [WebSocket] Received (546 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021800180004080300000003E5170B30AF16E5753C8351086AFB590335D54DFD55B350A6E22CF583561831DA0B77FE36BB56BF85D8E439312BF88428","pipeline":{"afterLFSR":"258F3AE1D2FF269690BF66C4CE98494466FFEF7CA07D4B3A61C417D56E9D463E","afterSalsa20":"E5170B30AF16E5753C8351086AFB590335D54DFD55B350A6E22CF583561831DA","afterSalt":"48522D36342053504F322D39352053544550532D313231304D50"},"plaintext":"HR-64 SPO2-95 STEPS-1210","serverTime":1770301922739,"timestamp":241186,"type":"encryption_update","ztmEnabled":true}
20:02:03.132 > [WebSocket] Processing message type: encryption_update
20:02:03.135 > [241.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.236 > [WebSocket] Received (88 bytes): {"heartRate":64,"spo2":95,"steps":1210,"time":1770301922739,"type":"health_data_update"}
20:02:03.244 > [WebSocket] Processing message type: health_data_update
20:02:03.250 > [241.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.358 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.3595,"encryptionTime":0.0,"finalPlaintext":"HR-64 SPO2-95 STEPS-1210","handshakeSuccess":true,"totalTime":0.3595},"type":"session_summary_update"}
20:02:03.380 > [WebSocket] Processing message type: session_summary_update
20:02:03.386 > [241.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.490 > [WebSocket] Received (660 bytes): {"decryptionTime":0.3595,"encryptedPacket":"82021800180004080300000003E5170B30AF16E5753C8351086AFB590335D54DFD55B350A6E22CF583561831DA0B77FE36BB56BF85D8E439312BF88428","finalPlaintext":"HR-64 SPO2-95 STEPS-1210","healthData":{"heartRate":64,"spo2":95,"steps":1210},"pipeline":{"afterDepad":"48522D36342053504F322D39352053544550532D31323130000000000000","afterLFSR":"48522D36342053504F322D39352053544550532D313231304D50000000000000","afterTinkerbell":"258F3AE1D2FF269690BF66C4CE98494466FFEF7CA07D4B3A61C417D56E9D463E","afterTransposition":"258F3AE1D2FF269690BF66C4CE98494466FFEF7CA07D4B3A61C417D56E9D463E"},"serverTime":1770301922740,"type":"decryption_update"}
20:02:03.549 > [WebSocket] Processing message type: decryption_update
20:02:03.554 > [WebSocket] Server decryption completed
20:02:03.556 > [WebSocket] Health data - HR: 64, SPO2: 95, Steps: 1210
20:02:03.563 > [242.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.664 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301922793,"threatLevel":2,"type":"heuristics_update"}
20:02:03.695 > [WebSocket] Processing message type: heuristics_update
20:02:03.697 > [242.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.806 > [WebSocket] Received (559 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":17,"pipeline":{"afterLFSR":"258F3AE1D2FF269690BF66C4CE98494466FFEF7CA07D4B3A61C417D56E9D463E","afterSalsa20":"E5170B30AF16E5753C8351086AFB590335D54DFD55B350A6E22CF583561831DA","afterSalt":"48522D36342053504F322D39352053544550532D313231304D50","finalPacket":"82021800180004080300000003E5170B30AF16E5753C8351086AFB590335D54DFD55B350A6E22CF583561831DA0B77FE36BB56BF85D8E439312BF88428"},"plaintext":"HR-64 SPO2-95 STEPS-1210","timestamp":241500,"type":"encryption_pipeline","ztmEnabled":true}
20:02:03.856 > [WebSocket] Processing message type: encryption_pipeline
20:02:03.863 > [242.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:03.970 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":17,"message":"Health data #18 sent successfully","state":7,"success":true,"timestamp":241505,"type":"health_data_sent"}
20:02:03.987 > [WebSocket] Processing message type: health_data_sent
20:02:03.989 > [242.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.095 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301923805,"threatLevel":2,"type":"heuristics_update"}
20:02:04.125 > [WebSocket] Processing message type: heuristics_update
20:02:04.128 > [242.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.237 > [242.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.337 > [242.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.439 > [243.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.539 > [243.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.641 > [243.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.741 > [243.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.843 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301924815,"threatLevel":2,"type":"heuristics_update"}
20:02:04.873 > [WebSocket] Processing message type: heuristics_update
20:02:04.877 > [243.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:04.985 > [243.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.086 > [243.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.187 > [243.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.288 > [243.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.390 > [243.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.491 > [244.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.591 > [244.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.693 > [244.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.794 > [244.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:05.896 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301925823,"threatLevel":2,"type":"heuristics_update"}
20:02:05.926 > [WebSocket] Processing message type: heuristics_update
20:02:05.928 > [244.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.038 > [244.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.138 > [244.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.240 > [244.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.341 > [244.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.442 > [245.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.543 > [245.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.643 > [245.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.745 > [245.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.845 > [245.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:06.948 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301926836,"threatLevel":2,"type":"heuristics_update"}
20:02:06.978 > [WebSocket] Processing message type: heuristics_update
20:02:06.980 > [245.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.089 > [245.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.191 > [245.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.292 > [245.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.393 > [245.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.494 > [246.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.595 > [246.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.696 > [246.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.796 > [246.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:07.899 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301927841,"threatLevel":2,"type":"heuristics_update"}
20:02:07.929 > [WebSocket] Processing message type: heuristics_update
20:02:07.932 > [246.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.041 > [246.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.141 > [246.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.242 > [246.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.343 > [246.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.445 > [247.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.545 > [247.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.647 > [247.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.748 > [247.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.849 > [247.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:08.953 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301928853,"threatLevel":2,"type":"heuristics_update"}
20:02:08.983 > [WebSocket] Processing message type: heuristics_update
20:02:08.986 > [247.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.095 > [247.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.195 > [247.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.296 > [247.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.397 > [247.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.499 > [248.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.599 > [248.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.701 > [248.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.802 > [248.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:09.903 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301929864,"threatLevel":2,"type":"heuristics_update"}
20:02:09.934 > [WebSocket] Processing message type: heuristics_update
20:02:09.937 > [248.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.045 > [248.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.146 > [248.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.248 > [248.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.349 > [248.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.450 > [249.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.551 > [249.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.652 > [249.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.752 > [249.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.853 > [249.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:10.954 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301930868,"threatLevel":2,"type":"heuristics_update"}
20:02:10.986 > [WebSocket] Processing message type: heuristics_update
20:02:10.988 > [249.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.097 > [249.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.198 > [249.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.299 > [249.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.401 > [249.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.501 > [250.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.603 > [250.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.704 > [250.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.804 > [250.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:11.906 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301931876,"threatLevel":2,"type":"heuristics_update"}
20:02:11.937 > [WebSocket] Processing message type: heuristics_update
20:02:11.939 > [250.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.048 > [250.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.149 > [250.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.250 > [250.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.352 > [250.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.452 > [251.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.553 > [251.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.654 > [251.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.756 > [251.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.856 > [251.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:12.958 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":3,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301932885,"threatLevel":2,"type":"heuristics_update"}
20:02:12.989 > [WebSocket] Processing message type: heuristics_update
20:02:12.993 > [251.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 18 | WS: CONNECTED
20:02:13.005 > [RETRY] Attempting to send health data (Max retries: 3)
20:02:13.006 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 4 for all retry attempts (saved: 3)
20:02:13.023 > Generated health data: HR-64 SPO2-95 STEPS-1258
20:02:13.029 > [ESP32] ========================================
20:02:13.036 > [ESP32] ENCRYPTION PIPELINE START
20:02:13.036 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:02:13.038 > [ESP32] Active Algorithms for this packet:
20:02:13.044 > [ESP32]   + LFSR
20:02:13.044 > [ESP32]   - Tinkerbell
20:02:13.049 > [ESP32]   - Transposition
20:02:13.050 > [ESP32]   - ChaCha20
20:02:13.050 > [ESP32]   + Salsa20
20:02:13.052 > [ESP32] ========================================
20:02:13.059 > [ESP32] MsgKeys: lfsrSeed=0xF924E54B tnk[0..3]=26A9F3B0 trn[0..3]=B208564D
20:02:13.063 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313235384D50
20:02:13.069 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313235384D50000000000000 
20:02:13.078 > [ESP32][LFSR] Initializing - Seed: 0xF924E54B SeedBe: 0x4BE524F9 ChaosKey[0..3]: 26A9F3B0 InitialTap: 0x0029 State: 0xF924E54B
20:02:13.089 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
20:02:13.097 > 3_After_LFSR (32): 03B709CF511A2553353701057894ABA3 714EDF56DC2E7545C0B95BD77CACBE8C 
20:02:13.106 > [ESP32][LFSR] Keystream (first 16 bytes): 4BE524F9653A76037A052C3C4DB4F8F7
20:02:13.111 > [ESP32][4D] LFSR keystream (first 32 bytes): 4BE524F9653A76037A052C3C4DB4F8F7341E8C7BED1C407D8DE95BD77CACBE8C
20:02:13.119 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:02:13.125 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:02:13.130 > [ESP32][SALSA20] Initializing - Nonce: 0x00000004
20:02:13.133 > [ESP32][SALSA20] Key (first 8 bytes): 4A6A30343E64485D
20:02:13.139 > [ESP32][SALSA20] Full Nonce (8 bytes): 0400000000000000
20:02:13.144 > [ESP32][SALSA20] Input (first 16 bytes): 03B709CF511A2553353701057894ABA3
20:02:13.150 > 7_After_Salsa20 (32): C32F381E2CF3E6B07B38321FDCF7BBE4 22647DD729E06ED9AE50936C4429C968 
20:02:13.158 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:02:13.163 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000004
20:02:13.169 > [ESP32] === HMAC DEBUG INFO ===
20:02:13.172 > [ESP32] HMAC Key being used: 4A6A30343E64485DBFA843A1B3DF3815DBF0C6497B88D4555E313645B9C56044
20:02:13.181 > [ESP32] HMAC Input length: 45 bytes
20:02:13.183 > [ESP32] HMAC Input (first 32 bytes): 82021800180004080300000004C32F381E2CF3E6B07B38321FDCF7BBE422647D
20:02:13.191 > [ESP32] Nonce: 0x00000004
20:02:13.194 > [ESP32] Packet size before HMAC: 61
20:02:13.197 > [ESP32] Computed HMAC Tag: 4ADE16DC2B479152C2F942491D815F44
20:02:13.202 > [ESP32] === END HMAC DEBUG ===
20:02:13.205 > 6_Final_Packet (61): 82021800180004080300000004C32F38 1E2CF3E6B07B38321FDCF7BBE422647D ...
20:02:13.214 > [RETRY] Attempt 1/3 (nonce: 4)
20:02:13.216 > POST http://10.249.92.115:8081/health-data with pipeline data
20:02:13.222 > Sending pipeline data to server (519 bytes)
20:02:13.368 > [HTTP] Response code: 200
20:02:13.368 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:02:13.381 > [RETRY] Health data sent successfully!
20:02:13.385 > ✓ Health data #19 sent successfully
20:02:13.486 > [WebSocket] Received (182 bytes): {"currentMode":"normal","decrypt_failures":0,"esp32_connected":true,"hmac_failures":0,"replay_attempts":0,"requests_per_minute":1,"serverTime":1770301933311,"type":"security_update"}
20:02:13.502 > [WebSocket] Processing message type: security_update
20:02:13.508 > [WebSocket] Security update - Mode: normal, ESP32 Connected: true
20:02:13.514 > [252.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:13.619 > [WebSocket] Received (546 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021800180004080300000004C32F381E2CF3E6B07B38321FDCF7BBE422647DD729E06ED9AE50936C4429C9684ADE16DC2B479152C2F942491D815F44","pipeline":{"afterLFSR":"03B709CF511A2553353701057894ABA3714EDF56DC2E7545C0B95BD77CACBE8C","afterSalsa20":"C32F381E2CF3E6B07B38321FDCF7BBE422647DD729E06ED9AE50936C4429C968","afterSalt":"48522D36342053504F322D39352053544550532D313235384D50"},"plaintext":"HR-64 SPO2-95 STEPS-1258","serverTime":1770301933311,"timestamp":251746,"type":"encryption_update","ztmEnabled":true}
20:02:13.669 > [WebSocket] Processing message type: encryption_update
20:02:13.671 > [252.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:13.781 > [WebSocket] Received (88 bytes): {"heartRate":64,"spo2":95,"steps":1258,"time":1770301933311,"type":"health_data_update"}
20:02:13.790 > [WebSocket] Processing message type: health_data_update
20:02:13.796 > [252.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:13.903 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2848,"encryptionTime":0.0,"finalPlaintext":"HR-64 SPO2-95 STEPS-1258","handshakeSuccess":true,"totalTime":0.2848},"type":"session_summary_update"}
20:02:13.926 > [WebSocket] Processing message type: session_summary_update
20:02:13.932 > [252.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.036 > [WebSocket] Received (660 bytes): {"decryptionTime":0.2848,"encryptedPacket":"82021800180004080300000004C32F381E2CF3E6B07B38321FDCF7BBE422647DD729E06ED9AE50936C4429C9684ADE16DC2B479152C2F942491D815F44","finalPlaintext":"HR-64 SPO2-95 STEPS-1258","healthData":{"heartRate":64,"spo2":95,"steps":1258},"pipeline":{"afterDepad":"48522D36342053504F322D39352053544550532D31323538000000000000","afterLFSR":"48522D36342053504F322D39352053544550532D313235384D50000000000000","afterTinkerbell":"03B709CF511A2553353701057894ABA3714EDF56DC2E7545C0B95BD77CACBE8C","afterTransposition":"03B709CF511A2553353701057894ABA3714EDF56DC2E7545C0B95BD77CACBE8C"},"serverTime":1770301933312,"type":"decryption_update"}
20:02:14.095 > [WebSocket] Processing message type: decryption_update
20:02:14.101 > [WebSocket] Server decryption completed
20:02:14.103 > [WebSocket] Health data - HR: 64, SPO2: 95, Steps: 1258
20:02:14.109 > [252.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.211 > [WebSocket] Received (559 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":18,"pipeline":{"afterLFSR":"03B709CF511A2553353701057894ABA3714EDF56DC2E7545C0B95BD77CACBE8C","afterSalsa20":"C32F381E2CF3E6B07B38321FDCF7BBE422647DD729E06ED9AE50936C4429C968","afterSalt":"48522D36342053504F322D39352053544550532D313235384D50","finalPacket":"82021800180004080300000004C32F381E2CF3E6B07B38321FDCF7BBE422647DD729E06ED9AE50936C4429C9684ADE16DC2B479152C2F942491D815F44"},"plaintext":"HR-64 SPO2-95 STEPS-1258","timestamp":251902,"type":"encryption_pipeline","ztmEnabled":true}
20:02:14.261 > [WebSocket] Processing message type: encryption_pipeline
20:02:14.265 > [252.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.374 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":18,"message":"Health data #19 sent successfully","state":7,"success":true,"timestamp":251906,"type":"health_data_sent"}
20:02:14.390 > [WebSocket] Processing message type: health_data_sent
20:02:14.394 > [252.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.495 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301933893,"threatLevel":2,"type":"heuristics_update"}
20:02:14.527 > [WebSocket] Processing message type: heuristics_update
20:02:14.529 > [253.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.639 > [253.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.739 > [253.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.841 > [253.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:14.944 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301934897,"threatLevel":2,"type":"heuristics_update"}
20:02:14.975 > [WebSocket] Processing message type: heuristics_update
20:02:14.978 > [253.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.086 > [253.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.187 > [253.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.289 > [253.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.390 > [253.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.490 > [254.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.591 > [254.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.693 > [254.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.793 > [254.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.895 > [254.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:15.996 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301935908,"threatLevel":2,"type":"heuristics_update"}
20:02:16.026 > [WebSocket] Processing message type: heuristics_update
20:02:16.029 > [254.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.139 > [254.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.239 > [254.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.340 > [254.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.442 > [255.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.542 > [255.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.644 > [255.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.745 > [255.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.846 > [255.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:16.947 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301936913,"threatLevel":2,"type":"heuristics_update"}
20:02:16.978 > [WebSocket] Processing message type: heuristics_update
20:02:16.980 > [255.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.090 > [255.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.190 > [255.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.291 > [255.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.393 > [255.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.494 > [256.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.595 > [256.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.695 > [256.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.796 > [256.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.898 > [256.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:17.999 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301937921,"threatLevel":2,"type":"heuristics_update"}
20:02:18.029 > [WebSocket] Processing message type: heuristics_update
20:02:18.031 > [256.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.141 > [256.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.242 > [256.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.343 > [256.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.444 > [257.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.546 > [257.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.646 > [257.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.748 > [257.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.848 > [257.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:18.950 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301938932,"threatLevel":2,"type":"heuristics_update"}
20:02:18.981 > [WebSocket] Processing message type: heuristics_update
20:02:18.983 > [257.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.093 > [257.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.194 > [257.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.295 > [257.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.395 > [257.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.497 > [258.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.598 > [258.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.699 > [258.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.800 > [258.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:19.900 > [258.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.004 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301939948,"threatLevel":2,"type":"heuristics_update"}
20:02:20.035 > [WebSocket] Processing message type: heuristics_update
20:02:20.038 > [258.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.146 > [258.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.247 > [258.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.348 > [258.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.449 > [259.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.550 > [259.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.652 > [259.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.752 > [259.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.853 > [259.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:20.954 > [259.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.056 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301940959,"threatLevel":2,"type":"heuristics_update"}
20:02:21.086 > [WebSocket] Processing message type: heuristics_update
20:02:21.089 > [259.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.199 > [259.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.299 > [259.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.401 > [259.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.501 > [260.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.602 > [260.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.703 > [260.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.804 > [260.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:21.906 > [260.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.006 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301941970,"threatLevel":2,"type":"heuristics_update"}
20:02:22.037 > [WebSocket] Processing message type: heuristics_update
20:02:22.040 > [260.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.149 > [260.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.250 > [260.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.352 > [260.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.452 > [261.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.553 > [261.1] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.654 > [261.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.756 > [261.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.857 > [261.4] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:22.956 > [261.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:23.059 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":4,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301942979,"threatLevel":2,"type":"heuristics_update"}
20:02:23.090 > [WebSocket] Processing message type: heuristics_update
20:02:23.092 > [261.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:23.202 > [261.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:23.302 > [261.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:23.403 > [261.9] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 19 | WS: CONNECTED
20:02:23.409 > [RETRY] Attempting to send health data (Max retries: 3)
20:02:23.414 > [BOUNDARY_CHECK] SwitchState=0 PendingActive=0 CommitNonce=51539607553\n[BOUNDARY_CHECK] Not ready to apply: SwitchState=0, PendingActive=0\n[RETRY] Using nonce 5 for all retry attempts (saved: 4)
20:02:23.431 > Generated health data: HR-64 SPO2-95 STEPS-1317
20:02:23.437 > [ESP32] ========================================
20:02:23.439 > [ESP32] ENCRYPTION PIPELINE START
20:02:23.444 > [ESP32] Mode: ZTM | ZTM Enabled: TRUE | Recipe: SALSA_LIGHT
20:02:23.448 > [ESP32] Active Algorithms for this packet:
20:02:23.453 > [ESP32]   + LFSR
20:02:23.453 > [ESP32]   - Tinkerbell
20:02:23.456 > [ESP32]   - Transposition
20:02:23.459 > [ESP32]   - ChaCha20
20:02:23.459 > [ESP32]   + Salsa20
20:02:23.461 > [ESP32] ========================================
20:02:23.467 > [ESP32] MsgKeys: lfsrSeed=0x05C92267 tnk[0..3]=538DD0A2 trn[0..3]=B4C0D4AC
20:02:23.473 > 1_After_Salt (26): 48522D36342053504F322D3935205354 4550532D313331374D50
20:02:23.478 > 2_After_Padding (32): 48522D36342053504F322D3935205354 4550532D313331374D50000000000000 
20:02:23.487 > [ESP32][LFSR] Initializing - Seed: 0x05C92267 SeedBe: 0x6722C905 ChaosKey[0..3]: 538DD0A2 InitialTap: 0x0029 State: 0x05C92267
20:02:23.497 > [ESP32][LFSR] Input (first 16 bytes): 48522D36342053504F322D3935205354 Buffer size: 32 bytes
20:02:23.506 > 3_After_LFSR (32): 2F70E43351A86C941B98E51F2EBAFCFE 931C5093A47641AF5F4D7D20EEEEDE58 
20:02:23.514 > [ESP32][LFSR] Keystream (first 16 bytes): 6722C90565883FC454AAC8261B9AAFAA
20:02:23.520 > [ESP32][4D] LFSR keystream (first 32 bytes): 6722C90565883FC454AAC8261B9AAFAAD64C03BE95457098121D7D20EEEEDE58
20:02:23.531 > [ESP32][TINKERBELL] SKIPPED (recipe: SALSA_LIGHT)
20:02:23.533 > [ESP32][TRANSPOSITION] SKIPPED (recipe: SALSA_LIGHT)
20:02:23.539 > [ESP32][SALSA20] Initializing - Nonce: 0x00000005
20:02:23.542 > [ESP32][SALSA20] Key (first 8 bytes): 4A6A30343E64485D
20:02:23.548 > [ESP32][SALSA20] Full Nonce (8 bytes): 0500000000000000
20:02:23.553 > [ESP32][SALSA20] Input (first 16 bytes): 2F70E43351A86C941B98E51F2EBAFCFE
20:02:23.559 > 7_After_Salsa20 (32): EFE8D5E22C41AF77032BE3448AD9ECB9 C036F21251B85A332B463858D66BA9BC 
20:02:23.567 > [ESP32][SALSA20] Encryption complete - Output size: 32 bytes
20:02:23.573 > [ESP32][4B] recipeId=3 (SALSA_LIGHT) nonce=0x00000005
20:02:23.578 > [ESP32] === HMAC DEBUG INFO ===
20:02:23.581 > [ESP32] HMAC Key being used: 4A6A30343E64485DBFA843A1B3DF3815DBF0C6497B88D4555E313645B9C56044
20:02:23.589 > [ESP32] HMAC Input length: 45 bytes
20:02:23.592 > [ESP32] HMAC Input (first 32 bytes): 82021800180004080300000005EFE8D5E22C41AF77032BE3448AD9ECB9C036F2
20:02:23.600 > [ESP32] Nonce: 0x00000005
20:02:23.603 > [ESP32] Packet size before HMAC: 61
20:02:23.606 > [ESP32] Computed HMAC Tag: 19483CA73E363494264368FE83823723
20:02:23.612 > [ESP32] === END HMAC DEBUG ===
20:02:23.614 > 6_Final_Packet (61): 82021800180004080300000005EFE8D5 E22C41AF77032BE3448AD9ECB9C036F2 ...
20:02:23.622 > [RETRY] Attempt 1/3 (nonce: 5)
20:02:23.625 > POST http://10.249.92.115:8081/health-data with pipeline data
20:02:23.631 > Sending pipeline data to server (519 bytes)
20:02:23.886 > [HTTP] Response code: 200
20:02:23.886 > [HTTP] Response: {"status":"OK:DECRYPTED"}
20:02:23.898 > [RETRY] Health data sent successfully!
20:02:23.901 > ✓ Health data #20 sent successfully
20:02:24.002 > [WebSocket] Received (546 bytes): {"currentRecipe":"SALSA_LIGHT","encData":"ENC_DATA:82021800180004080300000005EFE8D5E22C41AF77032BE3448AD9ECB9C036F21251B85A332B463858D66BA9BC19483CA73E363494264368FE83823723","pipeline":{"afterLFSR":"2F70E43351A86C941B98E51F2EBAFCFE931C5093A47641AF5F4D7D20EEEEDE58","afterSalsa20":"EFE8D5E22C41AF77032BE3448AD9ECB9C036F21251B85A332B463858D66BA9BC","afterSalt":"48522D36342053504F322D39352053544550532D313331374D50"},"plaintext":"HR-64 SPO2-95 STEPS-1317","serverTime":1770301943704,"timestamp":262160,"type":"encryption_update","ztmEnabled":true}
20:02:24.052 > [WebSocket] Processing message type: encryption_update
20:02:24.054 > [262.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:24.062 > Reached MAX_PACKETS limit; pausing transmissions
20:02:26.166 > [WebSocket] Received (88 bytes): {"heartRate":64,"spo2":95,"steps":1317,"time":1770301943704,"type":"health_data_update"}
20:02:26.175 > [WebSocket] Processing message type: health_data_update
20:02:26.181 > [264.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:26.189 > Reached MAX_PACKETS limit; pausing transmissions
20:02:28.288 > [WebSocket] Received (226 bytes): {"sessionSummary":{"adaptiveMode":"normal","dataStored":true,"decryptionTime":0.2436,"encryptionTime":0.0,"finalPlaintext":"HR-64 SPO2-95 STEPS-1317","handshakeSuccess":true,"totalTime":0.2436},"type":"session_summary_update"}
20:02:28.311 > [WebSocket] Processing message type: session_summary_update
20:02:28.316 > [266.8] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:28.324 > Reached MAX_PACKETS limit; pausing transmissions
20:02:30.421 > [WebSocket] Received (660 bytes): {"decryptionTime":0.2436,"encryptedPacket":"82021800180004080300000005EFE8D5E22C41AF77032BE3448AD9ECB9C036F21251B85A332B463858D66BA9BC19483CA73E363494264368FE83823723","finalPlaintext":"HR-64 SPO2-95 STEPS-1317","healthData":{"heartRate":64,"spo2":95,"steps":1317},"pipeline":{"afterDepad":"48522D36342053504F322D39352053544550532D31333137000000000000","afterLFSR":"48522D36342053504F322D39352053544550532D313331374D50000000000000","afterTinkerbell":"2F70E43351A86C941B98E51F2EBAFCFE931C5093A47641AF5F4D7D20EEEEDE58","afterTransposition":"2F70E43351A86C941B98E51F2EBAFCFE931C5093A47641AF5F4D7D20EEEEDE58"},"serverTime":1770301943705,"type":"decryption_update"}
20:02:30.479 > [WebSocket] Processing message type: decryption_update
20:02:30.485 > [WebSocket] Server decryption completed
20:02:30.487 > [WebSocket] Health data - HR: 64, SPO2: 95, Steps: 1317
20:02:30.493 > [269.0] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:30.501 > Reached MAX_PACKETS limit; pausing transmissions
20:02:32.604 > [WebSocket] Received (559 bytes): {"currentRecipe":"SALSA_LIGHT","deviceId":"f9641d44","healthSendCount":19,"pipeline":{"afterLFSR":"2F70E43351A86C941B98E51F2EBAFCFE931C5093A47641AF5F4D7D20EEEEDE58","afterSalsa20":"EFE8D5E22C41AF77032BE3448AD9ECB9C036F21251B85A332B463858D66BA9BC","afterSalt":"48522D36342053504F322D39352053544550532D313331374D50","finalPacket":"82021800180004080300000005EFE8D5E22C41AF77032BE3448AD9ECB9C036F21251B85A332B463858D66BA9BC19483CA73E363494264368FE83823723"},"plaintext":"HR-64 SPO2-95 STEPS-1317","timestamp":262420,"type":"encryption_pipeline","ztmEnabled":true}
20:02:32.654 > [WebSocket] Processing message type: encryption_pipeline
20:02:32.660 > [271.2] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:32.668 > Reached MAX_PACKETS limit; pausing transmissions
20:02:34.767 > [WebSocket] Received (160 bytes): {"deviceId":"f9641d44","healthSendCount":19,"message":"Health data #20 sent successfully","state":7,"success":true,"timestamp":262424,"type":"health_data_sent"}
20:02:34.784 > [WebSocket] Processing message type: health_data_sent
20:02:34.786 > [273.3] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:34.795 > Reached MAX_PACKETS limit; pausing transmissions
20:02:36.900 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301943992,"threatLevel":2,"type":"heuristics_update"}
20:02:36.929 > [WebSocket] Processing message type: heuristics_update
20:02:36.932 > [275.5] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:36.941 > Reached MAX_PACKETS limit; pausing transmissions
20:02:39.042 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301945006,"threatLevel":2,"type":"heuristics_update"}
20:02:39.073 > [WebSocket] Processing message type: heuristics_update
20:02:39.076 > [277.6] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:39.093 > Reached MAX_PACKETS limit; pausing transmissions
20:02:41.185 > [WebSocket] Received (323 bytes): {"currentRecipe":"SALSA_LIGHT","epoch":17,"lastCommitNonce":51539607553,"lastSeenNonce":5,"metrics":{"cpuPercent":20.0,"decryptFailures":0,"entropyAfter":6.8,"hmacFailures":0,"latencyMs":52.0,"malformedPackets":0,"replayAttempts":0,"timingAnomalies":0},"serverTime":1770301946008,"threatLevel":2,"type":"heuristics_update"}
20:02:41.216 > [WebSocket] Processing message type: heuristics_update
20:02:41.218 > [279.7] STATE: SEND_HEALTH_DATA | WiFi: OK | MasterKey: READY | HealthSent: 20 | WS: CONNECTED
20:02:41.226 > Reached MAX_PACKETS limit; pausing transmissions
